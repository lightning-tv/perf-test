var Ts=Object.defineProperty;var ys=(s,t,e)=>t in s?Ts(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var l=(s,t,e)=>ys(s,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function e(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(i){if(i.ep)return;i.ep=!0;const n=e(i);fetch(i.href,n)}})();const vs={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1};function _s(s,t=!1,e){const r={alpha:!0,antialias:!1,depth:!1,stencil:!0,desynchronized:!1,powerPreference:"high-performance",premultipliedAlpha:!0,preserveDrawingBuffer:!1},i=s.getContext(t?"webgl2":"webgl",r)||s.getContext("experimental-webgl",r);if(!i)throw new Error("Unable to create WebGL context");return e?new Proxy(i,{get(n,o){const a=n[o];return typeof a=="function"?(e.increment(String(o)),a.bind(n)):a}}):i}function M(s,t){if(Xe()!==!0&&!s)throw new Error(t||"Assertion failed")}function yr(s,t,e){const r=Math.trunc(s>>>24),i=Math.trunc(s>>>16&255),n=Math.trunc(s>>>8&255),o=Math.trunc(s&255),a=Math.trunc(t>>>24),h=Math.trunc(t>>>16&255),u=Math.trunc(t>>>8&255),d=Math.trunc(t&255),c=Math.round(a*e+r*(1-e)),p=Math.round(h*e+i*(1-e)),f=Math.round(u*e+n*(1-e)),_=Math.round(d*e+o*(1-e));return(c<<24|p<<16|f<<8|_)>>>0}let zr=!0;function Rs(s){zr=s==="webgl"}function qe(s,t,e=!1){const r=(s&255)/255*t,i=zr?r:1,n=Math.trunc((s>>>24)*i),o=Math.trunc((s>>>16&255)*i),a=Math.trunc((s>>>8&255)*i),h=Math.trunc(r*255);return e?(h<<24|a<<16|o<<8|n)>>>0:(n<<24|o<<16|a<<8|h)>>>0}function xt(s,t){return Object.prototype.hasOwnProperty.call(s,t)}function Xe(){return vs&&!0}let ws=1;function bs(){return ws++}class Ae{constructor(){l(this,"eventListeners",{})}on(t,e){let r=this.eventListeners[t];r||(r=[]),r.push(e),this.eventListeners[t]=r}off(t,e){const r=this.eventListeners[t];if(!r)return;if(!e){delete this.eventListeners[t];return}const i=r.indexOf(e);i>=0&&r.splice(i,1)}once(t,e){const r=(i,n)=>{this.off(t,r),e(i,n)};this.on(t,r)}emit(t,e){const r=this.eventListeners[t];r&&[...r].forEach(i=>{i(this,e)})}removeAllListeners(){this.eventListeners={}}}var W;(function(s){s[s.generic=0]="generic",s[s.color=1]="color",s[s.image=2]="image",s[s.noise=3]="noise",s[s.renderToTexture=4]="renderToTexture",s[s.subTexture=5]="subTexture"})(W||(W={}));class Ge extends Ae{constructor(e){super();l(this,"txManager");l(this,"dimensions",null);l(this,"error",null);l(this,"state","initial");l(this,"renderableOwners",new Set);l(this,"renderable",!1);l(this,"type",W.generic);l(this,"preventCleanup",!1);l(this,"ctxTexture");l(this,"textureData",null);this.txManager=e}setRenderableOwner(e,r){var n,o;const i=this.renderableOwners.size;if(r===!0){this.renderableOwners.has(e)===!1&&this.renderableOwners.add(e);const a=this.renderableOwners.size;a>i&&a===1&&(this.renderable=!0,(n=this.onChangeIsRenderable)==null||n.call(this,!0),this.load())}else{this.renderableOwners.delete(e);const a=this.renderableOwners.size;a<i&&a===0&&(this.renderable=!1,(o=this.onChangeIsRenderable)==null||o.call(this,!1),this.txManager.orphanTexture(this))}}load(){this.txManager.loadTexture(this)}loadCtxTexture(){return this.ctxTexture===void 0&&(this.ctxTexture=this.txManager.renderer.createCtxTexture(this)),this.ctxTexture}free(){var e;(e=this.ctxTexture)==null||e.free()}freeTextureData(){this.textureData=null}setState(e,r){if(this.state===e)return;let i=null;e==="loaded"?(this.dimensions=r,i=this.dimensions):e==="failed"&&(this.error=r,i=this.error),this.state=e,this.emit(e,i)}async getTextureData(){return this.textureData===null&&(this.textureData=await this.getTextureSource()),this.textureData}static makeCacheKey(e){return!1}static resolveDefaults(e){return{}}}const Ss=/^(data|ftps?|https?):/,Pt=s=>{const t=s>>>24,e=s>>>16&255,r=s>>>8&255,i=s&255;return[t/255,e/255,r/255,i/255]};function Se(s,t,e,r,i){return i?(i.x1=s,i.y1=t,i.x2=e,i.y2=r,i):{x1:s,y1:t,x2:e,y2:r}}function Es(s,t,e){const r=Math.max(s.x,t.x),i=Math.max(s.y,t.y),n=Math.min(s.x+s.width,t.x+t.width)-r,o=Math.min(s.y+s.height,t.y+t.height)-i;return n>0&&o>0?e?(e.x=r,e.y=i,e.width=n,e.height=o,e):{x:r,y:i,width:n,height:o}:e?(e.x=0,e.y=0,e.width=0,e.height=0,e):{x:0,y:0,width:0,height:0}}function Cs(s,t){return t?(t.x=s.x,t.y=s.y,t.width=s.width,t.height=s.height,t):{x:s.x,y:s.y,width:s.width,height:s.height}}function As(s,t){return s===t?!0:s===null||t===null?!1:s.x===t.x&&s.y===t.y&&s.width===t.width&&s.height===t.height}function Nt(s,t){return s.x1<=t.x2&&s.y1<=t.y2&&s.x2>=t.x1&&s.y2>=t.y1}function Ms(s,t){return s.x1<t.x1&&s.x2>t.x2&&s.y1<t.y1&&s.y2>t.y2}function Kt(s,t){return Se(s.x1-t[3],s.y1-t[0],s.x2+t[1],s.y2+t[2])}function Is(s){if(self.location.protocol==="file:"&&!Ss.test(s)){const e=self.location.pathname.split("/");e.pop();const r=e.join("/"),i=self.location.protocol+"//"+r;return s.charAt(0)==="."&&(s=s.slice(1)),s.charAt(0)==="/"&&(s=s.slice(1)),i+"/"+s}return new URL(s,self.location.href).href}function vr(s){return s.startsWith("data:")===!0}class G{constructor(){l(this,"ta");l(this,"tb");l(this,"tx");l(this,"tc");l(this,"td");l(this,"ty");l(this,"_floatArr",null);l(this,"mutation");this.ta=0,this.tb=0,this.tx=0,this.tc=0,this.td=0,this.ty=0,this.mutation=!0}static get temp(){return Ps}static multiply(t,e,r){const i=t.ta*e.ta+t.tb*e.tc,n=t.ta*e.tb+t.tb*e.td,o=t.ta*e.tx+t.tb*e.ty+t.tx,a=t.tc*e.ta+t.td*e.tc,h=t.tc*e.tb+t.td*e.td,u=t.tc*e.tx+t.td*e.ty+t.ty;return r||(r=new G),r.ta=i,r.tb=n,r.tx=o,r.tc=a,r.td=h,r.ty=u,r.mutation=!0,r}static identity(t){return t||(t=new G),t.ta=1,t.tb=0,t.tx=0,t.tc=0,t.td=1,t.ty=0,t.mutation=!0,t}static translate(t,e,r){return r||(r=new G),r.ta=1,r.tb=0,r.tx=t,r.tc=0,r.td=1,r.ty=e,r.mutation=!0,r}static scale(t,e,r){return r||(r=new G),r.ta=t,r.tb=0,r.tx=0,r.tc=0,r.td=e,r.ty=0,r.mutation=!0,r}static rotate(t,e){const r=Math.cos(t),i=Math.sin(t);return e||(e=new G),e.ta=r,e.tb=-i,e.tx=0,e.tc=i,e.td=r,e.ty=0,e.mutation=!0,e}static copy(t,e){return e||(e=new G),e.ta=t.ta,e.tc=t.tc,e.tb=t.tb,e.td=t.td,e.tx=t.tx,e.ty=t.ty,e.mutation=!0,e}translate(t,e){return this.tx=this.ta*t+this.tb*e+this.tx,this.ty=this.tc*t+this.td*e+this.ty,this.mutation=!0,this}scale(t,e){return this.ta=this.ta*t,this.tb=this.tb*e,this.tc=this.tc*t,this.td=this.td*e,this.mutation=!0,this}rotate(t){if(t===0||!(t%Math.PI*2))return this;const e=Math.cos(t),r=Math.sin(t),i=this.ta*e+this.tb*r,n=this.tb*e-this.ta*r,o=this.tc*e+this.td*r,a=this.td*e-this.tc*r;return this.ta=i,this.tb=n,this.tc=o,this.td=a,this.mutation=!0,this}multiply(t){return G.multiply(this,t,this)}getFloatArr(){return this._floatArr||(this._floatArr=new Float32Array(9)),this.mutation&&(this._floatArr[0]=this.ta,this._floatArr[1]=this.tc,this._floatArr[2]=0,this._floatArr[3]=this.tb,this._floatArr[4]=this.td,this._floatArr[5]=0,this._floatArr[6]=this.tx,this._floatArr[7]=this.ty,this._floatArr[8]=1,this.mutation=!1),this._floatArr}}const Ps=new G,Ke=0,Qe=2,je=4,Ze=6,Je=1,et=3,tt=5,rt=7;class Tt{constructor(t){l(this,"data");this.data=new Float32Array(8),t&&(this.data[Ke]=t[Ke],this.data[Qe]=t[Qe],this.data[je]=t[je],this.data[Ze]=t[Ze],this.data[Je]=t[Je],this.data[et]=t[et],this.data[tt]=t[tt],this.data[rt]=t[rt])}static translate(t,e,r,i,n,o,a,h,u){return u||(u=new Tt),u.data[Ke]=t,u.data[Qe]=r,u.data[je]=n,u.data[Ze]=a,u.data[Je]=e,u.data[et]=i,u.data[tt]=o,u.data[rt]=h,u}get x1(){return this.data[Ke]}get x2(){return this.data[Qe]}get x3(){return this.data[je]}get x4(){return this.data[Ze]}get y1(){return this.data[Je]}get y2(){return this.data[et]}get y3(){return this.data[tt]}get y4(){return this.data[rt]}}const Vr=(s,t,e,r)=>{const i=3*s,n=3*(e-s)-i,o=1-i-n,a=3*t,h=3*(r-t)-a,u=1-a-h;return function(d){if(d>=1)return 1;if(d<=0)return 0;let c=.5,p,f,_;for(let b=0;b<20;b++){if(p=c*(c*(c*o+n)+i),_=d-p,_>-1e-8&&_<1e-8)return c*(c*(c*u+h)+a);if(f=c*(c*(3*o)+2*n)+i,f>1e-10&&f<1e-10)break;c+=_/f}let T=0,w=1;for(let b=0;b<20;b++){if(c=.5*(T+w),p=c*(c*(c*o+n)+i),_=d-p,_>-1e-8&&_<1e-8)return c*(c*(c*u+h)+a);_<0?w=c:T=c}}},ct={},Bs={ease:[.25,.1,.25,1],"ease-in":[.42,0,1,1],"ease-out":[0,0,.58,1],"ease-in-out":[.42,0,.58,1],"ease-in-sine":[.12,0,.39,0],"ease-out-sine":[.12,0,.39,0],"ease-in-out-sine":[.37,0,.63,1],"ease-in-cubic":[.32,0,.67,0],"ease-out-cubic":[.33,1,.68,1],"ease-in-out-cubic":[.65,0,.35,1],"ease-in-circ":[.55,0,1,.45],"ease-out-circ":[0,.55,.45,1],"ease-in-out-circ":[.85,0,.15,1],"ease-in-back":[.36,0,.66,-.56],"ease-out-back":[.34,1.56,.64,1],"ease-in-out-back":[.68,-.6,.32,1.6]},dt=s=>s,Ls=s=>{const t=/-?\d*\.?\d+/g,e=s.match(t);if(e){const[r,i,n,o]=e,a=parseFloat(r||"0.42"),h=parseFloat(i||"0"),u=parseFloat(n||"1"),d=parseFloat(o||"1"),c=Vr(a,h,u,d);return ct[s]=c,c}return console.warn("Unknown cubic-bezier timing: "+s),dt},Os=s=>{if(s==="linear")return dt;if(ct[s]!==void 0)return ct[s]||dt;if(s==="step-start")return()=>1;if(s==="step-end")return e=>e===1?1:0;const t=Bs[s];if(t!==void 0){const[e,r,i,n]=t,o=Vr(e,r,i,n);return ct[s]=o,o}return s.startsWith("cubic-bezier")?Ls(s):(console.warn("Unknown timing function: "+s),dt)};function _r(s){return(s/1024/1024).toFixed(2)}class Us extends Ae{constructor(e,r,i){super();l(this,"node");l(this,"props");l(this,"settings");l(this,"progress",0);l(this,"delayFor",0);l(this,"delay",0);l(this,"timingFunction");l(this,"propValuesMap",{});l(this,"dynPropValuesMap");this.node=e,this.props=r;for(const a in r)if(a!=="shaderProps")this.propValuesMap.props===void 0&&(this.propValuesMap.props={}),this.propValuesMap.props[a]={start:e[a]||0,target:r[a]};else if(e.shader.type!=="DynamicShader"){this.propValuesMap.shaderProps={};for(const h in r.shaderProps)this.propValuesMap.shaderProps[h]={start:e.shader.props[h],target:r.shaderProps[h]}}else{const h=Object.keys(r.shaderProps),u=h.length;this.dynPropValuesMap={};for(let d=0;d<u;d++){const c=h[d],p=r.shaderProps[c];this.dynPropValuesMap[c]={};const f=Object.entries(p),_=f.length;for(let T=0;T<_;T++){const[w,b]=f[T];this.dynPropValuesMap[c][w]={start:e.shader.props[c][w],target:b}}}}const n=i.easing||"linear",o=i.delay??0;this.settings={duration:i.duration??0,delay:o,easing:n,loop:i.loop??!1,repeat:i.repeat??0,repeatDelay:i.repeatDelay??0,stopMethod:i.stopMethod??!1},this.timingFunction=Os(n),this.delayFor=o,this.delay=o}reset(){this.progress=0,this.delayFor=this.settings.delay||0,this.update(0)}restoreValues(e,r){const i=Object.entries(r),n=i.length;for(let o=0;o<n;o++){const[a,h]=i[o];e[a]=h.start}}restore(){if(this.reset(),this.propValuesMap.props!==void 0&&this.restoreValues(this.node,this.propValuesMap.props),this.propValuesMap.shaderProps!==void 0&&this.restoreValues(this.node.shader.props,this.propValuesMap.shaderProps),this.dynPropValuesMap!==void 0){const e=Object.keys(this.dynPropValuesMap),r=e.length;if(r>0)for(let i=0;i<r;i++){const n=e[i];this.restoreValues(this.node.shader.props[n],this.dynPropValuesMap[n])}}}reverseValues(e){const r=Object.entries(e),i=r.length;for(let n=0;n<i;n++){const[o,a]=r[n];e[o]={start:a.target,target:a.start}}}reverse(){if(this.progress=0,this.propValuesMap.props!==void 0&&this.reverseValues(this.propValuesMap.props),this.propValuesMap.shaderProps!==void 0&&this.reverseValues(this.propValuesMap.shaderProps),this.dynPropValuesMap!==void 0){const e=Object.keys(this.dynPropValuesMap),r=e.length;if(r>0)for(let i=0;i<r;i++){const n=e[i];this.reverseValues(this.dynPropValuesMap[n])}}this.settings.loop||(this.settings.stopMethod=!1)}applyEasing(e,r,i){return(this.timingFunction(e)||e)*(i-r)+r}updateValue(e,r,i,n){if(this.progress===1)return r;if(this.progress===0)return i;const o=r;if(e.indexOf("color")!==-1){if(i===o)return i;if(n){const a=this.timingFunction(this.progress)||this.progress;return yr(i,o,a)}return yr(i,o,this.progress)}return n?this.applyEasing(this.progress,i,o):i+(o-i)*this.progress}updateValues(e,r,i){const n=Object.entries(r),o=n.length;for(let a=0;a<o;a++){const[h,u]=n[a];e[h]=this.updateValue(h,u.target,u.start,i)}}update(e){const{duration:r,loop:i,easing:n,stopMethod:o}=this.settings,{delayFor:a}=this;if(r===0&&a===0){this.emit("finished",{});return}if(this.delayFor>0){if(this.delayFor-=e,this.delayFor>=0)return;e=-this.delayFor,this.delayFor=0}if(r===0){this.emit("finished",{});return}if(this.progress===0&&this.emit("animating",{}),this.progress+=e/r,this.progress>1&&(this.progress=i?0:1,this.delayFor=this.delay,o)){this.emit("finished",{});return}if(this.propValuesMap.props!==void 0&&this.updateValues(this.node,this.propValuesMap.props,n),this.propValuesMap.shaderProps!==void 0&&this.updateValues(this.node.shader.props,this.propValuesMap.shaderProps,n),this.dynPropValuesMap!==void 0){const h=Object.keys(this.dynPropValuesMap),u=h.length;if(u>0)for(let d=0;d<u;d++){const c=h[d];this.updateValues(this.node.shader.props[c],this.dynPropValuesMap[c],n)}}this.progress<1&&this.emit("tick",{progress:this.progress}),this.progress===1&&this.emit("finished",{})}}class Ds extends Ae{constructor(e,r){super();l(this,"manager");l(this,"animation");l(this,"stoppedPromise");l(this,"stoppedResolve",null);l(this,"state");this.manager=e,this.animation=r,this.state="stopped",this.stoppedPromise=Promise.resolve(),this.onAnimating=this.onAnimating.bind(this),this.onFinished=this.onFinished.bind(this),this.onTick=this.onTick.bind(this)}start(){return this.state!=="running"&&this.state!=="scheduled"&&(this.makeStoppedPromise(),this.registerAnimation(),this.state="scheduled"),this}stop(){return this.unregisterAnimation(),this.stoppedResolve!==null&&(this.stoppedResolve(),this.stoppedResolve=null,this.emit("stopped",this)),this.animation.reset(),this.state="stopped",this}pause(){return this.unregisterAnimation(),this.state="paused",this}restore(){return this.stoppedResolve=null,this.animation.restore(),this}waitUntilStopped(){return this.stoppedPromise}registerAnimation(){this.animation.once("finished",this.onFinished),this.animation.on("animating",this.onAnimating),this.animation.on("tick",this.onTick),this.manager.registerAnimation(this.animation)}unregisterAnimation(){this.manager.unregisterAnimation(this.animation),this.animation.off("finished",this.onFinished),this.animation.off("animating",this.onAnimating),this.animation.off("tick",this.onTick)}makeStoppedPromise(){this.stoppedResolve===null&&(this.stoppedPromise=new Promise(e=>{this.stoppedResolve=e}))}onFinished(){M(this.stoppedResolve);const{loop:e,stopMethod:r}=this.animation.settings;if(r==="reverse"){this.animation.once("finished",this.onFinished),this.animation.reverse();return}e||(this.unregisterAnimation(),this.stoppedResolve(),this.stoppedResolve=null,this.emit("stopped",this),this.state="stopped")}onAnimating(){this.state="running",this.emit("animating",this)}onTick(e,r){this.emit("tick",r)}}var N;(function(s){s[s.Init=0]="Init",s[s.OutOfBounds=2]="OutOfBounds",s[s.InBounds=4]="InBounds",s[s.InViewport=8]="InViewport"})(N||(N={}));const We=new Map;We.set(N.Init,"init");We.set(N.OutOfBounds,"outOfBounds");We.set(N.InBounds,"inBounds");We.set(N.InViewport,"inViewport");var y;(function(s){s[s.Children=1]="Children",s[s.ScaleRotate=2]="ScaleRotate",s[s.Local=4]="Local",s[s.Global=8]="Global",s[s.Clipping=16]="Clipping",s[s.CalculatedZIndex=32]="CalculatedZIndex",s[s.ZIndexSortedChildren=64]="ZIndexSortedChildren",s[s.PremultipliedColors=128]="PremultipliedColors",s[s.WorldAlpha=256]="WorldAlpha",s[s.RenderState=512]="RenderState",s[s.IsRenderable=1024]="IsRenderable",s[s.RenderTexture=2048]="RenderTexture",s[s.ParentRenderTexture=4096]="ParentRenderTexture",s[s.RenderBounds=8192]="RenderBounds",s[s.None=0]="None",s[s.All=14335]="All"})(y||(y={}));class Qt extends Ae{constructor(e,r){super();l(this,"stage");l(this,"children",[]);l(this,"_id",bs());l(this,"props");l(this,"updateType",y.All);l(this,"childUpdateType",y.None);l(this,"globalTransform");l(this,"scaleRotateTransform");l(this,"localTransform");l(this,"renderCoords");l(this,"renderBound");l(this,"strictBound");l(this,"preloadBound");l(this,"clippingRect",{x:0,y:0,width:0,height:0,valid:!1});l(this,"isRenderable",!1);l(this,"renderState",N.Init);l(this,"worldAlpha",1);l(this,"premultipliedColorTl",0);l(this,"premultipliedColorTr",0);l(this,"premultipliedColorBl",0);l(this,"premultipliedColorBr",0);l(this,"calcZIndex",0);l(this,"hasRTTupdates",!1);l(this,"parentHasRenderTexture",!1);l(this,"rttParent",null);l(this,"onTextureLoaded",(e,r)=>{var i,n;this.autosizeNode(r),this.setUpdateType(y.IsRenderable),this.stage.requestRender(),this.parentHasRenderTexture&&this.notifyParentRTTOfUpdate(),r.width>1&&r.height>1&&this.emit("loaded",{type:"texture",dimensions:r}),((n=(i=this.props.textureOptions)==null?void 0:i.resizeMode)==null?void 0:n.type)==="contain"&&this.setUpdateType(y.Local)});l(this,"onTextureFailed",(e,r)=>{this.setUpdateType(y.IsRenderable),this.parentHasRenderTexture&&this.notifyParentRTTOfUpdate(),this.emit("failed",{type:"texture",error:r})});l(this,"onTextureFreed",()=>{this.setUpdateType(y.IsRenderable),this.parentHasRenderTexture&&this.notifyParentRTTOfUpdate(),this.emit("freed",{type:"texture"})});this.stage=e,this.props={...r,parent:null,texture:null,src:null,rtt:!1},this.parent=r.parent,this.texture=r.texture,this.src=r.src,this.rtt=r.rtt,this.setUpdateType(y.ScaleRotate|y.Local|y.RenderBounds|y.RenderState),Xe()===!1&&r.preventCleanup===!0&&console.warn("CoreNode.preventCleanup: Is deprecated and will be removed in upcoming release, please use textureOptions.preventCleanup instead"),this.stage.defaultTexture&&this.stage.defaultTexture.state!=="loaded"&&this.stage.defaultTexture.once("loaded",()=>{this.setUpdateType(y.IsRenderable)})}loadTexture(){const{texture:e}=this.props;M(e),queueMicrotask(()=>{var r;if(this.textureOptions.preload===!0&&this.stage.txManager.loadTexture(e),e.preventCleanup=((r=this.props.textureOptions)==null?void 0:r.preventCleanup)??!1,e.on("loaded",this.onTextureLoaded),e.on("failed",this.onTextureFailed),e.on("freed",this.onTextureFreed),this.parentHasRenderTexture){this.notifyParentRTTOfUpdate();return}e.state==="loaded"?(M(e.dimensions),this.onTextureLoaded(e,e.dimensions)):e.state==="failed"?(M(e.error),this.onTextureFailed(e,e.error)):e.state==="freed"&&this.onTextureFreed(e)})}unloadTexture(){this.texture!==null&&(this.texture.off("loaded",this.onTextureLoaded),this.texture.off("failed",this.onTextureFailed),this.texture.off("freed",this.onTextureFreed),this.texture.setRenderableOwner(this,!1))}autosizeNode(e){this.autosize&&(this.width=e.width,this.height=e.height)}setUpdateType(e){this.updateType|=e;const r=this.props.parent;r&&(r.updateType&y.Children)===0&&r.setUpdateType(y.Children)}sortChildren(){this.children.sort((e,r)=>e.calcZIndex-r.calcZIndex)}updateScaleRotateTransform(){const{rotation:e,scaleX:r,scaleY:i}=this.props;if(e===0&&r===1&&i===1){this.scaleRotateTransform=void 0;return}this.scaleRotateTransform=G.rotate(e,this.scaleRotateTransform).scale(r,i)}updateLocalTransform(){var u,d;const{x:e,y:r,width:i,height:n}=this.props,o=this.props.mountX*i,a=this.props.mountY*n;if(this.scaleRotateTransform){const c=this.props.pivotX*i,p=this.props.pivotY*n;this.localTransform=G.translate(e-o+c,r-a+p,this.localTransform).multiply(this.scaleRotateTransform).translate(-c,-p)}else this.localTransform=G.translate(e-o,r-a,this.localTransform);const h=this.props.texture;if(h&&h.dimensions&&((d=(u=this.props.textureOptions)==null?void 0:u.resizeMode)==null?void 0:d.type)==="contain"){let c=1,p=1,f=0,_=0;const{width:T,height:w}=h.dimensions,b=T/w,g=i/n;if(b>g){const x=i/T,m=w*x;_=(n-m)/2,p=m/n}else{const x=n/w,m=T*x;f=(i-m)/2,c=m/i}this.localTransform.translate(f,_).scale(c,p)}this.setUpdateType(y.Global)}update(e,r){var o;this.updateType&y.ScaleRotate&&(this.updateScaleRotateTransform(),this.setUpdateType(y.Local)),this.updateType&y.Local&&(this.updateLocalTransform(),this.setUpdateType(y.Global));const i=this.props.parent;let n=null;if(this.updateType&y.RenderTexture&&this.rtt&&(this.hasRTTupdates=!0),this.updateType&y.Global&&(M(this.localTransform),this.globalTransform=G.copy((i==null?void 0:i.globalTransform)||this.localTransform,this.globalTransform),this.parentHasRenderTexture&&((o=this.props.parent)!=null&&o.rtt)&&(this.globalTransform=G.identity()),i&&this.globalTransform.multiply(this.localTransform),this.calculateRenderCoords(),this.updateBoundingRect(),this.setUpdateType(y.RenderState|y.Children),this.childUpdateType|=y.Global,this.clipping===!0&&(this.setUpdateType(y.Clipping|y.RenderBounds),this.childUpdateType|=y.RenderBounds)),this.updateType&y.RenderBounds&&(this.createRenderBounds(),this.setUpdateType(y.RenderState),this.setUpdateType(y.Children)),this.updateType&y.RenderState&&(n=this.checkRenderBounds(),this.setUpdateType(y.IsRenderable),n!==N.OutOfBounds&&this.updateRenderState(n)),this.updateType&y.WorldAlpha&&(i?this.worldAlpha=i.worldAlpha*this.props.alpha:this.worldAlpha=this.props.alpha,this.setUpdateType(y.Children|y.PremultipliedColors|y.IsRenderable),this.childUpdateType|=y.WorldAlpha),this.updateType&y.IsRenderable&&this.updateIsRenderable(),this.updateType&y.Clipping&&(this.calculateClippingRect(r),this.setUpdateType(y.Children),this.childUpdateType|=y.Clipping,this.childUpdateType|=y.RenderBounds),this.updateType&y.PremultipliedColors&&(this.premultipliedColorTl=qe(this.props.colorTl,this.worldAlpha,!0),this.props.colorTl===this.props.colorTr&&this.props.colorBl===this.props.colorBr&&this.props.colorTl===this.props.colorBl?this.premultipliedColorTr=this.premultipliedColorBl=this.premultipliedColorBr=this.premultipliedColorTl:(this.premultipliedColorTr=qe(this.props.colorTr,this.worldAlpha,!0),this.premultipliedColorBl=qe(this.props.colorBl,this.worldAlpha,!0),this.premultipliedColorBr=qe(this.props.colorBr,this.worldAlpha,!0))),i!==null&&this.updateType&y.CalculatedZIndex&&(this.calculateZIndex(),i.setUpdateType(y.ZIndexSortedChildren)),!(this.props.strictBounds===!0&&this.renderState===N.OutOfBounds)){if(this.updateType&y.Children&&this.children.length>0)for(let a=0,h=this.children.length;a<h;a++){const u=this.children[a];if(u.setUpdateType(this.childUpdateType),u.updateType===0)continue;let d=this.clippingRect;this.rtt===!0&&(d={x:0,y:0,width:0,height:0,valid:!1}),u.update(e,d)}this.parentHasRenderTexture&&this.updateType>0&&this.notifyParentRTTOfUpdate(),this.updateType&y.ZIndexSortedChildren&&this.sortChildren(),n===N.OutOfBounds&&(this.updateRenderState(n),this.updateIsRenderable(),this.rtt===!0&&n===N.OutOfBounds&&this.notifyChildrenRTTOfUpdate(n)),this.updateType=0,this.childUpdateType=0}}findParentRTTNode(){let e=this.parent;for(;e&&!e.rtt;)e=e.parent;return e}getRTTParentRenderState(){const e=this.rttParent||this.findParentRTTNode();return e?e.renderState:null}notifyChildrenRTTOfUpdate(e){for(const r of this.children)r.updateRenderState(e),r.updateIsRenderable(),r.notifyChildrenRTTOfUpdate(e)}notifyParentRTTOfUpdate(){if(this.parent===null)return;const e=this.rttParent||this.findParentRTTNode();e&&(e.hasRTTupdates=!0,e.setUpdateType(y.RenderTexture),e.parentHasRenderTexture===!0&&e.notifyParentRTTOfUpdate())}checkRenderBounds(){return M(this.renderBound),M(this.strictBound),M(this.preloadBound),this.parentHasRenderTexture===!0?this.getRTTParentRenderState()||N.OutOfBounds:Nt(this.renderBound,this.strictBound)?N.InViewport:Nt(this.renderBound,this.preloadBound)?N.InBounds:Ms(this.renderBound,this.strictBound)?N.InViewport:this.parent!==null&&(this.props.width===0||this.props.height===0)?this.parent.renderState:N.OutOfBounds}updateBoundingRect(){const{renderCoords:e,globalTransform:r}=this;M(r),M(e);const{tb:i,tc:n}=r,{x1:o,y1:a,x3:h,y3:u}=e;if(i===0||n===0)this.renderBound=Se(o,a,h,u,this.renderBound);else{const{x2:d,x4:c,y2:p,y4:f}=e;this.renderBound=Se(Math.min(o,d,h,c),Math.min(a,p,u,f),Math.max(o,d,h,c),Math.max(a,p,u,f),this.renderBound)}}createRenderBounds(){if(M(this.stage),this.parent!==null&&this.parent.strictBound!==void 0){const d=this.parent.strictBound;this.strictBound=Se(d.x1,d.y1,d.x2,d.y2),this.preloadBound=Kt(this.strictBound,this.stage.boundsMargin)}else this.strictBound=this.stage.strictBound,this.preloadBound=this.stage.preloadBound;if(this.props.clipping===!1||this.renderBound===void 0||Nt(this.renderBound,this.strictBound)===!1)return;const{x:e,y:r,width:i,height:n}=this.props,{tx:o,ty:a}=this.globalTransform||{},h=o??e,u=a??r;this.strictBound=Se(h,u,h+i,u+n,this.strictBound),this.preloadBound=Kt(this.strictBound,this.stage.boundsMargin)}updateRenderState(e){if(e===this.renderState)return;const r=this.renderState;this.renderState=e;const i=We.get(e);M(i),this.emit(i,{previous:r,current:e})}updateIsRenderable(){let e=!1,r=!1;if(this.checkBasicRenderability()===!1){this.updateTextureOwnership(!1),this.setRenderable(!1);return}this.texture!==null?(r=!0,e=this.texture.state==="loaded"):(this.hasShader()||this.hasColorProperties()===!0)&&this.hasDimensions()===!0&&this.stage.defaultTexture&&this.stage.defaultTexture.state==="loaded"&&(e=!0),this.updateTextureOwnership(r),this.setRenderable(e)}checkBasicRenderability(){return!(this.worldAlpha===0||this.isOutOfBounds()===!0)}setRenderable(e){this.isRenderable=e}updateTextureOwnership(e){var r;(r=this.texture)==null||r.setRenderableOwner(this,e)}isOutOfBounds(){return this.renderState<=N.OutOfBounds}hasDimensions(){return this.props.width!==0&&this.props.height!==0}hasColorProperties(){return this.props.color!==0||this.props.colorTop!==0||this.props.colorBottom!==0||this.props.colorLeft!==0||this.props.colorRight!==0||this.props.colorTl!==0||this.props.colorTr!==0||this.props.colorBl!==0||this.props.colorBr!==0}hasShader(){return this.props.shader!==null}calculateRenderCoords(){const{width:e,height:r,globalTransform:i}=this;M(i);const{tx:n,ty:o,ta:a,tb:h,tc:u,td:d}=i;if(h===0&&u===0){const c=n,p=n+e*a,f=o,_=o+r*d;this.renderCoords=Tt.translate(c,f,p,f,p,_,c,_,this.renderCoords)}else this.renderCoords=Tt.translate(n,o,n+e*a,o+e*u,n+e*a+r*h,o+e*u+r*d,n+r*h,o+r*d,this.renderCoords)}calculateClippingRect(e){M(this.globalTransform);const{clippingRect:r,props:i,globalTransform:n}=this,{clipping:o}=i,a=n.tb!==0||n.tc!==0;o===!0&&a===!1?(r.x=n.tx,r.y=n.ty,r.width=this.width*n.ta,r.height=this.height*n.td,r.valid=!0):r.valid=!1,e.valid===!0&&r.valid===!0?Es(e,r,r):e.valid===!0&&(Cs(e,r),r.valid=!0)}calculateZIndex(){var o,a;const e=this.props,r=e.zIndex||0,i=((o=e.parent)==null?void 0:o.zIndex)||0;let n=r;(a=e.parent)!=null&&a.zIndexLocked&&(n=r<i?r:i),this.calcZIndex=n}destroy(){var e;for(this.unloadTexture(),this.clippingRect.valid=!1,this.isRenderable=!1,this.renderCoords=void 0,this.renderBound=void 0,this.strictBound=void 0,this.preloadBound=void 0,this.globalTransform=void 0,this.scaleRotateTransform=void 0,this.localTransform=void 0,this.props.texture=null,this.props.shader=this.stage.defShaderCtr;this.children.length>0;)(e=this.children[0])==null||e.destroy();this.parent=null,this.rtt&&this.stage.renderer.removeRTTNode(this),this.removeAllListeners()}renderQuads(e){this.parentHasRenderTexture&&(!e.renderToTextureActive||this.parentRenderTexture!==e.activeRttNode)||(M(this.globalTransform),M(this.renderCoords),e.addQuad({width:this.props.width,height:this.props.height,colorTl:this.premultipliedColorTl,colorTr:this.premultipliedColorTr,colorBl:this.premultipliedColorBl,colorBr:this.premultipliedColorBr,texture:this.texture||this.stage.defaultTexture,textureOptions:this.textureOptions,zIndex:this.zIndex,shader:this.shader.shader,shaderProps:this.shader.getResolvedProps(),alpha:this.worldAlpha,clippingRect:this.clippingRect,tx:this.globalTransform.tx,ty:this.globalTransform.ty,ta:this.globalTransform.ta,tb:this.globalTransform.tb,tc:this.globalTransform.tc,td:this.globalTransform.td,renderCoords:this.renderCoords,rtt:this.rtt,parentHasRenderTexture:this.parentHasRenderTexture,framebufferDimensions:this.framebufferDimensions}))}get id(){return this._id}get data(){return this.props.data}set data(e){this.props.data=e}get x(){return this.props.x}set x(e){this.props.x!==e&&(this.props.x=e,this.setUpdateType(y.Local))}get absX(){var e,r,i;return this.props.x+-this.props.width*this.props.mountX+(((e=this.props.parent)==null?void 0:e.absX)||((i=(r=this.props.parent)==null?void 0:r.globalTransform)==null?void 0:i.tx)||0)}get absY(){var e;return this.props.y+-this.props.height*this.props.mountY+(((e=this.props.parent)==null?void 0:e.absY)??0)}get y(){return this.props.y}set y(e){this.props.y!==e&&(this.props.y=e,this.setUpdateType(y.Local))}get width(){return this.props.width}set width(e){this.props.width!==e&&(this.props.width=e,this.setUpdateType(y.Local),this.props.rtt&&(this.texture=this.stage.txManager.createTexture("RenderTexture",{width:this.width,height:this.height}),this.setUpdateType(y.RenderTexture)))}get height(){return this.props.height}set height(e){this.props.height!==e&&(this.props.height=e,this.setUpdateType(y.Local),this.props.rtt&&(this.texture=this.stage.txManager.createTexture("RenderTexture",{width:this.width,height:this.height}),this.setUpdateType(y.RenderTexture)))}get scale(){return this.scaleX}set scale(e){this.scaleX=e,this.scaleY=e}get scaleX(){return this.props.scaleX}set scaleX(e){this.props.scaleX!==e&&(this.props.scaleX=e,this.setUpdateType(y.ScaleRotate))}get scaleY(){return this.props.scaleY}set scaleY(e){this.props.scaleY!==e&&(this.props.scaleY=e,this.setUpdateType(y.ScaleRotate))}get mount(){return this.props.mount}set mount(e){(this.props.mountX!==e||this.props.mountY!==e)&&(this.props.mountX=e,this.props.mountY=e,this.props.mount=e,this.setUpdateType(y.Local))}get mountX(){return this.props.mountX}set mountX(e){this.props.mountX!==e&&(this.props.mountX=e,this.setUpdateType(y.Local))}get mountY(){return this.props.mountY}set mountY(e){this.props.mountY!==e&&(this.props.mountY=e,this.setUpdateType(y.Local))}get pivot(){return this.props.pivot}set pivot(e){(this.props.pivotX!==e||this.props.pivotY!==e)&&(this.props.pivotX=e,this.props.pivotY=e,this.props.pivot=e,this.setUpdateType(y.Local))}get pivotX(){return this.props.pivotX}set pivotX(e){this.props.pivotX!==e&&(this.props.pivotX=e,this.setUpdateType(y.Local))}get pivotY(){return this.props.pivotY}set pivotY(e){this.props.pivotY!==e&&(this.props.pivotY=e,this.setUpdateType(y.Local))}get rotation(){return this.props.rotation}set rotation(e){this.props.rotation!==e&&(this.props.rotation=e,this.setUpdateType(y.ScaleRotate))}get alpha(){return this.props.alpha}set alpha(e){this.props.alpha=e,this.setUpdateType(y.PremultipliedColors|y.WorldAlpha|y.Children|y.IsRenderable),this.childUpdateType|=y.WorldAlpha}get autosize(){return this.props.autosize}set autosize(e){this.props.autosize=e}get clipping(){return this.props.clipping}set clipping(e){this.props.clipping=e,this.setUpdateType(y.Clipping|y.RenderBounds|y.Children),this.childUpdateType|=y.Global|y.Clipping}get color(){return this.props.color}set color(e){this.colorTop=e,this.colorBottom=e,this.colorLeft=e,this.colorRight=e,this.props.color=e,this.setUpdateType(y.PremultipliedColors)}get colorTop(){return this.props.colorTop}set colorTop(e){(this.props.colorTl!==e||this.props.colorTr!==e)&&(this.colorTl=e,this.colorTr=e),this.props.colorTop=e,this.setUpdateType(y.PremultipliedColors)}get colorBottom(){return this.props.colorBottom}set colorBottom(e){(this.props.colorBl!==e||this.props.colorBr!==e)&&(this.colorBl=e,this.colorBr=e),this.props.colorBottom=e,this.setUpdateType(y.PremultipliedColors)}get colorLeft(){return this.props.colorLeft}set colorLeft(e){(this.props.colorTl!==e||this.props.colorBl!==e)&&(this.colorTl=e,this.colorBl=e),this.props.colorLeft=e,this.setUpdateType(y.PremultipliedColors)}get colorRight(){return this.props.colorRight}set colorRight(e){(this.props.colorTr!==e||this.props.colorBr!==e)&&(this.colorTr=e,this.colorBr=e),this.props.colorRight=e,this.setUpdateType(y.PremultipliedColors)}get colorTl(){return this.props.colorTl}set colorTl(e){this.props.colorTl=e,this.setUpdateType(y.PremultipliedColors)}get colorTr(){return this.props.colorTr}set colorTr(e){this.props.colorTr=e,this.setUpdateType(y.PremultipliedColors)}get colorBl(){return this.props.colorBl}set colorBl(e){this.props.colorBl=e,this.setUpdateType(y.PremultipliedColors)}get colorBr(){return this.props.colorBr}set colorBr(e){this.props.colorBr=e,this.setUpdateType(y.PremultipliedColors)}get zIndexLocked(){return this.props.zIndexLocked||0}set zIndexLocked(e){this.props.zIndexLocked=e,this.setUpdateType(y.CalculatedZIndex|y.Children);for(let r=0,i=this.children.length;r<i;r++)this.children[r].setUpdateType(y.CalculatedZIndex)}get zIndex(){return this.props.zIndex}set zIndex(e){this.props.zIndex=e,this.setUpdateType(y.CalculatedZIndex|y.Children);for(let r=0,i=this.children.length;r<i;r++)this.children[r].setUpdateType(y.CalculatedZIndex)}get parent(){return this.props.parent}set parent(e){const r=this.props.parent;if(r!==e){if(this.props.parent=e,r){const i=r.children.indexOf(this);M(i!==-1,"CoreNode.parent: Node not found in old parent's children!"),r.children.splice(i,1),r.setUpdateType(y.Children|y.ZIndexSortedChildren)}e&&(e.children.push(this),this.setUpdateType(y.All),e.setUpdateType(y.Children|y.ZIndexSortedChildren),(e.rtt||e.parentHasRenderTexture)&&this.applyRTTInheritance(e)),this.updateScaleRotateTransform(),this.setUpdateType(y.RenderBounds|y.Children)}}get preventCleanup(){return this.props.textureOptions.preventCleanup||!1}set preventCleanup(e){Xe()===!1&&console.warn("CoreNode.preventCleanup: Is deprecated and will be removed in upcoming release, please use textureOptions.preventCleanup instead"),this.props.textureOptions.preventCleanup=e}get rtt(){return this.props.rtt}set rtt(e){this.props.rtt!==e&&(this.props.rtt=e,e===!0?(this.initRenderTexture(),this.markChildrenWithRTT()):this.cleanupRenderTexture(),this.setUpdateType(y.RenderTexture),this.parentHasRenderTexture===!0&&this.notifyParentRTTOfUpdate())}initRenderTexture(){this.texture=this.stage.txManager.createTexture("RenderTexture",{width:this.width,height:this.height}),this.stage.renderer.renderToTexture(this)}cleanupRenderTexture(){this.unloadTexture(),this.clearRTTInheritance(),this.hasRTTupdates=!1,this.texture=null}markChildrenWithRTT(e=null){const r=e||this;for(const i of r.children)i.setUpdateType(y.All),i.parentHasRenderTexture=!0,i.markChildrenWithRTT()}applyRTTInheritance(e){e.rtt&&e.setUpdateType(y.RenderTexture),this.markChildrenWithRTT(e)}clearRTTInheritance(){if(!this.rtt)for(const e of this.children)e.parentHasRenderTexture=!1,e.rttParent=null,e.setUpdateType(y.All),e.clearRTTInheritance()}get shader(){return this.props.shader}set shader(e){this.props.shader!==e&&(this.props.shader=e,this.setUpdateType(y.IsRenderable))}get src(){return this.props.src}set src(e){if(this.props.src!==e){if(this.props.src=e,!e){this.texture=null;return}this.texture=this.stage.txManager.createTexture("ImageTexture",{src:e,width:this.props.width,height:this.props.height,type:this.props.imageType,sx:this.props.srcX,sy:this.props.srcY,sw:this.props.srcWidth,sh:this.props.srcHeight})}}set imageType(e){this.props.imageType!==e&&(this.props.imageType=e)}get imageType(){return this.props.imageType||null}get srcHeight(){return this.props.srcHeight}set srcHeight(e){this.props.srcHeight=e}get srcWidth(){return this.props.srcWidth}set srcWidth(e){this.props.srcWidth=e}get srcX(){return this.props.srcX}set srcX(e){this.props.srcX=e}get srcY(){return this.props.srcY}set srcY(e){this.props.srcY=e}get framebufferDimensions(){return this.parentHasRenderTexture&&!this.rtt&&this.parent?this.parent.framebufferDimensions:{width:this.width,height:this.height}}get parentRenderTexture(){let e=this.parent;for(;e;){if(e.rtt)return e;e=e.parent}return null}get texture(){return this.props.texture}set texture(e){if(this.props.texture===e)return;const r=this.props.texture;r&&(r.setRenderableOwner(this,!1),this.unloadTexture()),this.props.texture=e,e!==null&&(e.setRenderableOwner(this,this.isRenderable),this.loadTexture()),this.setUpdateType(y.IsRenderable)}set textureOptions(e){this.props.textureOptions=e}get textureOptions(){return this.props.textureOptions}get strictBounds(){return this.props.strictBounds}set strictBounds(e){e!==this.props.strictBounds&&(this.props.strictBounds=e,this.setUpdateType(y.RenderBounds|y.Children),this.childUpdateType|=y.RenderBounds|y.Children)}animate(e,r){const i=new Us(this,e,r);return new Ds(this.stage.animationManager,i)}flush(){}}const ks=s=>{let t=!1;const e=()=>{if(s.updateFrameTime(),s.updateAnimations(),!s.hasSceneUpdates()){s.calculateFps(),setTimeout(e,16.666666666666668),t||(s.txMemManager.checkCleanup()&&s.txMemManager.cleanup(),s.eventBus.emit("idle"),t=!0),s.flushFrameEvents();return}t=!1,s.drawFrame(),s.flushFrameEvents(),requestAnimationFrame(e)};requestAnimationFrame(e)},le=()=>performance?performance.now():Date.now();class Fs{constructor(){l(this,"activeAnimations",new Set)}registerAnimation(t){this.activeAnimations.add(t)}unregisterAnimation(t){this.activeAnimations.delete(t)}update(t){this.activeAnimations.forEach(e=>{e.update(t)})}}function Ns(){function s(e){return e.indexOf("image/png")!==-1}function t(e,r,i,n,o,a,h){return new Promise(function(u,d){var c=new XMLHttpRequest;c.open("GET",e,!0),c.responseType="blob",c.onload=function(){if(c.status!==200&&c.status!==0)return d(new Error("Failed to load image: "+c.statusText));var p=c.response;r!==void 0||s(p.type),createImageBitmap(p).then(function(f){u({data:f,premultiplyAlpha:r})}).catch(function(f){d(f)})},c.onerror=function(){d(new Error("Network error occurred while trying to fetch the image."))},c.send()})}self.onmessage=e=>{var r=e.data.src,i=e.data.id,n=e.data.premultiplyAlpha;e.data.sx,e.data.sy,e.data.sw,e.data.sh,t(r,n).then(function(o){self.postMessage({id:i,src:r,data:o})}).catch(function(o){self.postMessage({id:i,src:r,error:o.message})})}}class $s{constructor(t,e){l(this,"imageWorkersEnabled",!0);l(this,"messageManager",{});l(this,"workers",[]);l(this,"workerIndex",0);l(this,"nextId",0);this.workers=this.createWorkers(t,e),this.workers.forEach(r=>{r.onmessage=this.handleMessage.bind(this)})}handleMessage(t){const{id:e,data:r,error:i}=t.data,n=this.messageManager[e];if(n){const[o,a]=n;delete this.messageManager[e],i?a(new Error(i)):o(r)}}createWorkers(t=1,e){let r=`(${Ns.toString()})()`;e.options&&(r=r.replace("var supportsOptionsCreateImageBitmap = false;","var supportsOptionsCreateImageBitmap = true;")),e.full&&(r=r.replace("var supportsFullCreateImageBitmap = false;","var supportsFullCreateImageBitmap = true;")),r=r.replace('"use strict";',"");const i=new Blob([r],{type:"application/javascript"}),n=(self.URL?URL:webkitURL).createObjectURL(i),o=[];for(let a=0;a<t;a++)o.push(new Worker(n));return o}getNextWorker(){const t=this.workers[this.workerIndex];return this.workerIndex=(this.workerIndex+1)%this.workers.length,t}getImage(t,e,r,i,n,o){return new Promise((a,h)=>{try{if(this.workers){const u=this.nextId++;this.messageManager[u]=[a,h];const d=this.getNextWorker();d&&d.postMessage({id:u,src:t,premultiplyAlpha:e,sx:r,sy:i,sw:n,sh:o})}}catch(u){h(u)}})}}const ke=class ke extends Ge{constructor(e,r){super(e);l(this,"type",W.color);l(this,"props");this.props=ke.resolveDefaults(r||{})}get color(){return this.props.color}set color(e){this.props.color=e}async getTextureSource(){const e=new Uint8Array(4);return this.color===4294967295?(e[0]=255,e[1]=255,e[2]=255,e[3]=255):(e[0]=this.color>>16&255,e[1]=this.color>>8&255,e[2]=this.color&255,e[3]=this.color>>>24&255),this.setState("fetched",{width:1,height:1}),{data:e,premultiplyAlpha:!0}}static makeCacheKey(e){return`ColorTexture,${ke.resolveDefaults(e).color}`}static resolveDefaults(e){return{color:e.color||4294967295}}};l(ke,"z$__type__Props");let yt=ke;function Xs(s){return/\.(ktx|pvr)$/.test(s)}const Rr=async s=>{const e=await(await fetch(s)).arrayBuffer();return s.indexOf(".ktx")!==-1?zs(e):Vs(e)},zs=async s=>{const t=new DataView(s),e=t.getUint32(12)===16909060,r=[],i={glInternalFormat:t.getUint32(28,e),pixelWidth:t.getUint32(36,e),pixelHeight:t.getUint32(40,e),numberOfMipmapLevels:t.getUint32(56,e),bytesOfKeyValueData:t.getUint32(60,e)};let n=64;n+=i.bytesOfKeyValueData;for(let o=0;o<i.numberOfMipmapLevels;o++){const a=t.getUint32(n);n+=4,r.push(t.buffer.slice(n,a)),n+=a}return{data:{glInternalFormat:i.glInternalFormat,mipmaps:r,width:i.pixelWidth||0,height:i.pixelHeight||0,type:"ktx"},premultiplyAlpha:!1}},Vs=async s=>{const a=s,h=new Int32Array(a,0,13),u=h[12]+52,d=new Uint8Array(a,u),c=[],p={pixelWidth:h[7],pixelHeight:h[6],numberOfMipmapLevels:h[11]||0};let f=0,_=p.pixelWidth||0,T=p.pixelHeight||0;for(let w=0;w<p.numberOfMipmapLevels;w++){const b=(_+3>>2)*(T+3>>2)*8,g=new Uint8Array(a,d.byteOffset+f,b);c.push(g),f+=b,_=_>>1,T=T>>1}return{data:{glInternalFormat:36196,mipmaps:c,width:p.pixelWidth||0,height:p.pixelHeight||0,type:"pvr"},premultiplyAlpha:!1}};function Gs(s){return/\.(svg)(\?.*)?$/.test(s)}const wr=(s,t,e,r,i,n,o)=>new Promise((a,h)=>{const u=document.createElement("canvas"),d=u.getContext("2d");M(d),d.imageSmoothingEnabled=!0;const c=new Image;c.onload=()=>{const p=r??0,f=i??0,_=t||c.width,T=e||c.height;u.width=_,u.height=T,d.drawImage(c,0,0,_,T),a({data:d.getImageData(p,f,n??_,o??T),premultiplyAlpha:!1})},c.onerror=p=>{h(p)},c.src=s});function Ws(s,t=""){return new Promise((e,r)=>{const i=new XMLHttpRequest;i.responseType=t,i.onreadystatechange=function(){i.readyState==XMLHttpRequest.DONE&&(i.status===0||i.status===200?e(i.response):r(i.statusText))},i.open("GET",s,!0),i.send(null)})}const Fe=class Fe extends Ge{constructor(e,r){super(e);l(this,"props");l(this,"type",W.image);this.props=Fe.resolveDefaults(r)}hasAlphaChannel(e){return e.indexOf("image/png")!==-1}async loadImageFallback(e,r){const i=new Image;return vr(e)===!1&&(i.crossOrigin="anonymous"),new Promise(n=>{i.onload=()=>{n({data:i,premultiplyAlpha:r})},i.onerror=()=>{console.warn("Image loading failed, returning fallback object."),n({data:i,premultiplyAlpha:r})},i.src=e})}async createImageBitmap(e,r,i,n,o,a){const h=r??e.type.includes("image/png"),u=this.txManager.imageBitmapSupported;return u.full===!0&&i!==null&&n!==null&&o!==null&&a!==null?{data:await createImageBitmap(e,i,n,o,a,{premultiplyAlpha:h?"premultiply":"none",colorSpaceConversion:"none",imageOrientation:"none"}),premultiplyAlpha:h}:u.options===!0?{data:await createImageBitmap(e,{premultiplyAlpha:h?"premultiply":"none",colorSpaceConversion:"none",imageOrientation:"none"}),premultiplyAlpha:h}:{data:await createImageBitmap(e),premultiplyAlpha:h}}async loadImage(e){const{premultiplyAlpha:r,sx:i,sy:n,sw:o,sh:a}=this.props;if(this.txManager.hasCreateImageBitmap===!0){if(vr(e)===!1&&this.txManager.hasWorker===!0&&this.txManager.imageWorkerManager!==null)return this.txManager.imageWorkerManager.getImage(e,r,i,n,o,a);const h=await Ws(e,"blob").then(u=>u);return this.createImageBitmap(h,r,i,n,o,a)}return this.loadImageFallback(e,r??!0)}async getTextureSource(){var n,o;let e;try{e=await this.determineImageTypeAndLoadImage()}catch(a){return this.setState("failed",a),{data:null}}if(e.data===null)return this.setState("failed",Error("ImageTexture: No image data")),{data:null};let r,i;return e.data instanceof Uint8Array?(r=this.props.width??0,i=this.props.height??0):(r=((n=e.data)==null?void 0:n.width)??(this.props.width||0),i=((o=e.data)==null?void 0:o.height)??(this.props.height||0)),this.setState("fetched",{width:r,height:i}),{data:e.data,premultiplyAlpha:this.props.premultiplyAlpha??!0}}determineImageTypeAndLoadImage(){const{src:e,premultiplyAlpha:r,type:i}=this.props;if(e===null)return{data:null};if(typeof e!="string")return e instanceof ImageData?{data:e,premultiplyAlpha:r}:{data:e(),premultiplyAlpha:r};const n=Is(e);return i==="regular"?this.loadImage(n):i==="svg"?wr(n,this.props.width,this.props.height,this.props.sx,this.props.sy,this.props.sw,this.props.sh):Gs(e)===!0?wr(n,this.props.width,this.props.height,this.props.sx,this.props.sy,this.props.sw,this.props.sh):i==="compressed"||Xs(e)===!0?Rr(n):this.loadImage(n)}static makeCacheKey(e){const r=Fe.resolveDefaults(e),i=r.key||r.src;if(typeof i!="string")return!1;let n="";return r.sh!==null&&r.sw!==null&&(n+=",",n+=r.sx??"",n+=r.sy??"",n+=r.sw||"",n+=r.sh||""),`ImageTexture,${i},${r.premultiplyAlpha??"true"}${n}`}static resolveDefaults(e){return{src:e.src??"",premultiplyAlpha:e.premultiplyAlpha??!0,key:e.key??null,type:e.type??null,width:e.width??null,height:e.height??null,sx:e.sx??null,sy:e.sy??null,sw:e.sw??null,sh:e.sh??null}}};l(Fe,"z$__type__Props");let ze=Fe;const Ne=class Ne extends Ge{constructor(e,r){super(e);l(this,"props");l(this,"type",W.noise);this.props=Ne.resolveDefaults(r)}async getTextureSource(){const{width:e,height:r}=this.props,i=e*r*4,n=new Uint8ClampedArray(i);for(let o=0;o<i;o+=4){const a=Math.floor(Math.random()*256);n[o]=a,n[o+1]=a,n[o+2]=a,n[o+3]=255}return this.setState("fetched"),{data:new ImageData(n,e,r)}}static makeCacheKey(e){if(e.cacheId===void 0)return!1;const r=Ne.resolveDefaults(e);return`NoiseTexture,${r.width},${r.height},${r.cacheId}`}static resolveDefaults(e){return{width:e.width??128,height:e.height??128,cacheId:e.cacheId??0}}};l(Ne,"z$__type__Props");let jt=Ne;const Mt=class Mt extends Ge{constructor(e,r){super(e);l(this,"props");l(this,"parentTexture");l(this,"type",W.subTexture);l(this,"onParentTxLoaded",()=>{this.forwardParentTxState("loaded",{width:this.props.width,height:this.props.height})});l(this,"onParentTxFailed",(e,r)=>{this.forwardParentTxState("failed",r)});l(this,"onParentTxFetched",()=>{this.forwardParentTxState("fetched",{width:this.props.width,height:this.props.height})});l(this,"onParentTxFetching",()=>{this.forwardParentTxState("fetching")});l(this,"onParentTxLoading",()=>{this.forwardParentTxState("loading")});l(this,"onParentTxFreed",()=>{this.forwardParentTxState("freed")});this.props=Mt.resolveDefaults(r||{}),M(this.props.texture,"SubTexture requires a parent texture"),M(this.props.texture instanceof ze,"SubTexture requires an ImageTexture parent"),this.parentTexture=e.resolveParentTexture(this.props.texture),this.renderableOwners.size>0&&this.parentTexture.setRenderableOwner(this,!0),queueMicrotask(()=>{const i=this.parentTexture;i.state==="loaded"?this.onParentTxLoaded(i,i.dimensions):i.state==="fetching"?this.onParentTxFetching():i.state==="fetched"?this.onParentTxFetched():i.state==="loading"?this.onParentTxLoading():i.state==="failed"?this.onParentTxFailed(i,i.error):i.state==="freed"&&this.onParentTxFreed(),i.on("fetched",this.onParentTxFetched),i.on("loading",this.onParentTxLoading),i.on("fetching",this.onParentTxFetching),i.on("loaded",this.onParentTxLoaded),i.on("failed",this.onParentTxFailed),i.on("freed",this.onParentTxFreed)})}forwardParentTxState(e,r){this.setState(e,r)}onChangeIsRenderable(e){this.parentTexture.setRenderableOwner(this,e)}async getTextureSource(){return new Promise((e,r)=>{this.setState("fetched"),e({data:this.props})})}static makeCacheKey(e){return!1}static resolveDefaults(e){return{texture:e.texture,x:e.x||0,y:e.y||0,width:e.width||0,height:e.height||0}}};l(Mt,"z$__type__Props");let vt=Mt;const It=class It extends Ge{constructor(e,r){super(e);l(this,"props");l(this,"type",W.renderToTexture);this.props=It.resolveDefaults(r||{})}get width(){return this.props.width}set width(e){this.props.width=e}get height(){return this.props.height}set height(e){this.props.height=e}async getTextureSource(){return this.setState("fetched"),{data:null,premultiplyAlpha:null}}static resolveDefaults(e){return{width:e.width||256,height:e.height||256}}};l(It,"z$__type__Props");let _t=It;class Hs extends Ae{constructor(e,r){super();l(this,"keyCache",new Map);l(this,"inverseKeyCache",new WeakMap);l(this,"txConstructors",{});l(this,"downloadTextureSourceQueue",[]);l(this,"priorityQueue",[]);l(this,"uploadTextureQueue",[]);l(this,"initialized",!1);l(this,"stage");l(this,"imageWorkerManager",null);l(this,"hasCreateImageBitmap",!!self.createImageBitmap);l(this,"imageBitmapSupported",{basic:!1,options:!1,full:!1});l(this,"hasWorker",!!self.Worker);l(this,"renderer");l(this,"frameTime",0);this.stage=e,this.validateCreateImageBitmap().then(i=>{this.hasCreateImageBitmap=i.basic||i.options||i.full,this.imageBitmapSupported=i,this.hasCreateImageBitmap||console.warn("[Lightning] createImageBitmap is not supported on this browser. ImageTexture will be slower."),this.hasCreateImageBitmap&&this.hasWorker&&r>0?this.imageWorkerManager=new $s(r,i):console.warn("[Lightning] Imageworker is 0 or not supported on this browser. Image loading will be slower."),this.initialized=!0,this.emit("initialized")}).catch(i=>{console.warn("[Lightning] createImageBitmap is not supported on this browser. ImageTexture will be slower."),this.initialized=!0,this.emit("initialized")}),this.registerTextureType("ImageTexture",ze),this.registerTextureType("ColorTexture",yt),this.registerTextureType("NoiseTexture",jt),this.registerTextureType("SubTexture",vt),this.registerTextureType("RenderTexture",_t)}async validateCreateImageBitmap(){var o,a,h;const e=new Uint8Array([137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,0,0,0,1,0,0,0,1,1,3,0,0,0,37,219,86,202,0,0,0,3,80,76,84,69,0,0,0,167,122,61,218,0,0,0,1,116,82,78,83,0,64,230,216,102,0,0,0,10,73,68,65,84,8,215,99,96,0,0,0,2,0,1,226,33,188,51,0,0,0,0,73,69,78,68,174,66,96,130]),r={basic:!1,options:!1,full:!1},i=new Blob([e],{type:"image/png"}),n=await createImageBitmap(i);(o=n.close)==null||o.call(n),r.basic=!0;try{const u={premultiplyAlpha:"none"},d=await createImageBitmap(i,u);(a=d.close)==null||a.call(d),r.options=!0}catch{}try{const u=await createImageBitmap(i,0,0,1,1,{premultiplyAlpha:"none"});(h=u.close)==null||h.call(u),r.full=!0}catch{}return r}registerTextureType(e,r){this.txConstructors[e]=r}enqueueDownloadTextureSource(e){this.downloadTextureSourceQueue.includes(e)||this.downloadTextureSourceQueue.push(e)}enqueueUploadTexture(e){this.uploadTextureQueue.includes(e)===!1&&this.uploadTextureQueue.push(e)}createTexture(e,r){let i;const n=this.txConstructors[e];if(!n)throw new Error(`Texture type "${e}" is not registered`);const o=n.makeCacheKey(r);return o&&this.keyCache.has(o)?i=this.keyCache.get(o):(i=new n(this,r),o&&this.initTextureToCache(i,o)),i}orphanTexture(e){const r=this.downloadTextureSourceQueue.indexOf(e);r!==-1&&this.downloadTextureSourceQueue.splice(r,1);const i=this.uploadTextureQueue.indexOf(e);i!==-1&&this.uploadTextureQueue.splice(i,1),e.type!==W.subTexture&&this.stage.txMemManager.addToOrphanedTextures(e)}loadTexture(e,r){if(this.stage.txMemManager.removeFromOrphanedTextures(e),!(e.state!=="initial"&&e.state!=="freed")){if(e.setState("loading"),this.initialized===!1){this.priorityQueue.push(e);return}if(e.type===W.subTexture||e.type===W.color||e.type===W.renderToTexture){e.setState("fetched"),this.enqueueUploadTexture(e);return}r===!0&&e.getTextureData().then(()=>{this.uploadTexture(e)}).catch(i=>{console.error(i)}),this.enqueueDownloadTextureSource(e)}}uploadTexture(e){if(e.state!=="fetched")return;e.loadCtxTexture().load()}isProcessingTexture(e){return this.downloadTextureSourceQueue.includes(e)===!0||this.uploadTextureQueue.includes(e)===!0}processSome(e){if(this.initialized===!1)return;const r=le();for(;this.priorityQueue.length>0&&le()-r<e;){const i=this.priorityQueue.pop();i.getTextureData().then(()=>{this.uploadTexture(i)})}for(;this.uploadTextureQueue.length>0&&le()-r<e;)this.uploadTexture(this.uploadTextureQueue.pop());for(;this.downloadTextureSourceQueue.length>0&&le()-r<e;){const i=this.downloadTextureSourceQueue.shift();i.getTextureData().then(()=>{i.state==="fetched"&&this.enqueueUploadTexture(i)})}}hasUpdates(){return this.downloadTextureSourceQueue.length>0||this.uploadTextureQueue.length>0}initTextureToCache(e,r){const{keyCache:i,inverseKeyCache:n}=this;i.set(r,e),n.set(e,r)}getTextureFromCache(e){return this.keyCache.get(e)}removeTextureFromCache(e){const{inverseKeyCache:r,keyCache:i}=this,n=r.get(e);n&&i.delete(n)}resolveParentTexture(e){if(!(e!=null&&e.props))return e;const r=ze.makeCacheKey(e.props);return(r?this.getTextureFromCache(r):void 0)??e}}const Ys={normal:400,bold:700,bolder:900,lighter:100},br=s=>typeof s=="number"?s:Ys[s]||400;function qs(s,t,e,r,i){let n=br(e);for(const o of s){const a=o[t];if(!a)continue;if(a.size===1)return console.warn(`TrFontManager: Only one font face found for family: '${t}' - will be used for all weights and styles`),a.values().next().value;const h=new Map;for(const d of a){const c=br(d.descriptors.weight);if(c===n&&d.descriptors.style===r&&d.descriptors.stretch===i)return d;h.set(c,d)}const u=`TrFontManager: No exact match: '${t} Weight: ${n} Style: ${r} Stretch: ${i}'`;if(console.error(u),n===400&&h.has(500))return h.get(500);if(n===500&&h.has(400))return h.get(400);if(n<400){for(;n>0;){if(h.has(n))return h.get(n);n-=100}n=600}for(;n<1e3;){if(h.has(n))return h.get(n);n+=100}for(n=500;n>0;){if(h.has(n))return h.get(n);n-=100}}}class Ks{constructor(t){l(this,"textRenderers");l(this,"fontCache",new Map);this.textRenderers=t}addFontFace(t){for(const e in this.textRenderers){const r=this.textRenderers[e];r&&r.isFontFaceSupported(t)&&r.addFontFace(t)}}resolveFontFace(t,e,r){const{fontFamily:i,fontWeight:n,fontStyle:o,fontStretch:a}=e,h=`${r}_${i}_${o}_${n}_${a}`;if(this.fontCache.has(h)===!0)return this.fontCache.get(h);const u=qs(t,i,n,o,a);return u!==void 0&&this.fontCache.set(h,u),u}}class Gr{static makeCacheKey(t){return!1}static resolveDefaults(t){return{}}}function Sr(s,t,e){const r=s.createShader(t);if(!r){const n=s.getError();throw new Error(`Unable to create the shader: ${t===s.VERTEX_SHADER?"VERTEX_SHADER":"FRAGMENT_SHADER"}.${n?` WebGlContext Error: ${n}`:""}`)}if(s.shaderSource(r,e),s.compileShader(r),!!s.getShaderParameter(r,s.COMPILE_STATUS))return r;console.error(s.getShaderInfoLog(r)),s.deleteShader(r)}function Qs(s,t,e){const r=s.createProgram();if(!r)throw new Error("Unable to create program");if(s.attachShader(r,t),s.attachShader(r,e),s.linkProgram(r),!!s.getProgramParameter(r,s.LINK_STATUS))return r;console.warn(s.getProgramInfoLog(r)),s.deleteProgram(r)}class pe extends Gr{constructor(e){super();l(this,"boundBufferCollection",null);l(this,"buffersBound",!1);l(this,"program");l(this,"vao");l(this,"renderer");l(this,"glw");l(this,"attributeBuffers");l(this,"attributeLocations");l(this,"attributeNames");l(this,"uniformLocations");l(this,"uniformTypes");l(this,"supportsIndexedTextures");const r=this.renderer=e.renderer,i=this.glw=this.renderer.glw;this.supportsIndexedTextures=e.supportsIndexedTextures||!1;const n=i.isWebGl2(),o=n&&e.webgl2Extensions||!n&&e.webgl1Extensions||[],a=n?"2.0":"1.0";o.forEach(T=>{if(!i.getExtension(T))throw new Error(`Shader "${this.constructor.name}" requires extension "${T}" for WebGL ${a} but wasn't found`)});const h=e.shaderSources||this.constructor.shaderSources;if(h)n&&(h!=null&&h.webGl2)&&(h.fragment=h.webGl2.fragment,h.vertex=h.webGl2.vertex,delete h.webGl2);else throw new Error(`Shader "${this.constructor.name}" is missing shaderSources.`);const u=r.system.parameters.MAX_VERTEX_TEXTURE_IMAGE_UNITS,d=h.vertex instanceof Function?h.vertex(u):h.vertex,c=h.fragment instanceof Function?h.fragment(u):h.fragment,p=Sr(i,i.VERTEX_SHADER,d),f=Sr(i,i.FRAGMENT_SHADER,c);if(!p||!f)throw new Error(`Unable to create the following shader(s): ${[!p&&"VERTEX_SHADER",!f&&"FRAGMENT_SHADER"].filter(Boolean).join(" and ")}`);const _=Qs(i,p,f);if(!_)throw new Error("Unable to create program");this.program=_,this.attributeLocations={},this.attributeBuffers={},this.attributeNames=[],[...e.attributes].forEach(T=>{const w=i.getAttribLocation(this.program,T);if(w<0)throw new Error(`${this.constructor.name}: Vertex shader must have an attribute "${T}"!`);const b=i.createBuffer();if(!b)throw new Error(`${this.constructor.name}: Could not create buffer for attribute "${T}"`);this.attributeLocations[T]=w,this.attributeBuffers[T]=b,this.attributeNames.push(T)}),this.uniformLocations={},this.uniformTypes={},e.uniforms.forEach(T=>{const w=i.getUniformLocation(this.program,T.name);if(this.uniformTypes[T.name]=T.uniform,!w){console.warn(`Shader "${this.constructor.name}" could not get uniform location for "${T.name}"`);return}this.uniformLocations[T.name]=w})}bindBufferAttribute(e,r,i){const{glw:n}=this;n.enableVertexAttribArray(e),n.vertexAttribPointer(r,e,i.size,i.type,i.normalized,i.stride,i.offset)}disableAttribute(e){this.glw.disableVertexAttribArray(e)}disableAttributes(){for(const e in this.attributeLocations)this.disableAttribute(this.attributeLocations[e]);this.boundBufferCollection=null}canBatchShaderProps(e,r){return!1}bindRenderOp(e,r){this.bindBufferCollection(e.buffers),e.textures.length>0&&this.bindTextures(e.textures);const{glw:i,parentHasRenderTexture:n,renderToTexture:o}=e;if(!(o&&n)){if(n){const{width:a,height:h}=e.framebufferDimensions||{};i.uniform1f(this.getUniformLocation("u_pixelRatio"),1),i.uniform2f(this.getUniformLocation("u_resolution"),a??0,h??0)}else i.uniform1f(this.getUniformLocation("u_pixelRatio"),e.options.pixelRatio),i.uniform2f(this.getUniformLocation("u_resolution"),i.canvas.width,i.canvas.height);if(r){if(xt(r,"$dimensions")){let a=r.$dimensions;a||(a=e.dimensions),i.uniform2f(this.getUniformLocation("u_dimensions"),a.width,a.height)}if(xt(r,"$alpha")){let a=r.$alpha;a||(a=e.alpha),i.uniform1f(this.getUniformLocation("u_alpha"),a)}this.bindProps(r)}}}getUniformLocation(e){return this.uniformLocations[e]||null}bindBufferCollection(e){if(this.boundBufferCollection!==e){for(const r in this.attributeLocations){const i=e.getBuffer(r),n=e.getAttributeInfo(r);M(i,`Buffer for "${r}" not found`),M(n),this.bindBufferAttribute(this.attributeLocations[r],i,n)}this.boundBufferCollection=e}}bindProps(e){}bindTextures(e){}attach(){this.glw.useProgram(this.program),this.glw.isWebGl2()&&this.vao&&this.glw.bindVertexArray(this.vao)}detach(){this.disableAttributes()}}l(pe,"shaderSources");class Wr extends pe{constructor(t){super({renderer:t,attributes:["a_position","a_textureCoordinate","a_color"],uniforms:[{name:"u_resolution",uniform:"uniform2fv"},{name:"u_pixelRatio",uniform:"uniform1f"},{name:"u_texture",uniform:"uniform2fv"}]})}bindTextures(t){const{glw:e}=this;e.activeTexture(0),e.bindTexture(t[0].ctxTexture)}}l(Wr,"shaderSources",{vertex:`
      # ifdef GL_FRAGMENT_PRECISION_HIGH
      precision highp float;
      # else
      precision mediump float;
      # endif

      attribute vec2 a_position;
      attribute vec2 a_textureCoordinate;
      attribute vec4 a_color;

      uniform vec2 u_resolution;
      uniform float u_pixelRatio;


      varying vec4 v_color;
      varying vec2 v_textureCoordinate;

      void main() {
        vec2 normalized = a_position * u_pixelRatio;
        vec2 screenSpace = vec2(2.0 / u_resolution.x, -2.0 / u_resolution.y);

        v_color = a_color;
        v_textureCoordinate = a_textureCoordinate;

        gl_Position = vec4(normalized.x * screenSpace.x - 1.0, normalized.y * -abs(screenSpace.y) + 1.0, 0.0, 1.0);
        gl_Position.y = -sign(screenSpace.y) * gl_Position.y;
      }
    `,fragment:`
      # ifdef GL_FRAGMENT_PRECISION_HIGH
      precision highp float;
      # else
      precision mediump float;
      # endif

      uniform vec2 u_resolution;
      uniform sampler2D u_texture;

      varying vec4 v_color;
      varying vec2 v_textureCoordinate;

      void main() {
          vec4 color = texture2D(u_texture, v_textureCoordinate);
          gl_FragColor = vec4(v_color) * texture2D(u_texture, v_textureCoordinate);
      }
    `});class Hr extends pe{constructor(e){super({renderer:e,attributes:["a_position","a_textureCoordinate","a_color","a_textureIndex"],uniforms:[{name:"u_resolution",uniform:"uniform2fv"},{name:"u_pixelRatio",uniform:"uniform1f"},{name:"u_textures[0]",uniform:"uniform1iv"}]});l(this,"supportsIndexedTextures",!0)}bindTextures(e){const{renderer:r,glw:i}=this;if(e.length>r.system.parameters.MAX_VERTEX_TEXTURE_IMAGE_UNITS)throw new Error(`DefaultShaderBatched: Cannot bind more than ${r.system.parameters.MAX_VERTEX_TEXTURE_IMAGE_UNITS} textures`);e.forEach((o,a)=>{i.activeTexture(a),i.bindTexture(o.ctxTexture)});const n=Array.from(Array(e.length).keys());this.glw.uniform1iv(this.getUniformLocation("u_textures[0]"),n)}}l(Hr,"shaderSources",{vertex:`
      # ifdef GL_FRAGMENT_PRECISION_HIGH
      precision highp float;
      # else
      precision mediump float;
      # endif

      attribute vec2 a_textureCoordinate;
      attribute vec2 a_position;
      attribute vec4 a_color;
      attribute float a_textureIndex;
      attribute float a_depth;

      uniform vec2 u_resolution;
      uniform float u_pixelRatio;

      varying vec4 v_color;
      varying vec2 v_textureCoordinate;
      varying float v_textureIndex;

      void main(){
        vec2 normalized = a_position * u_pixelRatio / u_resolution;
        vec2 zero_two = normalized * 2.0;
        vec2 clip_space = zero_two - 1.0;

        // pass to fragment
        v_color = a_color;
        v_textureCoordinate = a_textureCoordinate;
        v_textureIndex = a_textureIndex;

        // flip y
        gl_Position = vec4(clip_space * vec2(1.0, -1.0), 0, 1);
      }
    `,fragment:e=>`
      #define txUnits ${e}
      # ifdef GL_FRAGMENT_PRECISION_HIGH
      precision highp float;
      # else
      precision mediump float;
      # endif

      uniform vec2 u_resolution;
      uniform sampler2D u_image;
      uniform sampler2D u_textures[txUnits];

      varying vec4 v_color;
      varying vec2 v_textureCoordinate;
      varying float v_textureIndex;

      vec4 sampleFromTexture(sampler2D textures[${e}], int idx, vec2 uv) {
        ${Array.from(Array(e).keys()).map(r=>`
          ${r!==0?"else ":""}if (idx == ${r}) {
            return texture2D(textures[${r}], uv);
          }
        `).join("")}
        return texture2D(textures[0], uv);
      }

      void main(){
        gl_FragColor = vec4(v_color) * sampleFromTexture(u_textures, int(v_textureIndex), v_textureCoordinate);
      }
    `});class ${constructor(t){l(this,"priority",1);l(this,"name","");l(this,"ref");l(this,"target");l(this,"passParameters","");l(this,"declaredUniforms","");l(this,"uniformInfo",{});const{ref:e,target:r,props:i={}}=t;this.ref=e,this.target=r;const n={},o=[];let a="";const h=this.constructor.uniforms||{};for(const u in h){const d=h[u],c=d.type,p=`${e}_${u}`;let f="";d.size&&(f=`[${d.size(i)}]`),o.push(p),a+=`uniform ${c} ${p}${f};`,n[u]={name:p,uniform:h[u].method}}this.passParameters=o.join(","),this.declaredUniforms=a,this.uniformInfo=n}static getEffectKey(t){return""}static getMethodParameters(t,e){const r=[];for(const i in t){const n=t[i];let o="";n.size&&(o=`[${n.size(e)}]`),r.push(`${n.type} ${i}${o}`)}return r.join(",")}static resolveDefaults(t){return{}}static makeEffectKey(t){return!1}}l($,"uniforms",{}),l($,"methods"),l($,"onShaderMask"),l($,"onColorize"),l($,"onEffectMask");const $t=new Map,js=(s,t)=>{const e=JSON.stringify(s);if($t.has(e))return $t.get(e);s=s??[];const r=[],i=s.length;let n=0;for(;n<i;n++){const{name:o,type:a,props:h}=s[n],u={name:o,type:a,props:{}},d=t[a],c=d.resolveDefaults(h),p=d.uniforms,f=Object.keys(p),_=f.length;let T=0;for(;T<_;T++){const w=f[T],b=p[w],g={value:c[w],programValue:void 0,method:b.method,updateOnBind:b.updateOnBind||!1,hasValidator:b.validator!==void 0,hasProgramValueUpdater:b.updateProgramValue!==void 0},x=g.hasValidator&&b.validator(c[w],c)||c[w];c[w]!==x&&(g.validatedValue=x),g.hasProgramValueUpdater&&b.updateProgramValue(g),g.programValue===void 0&&(g.programValue=g.value),u.props[w]=g}r.push(u)}return $t.set(e,r),r},ee=class ee extends pe{constructor(e,r,i){const n=ee.createShader(r,i);super({renderer:e,attributes:["a_position","a_textureCoordinate","a_color"],uniforms:[{name:"u_resolution",uniform:"uniform2fv"},{name:"u_pixelRatio",uniform:"uniform1f"},{name:"u_texture",uniform:"uniform2fv"},{name:"u_dimensions",uniform:"uniform2fv"},{name:"u_alpha",uniform:"uniform1f"},...n.uniforms],shaderSources:{vertex:n.vertex,fragment:n.fragment}});l(this,"effects",[]);this.effects=n.effects}bindTextures(e){const{glw:r}=this;r.activeTexture(0),r.bindTexture(e[0].ctxTexture)}bindUniformMethods(e){const r=this.glw,i=e.effects,n=i.length;for(let o=0;o<n;o++){const a=this.effects[o].uniformInfo,h=i[o],u=Object.keys(h.props),d=u.length;for(let c=0;c<d;c++){const p=u[c],f=h.props[p].method,_=this.getUniformLocation(a[p].name);if(f==="uniform2fv"||f==="uniform2iv"||f==="uniform3iv"||f==="uniform4fv"||f==="uniform4iv"||f==="uniformMatrix2fv"||f==="uniformMatrix3fv"||f==="uniformMatrix4fv"||f==="uniform1f"||f==="uniform1fv"||f==="uniform1i"||f==="uniform1iv"){h.props[p].setUniformValue=function(){r[f](_,this.programValue)};continue}if(f==="uniform2f"||f==="uniform2i"){h.props[p].setUniformValue=function(){r[f](_,this.programValue[0],this.programValue[1])};continue}if(f==="uniform3f"||f==="uniform3i"){h.props[p].setUniformValue=function(){r[f](_,this.programValue[0],this.programValue[1],this.programValue[2])};continue}if(f==="uniform4f"||f==="uniform4i"){h.props[p].setUniformValue=function(){r[f](_,this.programValue[0],this.programValue[1],this.programValue[2],this.programValue[3])};continue}}}}bindProps(e){var o;const r=e.effects,i=r.length;let n=0;for(;n<i;n++){const a=r[n],h=Object.keys(a.props),u=h.length;let d=0;for(;d<u;d++){const c=h[d],p=a.props[c];if(p.updateOnBind===!0){const f=(o=this.renderer.shManager.getRegisteredEffects()[a.type])==null?void 0:o.uniforms[c];f==null||f.updateProgramValue(a.props[c],e)}p.setUniformValue()}}}canBatchShaderProps(e,r){if(e.$alpha!==r.$alpha||e.$dimensions.width!==r.$dimensions.width||e.$dimensions.height!==r.$dimensions.height||e.effects.length!==r.effects.length)return!1;const i=e.effects.length;let n=0;for(;n<i;n++){const o=e.effects[n],a=r.effects[n];if(o.type!==a.type)return!1;for(const h in o.props)if(a.props&&!a.props[h]||o.props[h].value!==a.props[h].value)return!1}return!0}static createShader(e,r){const i={},n={};let o="";const a=[],h=[],u=e.effects.map(_=>{const T=r[_.type],w=T.getEffectKey(_.props||{});i[w]=i[w]?++i[w]:1;const b=i[w];b===1&&h.push({key:w,type:_.type,props:_.props});const g=new T({ref:`${w}${b===1?"":b}`,target:w,props:_.props});return o+=g.declaredUniforms,a.push(...Object.values(g.uniformInfo)),g});let d="";h==null||h.forEach(_=>{const T=r[_.type],w=T.resolveDefaults(_.props??{}),b=[];for(const A in T.methods){let R=A;const v=T.methods[A];n[A]&&n[A]!==v&&(R=ee.resolveMethodDuplicate(A,v,n)),n[R]=v.replace("function",R),b.push({m:A,cm:R})}let g=T.onShaderMask instanceof Function?T.onShaderMask(w):T.onShaderMask,x=T.onColorize instanceof Function?T.onColorize(w):T.onColorize,m=T.onEffectMask instanceof Function?T.onEffectMask(w):T.onEffectMask;b.forEach(A=>{const{m:R,cm:v}=A,C=new RegExp(`\\$${R}`,"g");g&&(g=g.replace(C,v)),x&&(x=x.replace(C,v)),m&&(m=m.replace(C,v))});const S=T.getMethodParameters(T.uniforms,w),E=S.length>0?`, ${S}`:"";g&&(d+=`
        float fx_${_.key}_onShaderMask(float shaderMask ${E}) {
          ${g}
        }
        `),x&&(d+=`
          vec4 fx_${_.key}_onColorize(float shaderMask, vec4 maskColor, vec4 shaderColor${E}) {
            ${x}
          }
        `),m&&(d+=`
          vec4 fx_${_.key}_onEffectMask(float shaderMask, vec4 maskColor, vec4 shaderColor${E}) {
            ${m}
          }
        `)});let c="";for(const _ in n)c+=n[_];let p="mix(shaderColor, maskColor, clamp(-(lng_DefaultMask), 0.0, 1.0))",f=`

    `;for(let _=0;_<u.length;_++){const T=u[_],w=T.passParameters.length>0?`, ${T.passParameters}`:"",b=r[T.name];b.onShaderMask&&(f+=`
        shaderMask = fx_${T.target}_onShaderMask(shaderMask ${w});
        `),b.onColorize&&(f+=`
        maskColor = fx_${T.target}_onColorize(shaderMask, maskColor, shaderColor${w});
        `),b.onEffectMask&&(p=`fx_${T.target}_onEffectMask(shaderMask, maskColor, shaderColor${w})`);const g=u[_+1];(g===void 0||r[g.name].onEffectMask)&&(f+=`
          shaderColor = ${p};
        `)}return{effects:u,uniforms:a,fragment:ee.fragment(o,c,d,f),vertex:ee.vertex()}}static resolveMethodDuplicate(e,r,i,n=0){const o=e+(n>0?n:"");return i[o]&&i[o]!==r?this.resolveMethodDuplicate(e,r,i,++n):o}static resolveDefaults(e,r){return M(r),{effects:js(e.effects??[],r),$dimensions:{width:0,height:0},$alpha:0}}static makeCacheKey(e,r){var n;let i="";return(n=e.effects)==null||n.forEach(o=>{const h=r[o.type].getEffectKey(o.props||{});i+=`,${h}`}),`DynamicShader${i}`}};l(ee,"z$__type__Props"),l(ee,"vertex",()=>`
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision mediump float;
    # endif

    attribute vec2 a_textureCoordinate;
    attribute vec2 a_position;
    attribute vec4 a_color;
    attribute float a_textureIndex;

    uniform vec2 u_resolution;
    uniform float u_pixelRatio;

    varying vec4 v_color;
    varying vec2 v_textureCoordinate;
    varying float v_textureIndex;

    void main(){
      vec2 normalized = a_position * u_pixelRatio / u_resolution;
      vec2 zero_two = normalized * 2.0;
      vec2 clip_space = zero_two - 1.0;

      // pass to fragment
      v_color = a_color;
      v_textureCoordinate = a_textureCoordinate;
      v_textureIndex = a_textureIndex;

      // flip y
      gl_Position = vec4(clip_space * vec2(1.0, -1.0), 0, 1);
    }
  `),l(ee,"fragment",(e,r,i,n)=>`
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision mediump float;
    # endif

    #define PI 3.14159265359

    uniform vec2 u_resolution;
    uniform vec2 u_dimensions;
    uniform float u_alpha;
    uniform float u_radius;
    uniform sampler2D u_texture;
    uniform float u_pixelRatio;

    ${e}

    varying vec4 v_color;
    varying vec2 v_textureCoordinate;

    ${r}

    ${i}

    void main() {
      vec2 p = v_textureCoordinate.xy * u_dimensions - u_dimensions * 0.5;
      vec2 d = abs(p) - (u_dimensions) * 0.5;
      float lng_DefaultMask = min(max(d.x, d.y), 0.0) + length(max(d, 0.0));

      vec4 shaderColor = vec4(0.0);
      float shaderMask = lng_DefaultMask;

      vec4 maskColor = texture2D(u_texture, v_textureCoordinate) * v_color;

      shaderColor = mix(shaderColor, maskColor, clamp(-(lng_DefaultMask + 0.5), 0.0, 1.0));

      ${n}

      gl_FragColor = shaderColor * u_alpha;
    }
  `);let Ee=ee;class Zt extends pe{constructor(t){super({renderer:t,attributes:["a_position","a_textureCoordinate","a_color"],uniforms:[{name:"u_resolution",uniform:"uniform2fv"},{name:"u_pixelRatio",uniform:"uniform1f"},{name:"u_texture",uniform:"uniform2f"},{name:"u_dimensions",uniform:"uniform2fv"},{name:"u_radius",uniform:"uniform1f"}]})}static resolveDefaults(t){return{radius:t.radius||10,$dimensions:{width:0,height:0}}}bindTextures(t){const{glw:e}=this;e.activeTexture(0),e.bindTexture(t[0].ctxTexture)}bindProps(t){const e=Math.min(t.$dimensions.width,t.$dimensions.height)/(2*t.radius);this.glw.uniform1f(this.getUniformLocation("u_radius"),t.radius*Math.min(e,1))}canBatchShaderProps(t,e){return t.radius===e.radius&&t.$dimensions.width===e.$dimensions.width&&t.$dimensions.height===e.$dimensions.height}}l(Zt,"z$__type__Props"),l(Zt,"shaderSources",{vertex:`
      # ifdef GL_FRAGMENT_PRECISION_HIGH
      precision highp float;
      # else
      precision mediump float;
      # endif

      attribute vec2 a_position;
      attribute vec2 a_textureCoordinate;
      attribute vec4 a_color;
      attribute float a_textureIndex;
      attribute float a_depth;

      uniform vec2 u_resolution;
      uniform float u_pixelRatio;

      varying vec4 v_color;
      varying vec2 v_textureCoordinate;

      void main() {
        vec2 normalized = a_position * u_pixelRatio / u_resolution;
        vec2 zero_two = normalized * 2.0;
        vec2 clip_space = zero_two - 1.0;

        // pass to fragment
        v_color = a_color;
        v_textureCoordinate = a_textureCoordinate;

        // flip y
        gl_Position = vec4(clip_space * vec2(1.0, -1.0), 0, 1);
      }
    `,fragment:`
      # ifdef GL_FRAGMENT_PRECISION_HIGH
      precision highp float;
      # else
      precision mediump float;
      # endif

      uniform vec2 u_resolution;
      uniform vec2 u_dimensions;
      uniform float u_radius;
      uniform sampler2D u_texture;

      varying vec4 v_color;
      varying vec2 v_textureCoordinate;

      float boxDist(vec2 p, vec2 size, float radius){
        size -= vec2(radius);
        vec2 d = abs(p) - size;
        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0)) - radius;
      }

      float fillMask(float dist) {
        return clamp(-dist, 0.0, 1.0);
      }

      void main() {
        vec4 color = texture2D(u_texture, v_textureCoordinate) * v_color;
        vec2 halfDimensions = u_dimensions * 0.5;

        float d = boxDist(v_textureCoordinate.xy * u_dimensions - halfDimensions, halfDimensions + 0.5, u_radius);
        gl_FragColor = mix(vec4(0.0), color, fillMask(d));
      }
    `});const Zs=new Float32Array([1,0,0,0,1,0,0,0,1]),$e=class $e extends pe{constructor(t){super({renderer:t,attributes:["a_position","a_textureCoordinate"],uniforms:[{name:"u_resolution",uniform:"uniform2fv"},{name:"u_transform",uniform:"uniformMatrix3fv"},{name:"u_scrollY",uniform:"uniform1f"},{name:"u_pixelRatio",uniform:"uniform1f"},{name:"u_texture",uniform:"uniform2f"},{name:"u_color",uniform:"uniform4fv"},{name:"u_size",uniform:"uniform1f"},{name:"u_distanceRange",uniform:"uniform1f"},{name:"u_debug",uniform:"uniform1i"}]})}bindTextures(t){const{glw:e}=this;e.activeTexture(0),e.bindTexture(t[0].ctxTexture)}bindProps(t){const e=$e.resolveDefaults(t);for(const r in e)if(r==="transform")this.glw.uniformMatrix3fv(this.getUniformLocation("u_transform"),e[r]);else if(r==="scrollY")this.glw.uniform1f(this.getUniformLocation("u_scrollY"),e[r]);else if(r==="color"){const i=Pt(e.color);this.glw.uniform4fv(this.getUniformLocation("u_color"),i)}else r==="size"?this.glw.uniform1f(this.getUniformLocation("u_size"),e[r]):r==="distanceRange"?this.glw.uniform1f(this.getUniformLocation("u_distanceRange"),e[r]):r==="debug"&&this.glw.uniform1i(this.getUniformLocation("u_debug"),e[r]?1:0)}static resolveDefaults(t={}){return{transform:t.transform??Zs,scrollY:t.scrollY??0,color:t.color??4294967295,size:t.size??16,distanceRange:t.distanceRange??1,debug:t.debug??!1}}};l($e,"z$__type__Props"),l($e,"shaderSources",{vertex:`
      # ifdef GL_FRAGMENT_PRECISION_HIGH
      precision highp float;
      # else
      precision mediump float;
      # endif
      // an attribute is an input (in) to a vertex shader.
      // It will receive data from a buffer
      attribute vec2 a_position;
      attribute vec2 a_textureCoordinate;

      uniform vec2 u_resolution;
      uniform mat3 u_transform;
      uniform float u_scrollY;
      uniform float u_pixelRatio;
      uniform float u_size;

      varying vec2 v_texcoord;

      void main() {
        vec2 scrolledPosition = a_position * u_size - vec2(0, u_scrollY);
        vec2 transformedPosition = (u_transform * vec3(scrolledPosition, 1)).xy;

        // Calculate screen space with pixel ratio
        vec2 screenSpace = (transformedPosition * u_pixelRatio / u_resolution * 2.0 - 1.0) * vec2(1, -1);

        gl_Position = vec4(screenSpace, 0.0, 1.0);
        v_texcoord = a_textureCoordinate;

      }
    `,fragment:`
      # ifdef GL_FRAGMENT_PRECISION_HIGH
      precision highp float;
      # else
      precision mediump float;
      # endif
      uniform vec4 u_color;
      uniform sampler2D u_texture;
      uniform float u_distanceRange;
      uniform float u_pixelRatio;
      uniform int u_debug;

      varying vec2 v_texcoord;

      float median(float r, float g, float b) {
          return max(min(r, g), min(max(r, g), b));
      }

      void main() {
          vec3 sample = texture2D(u_texture, v_texcoord).rgb;
          if (u_debug == 1) {
            gl_FragColor = vec4(sample.r, sample.g, sample.b, 1.0);
            return;
          }
          float scaledDistRange = u_distanceRange * u_pixelRatio;
          float sigDist = scaledDistRange * (median(sample.r, sample.g, sample.b) - 0.5);
          float opacity = clamp(sigDist + 0.5, 0.0, 1.0) * u_color.a;

          // Build the final color.
          // IMPORTANT: We must premultiply the color by the alpha value before returning it.
          gl_FragColor = vec4(u_color.r * opacity, u_color.g * opacity, u_color.b * opacity, opacity);
      }
    `});let Jt=$e;const Me=s=>{s.programValue===void 0&&(s.programValue=new Float32Array(4));const t=s.value,e=s.programValue;e[0]=(t>>>24)/255,e[1]=(t>>>16&255)/255,e[2]=(t>>>8&255)/255,e[3]=(t&255)/255},Js=s=>{const t=s.validatedValue||s.value;if(s.programValue instanceof Float32Array){const e=s.programValue;e[0]=t[0],e[1]=t[1]}else s.programValue=new Float32Array(t)},ei=s=>{const t=s.validatedValue||s.value;if(s.programValue instanceof Float32Array){const e=s.programValue;e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]}else s.programValue=new Float32Array(t)},Yr=s=>{const t=s.validatedValue||s.value;if(s.programValue instanceof Float32Array){const e=t.length,r=s.programValue;for(let i=0;i<e;i++)r[i]=t[i]}else s.programValue=new Float32Array(t)},ur=s=>{const t=Array.isArray(s);if(t){if(t&&s.length===4)return s;if(t&&s.length===2)return[s[0],s[1],s[0],s[1]];if(t&&s.length===3)return[s[0],s[1],s[2],s[0]]}else return[s,s,s,s];return[s[0],s[0],s[0],s[0]]},qr=(s,t)=>{s.programValue===void 0&&(s.programValue=new Float32Array(4));const e=s.programValue,r=s.validatedValue||s.value;if(t===void 0&&s.$dimensions===void 0){e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3];return}let i=s.$dimensions;if(t!==void 0){const{$dimensions:p}=t;if(i!==void 0&&(i.width===p.width||i.height===p.height))return;i===void 0&&(i={width:p==null?void 0:p.width,height:p==null?void 0:p.height},s.$dimensions=i)}const{width:n,height:o}=i,[a,h,u,d]=r,c=Math.min(Math.min(Math.min(n/Math.max(n,a+h),n/Math.max(n,u+d)),Math.min(o/Math.max(o,a+u),o/Math.max(o,h+d))),1);e[0]=a*c,e[1]=h*c,e[2]=u*c,e[3]=d*c};class Te extends ${constructor(){super(...arguments);l(this,"name","radius")}static getEffectKey(){return"radius"}static resolveDefaults(e){return{radius:e.radius??10}}}l(Te,"z$__type__Props"),l(Te,"uniforms",{radius:{value:0,method:"uniform4fv",type:"vec4",updateOnBind:!0,validator:ur,updateProgramValue:qr}}),l(Te,"methods",{fillMask:`
      float function(float dist) {
        return clamp(-dist, 0.0, 1.0);
      }
    `,boxDist:`
      float function(vec2 p, vec2 size, float radius) {
        size -= vec2(radius);
        vec2 d = abs(p) - size;
        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0)) - radius;
      }
    `}),l(Te,"onShaderMask",`
  vec2 halfDimensions = u_dimensions * 0.5;
  float r = radius[0] * step(v_textureCoordinate.x, 0.5) * step(v_textureCoordinate.y, 0.5);
  r = r + radius[1] * step(0.5, v_textureCoordinate.x) * step(v_textureCoordinate.y, 0.5);
  r = r + radius[2] * step(0.5, v_textureCoordinate.x) * step(0.5, v_textureCoordinate.y);
  r = r + radius[3] * step(v_textureCoordinate.x, 0.5) * step(0.5, v_textureCoordinate.y);
  return $boxDist(v_textureCoordinate.xy * u_dimensions - halfDimensions, halfDimensions, r);
  `),l(Te,"onEffectMask",`
  return mix(vec4(0.0), maskColor, $fillMask(shaderMask));
  `);class Le extends ${constructor(){super(...arguments);l(this,"name","border")}static getEffectKey(){return"border"}static resolveDefaults(e){return{width:e.width??10,color:e.color??4294967295}}}l(Le,"z$__type__Props"),l(Le,"uniforms",{width:{value:0,method:"uniform1f",type:"float"},color:{value:4294967295,updateProgramValue:Me,method:"uniform4fv",type:"vec4"}}),l(Le,"onEffectMask",`
  float intR = shaderMask + 1.0;
  float mask = clamp(intR + width, 0.0, 1.0) - clamp(intR, 0.0, 1.0);
  return mix(shaderColor, mix(shaderColor, maskColor, maskColor.a), mask);
  `),l(Le,"onColorize",`
    return color;
  `);const se=class se extends ${constructor(){super(...arguments);l(this,"name","linearGradient")}static getEffectKey(e){return e.colors.value?`linearGradient${e.colors.value.length}`:`linearGradient${e.colors.length}`}static resolveDefaults(e){const r=e.colors??[4278190080,4294967295];let i=e.stops||[];if(i.length===0||i.length!==r.length){const n=r.length;let o=0;const a=i;for(;o<n;o++)i[o]?(a[o]=i[o],i[o-1]===void 0&&a[o-2]!==void 0&&(a[o-1]=a[o-2]+(i[o]-a[o-2])/2)):a[o]=o*(1/(r.length-1));i=a}return{colors:r,stops:i,angle:e.angle??0}}};l(se,"z$__type__Props"),l(se,"uniforms",{angle:{value:0,method:"uniform1f",type:"float"},colors:{value:4294967295,validator:e=>e.reduce((r,i)=>r.concat(Pt(i)),[]),updateProgramValue:Yr,size:e=>e.colors.length,method:"uniform4fv",type:"vec4"},stops:{value:[],size:e=>e.colors.length,method:"uniform1fv",type:"float"}}),l(se,"methods",{fromLinear:`
      vec4 function(vec4 linearRGB) {
        vec4 higher = vec4(1.055)*pow(linearRGB, vec4(1.0/2.4)) - vec4(0.055);
        vec4 lower = linearRGB * vec4(12.92);
        return mix(higher, lower, 1.0);
      }
    `,toLinear:`
      vec4 function(vec4 sRGB) {
        vec4 higher = pow((sRGB + vec4(0.055))/vec4(1.055), vec4(2.4));
        vec4 lower = sRGB/vec4(12.92);
        return mix(higher, lower, 1.0);
      }
    `,calcPoint:`
      vec2 function(float d, float angle) {
        return d * vec2(cos(angle), sin(angle)) + (u_dimensions * 0.5);
      }
    `}),l(se,"ColorLoop",e=>{let r="";for(let i=2;i<e;i++)r+=`colorOut = mix(colorOut, colors[${i}], clamp((dist - stops[${i-1}]) / (stops[${i}] - stops[${i-1}]), 0.0, 1.0));`;return r}),l(se,"onColorize",e=>{const r=e.colors.length||1;return`
      float a = angle - (PI / 180.0 * 90.0);
      float lineDist = abs(u_dimensions.x * cos(a)) + abs(u_dimensions.y * sin(a));
      vec2 f = $calcPoint(lineDist * 0.5, a);
      vec2 t = $calcPoint(lineDist * 0.5, a + PI);
      vec2 gradVec = t - f;
      float dist = dot(v_textureCoordinate.xy * u_dimensions - f, gradVec) / dot(gradVec, gradVec);

      float stopCalc = (dist - stops[0]) / (stops[1] - stops[0]);
      vec4 colorOut = $fromLinear(mix($toLinear(colors[0]), $toLinear(colors[1]), stopCalc));
      ${se.ColorLoop(r)}
      return mix(maskColor, colorOut, clamp(colorOut.a, 0.0, 1.0));
    `});let er=se;class tr extends ${constructor(){super(...arguments);l(this,"name","grayscale")}static getEffectKey(){return"grayscale"}static resolveDefaults(e){return{amount:e.amount??1}}}l(tr,"uniforms",{amount:{value:1,method:"uniform1f",type:"float"}}),l(tr,"onColorize",`
    float grayness = 0.2 * maskColor.r + 0.6 * maskColor.g + 0.2 * maskColor.b;
    return vec4(amount * vec3(grayness) + (1.0 - amount) * maskColor.rgb, maskColor.a);
  `);class ye extends ${constructor(){super(...arguments);l(this,"name","borderRight")}static getEffectKey(){return"borderRight"}static resolveDefaults(e){return{width:e.width??10,color:e.color??4294967295}}}l(ye,"z$__type__Props"),l(ye,"uniforms",{width:{value:0,method:"uniform1f",type:"float"},color:{value:4294967295,updateProgramValue:Me,method:"uniform4fv",type:"vec4"}}),l(ye,"methods",{fillMask:`
      float function(float dist) {
        return clamp(-dist, 0.0, 1.0);
      }
    `,rectDist:`
      float function(vec2 p, vec2 size) {
        vec2 d = abs(p) - size;
        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));
      }
    `}),l(ye,"onEffectMask",`
  vec2 pos = vec2(u_dimensions.x - width * 0.5, 0.0);
  float mask = $rectDist(v_textureCoordinate.xy * u_dimensions - pos, vec2(width*0.5, u_dimensions.y));
  return mix(shaderColor, maskColor, $fillMask(mask));
  `),l(ye,"onColorize",`
    return color;
  `);class ve extends ${constructor(){super(...arguments);l(this,"name","borderTop")}static getEffectKey(){return"borderTop"}static resolveDefaults(e){return{width:e.width??10,color:e.color??4294967295}}}l(ve,"z$__type__Props"),l(ve,"uniforms",{width:{value:0,method:"uniform1f",type:"float"},color:{value:4294967295,updateProgramValue:Me,method:"uniform4fv",type:"vec4"}}),l(ve,"methods",{fillMask:`
      float function(float dist) {
        return clamp(-dist, 0.0, 1.0);
      }
    `,rectDist:`
      float function(vec2 p, vec2 size) {
        vec2 d = abs(p) - size;
        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));
      }
    `}),l(ve,"onEffectMask",`
  vec2 pos = vec2(0.0, width * 0.5);
  float mask = $rectDist(v_textureCoordinate.xy * u_dimensions - pos, vec2(u_dimensions.x, width*0.5));
  return mix(shaderColor, maskColor, $fillMask(mask));
  `),l(ve,"onColorize",`
    return color;
  `);class _e extends ${constructor(){super(...arguments);l(this,"name","borderBottom")}static getEffectKey(){return"borderBottom"}static resolveDefaults(e){return{width:e.width??10,color:e.color??4294967295}}}l(_e,"z$__type__Props"),l(_e,"uniforms",{width:{value:0,method:"uniform1f",type:"float"},color:{value:4294967295,updateProgramValue:Me,method:"uniform4fv",type:"vec4"}}),l(_e,"methods",{fillMask:`
      float function(float dist) {
        return clamp(-dist, 0.0, 1.0);
      }
    `,rectDist:`
      float function(vec2 p, vec2 size) {
        vec2 d = abs(p) - size;
        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));
      }
    `}),l(_e,"onEffectMask",`
  vec2 pos = vec2(0.0, u_dimensions.y - width * 0.5);
  float mask = $rectDist(v_textureCoordinate.xy * u_dimensions - pos, vec2(u_dimensions.x, width*0.5));
  return mix(shaderColor, maskColor, $fillMask(mask));
  `),l(_e,"onColorize",`
    return color;
  `);class Re extends ${constructor(){super(...arguments);l(this,"name","borderLeft")}static getEffectKey(){return"borderLeft"}static resolveDefaults(e){return{width:e.width??10,color:e.color??4294967295}}}l(Re,"z$__type__Props"),l(Re,"uniforms",{width:{value:0,method:"uniform1f",type:"float"},color:{value:4294967295,updateProgramValue:Me,method:"uniform4fv",type:"vec4"}}),l(Re,"methods",{fillMask:`
      float function(float dist) {
        return clamp(-dist, 0.0, 1.0);
      }
    `,rectDist:`
      float function(vec2 p, vec2 size) {
        vec2 d = abs(p) - size;
        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));
      }
    `}),l(Re,"onEffectMask",`
  vec2 pos = vec2(width * 0.5, 0.0);
  float mask = $rectDist(v_textureCoordinate.xy * u_dimensions - pos, vec2(width*0.5, u_dimensions.y));
  return mix(shaderColor, maskColor, $fillMask(mask));
  `),l(Re,"onColorize",`
    return color;
  `);class Oe extends ${constructor(){super(...arguments);l(this,"name","glitch")}static getEffectKey(e){return"glitch"}static resolveDefaults(e){return{amplitude:e.amplitude??.2,narrowness:e.narrowness??4,blockiness:e.blockiness??2,minimizer:e.minimizer??8,time:e.time??Date.now()}}}l(Oe,"z$__type__Props"),l(Oe,"uniforms",{amplitude:{value:0,method:"uniform1f",type:"float"},narrowness:{value:0,method:"uniform1f",type:"float"},blockiness:{value:0,method:"uniform1f",type:"float"},minimizer:{value:0,method:"uniform1f",type:"float"},time:{value:0,method:"uniform1f",updateOnBind:!0,updateProgramValue:e=>{const r=e.value=(Date.now()-e.value)%1e3;e.programValue=r},type:"float"}}),l(Oe,"methods",{rand:`
      float function(vec2 p, float time) {
        float t = floor(time * 20.) / 10.;
        return fract(sin(dot(p, vec2(t * 12.9898, t * 78.233))) * 43758.5453);
      }
    `,noise:`
      float function(vec2 uv, float blockiness, float time) {
        vec2 lv = fract(uv);
        vec2 id = floor(uv);

        float n1 = rand(id, time);
        float n2 = rand(id+vec2(1,0), time);
        float n3 = rand(id+vec2(0,1), time);
        float n4 = rand(id+vec2(1,1), time);
        vec2 u = smoothstep(0.0, 1.0 + blockiness, lv);
        return mix(mix(n1, n2, u.x), mix(n3, n4, u.x), u.y);
      }
    `,fbm:`
      float function(vec2 uv, int count, float blockiness, float complexity, float time) {
        float val = 0.0;
        float amp = 0.5;
        const int MAX_ITERATIONS = 10;

        for(int i = 0; i < MAX_ITERATIONS; i++) {
          if(i >= count) {break;}
          val += amp * noise(uv, blockiness, time);
          amp *= 0.5;
          uv *= complexity;
        }
        return val;
      }
    `}),l(Oe,"onColorize",`
    vec2 uv = v_textureCoordinate.xy;
    float aspect = u_dimensions.x / u_dimensions.y;
    vec2 a = vec2(uv.x * aspect , uv.y);
    vec2 uv2 = vec2(a.x / u_dimensions.x, exp(a.y));

    float shift = amplitude * pow($fbm(uv2, 4, blockiness, narrowness, time), minimizer);
    float colR = texture2D(u_texture, vec2(uv.x + shift, uv.y)).r * (1. - shift);
    float colG = texture2D(u_texture, vec2(uv.x - shift, uv.y)).g * (1. - shift);
    float colB = texture2D(u_texture, vec2(uv.x - shift, uv.y)).b * (1. - shift);

    vec3 f = vec3(colR, colG, colB);
    return vec4(f, texture2D(u_texture, vec2(uv.x - shift, uv.y)).a);
  `);class ft extends ${constructor(){super(...arguments);l(this,"name","fadeOut")}static getEffectKey(){return"fadeOut"}static resolveDefaults(e){return{fade:e.fade??10}}}l(ft,"z$__type__Props"),l(ft,"uniforms",{fade:{value:0,method:"uniform4fv",type:"vec4",validator:ur,updateProgramValue:ei}}),l(ft,"onColorize",`
  vec2 point = v_textureCoordinate.xy * u_dimensions.xy;
  vec2 pos1;
  vec2 pos2;
  vec2 d;
  float c;
  vec4 result = maskColor;


  if(fade[0] > 0.0) {
    pos1 = vec2(point.x, point.y);
    pos2 = vec2(point.x, point.y + fade[0]);
    d = pos2 - pos1;
    c = dot(pos1, d) / dot(d, d);
    result = mix(vec4(0.0), result, smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0)));
  }

  if(fade[1] > 0.0) {
    pos1 = vec2(point.x - u_dimensions.x - fade[1], v_textureCoordinate.y);
    pos2 = vec2(point.x - u_dimensions.x, v_textureCoordinate.y);
    d = pos1 - pos2;
    c = dot(pos2, d) / dot(d, d);
    result = mix(vec4(0.0), result, smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0)));
  }

  if(fade[2] > 0.0) {
    pos1 = vec2(v_textureCoordinate.x, point.y - u_dimensions.y - fade[2]);
    pos2 = vec2(v_textureCoordinate.x, point.y - u_dimensions.y);
    d = pos1 - pos2;
    c = dot(pos2, d) / dot(d, d);
    result = mix(vec4(0.0), result, smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0)));
  }

  if(fade[3] > 0.0) {
    pos1 = vec2(point.x, point.y);
    pos2 = vec2(point.x + fade[3], point.y);
    d = pos2 - pos1;
    c = dot(pos1, d) / dot(d, d);
    result = mix(vec4(0.0), result, smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0)));
  }

  return result;
  `);const ae=class ae extends ${constructor(){super(...arguments);l(this,"name","radialGradient")}static getEffectKey(e){return e.colors.value?`radialGradient${e.colors.value.length}`:`radialGradient${e.colors.length}`}static resolveDefaults(e){const r=e.colors??[4278190080,4294967295];let i=e.stops||[];if(i.length===0||i.length!==r.length){const n=r.length;let o=0;const a=i;for(;o<n;o++)i[o]?(a[o]=i[o],i[o-1]===void 0&&a[o-2]!==void 0&&(a[o-1]=a[o-2]+(i[o]-a[o-2])/2)):a[o]=o*(1/(r.length-1));i=a}return{colors:r,stops:i,width:e.width??0,height:e.height??e.width??0,pivot:e.pivot??[.5,.5]}}};l(ae,"z$__type__Props"),l(ae,"uniforms",{width:{value:0,method:"uniform1f",type:"float"},height:{value:0,method:"uniform1f",type:"float"},pivot:{value:[.5,.5],updateProgramValue:Js,method:"uniform2fv",type:"vec2"},colors:{value:4294967295,validator:e=>e.reduce((r,i)=>r.concat(Pt(i)),[]),updateProgramValue:Yr,size:e=>e.colors.length,method:"uniform4fv",type:"vec4"},stops:{value:[],size:e=>e.colors.length,method:"uniform1fv",type:"float"}}),l(ae,"ColorLoop",e=>{let r="";for(let i=2;i<e;i++)r+=`colorOut = mix(colorOut, colors[${i}], clamp((dist - stops[${i-1}]) / (stops[${i}] - stops[${i-1}]), 0.0, 1.0));`;return r}),l(ae,"onColorize",e=>{const r=e.colors.length||1;return`
      vec2 point = v_textureCoordinate.xy * u_dimensions;
      vec2 projection = vec2(pivot.x * u_dimensions.x, pivot.y * u_dimensions.y);

      float dist = length((point - projection) / vec2(width, height));

      float stopCalc = (dist - stops[0]) / (stops[1] - stops[0]);
      vec4 colorOut = mix(colors[0], colors[1], stopCalc);
      ${ae.ColorLoop(r)}
      return mix(maskColor, colorOut, clamp(colorOut.a, 0.0, 1.0));
    `});let rr=ae;class we extends ${constructor(){super(...arguments);l(this,"name","radialProgress")}static getEffectKey(){return"radialProgress"}static resolveDefaults(e){return{width:e.width??10,progress:e.progress??.5,offset:e.offset??0,range:e.range??Math.PI*2,rounded:e.rounded??!1,radius:e.radius??1,color:e.color??4294967295}}}l(we,"z$__type__Props"),l(we,"uniforms",{width:{value:0,method:"uniform1f",type:"float"},progress:{value:.5,method:"uniform1f",type:"float"},offset:{value:0,method:"uniform1f",type:"float"},range:{value:0,method:"uniform1f",type:"float"},rounded:{value:0,method:"uniform1f",type:"float",validator:e=>e?1:0},radius:{value:1,method:"uniform1f",type:"float"},color:{value:4294967295,updateProgramValue:Me,method:"uniform4fv",type:"vec4"}}),l(we,"methods",{rotateUV:`
    vec2 function(vec2 uv, float d) {
      float s = sin(d);
      float c = cos(d);
      mat2 rotMatrix = mat2(c, -s, s, c);
      return uv * rotMatrix;
    }
    `,drawDot:`
    float function(vec2 uv, vec2 p, float r) {
      uv += p;
      float circle = length(uv) - r;
      return clamp(-circle, 0.0, 1.0);
    }
    `}),l(we,"onEffectMask",`
    float outerRadius = radius * u_dimensions.y * 0.5;

    float endAngle = range * progress - 0.0005;

    vec2 uv = v_textureCoordinate.xy * u_dimensions.xy - u_dimensions * 0.5;

    uv = $rotateUV(uv, -(offset));
    float linewidth = width * u_pixelRatio;
    float circle = length(uv) - (outerRadius - linewidth) ;
    circle = abs(circle) - linewidth;
    circle = clamp(-circle, 0.0, 1.0);

    float angle = (atan(uv.x, -uv.y) / 3.14159265359 * 0.5);
    float p = endAngle / (PI * 2.);

    circle *= step(fract(angle), fract(p));

    circle = rounded < 1. ? circle : max(circle, $drawDot(uv, vec2(0, outerRadius - linewidth), linewidth));
    circle = rounded < 1. ? circle : max(circle, $drawDot($rotateUV(uv, -(endAngle)), vec2(0, outerRadius - linewidth), linewidth));

    return mix(shaderColor, maskColor, circle);
  `),l(we,"onColorize",`
    return color;
  `);class be extends ${constructor(){super(...arguments);l(this,"name","holePunch")}static getEffectKey(){return"holePunch"}static resolveDefaults(e){return{x:e.x||0,y:e.y||0,width:e.width||50,height:e.height||50,radius:e.radius??0}}}l(be,"z$__type__Props"),l(be,"uniforms",{x:{value:0,method:"uniform1f",type:"float"},y:{value:0,method:"uniform1f",type:"float"},width:{value:0,method:"uniform1f",type:"float"},height:{value:0,method:"uniform1f",type:"float"},radius:{value:0,method:"uniform4fv",type:"vec4",updateOnBind:!0,validator:ur,updateProgramValue:qr}}),l(be,"methods",{fillMask:`
      float function(float dist) {
        return clamp(-dist, 0.0, 1.0);
      }
    `,boxDist:`
      float function(vec2 p, vec2 size, float radius) {
        size -= vec2(radius);
        vec2 d = abs(p) - size;
        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0)) - radius;
      }
    `}),l(be,"onShaderMask",`
  vec2 halfDimensions = u_dimensions * 0.5;
  vec2 size = vec2(width, height) * 0.5;
  vec2 basePos = v_textureCoordinate.xy * u_dimensions.xy - vec2(x, y);
  vec2 pos = basePos - size;
  float r = radius[0] * step(pos.x, 0.5) * step(pos.y, 0.5);
  r = r + radius[1] * step(0.5, pos.x) * step(pos.y, 0.5);
  r = r + radius[2] * step(0.5, pos.x) * step(0.5, pos.y);
  r = r + radius[3] * step(pos.x, 0.5) * step(0.5, pos.y);
  return $boxDist(pos, size, r);
  `),l(be,"onEffectMask",`
  return mix(maskColor, vec4(0.0), $fillMask(shaderMask));
  `);class ti extends Gr{constructor(e){super();l(this,"shType");this.shType=e}bindRenderOp(){}bindProps(){}attach(){}detach(){}}class ri{constructor(t,e,r,i){l(this,"type");l(this,"shader");l(this,"resolvedProps");l(this,"props");this.type=t,this.shader=e,this.resolvedProps=r;const n=Object.keys(r),o=n.length,a={};for(let h=0;h<o;h++){const u=n[h];Object.defineProperty(a,u,{get:()=>this.resolvedProps[u],set:d=>{this.resolvedProps[u]=d,i.requestRender()}})}this.props=a}getResolvedProps(){return this.resolvedProps}}class si{constructor(t,e,r){l(this,"shader");l(this,"resolvedProps");l(this,"props");l(this,"type");this.shader=t,this.type="DynamicShader",this.resolvedProps=e;const i=r.getRegisteredEffects(),n={},o=e.effects,a=o.length;for(let h=0;h<a;h++){const{name:u,props:d,type:c}=o[h];if(u===void 0)continue;const p={},f=Object.keys(d),_=f.length;for(let T=0;T<_;T++){const w=f[T];Object.defineProperty(p,w,{get:()=>this.resolvedProps.effects[h].props[w].value,set:b=>{var x,m;const g=this.resolvedProps.effects[h].props[w];g.value=b,g.hasValidator&&(b=g.validatedValue=(x=i[c].uniforms[w])==null?void 0:x.validator(b,d)),g.hasProgramValueUpdater?(m=i[c].uniforms[w])==null||m.updateProgramValue(g):g.programValue=b,r.renderer.stage.requestRender()}})}Object.defineProperty(n,u,{get:()=>p})}this.props=n}getResolvedProps(){return this.resolvedProps}}class ii{constructor(){l(this,"shCache",new Map);l(this,"shConstructors",{});l(this,"attachedShader",null);l(this,"effectConstructors",{});l(this,"renderer");this.registerShaderType("DefaultShader",Wr),this.registerShaderType("DefaultShaderBatched",Hr),this.registerShaderType("RoundedRectangle",Zt),this.registerShaderType("DynamicShader",Ee),this.registerShaderType("SdfShader",Jt),this.registerEffectType("border",Le),this.registerEffectType("borderBottom",_e),this.registerEffectType("borderLeft",Re),this.registerEffectType("borderRight",ye),this.registerEffectType("borderTop",ve),this.registerEffectType("fadeOut",ft),this.registerEffectType("linearGradient",er),this.registerEffectType("radialGradient",rr),this.registerEffectType("grayscale",tr),this.registerEffectType("glitch",Oe),this.registerEffectType("radius",Te),this.registerEffectType("radialProgress",we),this.registerEffectType("holePunch",be)}registerShaderType(t,e){this.shConstructors[t]=e}registerEffectType(t,e){this.effectConstructors[t]=e}getRegisteredEffects(){return this.effectConstructors}getRegisteredShaders(){return this.shConstructors}loadShader(t,e){if(!this.renderer)throw new Error("Renderer is not been defined");const r=this.shConstructors[t];if(!r)throw new Error(`Shader type "${t}" is not registered`);if(this.renderer.mode==="canvas"&&r.prototype instanceof pe)return this._createShaderCtr(t,new ti(t),e);if(t==="DynamicShader")return this.loadDynamicShader(e);const i=r.resolveDefaults(e),n=r.makeCacheKey(i)||r.name;if(n&&this.shCache.has(n))return this._createShaderCtr(t,this.shCache.get(n),i);const o=new r(this.renderer,e);return n&&this.shCache.set(n,o),this._createShaderCtr(t,o,i)}loadDynamicShader(t){if(!this.renderer)throw new Error("Renderer is not been defined");const e=Ee.resolveDefaults(t,this.effectConstructors),r=Ee.makeCacheKey(e,this.effectConstructors);if(r&&this.shCache.has(r))return this._createDynShaderCtr(this.shCache.get(r),e);const i=new Ee(this.renderer,t,this.effectConstructors);return r&&this.shCache.set(r,i),this._createDynShaderCtr(i,e)}_createShaderCtr(t,e,r){return new ri(t,e,r,this.renderer.stage)}_createDynShaderCtr(t,e){return t.bindUniformMethods(e),new si(t,e,this)}useShader(t){this.attachedShader!==t&&(this.attachedShader&&this.attachedShader.detach(),t.attach(),this.attachedShader=t)}}const ni={x:(s,t)=>{s.props.x=t},y:(s,t)=>{s.props.y=t},width:(s,t)=>{s.props.width=t},height:(s,t)=>{s.props.height=t},color:(s,t)=>{s.props.color=t},zIndex:(s,t)=>{s.props.zIndex=t},fontFamily:(s,t)=>{s.props.fontFamily=t},fontWeight:(s,t)=>{s.props.fontWeight=t},fontStyle:(s,t)=>{s.props.fontStyle=t},fontStretch:(s,t)=>{s.props.fontStretch=t},fontSize:(s,t)=>{s.props.fontSize=t},text:(s,t)=>{s.props.text=t},textAlign:(s,t)=>{s.props.textAlign=t},contain:(s,t)=>{s.props.contain=t},offsetY:(s,t)=>{s.props.offsetY=t},scrollable:(s,t)=>{s.props.scrollable=t},scrollY:(s,t)=>{s.props.scrollY=t},letterSpacing:(s,t)=>{s.props.letterSpacing=t},lineHeight:(s,t)=>{s.props.lineHeight=t},maxLines:(s,t)=>{s.props.maxLines=t},textBaseline:(s,t)=>{s.props.textBaseline=t},verticalAlign:(s,t)=>{s.props.verticalAlign=t},overflowSuffix:(s,t)=>{s.props.overflowSuffix=t},debug:(s,t)=>{s.props.debug=t}};class oi{constructor(t){l(this,"stage");l(this,"set");this.stage=t;const e={...ni,...this.getPropertySetters()},r={};Object.keys(e).forEach(i=>{Object.defineProperty(r,i,{value:(n,o)=>{n.props[i]!==o&&(e[i](n,o),this.stage.requestRender())},writable:!1,configurable:!1})}),this.set=r}setStatus(t,e,r){t.status!==e&&(t.status=e,t.emitter.emit(e,r))}setIsRenderable(t,e){t.isRenderable=e}destroyState(t){this.setStatus(t,"destroyed"),t.emitter.removeAllListeners()}scheduleUpdateState(t){t.updateScheduled||(t.updateScheduled=!0,queueMicrotask(()=>{t.status!=="destroyed"&&(t.updateScheduled=!1,this.updateState(t))}))}}class ai{constructor(){l(this,"data",{})}reset(){this.data={}}increment(t){this.data[t]||(this.data[t]=0),this.data[t]++}getData(){return{...this.data}}}class li{constructor(t,e){l(this,"stage");l(this,"memUsed",0);l(this,"loadedTextures",new Map);l(this,"orphanedTextures",[]);l(this,"criticalThreshold");l(this,"targetThreshold");l(this,"cleanupInterval");l(this,"debugLogging");l(this,"lastCleanupTime",0);l(this,"baselineMemoryAllocation");l(this,"criticalCleanupRequested",!1);l(this,"frameTime",0);this.stage=t;const{criticalThreshold:r}=e;this.criticalThreshold=Math.round(r);const i=Math.max(0,Math.min(1,e.targetThresholdLevel));if(this.targetThreshold=Math.round(r*i),this.cleanupInterval=e.cleanupInterval,this.debugLogging=e.debugLogging,this.baselineMemoryAllocation=Math.round(e.baselineMemoryAllocation),this.memUsed=Math.round(e.baselineMemoryAllocation),e.debugLogging){let n=0;setInterval(()=>{n!==this.memUsed&&(n=this.memUsed,console.log(`[TextureMemoryManager] Memory used: ${_r(this.memUsed)} mb / ${_r(this.criticalThreshold)} mb (${(this.memUsed/this.criticalThreshold*100).toFixed(1)}%)`))},1e3)}r===0&&(this.setTextureMemUse=()=>{})}addToOrphanedTextures(t){this.orphanedTextures.includes(t)&&this.removeFromOrphanedTextures(t),t.preventCleanup===!1&&this.orphanedTextures.push(t)}removeFromOrphanedTextures(t){const e=this.orphanedTextures.indexOf(t);e!==-1&&this.orphanedTextures.splice(e,1)}setTextureMemUse(t,e){if(this.loadedTextures.has(t)&&(this.memUsed-=this.loadedTextures.get(t)),e===0){this.loadedTextures.delete(t);return}else this.memUsed+=e,this.loadedTextures.set(t,e);this.memUsed>this.criticalThreshold&&(this.criticalCleanupRequested=!0)}checkCleanup(){return this.criticalCleanupRequested||this.memUsed>this.targetThreshold&&this.frameTime-this.lastCleanupTime>=this.cleanupInterval}cleanup(){const t=this.criticalCleanupRequested;this.lastCleanupTime=this.frameTime,this.criticalCleanupRequested=!1,t===!0&&this.stage.queueFrameEvent("criticalCleanup",{memUsed:this.memUsed,criticalThreshold:this.criticalThreshold}),this.debugLogging&&console.log(`[TextureMemoryManager] Cleaning up textures. Critical: ${t}`);const e=this.targetThreshold,r=this.stage.txManager,i=le();for(;this.memUsed>=e&&this.orphanedTextures.length>0&&(t||le()-i<10);){const n=this.orphanedTextures.shift();n.renderable!==!0&&(n.free(),r.removeTextureFromCache(n))}this.memUsed>=this.criticalThreshold&&(this.stage.queueFrameEvent("criticalCleanupFailed",{memUsed:this.memUsed,criticalThreshold:this.criticalThreshold}),(this.debugLogging===!0||Xe()===!1)&&console.warn(`[TextureMemoryManager] Memory usage above critical threshold after cleanup: ${this.memUsed}`))}getMemoryInfo(){let t=0;const e=[...this.loadedTextures.keys()].reduce((r,i)=>(t+=i.renderable?1:0,r+(i.renderable?this.loadedTextures.get(i):0)),0);return{criticalThreshold:this.criticalThreshold,targetThreshold:this.targetThreshold,renderableMemUsed:e,memUsed:this.memUsed,renderableTexturesLoaded:t,loadedTextures:this.loadedTextures.size,baselineMemoryAllocation:this.baselineMemoryAllocation}}}class hi{constructor(t,e){l(this,"textureSource");l(this,"memManager");l(this,"state","freed");this.memManager=t,this.textureSource=e}setTextureMemUse(t){this.memManager.setTextureMemUse(this.textureSource,t)}get renderable(){return this.textureSource.renderable}}class ui{constructor(t){l(this,"options");l(this,"mode");l(this,"stage");l(this,"txManager");l(this,"txMemManager");l(this,"shManager");l(this,"rttNodes",[]);this.options=t,this.stage=t.stage,this.txManager=t.txManager,this.txMemManager=t.txMemManager,this.shManager=t.shManager}}class ci extends Qt{constructor(e,r,i){super(e,r);l(this,"textRenderer");l(this,"trState");l(this,"_textRendererOverride",null);l(this,"onTextLoaded",()=>{const{contain:e}=this,r=this.trState.props.width,i=this.trState.props.height,n=this.trState.textW||0,o=this.trState.textH||0;e==="both"?(this.props.width=r,this.props.height=i):e==="width"?(this.props.width=r,this.props.height=o):e==="none"&&(this.props.width=n,this.props.height=o),this.updateLocalTransform(),this.stage.requestRender(),this.emit("loaded",{type:"text",dimensions:{width:this.trState.textW||0,height:this.trState.textH||0}})});l(this,"onTextFailed",(e,r)=>{this.emit("failed",{type:"text",error:r})});this._textRendererOverride=r.textRendererOverride,this.textRenderer=i;const n=this.createState({x:this.absX,y:this.absY,width:r.width,height:r.height,textAlign:r.textAlign,color:r.color,zIndex:r.zIndex,contain:r.contain,scrollable:r.scrollable,scrollY:r.scrollY,offsetY:r.offsetY,letterSpacing:r.letterSpacing,debug:r.debug,fontFamily:r.fontFamily,fontSize:r.fontSize,fontStretch:r.fontStretch,fontStyle:r.fontStyle,fontWeight:r.fontWeight,text:r.text,lineHeight:r.lineHeight,maxLines:r.maxLines,textBaseline:r.textBaseline,verticalAlign:r.verticalAlign,overflowSuffix:r.overflowSuffix});this.trState=n}get width(){return this.props.width}set width(e){this.props.width=e,this.textRenderer.set.width(this.trState,e),this.contain==="none"&&this.setUpdateType(y.Local)}get height(){return this.props.height}set height(e){this.props.height=e,this.textRenderer.set.height(this.trState,e),this.contain!=="both"&&this.setUpdateType(y.Local)}get color(){return this.trState.props.color}set color(e){this.textRenderer.set.color(this.trState,e)}get text(){return this.trState.props.text}set text(e){this.textRenderer.set.text(this.trState,e)}get textRendererOverride(){return this._textRendererOverride}set textRendererOverride(e){this._textRendererOverride=e,this.textRenderer.destroyState(this.trState);const r=this.stage.resolveTextRenderer(this.trState.props,this._textRendererOverride);if(!r){console.warn("Text Renderer not found for font",this.trState.props.fontFamily);return}this.textRenderer=r,this.trState=this.createState(this.trState.props)}get fontSize(){return this.trState.props.fontSize}set fontSize(e){this.textRenderer.set.fontSize(this.trState,e)}get fontFamily(){return this.trState.props.fontFamily}set fontFamily(e){this.textRenderer.set.fontFamily(this.trState,e)}get fontStretch(){return this.trState.props.fontStretch}set fontStretch(e){this.textRenderer.set.fontStretch(this.trState,e)}get fontStyle(){return this.trState.props.fontStyle}set fontStyle(e){this.textRenderer.set.fontStyle(this.trState,e)}get fontWeight(){return this.trState.props.fontWeight}set fontWeight(e){this.textRenderer.set.fontWeight(this.trState,e)}get textAlign(){return this.trState.props.textAlign}set textAlign(e){this.textRenderer.set.textAlign(this.trState,e)}get contain(){return this.trState.props.contain}set contain(e){this.textRenderer.set.contain(this.trState,e)}get scrollable(){return this.trState.props.scrollable}set scrollable(e){this.textRenderer.set.scrollable(this.trState,e)}get scrollY(){return this.trState.props.scrollY}set scrollY(e){this.textRenderer.set.scrollY(this.trState,e)}get offsetY(){return this.trState.props.offsetY}set offsetY(e){this.textRenderer.set.offsetY(this.trState,e)}get letterSpacing(){return this.trState.props.letterSpacing}set letterSpacing(e){this.textRenderer.set.letterSpacing(this.trState,e)}get lineHeight(){return this.trState.props.lineHeight}set lineHeight(e){this.textRenderer.set.lineHeight(this.trState,e)}get maxLines(){return this.trState.props.maxLines}set maxLines(e){this.textRenderer.set.maxLines(this.trState,e)}get textBaseline(){return this.trState.props.textBaseline}set textBaseline(e){this.textRenderer.set.textBaseline(this.trState,e)}get verticalAlign(){return this.trState.props.verticalAlign}set verticalAlign(e){this.textRenderer.set.verticalAlign(this.trState,e)}get overflowSuffix(){return this.trState.props.overflowSuffix}set overflowSuffix(e){this.textRenderer.set.overflowSuffix(this.trState,e)}get debug(){return this.trState.props.debug}set debug(e){this.textRenderer.set.debug(this.trState,e)}update(e,r){super.update(e,r),M(this.globalTransform),this.textRenderer.set.x(this.trState,this.globalTransform.tx),this.textRenderer.set.y(this.trState,this.globalTransform.ty)}checkBasicRenderability(){return this.worldAlpha===0||this.isOutOfBounds()===!0?!1:!!(this.trState&&this.trState.props.text!=="")}setRenderable(e){super.setRenderable(e),this.textRenderer.setIsRenderable(this.trState,e)}renderQuads(e){var r;if(M(this.globalTransform),!this.textRenderer.renderQuads){super.renderQuads(e);return}this.parentHasRenderTexture&&(!e.renderToTextureActive||this.parentRenderTexture!==e.activeRttNode)||(this.parentHasRenderTexture&&((r=this.props.parent)!=null&&r.rtt)&&(this.globalTransform=G.identity(),this.localTransform&&this.globalTransform.multiply(this.localTransform)),M(this.globalTransform),this.textRenderer.renderQuads(this.trState,this.globalTransform,this.clippingRect,this.worldAlpha,this.parentHasRenderTexture,this.framebufferDimensions))}destroy(){super.destroy(),this.textRenderer.destroyState(this.trState)}createState(e){const r=this.textRenderer.createState(e,this);return r.emitter.on("loaded",this.onTextLoaded),r.emitter.on("failed",this.onTextFailed),this.textRenderer.scheduleUpdateState(r),r}}function di(s){const t={boolean:!0,string:!0,number:!0,undefined:!0},e=Object.keys(s);for(let r=0;r<e.length;r++){const i=e[r];if(!i)continue;const n=s[i],o=typeof n;o==="string"&&n.length>2048&&(console.warn(`Custom Data value for ${i} is too long, it will be truncated to 2048 characters`),s[i]=n.substring(0,2048)),t[o]||(console.warn(`Custom Data value for ${i} is not a boolean, string, or number, it will be ignored`),delete s[i])}return s}const fi=2e6;class pi{constructor(t){l(this,"options");l(this,"animationManager");l(this,"txManager");l(this,"txMemManager");l(this,"fontManager");l(this,"textRenderers");l(this,"shManager");l(this,"renderer");l(this,"root");l(this,"boundsMargin");l(this,"defShaderCtr");l(this,"strictBound");l(this,"preloadBound");l(this,"strictBounds");l(this,"defaultTexture",null);l(this,"eventBus");l(this,"deltaTime",0);l(this,"lastFrameTime",0);l(this,"currentFrameTime",0);l(this,"fpsNumFrames",0);l(this,"fpsElapsedTime",0);l(this,"numQuadsRendered",0);l(this,"renderRequested",!1);l(this,"frameEventQueue",[]);l(this,"fontResolveMap",{});l(this,"contextSpy",null);this.options=t;const{canvas:e,clearColor:r,appWidth:i,appHeight:n,boundsMargin:o,enableContextSpy:a,forceWebGL2:h,numImageWorkers:u,textureMemory:d,renderEngine:c,fontEngines:p}=t;this.eventBus=t.eventBus,this.txManager=new Hs(this,u),this.txManager.on("initialized",()=>{this.requestRender()}),this.txMemManager=new li(this,d),this.shManager=new ii,this.animationManager=new Fs,this.contextSpy=a?new ai:null,this.strictBounds=t.strictBounds;let f=[0,0,0,0];o&&(f=Array.isArray(o)?o:[o,o,o,o]),this.boundsMargin=f,this.strictBound=Se(0,0,i,n),this.preloadBound=Kt(this.strictBound,f);const _={stage:this,canvas:e,pixelRatio:t.devicePhysicalPixelRatio*t.deviceLogicalPixelRatio,clearColor:r??4278190080,bufferMemory:fi,txManager:this.txManager,txMemManager:this.txMemManager,shManager:this.shManager,contextSpy:this.contextSpy,forceWebGL2:h};this.renderer=new c(_);const T=this.renderer.mode||"webgl";this.createDefaultTexture(),this.defShaderCtr=this.renderer.getDefShaderCtr(),Rs(T),this.txManager.renderer=this.renderer,this.textRenderers={},p.forEach(b=>{const g=new b(this),x=g.type;if(x==="sdf"&&T==="canvas"){console.warn("SdfTextRenderer is not compatible with Canvas renderer. Skipping...");return}g instanceof oi&&(x==="canvas"?this.textRenderers.canvas=g:x==="sdf"&&(this.textRenderers.sdf=g))}),Object.keys(this.textRenderers).length===0&&console.warn("No text renderers available. Your text will not render."),this.fontManager=new Ks(this.textRenderers);const w=new Qt(this,{x:0,y:0,width:i,height:n,alpha:1,autosize:!1,clipping:!1,color:0,colorTop:0,colorBottom:0,colorLeft:0,colorRight:0,colorTl:0,colorTr:0,colorBl:0,colorBr:0,zIndex:0,zIndexLocked:0,scaleX:1,scaleY:1,mountX:0,mountY:0,mount:0,pivot:.5,pivotX:.5,pivotY:.5,rotation:0,parent:null,texture:null,textureOptions:{},shader:this.defShaderCtr,rtt:!1,src:null,scale:1,preventCleanup:!1,strictBounds:this.strictBounds});this.root=w,ks(this)}setClearColor(t){this.renderer.updateClearColor(t),this.renderRequested=!0}updateFrameTime(){const t=le();this.lastFrameTime=this.currentFrameTime,this.currentFrameTime=t,this.deltaTime=this.lastFrameTime?t-this.lastFrameTime:100/6,this.txManager.frameTime=t,this.txMemManager.frameTime=t,this.eventBus.emit("frameTick",{time:this.currentFrameTime,delta:this.deltaTime})}createDefaultTexture(){this.defaultTexture=this.txManager.createTexture("ColorTexture",{color:4294967295}),M(this.defaultTexture instanceof yt),this.txManager.loadTexture(this.defaultTexture,!0),this.defaultTexture.setRenderableOwner(this,!0),this.defaultTexture.once("loaded",()=>{this.requestRender()})}updateAnimations(){const{animationManager:t}=this;this.root&&t.update(this.deltaTime)}hasSceneUpdates(){return!!this.root.updateType||this.renderRequested||this.txManager.hasUpdates()}drawFrame(){const{renderer:t,renderRequested:e}=this;M(t),this.root.updateType!==0&&this.root.update(this.deltaTime,this.root.clippingRect),this.txManager.processSome(this.options.textureProcessingTimeLimit),t.reset(),this.txMemManager.criticalCleanupRequested&&this.txMemManager.cleanup(),t.rttNodes.length>0&&t.renderRTTNodes(),this.addQuads(this.root),t==null||t.render(),this.calculateFps(),this.calculateQuads(),e&&(this.renderRequested=!1)}queueFrameEvent(t,e){this.frameEventQueue.push([t,e])}flushFrameEvents(){for(const[t,e]of this.frameEventQueue)this.eventBus.emit(t,e);this.frameEventQueue=[]}calculateFps(){var e,r;const{fpsUpdateInterval:t}=this.options;if(t&&(this.fpsNumFrames++,this.fpsElapsedTime+=this.deltaTime,this.fpsElapsedTime>=t)){const i=Math.round(this.fpsNumFrames*1e3/this.fpsElapsedTime);this.fpsNumFrames=0,this.fpsElapsedTime=0,this.queueFrameEvent("fpsUpdate",{fps:i,contextSpyData:((e=this.contextSpy)==null?void 0:e.getData())??null}),(r=this.contextSpy)==null||r.reset()}}calculateQuads(){const t=this.renderer.getQuadCount();t&&t!==this.numQuadsRendered&&(this.numQuadsRendered=t,this.queueFrameEvent("quadsUpdate",{quads:t}))}addQuads(t){M(this.renderer),t.isRenderable===!0&&t.renderQuads(this.renderer);for(let e=0;e<t.children.length;e++){const r=t.children[e];r!==void 0&&(r.worldAlpha===0||r.strictBounds===!0&&r.renderState===N.OutOfBounds||this.addQuads(r))}}requestRender(){this.renderRequested=!0}resolveTextRenderer(t,e=null){const r=`${t.fontFamily}${t.fontStyle}${t.fontWeight}${t.fontStretch}${e||""}`;if(this.fontResolveMap[r]!==void 0)return this.fontResolveMap[r];let i=e,n=!1;if(i){const a=this.textRenderers[i];a?a.canRenderFont(t)||(console.warn(`Cannot use override text renderer '${i}' for font`,t),i=null,n=!0):(console.warn(`Text renderer override '${i}' not found.`),i=null,n=!0)}if(!i){for(const[a,h]of Object.entries(this.textRenderers))if(h.canRenderFont(t)){i=a;break}!i&&this.textRenderers.canvas!==void 0&&(i="canvas")}if(n&&console.warn(`Falling back to text renderer ${String(i)}`),!i)return null;const o=this.textRenderers[i];return M(o,"resolvedTextRenderer undefined"),this.fontResolveMap[r]=o,o}createShaderCtr(t,e){return this.shManager.loadShader(t,e)}createNode(t){const e=this.resolveNodeDefaults(t);return new Qt(this,e)}createTextNode(t){const e=t.fontSize??16,r={...this.resolveNodeDefaults(t),text:t.text??"",textRendererOverride:t.textRendererOverride??null,fontSize:e,fontFamily:t.fontFamily??"sans-serif",fontStyle:t.fontStyle??"normal",fontWeight:t.fontWeight??"normal",fontStretch:t.fontStretch??"normal",textAlign:t.textAlign??"left",contain:t.contain??"none",scrollable:t.scrollable??!1,scrollY:t.scrollY??0,offsetY:t.offsetY??0,letterSpacing:t.letterSpacing??0,lineHeight:t.lineHeight,maxLines:t.maxLines??0,textBaseline:t.textBaseline??"alphabetic",verticalAlign:t.verticalAlign??"middle",overflowSuffix:t.overflowSuffix??"...",debug:t.debug??{},shaderProps:null},i=this.resolveTextRenderer(r,t.textRendererOverride);if(!i)throw new Error(`No compatible text renderer found for ${r.fontFamily}`);return new ci(this,r,i)}resolveNodeDefaults(t){const e=t.color??4294967295,r=t.colorTl??t.colorTop??t.colorLeft??e,i=t.colorTr??t.colorTop??t.colorRight??e,n=t.colorBl??t.colorBottom??t.colorLeft??e,o=t.colorBr??t.colorBottom??t.colorRight??e;let a={};return this.options.inspector===!0&&(a=di(t.data??{})),{x:t.x??0,y:t.y??0,width:t.width??0,height:t.height??0,alpha:t.alpha??1,autosize:t.autosize??!1,clipping:t.clipping??!1,color:e,colorTop:t.colorTop??e,colorBottom:t.colorBottom??e,colorLeft:t.colorLeft??e,colorRight:t.colorRight??e,colorBl:n,colorBr:o,colorTl:r,colorTr:i,zIndex:t.zIndex??0,zIndexLocked:t.zIndexLocked??0,parent:t.parent??null,texture:t.texture??null,textureOptions:t.textureOptions??{},shader:t.shader??this.defShaderCtr,src:t.src??null,srcHeight:t.srcHeight,srcWidth:t.srcWidth,srcX:t.srcX,srcY:t.srcY,scale:t.scale??null,scaleX:t.scaleX??t.scale??1,scaleY:t.scaleY??t.scale??1,mount:t.mount??0,mountX:t.mountX??t.mount??0,mountY:t.mountY??t.mount??0,pivot:t.pivot??.5,pivotX:t.pivotX??t.pivot??.5,pivotY:t.pivotY??t.pivot??.5,rotation:t.rotation??0,rtt:t.rtt??!1,data:a,preventCleanup:t.preventCleanup??!1,imageType:t.imageType,strictBounds:t.strictBounds??this.strictBounds}}cleanup(){this.txMemManager.cleanup()}}class gi extends Ae{constructor(e,r){var T,w,b,g,x;super();l(this,"root");l(this,"canvas");l(this,"settings");l(this,"stage");l(this,"inspector",null);const i={criticalThreshold:((T=e.textureMemory)==null?void 0:T.criticalThreshold)||124e6,targetThresholdLevel:((w=e.textureMemory)==null?void 0:w.targetThresholdLevel)||.5,cleanupInterval:((b=e.textureMemory)==null?void 0:b.cleanupInterval)||3e4,debugLogging:((g=e.textureMemory)==null?void 0:g.debugLogging)||!1,baselineMemoryAllocation:((x=e.textureMemory)==null?void 0:x.baselineMemoryAllocation)||26e6},n={appWidth:e.appWidth||1920,appHeight:e.appHeight||1080,textureMemory:i,boundsMargin:e.boundsMargin||0,deviceLogicalPixelRatio:e.deviceLogicalPixelRatio||1,devicePhysicalPixelRatio:e.devicePhysicalPixelRatio||window.devicePixelRatio,clearColor:e.clearColor??0,fpsUpdateInterval:e.fpsUpdateInterval||0,numImageWorkers:e.numImageWorkers!==void 0?e.numImageWorkers:2,enableContextSpy:e.enableContextSpy??!1,forceWebGL2:e.forceWebGL2??!1,inspector:e.inspector??!1,renderEngine:e.renderEngine,quadBufferSize:e.quadBufferSize??4*1024*1024,fontEngines:e.fontEngines,strictBounds:e.strictBounds??!0,textureProcessingTimeLimit:e.textureProcessingTimeLimit||10,canvas:e.canvas||document.createElement("canvas")};this.settings=n;const{appWidth:o,appHeight:a,deviceLogicalPixelRatio:h,devicePhysicalPixelRatio:u,inspector:d,canvas:c}=n,p=o*h,f=a*h;this.canvas=c,c.width=p*u,c.height=f*u,c.style.width=`${p}px`,c.style.height=`${f}px`,this.stage=new pi({appWidth:this.settings.appWidth,appHeight:this.settings.appHeight,boundsMargin:this.settings.boundsMargin,clearColor:this.settings.clearColor,canvas:this.canvas,deviceLogicalPixelRatio:this.settings.deviceLogicalPixelRatio,devicePhysicalPixelRatio:this.settings.devicePhysicalPixelRatio,enableContextSpy:this.settings.enableContextSpy,forceWebGL2:this.settings.forceWebGL2,fpsUpdateInterval:this.settings.fpsUpdateInterval,numImageWorkers:this.settings.numImageWorkers,renderEngine:this.settings.renderEngine,textureMemory:i,eventBus:this,quadBufferSize:this.settings.quadBufferSize,fontEngines:this.settings.fontEngines,inspector:this.settings.inspector!==null,strictBounds:this.settings.strictBounds,textureProcessingTimeLimit:this.settings.textureProcessingTimeLimit}),this.root=this.stage.root;let _;if(typeof r=="string"?_=document.getElementById(r):_=r,!_)throw new Error("Could not find target element");_.appendChild(c),d&&!Xe()&&(this.inspector=new d(c,n))}createNode(e){const r=this.stage.createNode(e);return this.inspector?this.inspector.createNode(r):r}createTextNode(e){const r=this.stage.createTextNode(e);return this.inspector?this.inspector.createTextNode(r):r}destroyNode(e){return this.inspector&&this.inspector.destroyNode(e.id),e.destroy()}createTexture(e,r){return this.stage.txManager.createTexture(e,r)}createShader(e,r){return this.stage.shManager.loadShader(e,r)}createDynamicShader(e){return this.stage.shManager.loadDynamicShader({effects:e})}createEffect(e,r,i){return{name:i,type:e,props:r}}getNodeById(e){var n;const r=(n=this.stage)==null?void 0:n.root;if(!r)return null;const i=o=>{if(o.id===e)return o;for(const a of o.children){const h=i(a);if(h)return h}return null};return i(r)}toggleFreeze(){throw new Error("Not implemented")}advanceFrame(){throw new Error("Not implemented")}getBufferInfo(){return this.stage.renderer.getBufferInfo()}rerender(){this.stage.requestRender()}cleanup(){this.stage.cleanup()}setClearColor(e){this.stage.setClearColor(e)}}class mi{}class xi extends mi{constructor(e,r,i,n,o,a,h,u,d,c,p,f,_){super();l(this,"glw");l(this,"options");l(this,"buffers");l(this,"shader");l(this,"shaderProps");l(this,"alpha");l(this,"clippingRect");l(this,"dimensions");l(this,"bufferIdx");l(this,"zIndex");l(this,"renderToTexture");l(this,"parentHasRenderTexture");l(this,"framebufferDimensions");l(this,"length",0);l(this,"numQuads",0);l(this,"textures",[]);l(this,"maxTextures");this.glw=e,this.options=r,this.buffers=i,this.shader=n,this.shaderProps=o,this.alpha=a,this.clippingRect=h,this.dimensions=u,this.bufferIdx=d,this.zIndex=c,this.renderToTexture=p,this.parentHasRenderTexture=f,this.framebufferDimensions=_,this.maxTextures=n.supportsIndexedTextures?e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS):1}addTexture(e){const{textures:r,maxTextures:i}=this;let n=-1;const o=r.length;for(let a=0;a<o;a++)if(r[a]===e){n=a;break}return n!==-1?n:o>=i?4294967295:(this.textures.push(e),o)}draw(){const{glw:e,shader:r,shaderProps:i,options:n}=this,{shManager:o}=n;o.useShader(r),r.bindRenderOp(this,i);const a=this.bufferIdx/24*6*2;if(this.clippingRect.valid){const{x:h,y:u,width:d,height:c}=this.clippingRect,p=this.parentHasRenderTexture?1:n.pixelRatio,f=n.canvas.height,_=Math.round(h*p),T=Math.round(d*p),w=Math.round(c*p);let b=Math.round(f-w-u*p);this.parentHasRenderTexture&&(b=this.framebufferDimensions?this.framebufferDimensions.height-this.dimensions.height:0),e.setScissorTest(!0),e.scissor(_,b,T,w)}else e.setScissorTest(!1);e.drawElements(e.TRIANGLES,6*this.numQuads,e.UNSIGNED_SHORT,a)}}function Ti(s){const t={MAX_RENDERBUFFER_SIZE:0,MAX_TEXTURE_SIZE:0,MAX_VIEWPORT_DIMS:0,MAX_VERTEX_TEXTURE_IMAGE_UNITS:0,MAX_TEXTURE_IMAGE_UNITS:0,MAX_COMBINED_TEXTURE_IMAGE_UNITS:0,MAX_VERTEX_ATTRIBS:0,MAX_VARYING_VECTORS:0,MAX_VERTEX_UNIFORM_VECTORS:0,MAX_FRAGMENT_UNIFORM_VECTORS:0};return Object.keys(t).forEach(r=>{t[r]=s.getParameter(s[r])}),t}function yi(s){const t={ANGLE_instanced_arrays:null,WEBGL_compressed_texture_s3tc:null,WEBGL_compressed_texture_astc:null,WEBGL_compressed_texture_etc:null,WEBGL_compressed_texture_etc1:null,WEBGL_compressed_texture_pvrtc:null,WEBKIT_WEBGL_compressed_texture_pvrtc:null,WEBGL_compressed_texture_s3tc_srgb:null,OES_vertex_array_object:null};return Object.keys(t).forEach(r=>{t[r]=s.getExtension(r)}),t}function vi(s,t){const e=~~(t/80),r=new Uint16Array(e*6);for(let n=0,o=0;n<e;n+=6,o+=4)r[n]=o,r[n+1]=o+1,r[n+2]=o+2,r[n+3]=o+2,r[n+4]=o+1,r[n+5]=o+3;const i=s.createBuffer();s.elementArrayBufferData(i,r,s.STATIC_DRAW)}function _i(s){return s!==null&&(typeof s=="object"&&s.constructor&&s.constructor.name==="HTMLImageElement"||typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement)}const Xt=new Uint8Array([0,0,0,0]);class Rt extends hi{constructor(e,r,i){super(r,i);l(this,"glw");l(this,"_nativeCtxTexture",null);l(this,"_w",0);l(this,"_h",0);this.glw=e}get ctxTexture(){return this.state==="freed"?(this.load(),null):(M(this._nativeCtxTexture),this._nativeCtxTexture)}get w(){return this._w}get h(){return this._h}load(){if(!(this.state==="loading"||this.state==="loaded")){if(this.state="loading",this.textureSource.setState("loading"),this._nativeCtxTexture=this.createNativeCtxTexture(),this._nativeCtxTexture===null){this.state="failed",this.textureSource.setState("failed",new Error("Could not create WebGL Texture")),console.error("Could not create WebGL Texture");return}this.onLoadRequest().then(({width:e,height:r})=>{this.state!=="freed"&&(this.state="loaded",this._w=e,this._h=r,this.textureSource.setState("loaded",{width:e,height:r}),this.textureSource.freeTextureData())}).catch(e=>{this.state!=="freed"&&(this.state="failed",this.textureSource.setState("failed",e),this.textureSource.freeTextureData(),console.error(e))})}}async onLoadRequest(){const{glw:e}=this,r=this.textureSource.textureData;if(M(r,"Texture data is null"),e.texImage2D(0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,null),this.setTextureMemUse(Xt.byteLength),!this._nativeCtxTexture)return M(this.state==="freed"),{width:0,height:0};let i=0,n=0;e.activeTexture(0);const o=r.data,a=e.RGBA,h=4,u=1.1;if(typeof ImageBitmap<"u"&&o instanceof ImageBitmap||o instanceof ImageData||_i(o))i=o.width,n=o.height,e.bindTexture(this._nativeCtxTexture),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!!r.premultiplyAlpha),e.texImage2D(0,a,a,e.UNSIGNED_BYTE,o),this.setTextureMemUse(n*i*h*u);else if(o===null)i=0,n=0,e.bindTexture(this._nativeCtxTexture),e.texImage2D(0,a,1,1,0,a,e.UNSIGNED_BYTE,Xt),this.setTextureMemUse(Xt.byteLength);else if("mipmaps"in o&&o.mipmaps){const{mipmaps:d,width:c=0,height:p=0,type:f,glInternalFormat:_}=o,T=f==="ktx"?new DataView(d[0]??new ArrayBuffer(0)):d[0];e.bindTexture(this._nativeCtxTexture),e.compressedTexImage2D(0,_,c,p,0,T),e.texParameteri(e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_MIN_FILTER,e.LINEAR),this.setTextureMemUse(T.byteLength)}else o&&o instanceof Uint8Array?(i=1,n=1,e.bindTexture(this._nativeCtxTexture),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!!r.premultiplyAlpha),e.texImage2D(0,a,i,n,0,a,e.UNSIGNED_BYTE,o),this.setTextureMemUse(i*n*h)):console.error("WebGlCoreCtxTexture.onLoadRequest: Unexpected textureData returned",r);return{width:i,height:n}}free(){if(this.state==="freed"||(this.state="freed",this.textureSource.setState("freed"),this._w=0,this._h=0,!this._nativeCtxTexture))return;const{glw:e}=this;e.deleteTexture(this._nativeCtxTexture),this.setTextureMemUse(0),this._nativeCtxTexture=null,this.textureSource.freeTextureData()}createNativeCtxTexture(){const{glw:e}=this,r=e.createTexture();return r?(e.activeTexture(0),e.bindTexture(r),e.texParameteri(e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),r):null}}class Ri extends Rt{constructor(t,e,r){super(t,e,r)}async onLoadRequest(){var e,r;const t=this.textureSource.textureData;return M(t,"SubTexture must have texture data"),t.data instanceof Uint8Array?{width:1,height:1}:{width:((e=t.data)==null?void 0:e.width)||0,height:((r=t.data)==null?void 0:r.height)||0}}}class wi{constructor(t){l(this,"config");this.config=t}getBuffer(t){var e;return(e=this.config.find(r=>r.attributes[t]))==null?void 0:e.buffer}getAttributeInfo(t){var e;return(e=this.config.find(r=>r.attributes[t]))==null?void 0:e.attributes[t]}}function bi(s){return self.WebGL2RenderingContext&&s instanceof self.WebGL2RenderingContext}class Si{constructor(t){l(this,"gl");l(this,"activeTextureUnit",0);l(this,"texture2dUnits");l(this,"texture2dParams",new WeakMap);l(this,"scissorEnabled");l(this,"scissorX");l(this,"scissorY");l(this,"scissorWidth");l(this,"scissorHeight");l(this,"blendEnabled");l(this,"blendSrcRgb");l(this,"blendDstRgb");l(this,"blendSrcAlpha");l(this,"blendDstAlpha");l(this,"boundArrayBuffer");l(this,"boundElementArrayBuffer");l(this,"curProgram");l(this,"canvas");l(this,"MAX_RENDERBUFFER_SIZE");l(this,"MAX_TEXTURE_SIZE");l(this,"MAX_VIEWPORT_DIMS");l(this,"MAX_VERTEX_TEXTURE_IMAGE_UNITS");l(this,"MAX_TEXTURE_IMAGE_UNITS");l(this,"MAX_COMBINED_TEXTURE_IMAGE_UNITS");l(this,"MAX_VERTEX_ATTRIBS");l(this,"MAX_VARYING_VECTORS");l(this,"MAX_VERTEX_UNIFORM_VECTORS");l(this,"MAX_FRAGMENT_UNIFORM_VECTORS");l(this,"TEXTURE_MAG_FILTER");l(this,"TEXTURE_MIN_FILTER");l(this,"TEXTURE_WRAP_S");l(this,"TEXTURE_WRAP_T");l(this,"LINEAR");l(this,"CLAMP_TO_EDGE");l(this,"RGB");l(this,"RGBA");l(this,"UNSIGNED_BYTE");l(this,"UNPACK_PREMULTIPLY_ALPHA_WEBGL");l(this,"UNPACK_FLIP_Y_WEBGL");l(this,"FLOAT");l(this,"TRIANGLES");l(this,"UNSIGNED_SHORT");l(this,"ONE");l(this,"ONE_MINUS_SRC_ALPHA");l(this,"VERTEX_SHADER");l(this,"FRAGMENT_SHADER");l(this,"STATIC_DRAW");l(this,"COMPILE_STATUS");l(this,"LINK_STATUS");l(this,"DYNAMIC_DRAW");l(this,"COLOR_ATTACHMENT0");l(this,"INVALID_ENUM");l(this,"INVALID_OPERATION");this.gl=t,this.activeTextureUnit=t.getParameter(t.ACTIVE_TEXTURE)-t.TEXTURE0;const e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.texture2dUnits=new Array(e).fill(void 0).map((i,n)=>(this.activeTexture(n),t.getParameter(t.TEXTURE_BINDING_2D))),this.activeTexture(this.activeTextureUnit),this.scissorEnabled=t.isEnabled(t.SCISSOR_TEST);const r=t.getParameter(t.SCISSOR_BOX);this.scissorX=r[0],this.scissorY=r[1],this.scissorWidth=r[2],this.scissorHeight=r[3],this.blendEnabled=t.isEnabled(t.BLEND),this.blendSrcRgb=t.getParameter(t.BLEND_SRC_RGB),this.blendDstRgb=t.getParameter(t.BLEND_DST_RGB),this.blendSrcAlpha=t.getParameter(t.BLEND_SRC_ALPHA),this.blendDstAlpha=t.getParameter(t.BLEND_DST_ALPHA),this.boundArrayBuffer=t.getParameter(t.ARRAY_BUFFER_BINDING),this.boundElementArrayBuffer=t.getParameter(t.ELEMENT_ARRAY_BUFFER_BINDING),this.curProgram=t.getParameter(t.CURRENT_PROGRAM),this.canvas=t.canvas,this.MAX_RENDERBUFFER_SIZE=t.MAX_RENDERBUFFER_SIZE,this.MAX_TEXTURE_SIZE=t.MAX_TEXTURE_SIZE,this.MAX_VIEWPORT_DIMS=t.MAX_VIEWPORT_DIMS,this.MAX_VERTEX_TEXTURE_IMAGE_UNITS=t.MAX_VERTEX_TEXTURE_IMAGE_UNITS,this.MAX_TEXTURE_IMAGE_UNITS=t.MAX_TEXTURE_IMAGE_UNITS,this.MAX_COMBINED_TEXTURE_IMAGE_UNITS=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS,this.MAX_VERTEX_ATTRIBS=t.MAX_VERTEX_ATTRIBS,this.MAX_VARYING_VECTORS=t.MAX_VARYING_VECTORS,this.MAX_VERTEX_UNIFORM_VECTORS=t.MAX_VERTEX_UNIFORM_VECTORS,this.MAX_FRAGMENT_UNIFORM_VECTORS=t.MAX_FRAGMENT_UNIFORM_VECTORS,this.TEXTURE_MAG_FILTER=t.TEXTURE_MAG_FILTER,this.TEXTURE_MIN_FILTER=t.TEXTURE_MIN_FILTER,this.TEXTURE_WRAP_S=t.TEXTURE_WRAP_S,this.TEXTURE_WRAP_T=t.TEXTURE_WRAP_T,this.LINEAR=t.LINEAR,this.CLAMP_TO_EDGE=t.CLAMP_TO_EDGE,this.RGB=t.RGB,this.RGBA=t.RGBA,this.UNSIGNED_BYTE=t.UNSIGNED_BYTE,this.UNPACK_PREMULTIPLY_ALPHA_WEBGL=t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.UNPACK_FLIP_Y_WEBGL=t.UNPACK_FLIP_Y_WEBGL,this.FLOAT=t.FLOAT,this.TRIANGLES=t.TRIANGLES,this.UNSIGNED_SHORT=t.UNSIGNED_SHORT,this.ONE=t.ONE,this.ONE_MINUS_SRC_ALPHA=t.ONE_MINUS_SRC_ALPHA,this.MAX_VERTEX_TEXTURE_IMAGE_UNITS=t.MAX_VERTEX_TEXTURE_IMAGE_UNITS,this.TRIANGLES=t.TRIANGLES,this.UNSIGNED_SHORT=t.UNSIGNED_SHORT,this.VERTEX_SHADER=t.VERTEX_SHADER,this.FRAGMENT_SHADER=t.FRAGMENT_SHADER,this.STATIC_DRAW=t.STATIC_DRAW,this.COMPILE_STATUS=t.COMPILE_STATUS,this.LINK_STATUS=t.LINK_STATUS,this.DYNAMIC_DRAW=t.DYNAMIC_DRAW,this.COLOR_ATTACHMENT0=t.COLOR_ATTACHMENT0,this.INVALID_ENUM=t.INVALID_ENUM,this.INVALID_OPERATION=t.INVALID_OPERATION}isWebGl2(){return bi(this.gl)}activeTexture(t){const{gl:e}=this;this.activeTextureUnit!==t&&(e.activeTexture(t+e.TEXTURE0),this.activeTextureUnit=t)}bindTexture(t){const{gl:e,activeTextureUnit:r,texture2dUnits:i}=this;i[r]!==t&&(i[r]=t,e.bindTexture(this.gl.TEXTURE_2D,t))}_getActiveTexture(){const{activeTextureUnit:t,texture2dUnits:e}=this;return e[t]}texParameteri(t,e){const{gl:r,texture2dParams:i}=this,n=this._getActiveTexture();if(!n)throw new Error("No active texture");let o=i.get(n);o||(o={},i.set(n,o)),o[t]!==e&&(o[t]=e,r.texParameteri(r.TEXTURE_2D,t,e))}texImage2D(t,e,r,i,n,o,a,h){const{gl:u}=this;o?u.texImage2D(u.TEXTURE_2D,t,e,r,i,n,o,a,h):u.texImage2D(u.TEXTURE_2D,t,e,r,i,n)}compressedTexImage2D(t,e,r,i,n,o){const{gl:a}=this;a.compressedTexImage2D(a.TEXTURE_2D,t,e,r,i,n,o)}pixelStorei(t,e){const{gl:r}=this;r.pixelStorei(t,e)}generateMipmap(){const{gl:t}=this;t.generateMipmap(t.TEXTURE_2D)}createTexture(){const{gl:t}=this;return t.createTexture()}deleteTexture(t){const{gl:e}=this;t&&this.texture2dParams.delete(t),e.deleteTexture(t)}deleteFramebuffer(t){this.gl.deleteFramebuffer(t)}viewport(t,e,r,i){const{gl:n}=this;n.viewport(t,e,r,i)}clearColor(t,e,r,i){const{gl:n}=this;n.clearColor(t,e,r,i)}setScissorTest(t){const{gl:e,scissorEnabled:r}=this;t!==r&&(t?e.enable(e.SCISSOR_TEST):e.disable(e.SCISSOR_TEST),this.scissorEnabled=t)}scissor(t,e,r,i){const{gl:n,scissorX:o,scissorY:a,scissorWidth:h,scissorHeight:u}=this;(t!==o||e!==a||r!==h||i!==u)&&(n.scissor(t,e,r,i),this.scissorX=t,this.scissorY=e,this.scissorWidth=r,this.scissorHeight=i)}setBlend(t){const{gl:e,blendEnabled:r}=this;t!==r&&(t?e.enable(e.BLEND):e.disable(e.BLEND),this.blendEnabled=t)}blendFunc(t,e){const{gl:r,blendSrcRgb:i,blendDstRgb:n,blendSrcAlpha:o,blendDstAlpha:a}=this;(t!==i||e!==n||t!==o||e!==a)&&(r.blendFunc(t,e),this.blendSrcRgb=t,this.blendDstRgb=e,this.blendSrcAlpha=t,this.blendDstAlpha=e)}createBuffer(){const{gl:t}=this;return t.createBuffer()}createFramebuffer(){const{gl:t}=this;return t.createFramebuffer()}bindFramebuffer(t){const{gl:e}=this;e.bindFramebuffer(e.FRAMEBUFFER,t)}framebufferTexture2D(t,e,r){const{gl:i}=this;i.framebufferTexture2D(i.FRAMEBUFFER,t,i.TEXTURE_2D,e,r)}clear(){const{gl:t}=this;t.clear(t.COLOR_BUFFER_BIT)}arrayBufferData(t,e,r){const{gl:i,boundArrayBuffer:n}=this;n!==t&&(i.bindBuffer(i.ARRAY_BUFFER,t),this.boundArrayBuffer=t),i.bufferData(i.ARRAY_BUFFER,e,r)}elementArrayBufferData(t,e,r){const{gl:i,boundElementArrayBuffer:n}=this;n!==t&&(i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,t),this.boundElementArrayBuffer=t),i.bufferData(i.ELEMENT_ARRAY_BUFFER,e,r)}vertexAttribPointer(t,e,r,i,n,o,a){const{gl:h,boundArrayBuffer:u}=this;u!==t&&(h.bindBuffer(h.ARRAY_BUFFER,t),this.boundArrayBuffer=t),h.vertexAttribPointer(e,r,i,n,o,a)}useProgram(t){const{gl:e,curProgram:r}=this;r!==t&&(e.useProgram(t),this.curProgram=t)}uniform1f(t,e){const{gl:r}=this;r.uniform1f(t,e)}uniform1fv(t,e){const{gl:r}=this;r.uniform1fv(t,e)}uniform1i(t,e){const{gl:r}=this;r.uniform1i(t,e)}uniform1iv(t,e){const{gl:r}=this;r.uniform1iv(t,e)}uniform2f(t,e,r){const{gl:i}=this;i.uniform2f(t,e,r)}uniform2fv(t,e){const{gl:r}=this;r.uniform2fv(t,e)}uniform2i(t,e,r){const{gl:i}=this;i.uniform2i(t,e,r)}uniform2iv(t,e){const{gl:r}=this;r.uniform2iv(t,e)}uniform3f(t,e,r,i){const{gl:n}=this;n.uniform3f(t,e,r,i)}uniform3fv(t,e){const{gl:r}=this;r.uniform3fv(t,e)}uniform3i(t,e,r,i){const{gl:n}=this;n.uniform3i(t,e,r,i)}uniform3iv(t,e){const{gl:r}=this;r.uniform3iv(t,e)}uniform4f(t,e,r,i,n){const{gl:o}=this;o.uniform4f(t,e,r,i,n)}uniform4fv(t,e){const{gl:r}=this;r.uniform4fv(t,e)}uniform4i(t,e,r,i,n){const{gl:o}=this;o.uniform4i(t,e,r,i,n)}uniform4iv(t,e){const{gl:r}=this;r.uniform4iv(t,e)}uniformMatrix2fv(t,e){const{gl:r}=this;r.uniformMatrix2fv(t,!1,e)}uniformMatrix3fv(t,e){const{gl:r}=this;r.uniformMatrix3fv(t,!1,e)}uniformMatrix4fv(t,e){const{gl:r}=this;r.uniformMatrix4fv(t,!1,e)}getParameter(t){const{gl:e}=this;return e.getParameter(t)}drawElements(t,e,r,i){const{gl:n}=this;n.drawElements(t,e,r,i)}getExtension(t){const{gl:e}=this;return e.getExtension(t)}getError(){const{gl:t}=this;return t.getError()}createVertexArray(){const{gl:t}=this;return M(t instanceof WebGL2RenderingContext),t.createVertexArray()}bindVertexArray(t){const{gl:e}=this;M(e instanceof WebGL2RenderingContext),e.bindVertexArray(t)}getAttribLocation(t,e){const{gl:r}=this;return r.getAttribLocation(t,e)}getUniformLocation(t,e){const{gl:r}=this;return r.getUniformLocation(t,e)}enableVertexAttribArray(t){const{gl:e}=this;e.enableVertexAttribArray(t)}disableVertexAttribArray(t){const{gl:e}=this;e.disableVertexAttribArray(t)}createShader(t){const{gl:e}=this;return e.createShader(t)}compileShader(t){const{gl:e}=this;e.compileShader(t)}attachShader(t,e){const{gl:r}=this;r.attachShader(t,e)}linkProgram(t){const{gl:e}=this;e.linkProgram(t)}deleteProgram(t){const{gl:e}=this;e.deleteProgram(t)}getShaderParameter(t,e){const{gl:r}=this;return r.getShaderParameter(t,e)}getShaderInfoLog(t){const{gl:e}=this;return e.getShaderInfoLog(t)}createProgram(){const{gl:t}=this;return t.createProgram()}getProgramParameter(t,e){const{gl:r}=this;return r.getProgramParameter(t,e)}getProgramInfoLog(t){const{gl:e}=this;return e.getProgramInfoLog(t)}shaderSource(t,e){const{gl:r}=this;r.shaderSource(t,e)}deleteShader(t){const{gl:e}=this;e.deleteShader(t)}}class Er extends Rt{constructor(e,r,i){super(e,r,i);l(this,"framebuffer",null)}async onLoadRequest(){const{glw:e}=this,r=this._nativeCtxTexture=this.createNativeCtxTexture(),{width:i,height:n}=this.textureSource;return this.framebuffer=e.createFramebuffer(),e.texImage2D(0,e.RGBA,i,n,0,e.RGBA,e.UNSIGNED_BYTE,null),this.setTextureMemUse(i*n*4),e.bindFramebuffer(this.framebuffer),e.framebufferTexture2D(e.COLOR_ATTACHMENT0,r,0),e.bindFramebuffer(null),{width:i,height:n}}free(){super.free(),this.glw.deleteFramebuffer(this.framebuffer),this.framebuffer=null}}const Ei=24;class Ci extends ui{constructor(e){super(e);l(this,"glw");l(this,"system");l(this,"quadBuffer");l(this,"fQuadBuffer");l(this,"uiQuadBuffer");l(this,"renderOps",[]);l(this,"curBufferIdx",0);l(this,"curRenderOp",null);l(this,"rttNodes",[]);l(this,"activeRttNode",null);l(this,"defShaderCtrl");l(this,"defaultShader");l(this,"quadBufferCollection");l(this,"clearColor",{raw:0,normalized:[0,0,0,0]});l(this,"quadBufferUsage",0);l(this,"numQuadsRendered",0);l(this,"renderToTextureActive",!1);this.quadBuffer=new ArrayBuffer(this.stage.options.quadBufferSize),this.fQuadBuffer=new Float32Array(this.quadBuffer),this.uiQuadBuffer=new Uint32Array(this.quadBuffer),this.mode="webgl";const{canvas:r,clearColor:i,bufferMemory:n}=e,o=_s(r,e.forceWebGL2,e.contextSpy),a=this.glw=new Si(o);a.viewport(0,0,r.width,r.height),this.updateClearColor(i),a.setBlend(!0),a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA),vi(a,n),this.system={parameters:Ti(this.glw),extensions:yi(this.glw)},this.shManager.renderer=this,this.defShaderCtrl=this.shManager.loadShader("DefaultShader"),this.defaultShader=this.defShaderCtrl.shader;const h=a.createBuffer();M(h);const u=6*Float32Array.BYTES_PER_ELEMENT;this.quadBufferCollection=new wi([{buffer:h,attributes:{a_position:{name:"a_position",size:2,type:a.FLOAT,normalized:!1,stride:u,offset:0},a_textureCoordinate:{name:"a_textureCoordinate",size:2,type:a.FLOAT,normalized:!1,stride:u,offset:2*Float32Array.BYTES_PER_ELEMENT},a_color:{name:"a_color",size:4,type:a.UNSIGNED_BYTE,normalized:!0,stride:u,offset:4*Float32Array.BYTES_PER_ELEMENT},a_textureIndex:{name:"a_textureIndex",size:1,type:a.FLOAT,normalized:!1,stride:u,offset:5*Float32Array.BYTES_PER_ELEMENT}}}])}reset(){const{glw:e}=this;this.curBufferIdx=0,this.curRenderOp=null,this.renderOps.length=0,e.setScissorTest(!1),e.clear()}getShaderManager(){return this.shManager}createCtxTexture(e){return e instanceof vt?new Ri(this.glw,this.txMemManager,e):e instanceof _t?new Er(this.glw,this.txMemManager,e):new Rt(this.glw,this.txMemManager,e)}addQuad(e){const{fQuadBuffer:r,uiQuadBuffer:i}=this;let n=e.texture;if(M(n!==null,"Texture is required"),e.shaderProps!==null){if(xt(e.shaderProps,"$dimensions")==!0){const b=e.shaderProps.$dimensions;b.width=e.width,b.height=e.height}xt(e.shaderProps,"$alpha")===!0&&(e.shaderProps.$alpha=e.alpha)}let{curBufferIdx:o,curRenderOp:a}=this;const h={width:-1,height:-1};h.width=e.width,h.height=e.height;const u=e.shader||this.defaultShader;M(u.getUniformLocation!==void 0,"Invalid WebGL shader"),this.reuseRenderOp(e)===!1&&(this.newRenderOp(u,e.shaderProps,e.alpha,h,e.clippingRect,o,e.rtt,e.parentHasRenderTexture,e.framebufferDimensions),a=this.curRenderOp,M(a));let d=0,c=0,p=1,f=1;if(n.type===W.subTexture){const{x:b,y:g,width:x,height:m}=n.props,{width:S=0,height:E=0}=n.parentTexture.dimensions||{width:0,height:0};d=b/S,p=d+x/S,c=g/E,f=c+m/E,n=n.parentTexture}if(n.type===W.image&&e.textureOptions!==null&&e.textureOptions.resizeMode!==void 0&&n.dimensions!==null){const b=e.textureOptions.resizeMode,{width:g,height:x}=n.dimensions;if(b.type==="cover"){const m=e.width/g,S=e.height/x,E=Math.max(m,S),A=1/E;if(E&&m&&m<E){const R=A*e.width;d=(1-R/g)*(b.clipX??.5),p=d+R/g}if(E&&S&&S<E){const R=A*e.height;c=(1-R/x)*(b.clipY??.5),f=c+R/x}}}let _=0;e.textureOptions!==null&&(e.textureOptions.flipX===!0&&([d,p]=[p,d]),_=+(e.textureOptions.flipY||!1)),_^+(n.type===W.renderToTexture)&&([c,f]=[f,c]);const T=n.ctxTexture;M(T instanceof Rt);const w=this.addTexture(T,o);if(M(this.curRenderOp!==null),e.renderCoords)r[o++]=e.renderCoords.x1,r[o++]=e.renderCoords.y1,r[o++]=d,r[o++]=c,i[o++]=e.colorTl,r[o++]=w,r[o++]=e.renderCoords.x2,r[o++]=e.renderCoords.y2,r[o++]=p,r[o++]=c,i[o++]=e.colorTr,r[o++]=w,r[o++]=e.renderCoords.x4,r[o++]=e.renderCoords.y4,r[o++]=d,r[o++]=f,i[o++]=e.colorBl,r[o++]=w,r[o++]=e.renderCoords.x3,r[o++]=e.renderCoords.y3,r[o++]=p,r[o++]=f,i[o++]=e.colorBr,r[o++]=w;else if(e.tb!==0||e.tc!==0)r[o++]=e.tx,r[o++]=e.ty,r[o++]=d,r[o++]=c,i[o++]=e.colorTl,r[o++]=w,r[o++]=e.tx+e.width*e.ta,r[o++]=e.ty+e.width*e.tc,r[o++]=p,r[o++]=c,i[o++]=e.colorTr,r[o++]=w,r[o++]=e.tx+e.height*e.tb,r[o++]=e.ty+e.height*e.td,r[o++]=d,r[o++]=f,i[o++]=e.colorBl,r[o++]=w,r[o++]=e.tx+e.width*e.ta+e.height*e.tb,r[o++]=e.ty+e.width*e.tc+e.height*e.td,r[o++]=p,r[o++]=f,i[o++]=e.colorBr,r[o++]=w;else{const b=e.tx+e.width*e.ta,g=e.ty+e.height*e.td;r[o++]=e.tx,r[o++]=e.ty,r[o++]=d,r[o++]=c,i[o++]=e.colorTl,r[o++]=w,r[o++]=b,r[o++]=e.ty,r[o++]=p,r[o++]=c,i[o++]=e.colorTr,r[o++]=w,r[o++]=e.tx,r[o++]=g,r[o++]=d,r[o++]=f,i[o++]=e.colorBl,r[o++]=w,r[o++]=b,r[o++]=g,r[o++]=p,r[o++]=f,i[o++]=e.colorBr,r[o++]=w}this.curRenderOp.length+=Ei,this.curRenderOp.numQuads++,this.curBufferIdx=o}newRenderOp(e,r,i,n,o,a,h,u,d){const c=new xi(this.glw,this.options,this.quadBufferCollection,e,r,i,o,n,a,0,h,u,d);this.curRenderOp=c,this.renderOps.push(c)}addTexture(e,r,i){const{curRenderOp:n}=this;M(n);const o=n.addTexture(e);if(o===4294967295){if(i)throw new Error("Unable to add texture to render op");return this.newRenderOp(n.shader,n.shaderProps,n.alpha,n.dimensions,n.clippingRect,r),this.addTexture(e,r,!0)}return o}reuseRenderOp(e){var u;const{shader:r,shaderProps:i,parentHasRenderTexture:n,rtt:o,clippingRect:a}=e,h=r||this.defaultShader;return!(((u=this.curRenderOp)==null?void 0:u.shader)!==h||As(this.curRenderOp.clippingRect,a)===!1||n!==void 0||o!==void 0||this.curRenderOp.shader!==this.defaultShader&&(i===null||this.curRenderOp.shader.canBatchShaderProps(this.curRenderOp.shaderProps,i)===!1))}addRenderOp(e){this.renderOps.push(e),this.curRenderOp=null}render(e="screen"){const{glw:r,quadBuffer:i}=this,n=new Float32Array(i,0,this.curBufferIdx),o=this.quadBufferCollection.getBuffer("a_position")||null;r.arrayBufferData(o,n,r.STATIC_DRAW);for(let h=0,u=this.renderOps.length;h<u;h++)this.renderOps[h].draw();this.quadBufferUsage=this.curBufferIdx*n.BYTES_PER_ELEMENT;const a=4*(6*n.BYTES_PER_ELEMENT);this.numQuadsRendered=this.quadBufferUsage/a}getQuadCount(){return this.numQuadsRendered}renderToTexture(e){for(let r=0;r<this.rttNodes.length;r++)if(this.rttNodes[r]===e)return;this.insertRTTNodeInOrder(e)}insertRTTNodeInOrder(e){let r=this.rttNodes.length,i=e;for(;i&&i.parent;){const o=this.rttNodes.indexOf(i.parent);if(o!==-1){r=o;break}i=i.parent}const n=this.findMaxChildRTTIndex(e);n!==-1&&(r=Math.max(r,n+1)),this.rttNodes.splice(r,0,e)}findMaxChildRTTIndex(e){let r=-1;const i=n=>{const o=this.rttNodes.indexOf(n);o!==-1&&(r=Math.max(r,o));for(const a of n.children)i(a)};return i(e),r}renderRTTNodes(){const{glw:e}=this,{txManager:r}=this.stage;for(let n=0;n<this.rttNodes.length;n++){const o=this.rttNodes[n];if(o===void 0||o.hasRTTupdates===!1||o.worldAlpha===0||o.strictBounds===!0&&o.renderState===N.OutOfBounds||o.texture===null||o.texture.state!=="loaded")continue;this.activeRttNode=o,M(o.texture,"RTT node missing texture");const a=o.texture.ctxTexture;M(a instanceof Er),this.renderToTextureActive=!0,e.bindFramebuffer(a.framebuffer),e.viewport(0,0,a.w,a.h),e.clearColor(0,0,0,0),e.clear();for(let h=0;h<o.children.length;h++){const u=o.children[h];u!==void 0&&(this.stage.addQuads(u),u.hasRTTupdates=!1)}this.render(),this.renderOps.length=0,o.hasRTTupdates=!1}const i=this.clearColor.normalized;e.clearColor(i[0],i[1],i[2],i[3]),e.bindFramebuffer(null),e.viewport(0,0,this.glw.canvas.width,this.glw.canvas.height),this.renderToTextureActive=!1}removeRTTNode(e){const r=this.rttNodes.indexOf(e);r!==-1&&this.rttNodes.splice(r,1)}getBufferInfo(){return{totalAvailable:this.stage.options.quadBufferSize,totalUsed:this.quadBufferUsage}}getDefShaderCtr(){return this.defShaderCtrl}updateClearColor(e){if(this.clearColor.raw===e)return;const r=this.glw,i=Pt(e);r.clearColor(i[0],i[1],i[2],i[3]),this.clearColor={raw:e,normalized:i},r.clear()}}let ue;function Ai(s,t="app"){return ue=new gi(s,t),ue}const D={debug:!1,focusDebug:!1,keyDebug:!1,animationsEnabled:!0,animationSettings:{duration:250,easing:"ease-in-out"},fontSettings:{fontFamily:"Ubuntu",fontSize:100},setActiveElement:()=>{},focusStateKey:"$focus"},Ce={Element:"element",TextNode:"textNode",Text:"text"};function he(s,t,...e){}const zt=s=>s instanceof Function,pt=s=>typeof s=="function";function sr(s){return Array.isArray(s)}function Cr(s){return typeof s=="string"}function Mi(s){return typeof s=="number"}function Ii(s){return Number.isInteger(s)}function Pi(s){return"destroy"in s&&typeof s.destroy=="function"}function st(s){return s instanceof de}function wt(s){return s._type===Ce.TextNode}function Bi(s){return s._type===Ce.Text}function Li(s,t){for(const e of t)if(e in s)return!0;return!1}class Ar extends Array{constructor(e,r={}){var t=(...xo)=>(super(...xo),l(this,"onChange"),this);return sr(r)?t(...r):Cr(r)?t(r):t(...Object.entries(r).filter(([i,n])=>n).map(([i])=>i)),this.onChange=e,this}has(e){return this.indexOf(e)>=0||this.indexOf(`$${e}`)>=0}is(e){return this.indexOf(e)>=0}add(e){this.has(e)||(this.push(e),this.onChange())}toggle(e,r){r===!0?this.add(e):r===!1?this.remove(e):this.has(e)?this.remove(e):this.add(e)}merge(e){if(sr(e))this.length=0,this.push(...e);else if(Cr(e))this.length=0,this.push(e);else for(const r in e)if(e[r])this.has(r)||this.push(r);else{const n=this.indexOf(r);n>=0&&this.splice(n,1)}return this}remove(e){const r=this.indexOf(e);r>=0&&(this.splice(r,1),this.onChange())}}function Oi(s){var A;const t=[];let e=!1,r=0;for(let R=0;R<s.children.length;R++){const v=s.children[R];if(wt(v)&&v.text&&!(v.width||v.height))return!1;Bi(v)||v.flexItem===!1||(v.flexOrder!==void 0&&(e=!0),v.flexGrow!==void 0&&(r+=v.flexGrow),t.push(v))}e?t.sort((R,v)=>(R.flexOrder||0)-(v.flexOrder||0)):s.direction==="rtl"&&t.reverse();const i=t.length,o=(s.flexDirection||"row")==="row",a=o?"width":"height",h=o?"height":"width",u=o?"marginLeft":"marginTop",d=o?"marginTop":"marginLeft",c=o?"marginRight":"marginBottom",p=o?"marginBottom":"marginRight",f=o?"x":"y",_=o?"y":"x",T=s[a]||0;let w=s[h]||0;const b=s.gap||0,g=s.justifyContent||"flexStart",x=s.alignItems||(s.flexWrap?"flexStart":void 0);let m=!1;if(r&&i>1){s.flexBoundary=s.flexBoundary||"fixed";const R=t.reduce((C,I)=>C+(I.flexGrow!=null&&I.flexGrow>=0?0:I[a]||0)+(I[u]||0)+(I[c]||0),0),v=(T-R-b*(i-1))/r;if(v>=0)for(let C=0;C<i;C++){const I=t[C];I.flexGrow!=null&&I.flexGrow>=0&&(I[a]=I.flexGrow*v)}else console.warn("Negative growFactor, flexGrow not applied")}let S=0;(g==="center"||g==="spaceBetween"||g==="spaceEvenly")&&(S=t.reduce((R,v)=>R+(v[a]||0)+(v[u]||0)+(v[c]||0),0));const E=w?(R,v=0)=>{const C=R.alignSelf||x;if(C)C==="flexStart"?R[_]=v+(R[d]||0):C==="center"?R[_]=v+(w-(R[h]||0))/2+(R[d]||0):C==="flexEnd"&&(R[_]=v+w-(R[h]||0)-(R[p]||0));else return}:R=>R;if(o&&s._calcHeight&&!s.flexCrossBoundary){const R=((A=t[0])==null?void 0:A.height)||s.height;R!==s.height&&(m=!0,s.height=w=R)}if(g==="flexStart"){let R=s.padding||0;if(s.flexWrap==="wrap"){let v=0;const C=o?s.columnGap??b:s.rowGap??b;for(let I=0;I<t.length;I++){const F=t[I],H=(F[a]||0)+(F[u]||0)+(F[c]||0);R+H>T&&(R=s.padding||0,v+=w+C),F[f]=R+(F[u]||0),R+=H+b,E(F,v)}s[`preFlex${h}`]=w,s[h]=v+w}else for(let v=0;v<t.length;v++){const C=t[v];C[f]=R+(C[u]||0),R+=(C[a]||0)+b+(C[u]||0)+(C[c]||0),E(C)}if(s.flexBoundary!=="fixed"&&s.flexWrap!=="wrap"){const v=R-b+(s.padding||0);if(v!==T)return s[`preFlex${a}`]=T,s[a]=v,!0}}else if(g==="flexEnd"){let R=T;for(let v=i-1;v>=0;v--){const C=t[v];C[f]=R-(C[a]||0)-(C[c]||0),R-=(C[a]||0)+b+(C[u]||0)+(C[c]||0),E(C)}}else if(g==="center"){let R=(T-(S+b*(i-1)))/2;for(let v=0;v<t.length;v++){const C=t[v];C[f]=R+(C[u]||0),R+=(C[a]||0)+b+(C[u]||0)+(C[c]||0),E(C)}}else if(g==="spaceBetween"){const R=(T-S)/(i-1);let v=0;for(let C=0;C<t.length;C++){const I=t[C];I[f]=v+(I[u]||0),v+=(I[a]||0)+R+(I[u]||0)+(I[c]||0),E(I)}}else if(g==="spaceEvenly"){const R=(T-S)/(i+1);let v=R;for(let C=0;C<t.length;C++){const I=t[C];I[f]=v+(I[u]||0),v+=(I[a]||0)+R+(I[u]||0)+(I[c]||0),E(I)}}return m}const Ue={ArrowLeft:"Left",ArrowRight:"Right",ArrowUp:"Up",ArrowDown:"Down",Enter:"Enter",l:"Last"," ":"Space",Backspace:"Back",Escape:"Escape"},ir={},Mr=(s,t)=>{for(const[e,r]of Object.entries(s))Array.isArray(r)?r.forEach(i=>{t[i]=e}):r===null?delete t[e]:t[r]=e};let Ir=!0;const Ui=(s,t)=>{if(Ir){const e=document.createElement("style");e.type="text/css",e.innerHTML=`
      [data-focus="3"] {
        border: 2px solid rgba(255, 33, 33, 0.2);
        border-radius: 5px;
        transition: border-color 0.3s ease;
      }

      [data-focus="2"] {
        border: 2px solid rgba(255, 33, 33, 0.4);
        border-radius: 5px;
        transition: border-color 0.3s ease;
      }

      [data-focus="1"] {
        border: 4px solid rgba(255, 33, 33, 0.9);
        border-radius: 5px;
        transition: border-color 0.5s ease;
      }
    `,document.head.appendChild(e),Ir=!1}s.forEach(e=>{e.data={...e.data,focus:void 0}}),t.forEach((e,r)=>{e.data={...e.data,focus:r+1}})};let Pr;const Di=s=>{ki(s,Pr),Pr=s,D.setActiveElement(s)};let ce=[];const ki=(s,t)=>{var i,n;let e=s;const r=[];for(;e;)(!e.states.has(D.focusStateKey)||e===s)&&(e.states.add(D.focusStateKey),(i=e.onFocus)==null||i.call(e,s,t),(n=e.onFocusChanged)==null||n.call(e,!0,s,t)),r.push(e),e=e.parent;return ce.forEach(o=>{var a,h;r.includes(o)||(o.states.remove(D.focusStateKey),(a=o.onBlur)==null||a.call(o,s,t),(h=o.onFocusChanged)==null||h.call(o,!1,s,t))}),D.focusDebug&&Ui(ce,r),ce=r,r},it=(s,t,e=!1,r=!1)=>{let i;const n=ce.length;for(let o=n-1;o>=0;o--){const a=ce[o],h=`capture${s.key}`,u=a[h]||a.captureKey;if(pt(u)&&u.call(a,s,a,i)===!0)return!0}for(let o=0;o<n;o++){const a=ce[o];if(i||(i=a),t){const h=r?a[`on${t}Release`]:a[`on${t}`];if(pt(h)&&h.call(a,s,a,i)===!0)return!0}if(!r){const h=e?a.onKeyHold:a.onKeyPress;if(pt(h)&&h.call(a,s,t,a,i)===!0)return!0}}return!1},Fi=500,J={},Ni=(s,t,e)=>{if(t){const r=t.key||t.keyCode,i=ir[t.key]||ir[t.keyCode],n=Ue[t.key]||Ue[t.keyCode];if(i){J[r]||(J[r]=window.setTimeout(()=>{J[r]=!0,it(t,i,!0)},s));return}it(t,n,!1)}else if(e){const r=e.key||e.keyCode,i=Ue[e.key]||Ue[e.keyCode];J[r]===!0?delete J[r]:J[r]&&(clearTimeout(J[r]),delete J[r],it(e,i,!1)),it(e,i,!1,!0)}},$i=({userKeyMap:s,keyHoldOptions:t,ownerContext:e=r=>{r()}}={})=>{s&&Mr(s,Ue),t!=null&&t.userKeyHoldMap&&Mr(t.userKeyHoldMap,ir);const r=(t==null?void 0:t.holdThreshold)||Fi,i=Ni.bind(null,r),n=a=>e(()=>{i(a,void 0)}),o=a=>e(()=>{i(void 0,a)});return document.addEventListener("keyup",o),document.addEventListener("keydown",n),{cleanup:()=>{document.removeEventListener("keydown",n),document.removeEventListener("keyup",o);for(const[a,h]of Object.entries(J))h&&h!==!0&&clearTimeout(h)},focusPath:()=>ce}},nr=new Set;function Xi(){const s=[...nr];nr.clear();for(let t=s.length-1;t>=0;t--)s[t].updateLayout()}function Vt(s,t){const e=[];for(const r in t)e.push(ue.createEffect(r,t[r],r));return ue.createShader("DynamicShader",{effects:e})}function Be(s=""){return{set(t){Mi(t)&&(t={width:t,color:255}),this.effects=this.effects?{...this.effects||{},[`border${s}`]:t}:{[`border${s}`]:t}},get(){var t;return(t=this.effects)==null?void 0:t[`border${s}`]}}}const zi=["alpha","color","colorTop","colorRight","colorLeft","colorBottom","colorTl","colorTr","colorBl","colorBr","height","fontSize","lineHeight","mount","mountX","mountY","pivot","pivotX","pivotY","rotation","scale","scaleX","scaleY","width","worldX","worldY","x","y","zIndex","zIndexLocked"],Vi=["absX","absY","autosize","clipping","contain","data","fontFamily","fontStretch","fontStyle","fontWeight","imageType","letterSpacing","maxLines","offsetY","overflowSuffix","preventCleanup","rtt","scrollable","scrollY","srcHeight","srcWidth","srcX","srcY","strictBounds","text","textAlign","textBaseline","textOverflow","texture","textureOptions","verticalAlign","wordWrap"];class de extends Object{constructor(t){super(),this._type=t==="text"?Ce.TextNode:Ce.Element,this.rendered=!1,this.lng={},this.children=[]}get effects(){return this._effects}set effects(t){this._effects=t,this.rendered&&(this.lng.shader=Vt(this,t))}set id(t){var e;this._id=t,(e=D.rendererOptions)!=null&&e.inspector&&(this.data={...this.data,testId:t})}get id(){return this._id}get parent(){return this._parent}set parent(t){this._parent=t,this.rendered&&(this.lng.parent=(t==null?void 0:t.lng)??null)}insertChild(t,e){if(t.parent=this,e){this.removeChild(t);const r=this.children.indexOf(e);if(r>=0){this.children.splice(r,0,t);return}}this.children.push(t)}removeChild(t){const e=this.children.indexOf(t);e>=0&&this.children.splice(e,1)}get selectedNode(){const t=this.selected||0;for(let e=t;e<this.children.length;e++){const r=this.children[e];if(st(r))return this.selected=e,r}}set shader(t){let e=t;sr(t)&&(e=ue.createShader(...t)),this.lng.shader=e}_sendToLightningAnimatable(t,e){if(this.transition&&this.rendered&&D.animationsEnabled&&(this.transition===!0||this.transition[t])){const r=this.transition===!0||this.transition[t]===!0?void 0:this.transition[t],i=this.animate({[t]:e},r);if(this.onAnimation){const n=Object.keys(this.onAnimation);for(const o of n){const a=this.onAnimation[o];i.on(o,(h,u)=>{a.call(this,h,t,e,u)})}}return i.start()}this.lng[t]=e}animate(t,e){return M(this.rendered,"Node must be rendered before animating"),this.lng.animate(t,e||this.animationSettings||{})}chain(t,e){return this._animationRunning&&(this._animationQueue=[],this._animationRunning=!1),e?this._animationQueueSettings=e:this._animationQueueSettings||(this._animationQueueSettings=e||this.animationSettings),e=e||this._animationQueueSettings,this._animationQueue=this._animationQueue||[],this._animationQueue.push({props:t,animationSettings:e}),this}async start(){let t=this._animationQueue.shift();for(;t;)this._animationRunning=!0,await this.animate(t.props,t.animationSettings).start().waitUntilStopped(),t=this._animationQueue.shift();this._animationRunning=!1,this._animationQueueSettings=void 0}emit(t,...e){let r=this;const i=`on${t.charAt(0).toUpperCase()}${t.slice(1)}`;for(;r;){const n=r[i];if(pt(n)&&n.call(r,this,...e)===!0)return!0;r=r.parent}return!1}setFocus(){if(this.rendered){if(this.forwardFocus!==void 0)if(zt(this.forwardFocus)){if(this.forwardFocus.call(this,this)!==!1)return}else{const t=typeof this.forwardFocus=="number"?this.forwardFocus:null,e=this.children;if(t!==null&&t<e.length){const r=e[t];st(r)&&r.setFocus();return}}queueMicrotask(()=>Di(this))}else this._autofocus=!0}_layoutOnLoad(){this.lng.on("loaded",()=>{this.parent.updateLayout()})}getText(){let t="";for(let e=0;e<this.children.length;e++)t+=this.children[e].text;return t}destroy(){if(this.onDestroy){const t=this.onDestroy(this);t instanceof Promise?t.then(()=>this._destroy()):this._destroy()}else this._destroy()}_destroy(){var t;this._queueDelete&&Pi(this.lng)&&(this.lng.destroy(),(t=this.parent)!=null&&t.requiresLayout()&&this.parent.updateLayout())}set style(t){if(!(D.lockStyles&&this._style)&&t){this._style=t;for(const e in this._style)this[e]===void 0&&(this[e]=this._style[e])}}get style(){return this._style}get hasChildren(){return this.children.length>0}set src(t){typeof t=="string"?(this.lng.src=t,!this.color&&this.rendered&&(this.color=4294967295)):this.color=0}get src(){return this.lng.src}getChildById(t){return this.children.find(e=>e.id===t)}searchChildrenById(t){for(let e=0;e<this.children.length;e++){const r=this.children[e];if(st(r)){if(r.id===t)return r;const i=r.searchChildrenById(t);if(i)return i}}}set states(t){this._states=this._states?this._states.merge(t):new Ar(this._stateChanged.bind(this),t),this.rendered&&this._stateChanged()}get states(){return this._states=this._states||new Ar(this._stateChanged.bind(this)),this._states}get animationSettings(){return this._animationSettings||D.animationSettings}set animationSettings(t){this._animationSettings=t}set hidden(t){this.alpha=t?0:1}get hidden(){return this.alpha===0}set autofocus(t){this._autofocus=t,t&&queueMicrotask(()=>this.setFocus())}get autofocus(){return this._autofocus}requiresLayout(){return this.display==="flex"||this.onLayout}set updateLayoutOn(t){this.updateLayout()}get updateLayoutOn(){return null}updateLayout(){var t,e;this.hasChildren&&(he(),this.display==="flex"&&Oi(this)&&((t=this.parent)==null||t.updateLayout()),zt(this.onLayout)&&this.onLayout.call(this,this)&&((e=this.parent)==null||e.updateLayout()))}_stateChanged(){if(he("State Changed: ",this,this.states),this.forwardStates){const e=this.states.slice();this.children.forEach(r=>{r.states=e})}const t=this.states;if(this._undoStyles||Li(this,t)){let e;this._undoStyles&&this._undoStyles.length&&(e={},this._undoStyles.forEach(n=>{e[n]=this.style[n]}));const r=t.length;if(r===0){Object.assign(this,e),this._undoStyles=[];return}let i;r===1?(i=this[t[0]],i=e?{...e,...i}:i):i=t.reduce((n,o)=>{const a=this[o];return a?{...n,...a}:n},e||{}),i?(this._undoStyles=Object.keys(i),i.transition!==void 0&&(this.transition=i.transition),Object.assign(this,i)):this._undoStyles=[]}}render(t){var n;const e=this,r=this.parent;if(!r){console.warn("Parent not set - no node created for: ",this);return}if(!r.rendered){console.warn("Parent not rendered yet: ",this);return}if(r.requiresLayout()&&nr.add(r),this.rendered)return;this._states&&this._stateChanged();const i=e.lng;if(i.x=i.x||0,i.y=i.y||0,i.parent=r.lng,(this.right||this.right===0)&&(i.x=(r.width||0)-this.right,i.mountX=1),(this.bottom||this.bottom===0)&&(i.y=(r.height||0)-this.bottom,i.mountY=1),this.center&&(this.centerX=this.centerY=!0),this.centerX&&(i.x+=(r.width||0)/2,i.mountX=.5),this.centerY&&(i.y+=(r.height||0)/2,i.mountY=.5),wt(e)){const o=i;if(D.fontSettings)for(const a in D.fontSettings)o[a]===void 0&&(o[a]=D.fontSettings[a]);o.text=o.text||e.getText(),o.textAlign&&!o.contain&&console.warn("Text align requires contain: ",e.getText()),o.contain&&(o.width||(o.width=(r.width||0)-o.x-(o.marginRight||0)),o.contain==="both"&&!o.height&&!o.maxLines?o.height=(r.height||0)-o.y-(o.marginBottom||0):o.maxLines===1&&(o.height=o.height||o.lineHeight||o.fontSize)),e._effects&&(i.shader=Vt(e,e._effects)),he("Rendering: ",this,i),e.lng=ue.createTextNode(i),r.requiresLayout()&&(!i.width||!i.height)&&e._layoutOnLoad()}else i.texture||(isNaN(i.width)&&(i.width=(r.width||0)-i.x,e._calcWidth=!0),isNaN(i.height)&&(i.height=(r.height||0)-i.y,e._calcHeight=!0),i.rtt&&!i.color&&(i.color=4294967295),!i.color&&!i.src&&(i.color=0)),e._effects&&(i.shader=Vt(e,e._effects)),he("Rendering: ",this,i),e.lng=ue.createNode(i);if(e.rendered=!0,e.autosize&&r.requiresLayout()&&e._layoutOnLoad(),zt(this.onCreate)&&this.onCreate.call(this,e),e.onEvent)for(const[o,a]of Object.entries(e.onEvent))e.lng.on(o,(h,u)=>a.call(e,e,u));if((n=e.lng)!=null&&n.div&&(e.lng.div.element=e),e._type===Ce.Element){const o=e.children.length;for(let a=0;a<o;a++){const h=e.children[a];M(h,"Child is undefined"),st(h)&&h.render()}}t&&Xi(),e._autofocus&&e.setFocus()}}for(const s of zi)Object.defineProperty(de.prototype,s,{get(){return this.lng[s]},set(t){this._sendToLightningAnimatable(s,t)}});for(const s of Vi)Object.defineProperty(de.prototype,s,{get(){return this.lng[s]},set(t){this.lng[s]=t}});function Gt(s){return{set(t){this.effects=this.effects?{...this.effects,[s]:t}:{[s]:t}},get(){var t;return(t=this.effects)==null?void 0:t[s]}}}Object.defineProperties(de.prototype,{border:Be(),borderLeft:Be("Left"),borderRight:Be("Right"),borderTop:Be("Top"),borderBottom:Be("Bottom"),linearGradient:Gt("linearGradient"),radialGradient:Gt("radialGradient"),radialProgress:Gt("radialProgressGradient"),borderRadius:{set(s){this.effects=this.effects?{...this.effects,radius:{radius:s}}:{radius:{radius:s}}},get(){var s,t;return(t=(s=this.effects)==null?void 0:s.radius)==null?void 0:t.radius}}});const Gi=!1,Wi=(s,t)=>s===t,or=Symbol("solid-proxy"),Hi=typeof Proxy=="function",Kr=Symbol("solid-track"),bt={equals:Wi};let Qr=ts;const ie=1,St=2,jr={owned:null,cleanups:null,context:null,owner:null};var L=null;let Wt=null,Yi=null,U=null,z=null,te=null,Bt=0;function fe(s,t){const e=U,r=L,i=s.length===0,n=r,o=i?jr:{owned:null,cleanups:null,context:n?n.context:null,owner:n},a=i?s:()=>s(()=>q(()=>Ve(o)));L=o,U=null;try{return ne(a,!0)}finally{U=e,L=r}}function X(s,t){t=t?Object.assign({},bt,t):bt;const e={value:s,observers:null,observerSlots:null,comparator:t.equals||void 0},r=i=>(typeof i=="function"&&(i=i(e.value)),es(e,i));return[Jr.bind(e),r]}function K(s,t,e){const r=dr(s,t,!1,ie);He(r)}function qi(s,t,e){Qr=en;const r=dr(s,t,!1,ie);r.user=!0,te?te.push(r):He(r)}function k(s,t,e){e=e?Object.assign({},bt,e):bt;const r=dr(s,t,!0,0);return r.observers=null,r.observerSlots=null,r.comparator=e.equals||void 0,He(r),Jr.bind(r)}function Ki(s){return ne(s,!1)}function q(s){if(U===null)return s();const t=U;U=null;try{return s()}finally{U=t}}function Lt(s,t,e){const r=Array.isArray(s);let i,n=e&&e.defer;return o=>{let a;if(r){a=Array(s.length);for(let u=0;u<s.length;u++)a[u]=s[u]()}else a=s();if(n)return n=!1,o;const h=q(()=>t(a,i,o));return i=a,h}}function j(s){return L===null||(L.cleanups===null?L.cleanups=[s]:L.cleanups.push(s)),s}function Ot(){return L}function Ut(s,t){const e=L,r=U;L=s,U=null;try{return ne(t,!0)}catch(i){fr(i)}finally{L=e,U=r}}function Qi(s){const t=U,e=L;return Promise.resolve().then(()=>{U=t,L=e,ne(s,!1),U=L=null})}const[po,go]=X(!1);function Zr(s,t){const e=Symbol("context");return{id:e,Provider:rn(e),defaultValue:s}}function ji(s){let t;return L&&L.context&&(t=L.context[s.id])!==void 0?t:s.defaultValue}function cr(s){const t=k(s),e=k(()=>ar(t()));return e.toArray=()=>{const r=e();return Array.isArray(r)?r:r!=null?[r]:[]},e}function Jr(){if(this.sources&&this.state)if(this.state===ie)He(this);else{const s=z;z=null,ne(()=>Ct(this),!1),z=s}if(U){const s=this.observers?this.observers.length:0;U.sources?(U.sources.push(this),U.sourceSlots.push(s)):(U.sources=[this],U.sourceSlots=[s]),this.observers?(this.observers.push(U),this.observerSlots.push(U.sources.length-1)):(this.observers=[U],this.observerSlots=[U.sources.length-1])}return this.value}function es(s,t,e){let r=s.value;return(!s.comparator||!s.comparator(r,t))&&(s.value=t,s.observers&&s.observers.length&&ne(()=>{for(let i=0;i<s.observers.length;i+=1){const n=s.observers[i],o=Wt&&Wt.running;o&&Wt.disposed.has(n),(o?!n.tState:!n.state)&&(n.pure?z.push(n):te.push(n),n.observers&&rs(n)),o||(n.state=ie)}if(z.length>1e6)throw z=[],new Error},!1)),t}function He(s){if(!s.fn)return;Ve(s);const t=Bt;Zi(s,s.value,t)}function Zi(s,t,e){let r;const i=L,n=U;U=L=s;try{r=s.fn(t)}catch(o){return s.pure&&(s.state=ie,s.owned&&s.owned.forEach(Ve),s.owned=null),s.updatedAt=e+1,fr(o)}finally{U=n,L=i}(!s.updatedAt||s.updatedAt<=e)&&(s.updatedAt!=null&&"observers"in s?es(s,r):s.value=r,s.updatedAt=e)}function dr(s,t,e,r=ie,i){const n={fn:s,state:r,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:L,context:L?L.context:null,pure:e};return L===null||L!==jr&&(L.owned?L.owned.push(n):L.owned=[n]),n}function Et(s){if(s.state===0)return;if(s.state===St)return Ct(s);if(s.suspense&&q(s.suspense.inFallback))return s.suspense.effects.push(s);const t=[s];for(;(s=s.owner)&&(!s.updatedAt||s.updatedAt<Bt);)s.state&&t.push(s);for(let e=t.length-1;e>=0;e--)if(s=t[e],s.state===ie)He(s);else if(s.state===St){const r=z;z=null,ne(()=>Ct(s,t[0]),!1),z=r}}function ne(s,t){if(z)return s();let e=!1;t||(z=[]),te?e=!0:te=[],Bt++;try{const r=s();return Ji(e),r}catch(r){e||(te=null),z=null,fr(r)}}function Ji(s){if(z&&(ts(z),z=null),s)return;const t=te;te=null,t.length&&ne(()=>Qr(t),!1)}function ts(s){for(let t=0;t<s.length;t++)Et(s[t])}function en(s){let t,e=0;for(t=0;t<s.length;t++){const r=s[t];r.user?s[e++]=r:Et(r)}for(t=0;t<e;t++)Et(s[t])}function Ct(s,t){s.state=0;for(let e=0;e<s.sources.length;e+=1){const r=s.sources[e];if(r.sources){const i=r.state;i===ie?r!==t&&(!r.updatedAt||r.updatedAt<Bt)&&Et(r):i===St&&Ct(r,t)}}}function rs(s){for(let t=0;t<s.observers.length;t+=1){const e=s.observers[t];e.state||(e.state=St,e.pure?z.push(e):te.push(e),e.observers&&rs(e))}}function Ve(s){let t;if(s.sources)for(;s.sources.length;){const e=s.sources.pop(),r=s.sourceSlots.pop(),i=e.observers;if(i&&i.length){const n=i.pop(),o=e.observerSlots.pop();r<i.length&&(n.sourceSlots[o]=r,i[r]=n,e.observerSlots[r]=o)}}if(s.tOwned){for(t=s.tOwned.length-1;t>=0;t--)Ve(s.tOwned[t]);delete s.tOwned}if(s.owned){for(t=s.owned.length-1;t>=0;t--)Ve(s.owned[t]);s.owned=null}if(s.cleanups){for(t=s.cleanups.length-1;t>=0;t--)s.cleanups[t]();s.cleanups=null}s.state=0}function tn(s){return s instanceof Error?s:new Error(typeof s=="string"?s:"Unknown error",{cause:s})}function fr(s,t=L){throw tn(s)}function ar(s){if(typeof s=="function"&&!s.length)return ar(s());if(Array.isArray(s)){const t=[];for(let e=0;e<s.length;e++){const r=ar(s[e]);Array.isArray(r)?t.push.apply(t,r):t.push(r)}return t}return s}function rn(s,t){return function(r){let i;return K(()=>i=q(()=>(L.context={...L.context,[s]:r.value},cr(()=>r.children))),void 0),i}}const lr=Symbol("fallback");function At(s){for(let t=0;t<s.length;t++)s[t]()}function sn(s,t,e={}){let r=[],i=[],n=[],o=0,a=t.length>1?[]:null;return j(()=>At(n)),()=>{let h=s()||[],u=h.length,d,c;return h[Kr],q(()=>{let f,_,T,w,b,g,x,m,S;if(u===0)o!==0&&(At(n),n=[],r=[],i=[],o=0,a&&(a=[])),e.fallback&&(r=[lr],i[0]=fe(E=>(n[0]=E,e.fallback())),o=1);else if(o===0){for(i=new Array(u),c=0;c<u;c++)r[c]=h[c],i[c]=fe(p);o=u}else{for(T=new Array(u),w=new Array(u),a&&(b=new Array(u)),g=0,x=Math.min(o,u);g<x&&r[g]===h[g];g++);for(x=o-1,m=u-1;x>=g&&m>=g&&r[x]===h[m];x--,m--)T[m]=i[x],w[m]=n[x],a&&(b[m]=a[x]);for(f=new Map,_=new Array(m+1),c=m;c>=g;c--)S=h[c],d=f.get(S),_[c]=d===void 0?-1:d,f.set(S,c);for(d=g;d<=x;d++)S=r[d],c=f.get(S),c!==void 0&&c!==-1?(T[c]=i[d],w[c]=n[d],a&&(b[c]=a[d]),c=_[c],f.set(S,c)):n[d]();for(c=g;c<u;c++)c in T?(i[c]=T[c],n[c]=w[c],a&&(a[c]=b[c],a[c](c))):i[c]=fe(p);i=i.slice(0,o=u),r=h.slice(0)}return i});function p(f){if(n[c]=f,a){const[_,T]=X(c);return a[c]=T,t(h[c],_)}return t(h[c])}}}function nn(s,t,e={}){let r=[],i=[],n=[],o=[],a=0,h;return j(()=>At(n)),()=>{const u=s()||[],d=u.length;return u[Kr],q(()=>{if(d===0)return a!==0&&(At(n),n=[],r=[],i=[],a=0,o=[]),e.fallback&&(r=[lr],i[0]=fe(p=>(n[0]=p,e.fallback())),a=1),i;for(r[0]===lr&&(n[0](),n=[],r=[],i=[],a=0),h=0;h<d;h++)h<r.length&&r[h]!==u[h]?o[h](()=>u[h]):h>=r.length&&(i[h]=fe(c));for(;h<r.length;h++)n[h]();return a=o.length=n.length=d,r=u.slice(0),i=i.slice(0,a)});function c(p){n[h]=p;const[f,_]=X(u[h]);return o[h]=_,t(f,h)}}}function ss(s,t){return q(()=>s(t||{}))}function nt(){return!0}const on={get(s,t,e){return t===or?e:s.get(t)},has(s,t){return t===or?!0:s.has(t)},set:nt,deleteProperty:nt,getOwnPropertyDescriptor(s,t){return{configurable:!0,enumerable:!0,get(){return s.get(t)},set:nt,deleteProperty:nt}},ownKeys(s){return s.keys()}};function Ht(s){return(s=typeof s=="function"?s():s)?s:{}}function an(){for(let s=0,t=this.length;s<t;++s){const e=this[s]();if(e!==void 0)return e}}function pr(...s){let t=!1;for(let o=0;o<s.length;o++){const a=s[o];t=t||!!a&&or in a,s[o]=typeof a=="function"?(t=!0,k(a)):a}if(Hi&&t)return new Proxy({get(o){for(let a=s.length-1;a>=0;a--){const h=Ht(s[a])[o];if(h!==void 0)return h}},has(o){for(let a=s.length-1;a>=0;a--)if(o in Ht(s[a]))return!0;return!1},keys(){const o=[];for(let a=0;a<s.length;a++)o.push(...Object.keys(Ht(s[a])));return[...new Set(o)]}},on);const e={},r=Object.create(null);for(let o=s.length-1;o>=0;o--){const a=s[o];if(!a)continue;const h=Object.getOwnPropertyNames(a);for(let u=h.length-1;u>=0;u--){const d=h[u];if(d==="__proto__"||d==="constructor")continue;const c=Object.getOwnPropertyDescriptor(a,d);if(!r[d])r[d]=c.get?{enumerable:!0,configurable:!0,get:an.bind(e[d]=[c.get.bind(a)])}:c.value!==void 0?c:void 0;else{const p=e[d];p&&(c.get?p.push(c.get.bind(a)):c.value!==void 0&&p.push(()=>c.value))}}}const i={},n=Object.keys(r);for(let o=n.length-1;o>=0;o--){const a=n[o],h=r[a];h&&h.get?Object.defineProperty(i,a,h):i[a]=h?h.value:void 0}return i}const ln=s=>`Stale read from <${s}>.`;function hn(s){const t="fallback"in s&&{fallback:()=>s.fallback};return k(sn(()=>s.each,s.children,t||void 0))}function Dt(s){const t="fallback"in s&&{fallback:()=>s.fallback};return k(nn(()=>s.each,s.children,t||void 0))}function is(s){const t=s.keyed,e=k(()=>s.when,void 0,void 0),r=t?e:k(e,void 0,{equals:(i,n)=>!i==!n});return k(()=>{const i=r();if(i){const n=s.children;return typeof n=="function"&&n.length>0?q(()=>n(t?i:()=>{if(!q(r))throw ln("Show");return e()})):n}return s.fallback},void 0,void 0)}const[ns,os]=X(void 0);function Ie(s=""){return Ii(s)?s:typeof s=="string"?s.startsWith("#")?+(s.replace("#","0x")+(s.length===7?"ff":"")):s.startsWith("0x")?Number(s):+("0x"+(s.length===6?s+"ff":s)):0}function un({createElement:s,createTextNode:t,isTextNode:e,replaceText:r,insertNode:i,removeNode:n,setProperty:o,getParentNode:a,getFirstChild:h,getNextSibling:u}){function d(g,x,m,S){if(m!==void 0&&!S&&(S=[]),typeof x!="function")return c(g,x,S,m);K(E=>c(g,x(),E,m),S)}function c(g,x,m,S,E){for(;typeof m=="function";)m=m();if(x===m)return m;const A=typeof x,R=S!==void 0;if(A==="string"||A==="number")if(A==="number"&&(x=x.toString()),R){let v=m[0];v&&e(v)?r(v,x):v=t(x),m=_(g,m,S,v)}else m!==""&&typeof m=="string"?r(h(g),m=x):(_(g,m,S,t(x)),m=x);else if(x==null||A==="boolean")m=_(g,m,S);else{if(A==="function")return K(()=>{let v=x();for(;typeof v=="function";)v=v();m=c(g,v,m,S)}),()=>m;if(Array.isArray(x)){const v=[];if(p(v,x,E))return K(()=>m=c(g,v,m,S,!0)),()=>m;if(v.length===0){const C=_(g,m,S);if(R)return m=C}else Array.isArray(m)?m.length===0?T(g,v,S):f(g,m,v):m==null||m===""?T(g,v):f(g,R&&m||[h(g)],v);m=v}else{if(Array.isArray(m)){if(R)return m=_(g,m,S,x);_(g,m,null,x)}else m==null||m===""||!h(g)?i(g,x):w(g,x,h(g));m=x}}return m}function p(g,x,m){let S=!1;for(let E=0,A=x.length;E<A;E++){let R=x[E],v;if(!(R==null||R===!0||R===!1))if(Array.isArray(R))S=p(g,R)||S;else if((v=typeof R)=="string"||v==="number")g.push(t(R));else if(v==="function")if(m){for(;typeof R=="function";)R=R();S=p(g,Array.isArray(R)?R:[R])||S}else g.push(R),S=!0;else g.push(R)}return S}function f(g,x,m){let S=m.length,E=x.length,A=S,R=0,v=0,C=u(x[E-1]),I=null;for(;R<E||v<A;){if(x[R]===m[v]){R++,v++;continue}for(;x[E-1]===m[A-1];)E--,A--;if(E===R){const F=A<S?v?u(m[v-1]):m[A-v]:C;for(;v<A;)i(g,m[v++],F)}else if(A===v)for(;R<E;)(!I||!I.has(x[R]))&&n(g,x[R]),R++;else if(x[R]===m[A-1]&&m[v]===x[E-1]){const F=u(x[--E]);i(g,m[v++],u(x[R++])),i(g,m[--A],F),x[E]=m[A]}else{if(!I){I=new Map;let H=v;for(;H<A;)I.set(m[H],H++)}const F=I.get(x[R]);if(F!=null)if(v<F&&F<A){let H=R,B=1,O;for(;++H<E&&H<A&&!((O=I.get(x[H]))==null||O!==F+B);)B++;if(B>F-v){const V=x[R];for(;v<F;)i(g,m[v++],V)}else w(g,m[v++],x[R++])}else R++;else n(g,x[R++])}}}function _(g,x,m,S){if(m===void 0){let A;for(;A=h(g);)n(g,A);return S&&i(g,S),""}const E=S||t("");if(x.length){let A=!1;for(let R=x.length-1;R>=0;R--){const v=x[R];if(E!==v){const C=a(v)===g;!A&&!R?C?w(g,E,v):i(g,E,m):C&&n(g,v)}else A=!0}}else i(g,E,m);return[E]}function T(g,x,m){for(let S=0,E=x.length;S<E;S++)i(g,x[S],m)}function w(g,x,m){i(g,x,m),n(g,m)}function b(g,x,m={},S){return x||(x={}),S||K(()=>m.children=c(g,x.children,m.children)),K(()=>x.ref&&x.ref(g)),K(()=>{for(const E in x){if(E==="children"||E==="ref")continue;const A=x[E];A!==m[E]&&(o(g,E,A,m[E]),m[E]=A)}}),m}return{render(g,x){let m;return fe(S=>{m=S,d(x,g())}),m},insert:d,spread(g,x,m){typeof x=="function"?K(S=>b(g,x(),S,m)):b(g,x,void 0,m)},createElement:s,createTextNode:t,insertNode:i,setProp(g,x,m,S){return o(g,x,m,S),m},mergeProps:pr,effect:K,memo:k,createComponent:ss,use(g,x,m){return q(()=>g(x,m))}}}function cn(s){const t=un(s);return t.mergeProps=pr,t}const as={createElement(s){return new de(s)},createTextNode(s){return{_type:Ce.Text,text:s}},replaceText(s,t){he("Replace Text: ",s,t),s.text=t;const e=s.parent;M(e),e.text=e.getText()},setProperty(s,t,e=!0){s[t]=e},insertNode(s,t,e){he("INSERT: ",s,t,e),s.insertChild(t,e),t._queueDelete=!1,t instanceof de?s.rendered&&t.render(!0):wt(s)&&(s.text=s.getText())},isTextNode(s){return wt(s)},removeNode(s,t){he("REMOVE: ",s,t),s.removeChild(t),t._queueDelete=!0,t instanceof de&&queueMicrotask(()=>t.destroy())},getParentNode(s){return s.parent},getFirstChild(s){return s.children[0]},getNextSibling(s){const t=s.parent.children||[],e=t.indexOf(s)+1;if(e<t.length)return t[e]}},ls=cn(as);let ot;const gt=as.createElement("App"),dn=function(s){return ls.render(s,gt)};function fn(s,t){const e=D.rendererOptions;return ot=Ai(e,"app"),D.setActiveElement=os,gt.lng=ot.root,gt.rendered=!0,ot.on("idle",()=>{mr=!0,us()}),{renderer:ot,rootNode:gt,render:dn}}const{effect:hs,memo:pn,createComponent:P,createElement:gr,spread:gn,setProp:Y}=ls,Br=[];let mr=!1;K(()=>{ns(),mr=!1});function us(){mr&&Br.length&&setTimeout(()=>{const s=Br.shift();s&&(s(),us())},D.taskDelay||50)}const Q=s=>{const t=gr("node");return gn(t,s,!1),t},[mo,mn]=X([]),xn=(s,t)=>{const e=Ot(),r=Ut.bind(void 0,e);D.setActiveElement=o=>r(()=>os(o));const{cleanup:i,focusPath:n}=$i({userKeyMap:s,keyHoldOptions:t,ownerContext:r});qi(Lt(ns,()=>{mn([...n()])},{defer:!0})),j(i)};const Tn=!1;function cs(){let s=new Set;function t(i){return s.add(i),()=>s.delete(i)}let e=!1;function r(i,n){if(e)return!(e=!1);const o={to:i,options:n,defaultPrevented:!1,preventDefault:()=>o.defaultPrevented=!0};for(const a of s)a.listener({...o,from:a.location,retry:h=>{h&&(e=!0),a.navigate(i,{...n,resolve:!1})}});return!o.defaultPrevented}return{subscribe:t,confirm:r}}let hr;function xr(){(!window.history.state||window.history.state._depth==null)&&window.history.replaceState({...window.history.state,_depth:window.history.length-1},""),hr=window.history.state._depth}xr();function yn(s){return{...s,_depth:window.history.state&&window.history.state._depth}}function vn(s,t){let e=!1;return()=>{const r=hr;xr();const i=r==null?null:hr-r;if(e){e=!1;return}i&&t(i)?(e=!0,window.history.go(-i)):s()}}const _n=/^(?:[a-z0-9]+:)?\/\//i,Rn=/^\/+|(\/)\/+$/g,wn="http://sr";function De(s,t=!1){const e=s.replace(Rn,"$1");return e?t||/^[?#]/.test(e)?e:"/"+e:""}function mt(s,t,e){if(_n.test(t))return;const r=De(s),i=e&&De(e);let n="";return!i||t.startsWith("/")?n=r:i.toLowerCase().indexOf(r.toLowerCase())!==0?n=r+i:n=i,(n||"/")+De(t,!n)}function bn(s,t){return De(s).replace(/\/*(\*.*)?$/g,"")+De(t)}function ds(s){const t={};return s.searchParams.forEach((e,r)=>{r in t?Array.isArray(t[r])?t[r].push(e):t[r]=[t[r],e]:t[r]=e}),t}function Sn(s,t,e){const[r,i]=s.split("/*",2),n=r.split("/").filter(Boolean),o=n.length;return a=>{const h=a.split("/").filter(Boolean),u=h.length-o;if(u<0||u>0&&i===void 0&&!t)return null;const d={path:o?"":"/",params:{}},c=p=>e===void 0?void 0:e[p];for(let p=0;p<o;p++){const f=n[p],_=f[0]===":",T=_?h[p]:h[p].toLowerCase(),w=_?f.slice(1):f.toLowerCase();if(_&&Yt(T,c(w)))d.params[w]=T;else if(_||!Yt(T,w))return null;d.path+=`/${T}`}if(i){const p=u?h.slice(-u).join("/"):"";if(Yt(p,c(i)))d.params[i]=p;else return null}return d}}function Yt(s,t){const e=r=>r===s;return t===void 0?!0:typeof t=="string"?e(t):typeof t=="function"?t(s):Array.isArray(t)?t.some(e):t instanceof RegExp?t.test(s):!1}function En(s){const[t,e]=s.pattern.split("/*",2),r=t.split("/").filter(Boolean);return r.reduce((i,n)=>i+(n.startsWith(":")?2:3),r.length-(e===void 0?0:1))}function fs(s){const t=new Map,e=Ot();return new Proxy({},{get(r,i){return t.has(i)||Ut(e,()=>t.set(i,k(()=>s()[i]))),t.get(i)()},getOwnPropertyDescriptor(){return{enumerable:!0,configurable:!0}},ownKeys(){return Reflect.ownKeys(s())}})}function ps(s){let t=/(\/?\:[^\/]+)\?/.exec(s);if(!t)return[s];let e=s.slice(0,t.index),r=s.slice(t.index+t[0].length);const i=[e,e+=t[1]];for(;t=/^(\/\:[^\/]+)\?/.exec(r);)i.push(e+=t[1]),r=r.slice(t[0].length);return ps(r).reduce((n,o)=>[...n,...i.map(a=>a+o)],[])}const Cn=100,An=Zr(),gs=Zr();function Mn(s,t=""){const{component:e,preload:r,load:i,children:n,info:o}=s,a=!n||Array.isArray(n)&&!n.length,h={key:s,component:e,preload:r||i,info:o};return ms(s.path).reduce((u,d)=>{for(const c of ps(d)){const p=bn(t,c);let f=a?p:p.split("/*",1)[0];f=f.split("/").map(_=>_.startsWith(":")||_.startsWith("*")?_:encodeURIComponent(_)).join("/"),u.push({...h,originalPath:d,pattern:f,matcher:Sn(f,!a,s.matchFilters)})}return u},[])}function In(s,t=0){return{routes:s,score:En(s[s.length-1])*1e4-t,matcher(e){const r=[];for(let i=s.length-1;i>=0;i--){const n=s[i],o=n.matcher(e);if(!o)return null;r.unshift({...o,route:n})}return r}}}function ms(s){return Array.isArray(s)?s:[s]}function xs(s,t="",e=[],r=[]){const i=ms(s);for(let n=0,o=i.length;n<o;n++){const a=i[n];if(a&&typeof a=="object"){a.hasOwnProperty("path")||(a.path="");const h=Mn(a,t);for(const u of h){e.push(u);const d=Array.isArray(a.children)&&a.children.length===0;if(a.children&&!d)xs(a.children,u.pattern,e,r);else{const c=In([...e],r.length);r.push(c)}e.pop()}}}return e.length?r:r.sort((n,o)=>o.score-n.score)}function qt(s,t){for(let e=0,r=s.length;e<r;e++){const i=s[e].matcher(t);if(i)return i}return[]}function Pn(s,t,e){const r=new URL(wn),i=k(d=>{const c=s();try{return new URL(c,r)}catch{return console.error(`Invalid path ${c}`),d}},r,{equals:(d,c)=>d.href===c.href}),n=k(()=>i().pathname),o=k(()=>i().search,!0),a=k(()=>i().hash),h=()=>"",u=Lt(o,()=>ds(i()));return{get pathname(){return n()},get search(){return o()},get hash(){return a()},get state(){return t()},get key(){return h()},query:e?e(u):fs(u)}}let oe;function Bn(){return oe}function Ln(s,t,e,r={}){const{signal:[i,n],utils:o={}}=s,a=o.parsePath||(B=>B),h=o.renderPath||(B=>B),u=o.beforeLeave||cs(),d=mt("",r.base||"");if(d===void 0)throw new Error(`${d} is not a valid base path`);d&&!i().value&&n({value:d,replace:!0,scroll:!1});const[c,p]=X(!1);let f;const _=(B,O)=>{O.value===T()&&O.state===b()||(f===void 0&&p(!0),oe=B,f=O,Qi(()=>{f===O&&(w(f.value),g(f.state),S[1](V=>V.filter(ge=>ge.pending)))}).finally(()=>{f===O&&Ki(()=>{oe=void 0,B==="navigate"&&F(f),p(!1),f=void 0})}))},[T,w]=X(i().value),[b,g]=X(i().state),x=Pn(T,b,o.queryWrapper),m=[],S=X([]),E=k(()=>typeof r.transformUrl=="function"?qt(t(),r.transformUrl(x.pathname)):qt(t(),x.pathname)),A=()=>{const B=E(),O={};for(let V=0;V<B.length;V++)Object.assign(O,B[V].params);return O},R=o.paramsWrapper?o.paramsWrapper(A,t):fs(A),v={pattern:d,path:()=>d,outlet:()=>null,resolvePath(B){return mt(d,B)}};return K(Lt(i,B=>_("native",B),{defer:!0})),{base:v,location:x,params:R,isRouting:c,renderPath:h,parsePath:a,navigatorFactory:I,matches:E,beforeLeave:u,preloadRoute:H,singleFlight:r.singleFlight===void 0?!0:r.singleFlight,submissions:S};function C(B,O,V){q(()=>{if(typeof O=="number"){O&&(o.go?o.go(O):console.warn("Router integration does not support relative routing"));return}const ge=!O||O[0]==="?",{replace:kt,resolve:me,scroll:Ft,state:Pe}={replace:!1,resolve:!ge,scroll:!0,...V},Ye=me?B.resolvePath(O):mt(ge&&x.pathname||"",O);if(Ye===void 0)throw new Error(`Path '${O}' is not a routable path`);if(m.length>=Cn)throw new Error("Too many redirects");const Tr=T();(Ye!==Tr||Pe!==b())&&(Tn||u.confirm(Ye,V)&&(m.push({value:Tr,replace:kt,scroll:Ft,state:b()}),_("navigate",{value:Ye,state:Pe})))})}function I(B){return B=B||ji(gs)||v,(O,V)=>C(B,O,V)}function F(B){const O=m[0];O&&(n({...B,replace:O.replace,scroll:O.scroll}),m.length=0)}function H(B,O){const V=qt(t(),B.pathname),ge=oe;oe="preload";for(let kt in V){const{route:me,params:Ft}=V[kt];me.component&&me.component.preload&&me.component.preload();const{preload:Pe}=me;O&&Pe&&Ut(e(),()=>Pe({params:Ft,location:{pathname:B.pathname,search:B.search,hash:B.hash,query:ds(B),state:null,key:""},intent:"preload"}))}oe=ge}}function On(s,t,e,r){const{base:i,location:n,params:o}=s,{pattern:a,component:h,preload:u}=r().route,d=k(()=>r().path);h&&h.preload&&h.preload();const c=u?u({params:o,location:n,intent:oe||"initial"}):void 0;return{parent:t,pattern:a,path:d,outlet:()=>h?ss(h,{params:o,location:n,data:c,get children(){return e()}}):e(),resolvePath(f){return mt(i.path(),f,d())}}}const Un=s=>t=>{const{base:e}=t,r=cr(()=>t.children),i=k(()=>xs(r(),t.base||""));let n;const o=Ln(s,i,()=>n,{base:e,singleFlight:t.singleFlight,transformUrl:t.transformUrl});return s.create&&s.create(o),P(An.Provider,{value:o,get children(){return P(Dn,{routerState:o,get root(){return t.root},get preload(){return t.rootPreload||t.rootLoad},get children(){return[pn(()=>(n=Ot())&&null),P(kn,{routerState:o,get branches(){return i()}})]}})}})};function Dn(s){const t=s.routerState.location,e=s.routerState.params,r=k(()=>s.preload&&q(()=>{s.preload({params:e,location:t,intent:Bn()||"initial"})}));return P(is,{get when(){return s.root},keyed:!0,get fallback(){return s.children},children:i=>P(i,{params:e,location:t,get data(){return r()},get children(){return s.children}})})}function kn(s){const t=[];let e;const r=k(Lt(s.routerState.matches,(i,n,o)=>{let a=n&&i.length===n.length;const h=[];for(let u=0,d=i.length;u<d;u++){const c=n&&n[u],p=i[u];o&&c&&p.route.key===c.route.key?h[u]=o[u]:(a=!1,t[u]&&t[u](),fe(f=>{t[u]=f,h[u]=On(s.routerState,h[u-1]||s.routerState.base,Lr(()=>r()[u+1]),()=>s.routerState.matches()[u])}))}return t.splice(i.length).forEach(u=>u()),o&&a?o:(e=h[0],h)}));return Lr(()=>r()&&e)()}const Lr=s=>()=>P(is,{get when(){return s()},keyed:!0,children:t=>P(gs.Provider,{value:t,get children(){return t.outlet()}})}),xe=s=>{const t=cr(()=>s.children);return pr(s,{get children(){return t()}})};function Fn([s,t],e,r){return[s,r?i=>t(r(i)):t]}function Nn(s){let t=!1;const e=i=>typeof i=="string"?{value:i}:i,r=Fn(X(e(s.get()),{equals:(i,n)=>i.value===n.value&&i.state===n.state}),void 0,i=>(!t&&s.set(i),i));return s.init&&j(s.init((i=s.get())=>{t=!0,r[1](e(i)),t=!1})),Un({signal:r,create:s.create,utils:s.utils})}function $n(s){const t=s.replace(/^.*?#/,"");if(!t.startsWith("/")){const[,e="/"]=window.location.hash.split("#",2);return`${e}#${t}`}return t}function Xn(s,t,e){return s.addEventListener(t,e),()=>s.removeEventListener(t,e)}function zn(s){const t=()=>window.location.hash.slice(1),e=cs();return Nn({get:t,set({value:r,replace:i,state:n}){i?window.history.replaceState(yn(n),"","#"+r):window.history.pushState(n,"","#"+r),xr()},init:r=>Xn(window,"hashchange",vn(r,i=>!e.confirm(i&&i<0?i:t()))),utils:{go:r=>window.history.go(r),renderPath:r=>`#${r}`,parsePath:$n,beforeLeave:e,queryWrapper:s.forceProxy||!Or?r=>Ur(r,s.queryParams):void 0,paramsWrapper:s.forceProxy||!Or?(r,i)=>Ur(r,Vn(i())):void 0}})(s)}const Or=typeof Proxy=="function";function Ur(s,t){const e=new Map,r=Ot(),i={},n=a=>(e.has(a)||Ut(r,()=>e.set(a,k(()=>s()[a]))),e.get(a)());return(t||Object.keys(s())).forEach(a=>{Object.defineProperty(i,a,{get:()=>n(a),enumerable:!0,configurable:!0})}),i}const Vn=s=>{const t=[];return s.forEach(e=>{e.routes.forEach(r=>{if(r.pattern){const i=r.pattern.match(/:(\w+)/g);i&&i.forEach(n=>{const o=n.slice(1);t.includes(o)||t.push(o)})}})}),t};function Z(s,t){return Math.floor(Math.random()*(t-s+1))+s}const Dr=600,kr=800,Fr=()=>"0x"+Math.floor(Math.random()*16777215).toString(16)+"FF",Gn=()=>{const[s,t]=X([]);let e;const r=()=>{const n=[];if(s().length===0){for(let o=0;o<1e3;o++)n.push({width:Z(50,100),height:Z(50,100),x:Z(0,kr),y:Z(0,Dr),borderRadius:Z(0,50),color:Fr()});t(n)}else for(let o=0;o<1e3;o++){let a=e.children[o];a.width=Z(50,100),a.height=Z(50,100),a.x=Z(0,kr),a.y=Z(0,Dr),a.color=Fr()}},i=setInterval(()=>{r()},2e3);return j(()=>{clearInterval(i)}),P(Q,{ref(n){var o=e;typeof o=="function"?o(n):e=n},get color(){return Ie("#f0f0f0")},get children(){return P(Dt,{get each(){return s()},children:n=>P(Q,{get x(){return n().x},get y(){return n().y},get width(){return n().width},get height(){return n().height},get color(){return n().color},get effects(){return{radius:{radius:n().borderRadius}}}})})}})};function at(s,t){return Math.floor(Math.random()*(t-s+1))+s}const Wn=()=>(4278190080|Math.floor(Math.random()*16777215))>>>0,Hn=s=>P(Q,s),Yn=600,qn=800,Kn=()=>{const[s,t]=X([]);let e;const r=()=>{const n=[];for(let o=0;o<1e3;o++)n.push({width:at(50,100),height:at(50,100),x:at(0,qn),y:at(0,Yn),color:Wn()});t(n)},i=setInterval(()=>{r()},2e3);return j(()=>{clearInterval(i)}),P(Q,{ref(n){var o=e;typeof o=="function"?o(n):e=n},get style(){return{color:Ie("#f0f0f0")}},get children(){return P(Dt,{get each(){return s()},children:n=>P(Hn,{get x(){return n().x},get y(){return n().y},get width(){return n().width},get height(){return n().height},get color(){return n().color},get effects(){return{radius:{radius:n().borderRadius}}}})})}})};function lt(s,t){return Math.floor(Math.random()*(t-s+1))+s}const Qn=()=>"0x"+Math.floor(Math.random()*16777215).toString(16)+"FF",jn=s=>P(Q,{get x(){return s.item.x},get y(){return s.item.y},get width(){return s.item.width},get height(){return s.item.height},get color(){return s.item.color},get effects(){return{radius:{radius:s.item.borderRadius}}}}),Zn=600,Jn=800,eo=()=>{const[s,t]=X([]);let e;const r=()=>{const n=[];for(let o=0;o<1e3;o++)n.push({width:lt(50,100),height:lt(50,100),x:lt(0,Jn),y:lt(0,Zn),color:Qn()});t(n)},i=setInterval(()=>{r()},2e3);return j(()=>{clearInterval(i)}),P(Q,{ref(n){var o=e;typeof o=="function"?o(n):e=n},get style(){return{color:Ie("#f0f0f0")}},get children(){return P(Dt,{get each(){return s()},children:n=>P(jn,{get item(){return n()}})})}})};function ht(s,t){return Math.floor(Math.random()*(t-s+1))+s}const to=600,ro=800,so=()=>(4278190080|Math.floor(Math.random()*16777215))>>>0,io=()=>{const[s,t]=X([]);let e;const r=()=>{const n=[];for(let o=0;o<1e3;o++)n.push({width:ht(50,100),height:ht(50,100),x:ht(0,ro),y:ht(0,to),color:so()});t(n)},i=setInterval(()=>{r()},2e3);return j(()=>{clearInterval(i)}),P(Q,{ref(n){var o=e;typeof o=="function"?o(n):e=n},get style(){return{color:Ie("#f0f0f0")}},get children(){return s().map(n=>(()=>{var o=gr("node");return hs(a=>{var h=n.x,u=n.y,d=n.width,c=n.height,p=n.color,f={radius:{radius:n.borderRadius}};return h!==a.e&&(a.e=Y(o,"x",h,a.e)),u!==a.t&&(a.t=Y(o,"y",u,a.t)),d!==a.a&&(a.a=Y(o,"width",d,a.a)),c!==a.o&&(a.o=Y(o,"height",c,a.o)),p!==a.i&&(a.i=Y(o,"color",p,a.i)),f!==a.n&&(a.n=Y(o,"effects",f,a.n)),a},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),o})())}})};function ut(s,t){return Math.floor(Math.random()*(t-s+1))+s}const no=()=>(4278190080|Math.floor(Math.random()*16777215))>>>0,oo=600,ao=800,lo=()=>{const[s,t]=X([]);let e;const r=()=>{const n=[];for(let o=0;o<1e3;o++)n.push({width:ut(50,100),height:ut(50,100),x:ut(0,ao),y:ut(0,oo),color:no()});t(n)},i=setInterval(()=>{r()},2e3);return j(()=>{clearInterval(i)}),P(Q,{ref(n){var o=e;typeof o=="function"?o(n):e=n},get style(){return{color:Ie("#f0f0f0")}},get children(){return P(Dt,{get each(){return s()},children:n=>(()=>{var o=gr("node");return hs(a=>{var h=n().x,u=n().y,d=n().width,c=n().height,p=n().color,f={radius:{radius:n().borderRadius}};return h!==a.e&&(a.e=Y(o,"x",h,a.e)),u!==a.t&&(a.t=Y(o,"y",u,a.t)),d!==a.a&&(a.a=Y(o,"width",d,a.a)),c!==a.o&&(a.o=Y(o,"height",c,a.o)),p!==a.i&&(a.i=Y(o,"color",p,a.i)),f!==a.n&&(a.n=Y(o,"effects",f,a.n)),a},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),o})()})}})};function re(s,t){return Math.floor(Math.random()*(t-s+1))+s}const Nr=()=>(4278190080|Math.floor(Math.random()*16777215))>>>0,$r=600,Xr=800,ho=()=>{const[s,t]=X([]);let e;const r=()=>{const n=[];if(s().length===0){for(let o=0;o<1e3;o++)n.push({width:re(50,100),height:re(50,100),x:re(0,Xr),y:re(0,$r),color:Nr()});t(n)}else{const o=s();for(let a=0,h=o.length;a<1e3;a++){let u=o[a];u.width=re(50,100),u.height=re(50,100),u.x=re(0,Xr),u.y=re(0,$r),u.color=Nr()}t([...o])}},i=setInterval(()=>{r()},2e3);return j(()=>{clearInterval(i)}),P(Q,{ref(n){var o=e;typeof o=="function"?o(n):e=n},get style(){return{color:Ie("#f0f0f0")}},get children(){return P(hn,{get each(){return s()},children:n=>P(Q,{get x(){return n.x},get y(){return n.y},get width(){return n.width},get height(){return n.height},get color(){return n.color},get effects(){return{radius:{radius:n.borderRadius}}}})})}})},uo=s=>(xn(),P(Q,{ref(t){var e=window.APP;typeof e=="function"?e(t):window.APP=t},onLast:()=>history.back(),onText:()=>navigate("/text"),onCounter:()=>navigate("/counter"),onButtons:()=>navigate("/buttons"),onMenu:()=>navigate("/"),get children(){return s.children}}));D.debug=!1;D.fontSettings.fontFamily="Ubuntu";D.fontSettings.color=4294967295;D.rendererOptions={numImageWorkers:2,enableInspector:!1,renderEngine:Ci,fontEngines:[]};const{render:co}=fn();co(()=>P(zn,{root:s=>P(uo,s),get children(){return[P(xe,{path:"",component:Gn}),P(xe,{path:"tile",component:Kn}),P(xe,{path:"tileone",component:eo}),P(xe,{path:"for",component:ho}),P(xe,{path:"map",component:io}),P(xe,{path:"index",component:lo})]}}));
//# sourceMappingURL=index-FMqmsARr.js.map
