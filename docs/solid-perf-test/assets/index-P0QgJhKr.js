var ar=Object.defineProperty;var lr=(r,t,e)=>t in r?ar(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var a=(r,t,e)=>lr(r,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function e(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=e(i);fetch(i.href,n)}})();var hr={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1};function cr(r,t){const e={alpha:!0,antialias:!1,depth:!1,stencil:!0,desynchronized:!1,powerPreference:"high-performance",premultipliedAlpha:!0,preserveDrawingBuffer:!1},s=r.getContext("webgl",e)||r.getContext("experimental-webgl",e);if(!s)throw new Error("Unable to create WebGL context");return t?new Proxy(s,{get(i,n){const o=i[n];return typeof o=="function"?(t.increment(String(n)),o.bind(i)):o}}):s}function M(r,t){if(!jt()&&!r)throw new Error(t||"Assertion failed")}function is(r,t,e){const s=Math.trunc(r>>>24),i=Math.trunc(r>>>16&255),n=Math.trunc(r>>>8&255),o=Math.trunc(r&255),l=Math.trunc(t>>>24),h=Math.trunc(t>>>16&255),c=Math.trunc(t>>>8&255),u=Math.trunc(t&255),d=Math.round(l*e+s*(1-e)),p=Math.round(h*e+i*(1-e)),_=Math.round(c*e+n*(1-e)),g=Math.round(u*e+o*(1-e));return(d<<24|p<<16|_<<8|g)>>>0}function ur(r,t){const e=r>>>24,s=r>>>16&255,i=r>>>8&255,n=Math.trunc((r&255)*t);return(e<<24|s<<16|i<<8|n)>>>0}let As=!0;function dr(r){As=r==="webgl"}function Qe(r,t,e=!1){const s=(r&255)/255*t,i=As?s:1,n=Math.trunc((r>>>24)*i),o=Math.trunc((r>>>16&255)*i),l=Math.trunc((r>>>8&255)*i),h=Math.trunc(s*255);return e?(h<<24|l<<16|o<<8|n)>>>0:(n<<24|o<<16|l<<8|h)>>>0}function kt(r,t){return Object.prototype.hasOwnProperty.call(r,t)}function jt(){return hr&&!0}let fr=1;function pr(){return fr++}class he{constructor(){a(this,"eventListeners",{})}on(t,e){let s=this.eventListeners[t];s||(s=[]),s.push(e),this.eventListeners[t]=s}off(t,e){const s=this.eventListeners[t];if(!s)return;if(!e){delete this.eventListeners[t];return}const i=s.indexOf(e);i>=0&&s.splice(i,1)}once(t,e){const s=(i,n)=>{this.off(t,s),e(i,n)};this.on(t,s)}emit(t,e){const s=this.eventListeners[t];s&&[...s].forEach(i=>{i(this,e)})}removeAllListeners(){this.eventListeners={}}}const gr=/^(data|ftps?|https?):/,He=r=>{const t=r>>>24,e=r>>>16&255,s=r>>>8&255,i=r&255;return[t/255,e/255,s/255,i/255]},mr=r=>{const t=r>>>24,e=r>>>16&255,s=r>>>8&255,i=r&255;return[t,e,s,i]};function xr(r){return(r&255)/255}function Mt(r){const t=Math.floor(r[0]*255),e=Math.floor(r[1]*255),s=Math.floor(r[2]*255),i=Math.floor(r[3]*255);return`rgba(${t},${e},${s},${i.toFixed(4)})`}function Ze(r,t,e,s,i){return i?(i.x1=r,i.y1=t,i.x2=e,i.y2=s,i):{x1:r,y1:t,x2:e,y2:s}}function It(r,t){return r.x1<t.x2&&r.x2>t.x1&&r.y1<t.y2&&r.y2>t.y1}function yr(r,t){return t?(t.x=r.x1,t.y=r.y1,t.width=r.x2-r.x1,t.height=r.y2-r.y1,t):{x:r.x1,y:r.y1,width:r.x2-r.x1,height:r.y2-r.y1}}function Ms(r,t,e){const s=Math.max(r.x,t.x),i=Math.max(r.y,t.y),n=Math.min(r.x+r.width,t.x+t.width)-s,o=Math.min(r.y+r.height,t.y+t.height)-i;return n>0&&o>0?e?(e.x=s,e.y=i,e.width=n,e.height=o,e):{x:s,y:i,width:n,height:o}:e?(e.x=0,e.y=0,e.width=0,e.height=0,e):{x:0,y:0,width:0,height:0}}function Is(r,t){return t?(t.x=r.x,t.y=r.y,t.width=r.width,t.height=r.height,t):{x:r.x,y:r.y,width:r.width,height:r.height}}function Tr(r,t){return r===t?!0:r===null||t===null?!1:r.x===t.x&&r.y===t.y&&r.width===t.width&&r.height===t.height}function ns(r,t){return r.x1<=t.x2&&r.y1<=t.y2&&r.x2>=t.x1&&r.y2>=t.y1}function _r(r){return r.x1<r.x2&&r.y1<r.y2}function vr(r){if(self.location.protocol==="file:"&&!gr.test(r)){const e=self.location.pathname.split("/");e.pop();const s=e.join("/"),i=self.location.protocol+"//"+s;return r.charAt(0)==="."&&(r=r.slice(1)),r.charAt(0)==="/"&&(r=r.slice(1)),i+"/"+r}return new URL(r,self.location.href).href}class K{constructor(){a(this,"ta");a(this,"tb");a(this,"tx");a(this,"tc");a(this,"td");a(this,"ty");a(this,"_floatArr",null);a(this,"mutation");this.ta=0,this.tb=0,this.tx=0,this.tc=0,this.td=0,this.ty=0,this.mutation=!0}static get temp(){return Rr}static multiply(t,e,s){const i=t.ta*e.ta+t.tb*e.tc,n=t.ta*e.tb+t.tb*e.td,o=t.ta*e.tx+t.tb*e.ty+t.tx,l=t.tc*e.ta+t.td*e.tc,h=t.tc*e.tb+t.td*e.td,c=t.tc*e.tx+t.td*e.ty+t.ty;return s||(s=new K),s.ta=i,s.tb=n,s.tx=o,s.tc=l,s.td=h,s.ty=c,s.mutation=!0,s}static identity(t){return t||(t=new K),t.ta=1,t.tb=0,t.tx=0,t.tc=0,t.td=1,t.ty=0,t.mutation=!0,t}static translate(t,e,s){return s||(s=new K),s.ta=1,s.tb=0,s.tx=t,s.tc=0,s.td=1,s.ty=e,s.mutation=!0,s}static scale(t,e,s){return s||(s=new K),s.ta=t,s.tb=0,s.tx=0,s.tc=0,s.td=e,s.ty=0,s.mutation=!0,s}static rotate(t,e){const s=Math.cos(t),i=Math.sin(t);return e||(e=new K),e.ta=s,e.tb=-i,e.tx=0,e.tc=i,e.td=s,e.ty=0,e.mutation=!0,e}static copy(t,e){return e||(e=new K),e.ta=t.ta,e.tc=t.tc,e.tb=t.tb,e.td=t.td,e.tx=t.tx,e.ty=t.ty,e.mutation=!0,e}translate(t,e){return this.tx=this.ta*t+this.tb*e+this.tx,this.ty=this.tc*t+this.td*e+this.ty,this.mutation=!0,this}scale(t,e){return this.ta=this.ta*t,this.tb=this.tb*e,this.tc=this.tc*t,this.td=this.td*e,this.mutation=!0,this}rotate(t){if(t===0||!(t%Math.PI*2))return this;const e=Math.cos(t),s=Math.sin(t),i=this.ta*e+this.tb*s,n=this.tb*e-this.ta*s,o=this.tc*e+this.td*s,l=this.td*e-this.tc*s;return this.ta=i,this.tb=n,this.tc=o,this.td=l,this.mutation=!0,this}multiply(t){return K.multiply(this,t,this)}getFloatArr(){return this._floatArr||(this._floatArr=new Float32Array(9)),this.mutation&&(this._floatArr[0]=this.ta,this._floatArr[1]=this.tc,this._floatArr[2]=0,this._floatArr[3]=this.tb,this._floatArr[4]=this.td,this._floatArr[5]=0,this._floatArr[6]=this.tx,this._floatArr[7]=this.ty,this._floatArr[8]=1,this.mutation=!1),this._floatArr}}const Rr=new K,Je=0,et=2,tt=4,st=6,rt=1,it=3,nt=5,ot=7;class mt{constructor(t){a(this,"data");this.data=new Float32Array(8),t&&(this.data[Je]=t[Je],this.data[et]=t[et],this.data[tt]=t[tt],this.data[st]=t[st],this.data[rt]=t[rt],this.data[it]=t[it],this.data[nt]=t[nt],this.data[ot]=t[ot])}static translate(t,e,s,i,n,o,l,h,c){return c||(c=new mt),c.data[Je]=t,c.data[et]=s,c.data[tt]=n,c.data[st]=l,c.data[rt]=e,c.data[it]=i,c.data[nt]=o,c.data[ot]=h,c}get x1(){return this.data[Je]}get x2(){return this.data[et]}get x3(){return this.data[tt]}get x4(){return this.data[st]}get y1(){return this.data[rt]}get y2(){return this.data[it]}get y3(){return this.data[nt]}get y4(){return this.data[ot]}}const os=r=>r&&!(r&r-1),Ls=(r,t,e,s)=>{const i=3*r,n=3*(e-r)-i,o=1-i-n,l=3*t,h=3*(s-t)-l,c=1-l-h;return function(u){if(u>=1)return 1;if(u<=0)return 0;let d=.5,p,_,g;for(let b=0;b<20;b++){if(p=d*(d*(d*o+n)+i),g=u-p,g>-1e-8&&g<1e-8)return d*(d*(d*c+h)+l);if(_=d*(d*(3*o)+2*n)+i,_>1e-10&&_<1e-10)break;d+=g/_}let T=0,R=1;for(let b=0;b<20;b++){if(d=.5*(T+R),p=d*(d*(d*o+n)+i),g=u-p,g>-1e-8&&g<1e-8)return d*(d*(d*c+h)+l);g<0?R=d:T=d}}},ut={},Sr={ease:[.25,.1,.25,1],"ease-in":[.42,0,1,1],"ease-out":[0,0,.58,1],"ease-in-out":[.42,0,.58,1],"ease-in-sine":[.12,0,.39,0],"ease-out-sine":[.12,0,.39,0],"ease-in-out-sine":[.37,0,.63,1],"ease-in-cubic":[.32,0,.67,0],"ease-out-cubic":[.33,1,.68,1],"ease-in-out-cubic":[.65,0,.35,1],"ease-in-circ":[.55,0,1,.45],"ease-out-circ":[0,.55,.45,1],"ease-in-out-circ":[.85,0,.15,1],"ease-in-back":[.36,0,.66,-.56],"ease-out-back":[.34,1.56,.64,1],"ease-in-out-back":[.68,-.6,.32,1.6]},dt=r=>r,wr=r=>{const t=/-?\d*\.?\d+/g,e=r.match(t);if(e){const[s,i,n,o]=e,l=parseFloat(s||"0.42"),h=parseFloat(i||"0"),c=parseFloat(n||"1"),u=parseFloat(o||"1"),d=Ls(l,h,c,u);return ut[r]=d,d}return console.warn("Unknown cubic-bezier timing: "+r),dt},br=r=>{if(r==="linear")return dt;if(ut[r]!==void 0)return ut[r]||dt;if(r==="step-start")return()=>1;if(r==="step-end")return e=>e===1?1:0;const t=Sr[r];if(t!==void 0){const[e,s,i,n]=t,o=Ls(e,s,i,n);return ut[r]=o,o}return r.startsWith("cubic-bezier")?wr(r):(console.warn("Unknown timing function: "+r),dt)};function as(r){return(r/1024/1024).toFixed(2)}class Er extends he{constructor(e,s,i){super();a(this,"node");a(this,"props");a(this,"settings");a(this,"progress",0);a(this,"delayFor",0);a(this,"timingFunction");a(this,"propValuesMap",{});a(this,"dynPropValuesMap");this.node=e,this.props=s;for(const l in s)if(l!=="shaderProps")this.propValuesMap.props===void 0&&(this.propValuesMap.props={}),this.propValuesMap.props[l]={start:e[l],target:s[l]};else if(e.shader.type!=="DynamicShader"){this.propValuesMap.shaderProps={};for(const h in s.shaderProps)this.propValuesMap.shaderProps[h]={start:e.shader.props[h],target:s.shaderProps[h]}}else{const h=Object.keys(s.shaderProps),c=h.length;this.dynPropValuesMap={};for(let u=0;u<c;u++){const d=h[u],p=s.shaderProps[d];this.dynPropValuesMap[d]={};const _=Object.entries(p),g=_.length;for(let T=0;T<g;T++){const[R,b]=_[T];this.dynPropValuesMap[d][R]={start:e.shader.props[d][R],target:b}}}}const n=i.easing||"linear",o=i.delay??0;this.settings={duration:i.duration??0,delay:o,easing:n,loop:i.loop??!1,repeat:i.repeat??0,repeatDelay:i.repeatDelay??0,stopMethod:i.stopMethod??!1},this.timingFunction=br(n),this.delayFor=o}reset(){this.progress=0,this.delayFor=this.settings.delay||0,this.update(0)}restoreValues(e,s){const i=Object.entries(s),n=i.length;for(let o=0;o<n;o++){const[l,h]=i[o];e[l]=h.start}}restore(){if(this.reset(),this.propValuesMap.props!==void 0&&this.restoreValues(this.node,this.propValuesMap.props),this.propValuesMap.shaderProps!==void 0&&this.restoreValues(this.node.shader.props,this.propValuesMap.shaderProps),this.dynPropValuesMap!==void 0){const e=Object.keys(this.dynPropValuesMap),s=e.length;if(s>0)for(let i=0;i<s;i++){const n=e[i];this.restoreValues(this.node.shader.props[n],this.dynPropValuesMap[n])}}}reverseValues(e){const s=Object.entries(e),i=s.length;for(let n=0;n<i;n++){const[o,l]=s[n];e[o]={start:l.target,target:l.start}}}reverse(){if(this.progress=0,this.propValuesMap.props!==void 0&&this.reverseValues(this.propValuesMap.props),this.propValuesMap.shaderProps!==void 0&&this.reverseValues(this.propValuesMap.shaderProps),this.dynPropValuesMap!==void 0){const e=Object.keys(this.dynPropValuesMap),s=e.length;if(s>0)for(let i=0;i<s;i++){const n=e[i];this.reverseValues(this.dynPropValuesMap[n])}}this.settings.loop||(this.settings.stopMethod=!1)}applyEasing(e,s,i){return(this.timingFunction(e)||e)*(i-s)+s}updateValue(e,s,i,n){if(this.progress===1)return s;if(this.progress===0)return i;const o=s;if(e.indexOf("color")!==-1){if(i===o)return i;if(n){const l=this.timingFunction(this.progress)||this.progress;return is(i,o,l)}return is(i,o,this.progress)}return n?this.applyEasing(this.progress,i,o):i+(o-i)*this.progress}updateValues(e,s,i){const n=Object.entries(s),o=n.length;for(let l=0;l<o;l++){const[h,c]=n[l];e[h]=this.updateValue(h,c.target,c.start,i)}}update(e){const{duration:s,loop:i,easing:n,stopMethod:o}=this.settings,{delayFor:l}=this;if(s===0&&l===0){this.emit("finished",{});return}if(this.delayFor>0){if(this.delayFor-=e,this.delayFor>=0)return;e=-this.delayFor,this.delayFor=0}if(s===0){this.emit("finished",{});return}if(this.progress===0&&this.emit("animating",{}),this.progress+=e/s,this.progress>1&&(this.progress=i?0:1,o)){this.emit("finished",{});return}if(this.propValuesMap.props!==void 0&&this.updateValues(this.node,this.propValuesMap.props,n),this.propValuesMap.shaderProps!==void 0&&this.updateValues(this.node.shader.props,this.propValuesMap.shaderProps,n),this.dynPropValuesMap!==void 0){const h=Object.keys(this.dynPropValuesMap),c=h.length;if(c>0)for(let u=0;u<c;u++){const d=h[u];this.updateValues(this.node.shader.props[d],this.dynPropValuesMap[d],n)}}this.progress===1&&this.emit("finished",{})}}class Cr extends he{constructor(e,s){super();a(this,"manager");a(this,"animation");a(this,"stoppedPromise");a(this,"stoppedResolve",null);a(this,"state");this.manager=e,this.animation=s,this.state="stopped",this.stoppedPromise=Promise.resolve(),this.onAnimating=this.onAnimating.bind(this),this.onFinished=this.onFinished.bind(this)}start(){return this.state!=="running"&&(this.makeStoppedPromise(),this.registerAnimation(),this.state="running"),this}stop(){return this.unregisterAnimation(),this.stoppedResolve!==null&&(this.stoppedResolve(),this.stoppedResolve=null,this.emit("stopped",this)),this.animation.reset(),this.state="stopped",this}pause(){return this.unregisterAnimation(),this.state="paused",this}restore(){return this.stoppedResolve=null,this.animation.restore(),this}waitUntilStopped(){return this.stoppedPromise}registerAnimation(){this.animation.once("finished",this.onFinished),this.animation.on("animating",this.onAnimating),this.manager.registerAnimation(this.animation)}unregisterAnimation(){this.manager.unregisterAnimation(this.animation),this.animation.off("finished",this.onFinished),this.animation.off("animating",this.onAnimating)}makeStoppedPromise(){this.stoppedResolve===null&&(this.stoppedPromise=new Promise(e=>{this.stoppedResolve=e}))}onFinished(){M(this.stoppedResolve);const{loop:e,stopMethod:s}=this.animation.settings;if(s==="reverse"){this.animation.once("finished",this.onFinished),this.animation.reverse();return}e||(this.unregisterAnimation(),this.stoppedResolve(),this.stoppedResolve=null,this.emit("stopped",this),this.state="stopped")}onAnimating(){this.emit("animating",this)}}var ie;(function(r){r[r.Init=0]="Init",r[r.OutOfBounds=2]="OutOfBounds",r[r.InBounds=4]="InBounds",r[r.InViewport=8]="InViewport"})(ie||(ie={}));const Ve=new Map;Ve.set(ie.Init,"init");Ve.set(ie.OutOfBounds,"outOfBounds");Ve.set(ie.InBounds,"inBounds");Ve.set(ie.InViewport,"inViewport");var C;(function(r){r[r.Children=1]="Children",r[r.ScaleRotate=2]="ScaleRotate",r[r.Local=4]="Local",r[r.Global=8]="Global",r[r.Clipping=16]="Clipping",r[r.CalculatedZIndex=32]="CalculatedZIndex",r[r.ZIndexSortedChildren=64]="ZIndexSortedChildren",r[r.PremultipliedColors=128]="PremultipliedColors",r[r.WorldAlpha=256]="WorldAlpha",r[r.RenderState=512]="RenderState",r[r.IsRenderable=1024]="IsRenderable",r[r.RenderTexture=2048]="RenderTexture",r[r.ParentRenderTexture=4096]="ParentRenderTexture",r[r.None=0]="None",r[r.All=8191]="All"})(C||(C={}));class $t extends he{constructor(e,s){super();a(this,"stage");a(this,"children",[]);a(this,"_id",pr());a(this,"props");a(this,"updateType",C.All);a(this,"globalTransform");a(this,"scaleRotateTransform");a(this,"localTransform");a(this,"renderCoords");a(this,"renderBound");a(this,"strictBound");a(this,"preloadBound");a(this,"clippingRect",{x:0,y:0,width:0,height:0,valid:!1});a(this,"isRenderable",!1);a(this,"renderState",ie.Init);a(this,"worldAlpha",1);a(this,"premultipliedColorTl",0);a(this,"premultipliedColorTr",0);a(this,"premultipliedColorBl",0);a(this,"premultipliedColorBr",0);a(this,"calcZIndex",0);a(this,"hasRTTupdates",!1);a(this,"parentHasRenderTexture",!1);a(this,"onTextureLoaded",(e,s)=>{var i,n;this.autosizeNode(s),this.stage.requestRender(),this.parentHasRenderTexture&&this.setRTTUpdates(1),this.emit("loaded",{type:"texture",dimensions:s}),((n=(i=this.props.textureOptions)==null?void 0:i.resizeMode)==null?void 0:n.type)==="contain"&&this.setUpdateType(C.Local)});a(this,"onTextureFailed",(e,s)=>{this.emit("failed",{type:"texture",error:s})});a(this,"onTextureFreed",()=>{this.emit("freed",{type:"texture"})});this.stage=e,this.props={...s,parent:null,texture:null,src:null,rtt:!1},this.parent=s.parent,this.texture=s.texture,this.src=s.src,this.rtt=s.rtt,this.updateScaleRotateTransform()}loadTexture(){const{texture:e}=this.props;M(e),queueMicrotask(()=>{this.textureOptions.preload&&e.ctxTexture.load(),e.state==="loaded"?(M(e.dimensions),this.onTextureLoaded(e,e.dimensions)):e.state==="failed"?(M(e.error),this.onTextureFailed(e,e.error)):e.state==="freed"&&this.onTextureFreed(e),e.on("loaded",this.onTextureLoaded),e.on("failed",this.onTextureFailed),e.on("freed",this.onTextureFreed)})}unloadTexture(){this.texture&&(this.texture.off("loaded",this.onTextureLoaded),this.texture.off("failed",this.onTextureFailed),this.texture.off("freed",this.onTextureFreed),this.texture.setRenderableOwner(this,!1))}autosizeNode(e){this.autosize&&(this.width=e.width,this.height=e.height)}setUpdateType(e){this.updateType|=e;const s=this.props.parent;s&&!(s.updateType&C.Children)&&s.setUpdateType(C.Children),this.parentHasRenderTexture&&this.setRTTUpdates(e)}sortChildren(){this.children.sort((e,s)=>e.calcZIndex-s.calcZIndex)}updateScaleRotateTransform(){const{rotation:e,scaleX:s,scaleY:i}=this.props;if(e===0&&s===1&&i===1){this.scaleRotateTransform=void 0;return}this.scaleRotateTransform=K.rotate(e,this.scaleRotateTransform).scale(s,i)}updateLocalTransform(){var c,u;const{x:e,y:s,width:i,height:n}=this.props,o=this.props.mountX*i,l=this.props.mountY*n;if(this.scaleRotateTransform){const d=this.props.pivotX*i,p=this.props.pivotY*n;this.localTransform=K.translate(e-o+d,s-l+p,this.localTransform).multiply(this.scaleRotateTransform).translate(-d,-p)}else this.localTransform=K.translate(e-o,s-l,this.localTransform);const h=this.props.texture;if(h&&h.dimensions&&((u=(c=this.props.textureOptions)==null?void 0:c.resizeMode)==null?void 0:u.type)==="contain"){let d=1,p=1,_=0,g=0;const{width:T,height:R}=h.dimensions,b=T/R,m=i/n;if(b>m){const x=i/T,f=R*x;g=(n-f)/2,p=f/n}else{const x=n/R,f=T*x;_=(i-f)/2,d=f/i}this.localTransform.translate(_,g).scale(d,p)}this.setUpdateType(C.Global)}update(e,s){var o;this.updateType&C.ScaleRotate&&(this.updateScaleRotateTransform(),this.setUpdateType(C.Local)),this.updateType&C.Local&&(this.updateLocalTransform(),this.setUpdateType(C.Global));const i=this.props.parent;let n=C.None;if(this.updateType&C.ParentRenderTexture){let l=this.parent;for(;l;)l.rtt&&(this.parentHasRenderTexture=!0),l=l.parent}this.updateType^C.All&&this.updateType&C.RenderTexture&&this.children.forEach(l=>{l.setUpdateType(C.All)}),this.updateType&C.Global&&(M(this.localTransform),this.globalTransform=K.copy((i==null?void 0:i.globalTransform)||this.localTransform,this.globalTransform),this.parentHasRenderTexture&&((o=this.props.parent)!=null&&o.rtt)&&(this.globalTransform=K.identity()),i&&this.globalTransform.multiply(this.localTransform),this.calculateRenderCoords(),this.updateBoundingRect(),this.setUpdateType(C.Clipping|C.RenderState|C.Children),n|=C.Global),this.updateType&C.Clipping&&(this.calculateClippingRect(s),this.setUpdateType(C.Children),n|=C.Clipping),this.updateType&C.WorldAlpha&&(i?this.worldAlpha=i.worldAlpha*this.props.alpha:this.worldAlpha=this.props.alpha,this.setUpdateType(C.Children|C.PremultipliedColors|C.IsRenderable),n|=C.WorldAlpha),this.updateType&C.PremultipliedColors&&(this.premultipliedColorTl=Qe(this.props.colorTl,this.worldAlpha,!0),this.props.colorTl===this.props.colorTr&&this.props.colorBl===this.props.colorBr&&this.props.colorTl===this.props.colorBl?this.premultipliedColorTr=this.premultipliedColorBl=this.premultipliedColorBr=this.premultipliedColorTl:(this.premultipliedColorTr=Qe(this.props.colorTr,this.worldAlpha,!0),this.premultipliedColorBl=Qe(this.props.colorBl,this.worldAlpha,!0),this.premultipliedColorBr=Qe(this.props.colorBr,this.worldAlpha,!0))),this.updateType&C.RenderState&&(this.updateRenderState(s),this.setUpdateType(C.IsRenderable)),this.updateType&C.IsRenderable&&this.updateIsRenderable(),i&&this.updateType&C.CalculatedZIndex&&(this.calculateZIndex(),i.setUpdateType(C.ZIndexSortedChildren)),this.updateType&C.Children&&this.children.length&&!this.rtt&&this.children.forEach(l=>{l.setUpdateType(n),l.updateType!==0&&l.update(e,this.clippingRect)}),this.updateType&C.ZIndexSortedChildren&&this.sortChildren(),this.updateType=0}checkRenderProps(){return this.props.texture?!0:!this.props.width||!this.props.height?!1:!!(this.props.shader!==this.stage.defShaderCtr||this.props.clipping||this.props.color!==0||this.props.colorTop!==0||this.props.colorBottom!==0||this.props.colorLeft!==0||this.props.colorRight!==0||this.props.colorTl!==0||this.props.colorTr!==0||this.props.colorBl!==0||this.props.colorBr!==0)}checkRenderBounds(e){M(this.renderBound);const s=e.width||this.stage.root.width,i=e.height||this.stage.root.height;if(this.strictBound=Ze(e.x,e.y,e.x+s,e.y+i,this.strictBound),ns(this.renderBound,this.strictBound))return ie.InViewport;const n=this.stage.boundsMargin;return this.preloadBound=Ze(this.strictBound.x1-n[3],this.strictBound.y1-n[0],this.strictBound.x2+n[1],this.strictBound.y2+n[2],this.preloadBound),ns(this.renderBound,this.preloadBound)?ie.InBounds:ie.OutOfBounds}updateRenderState(e){const s=this.checkRenderBounds(e);if(s===this.renderState)return;const i=this.renderState;this.renderState=s;const n=Ve.get(s);M(n),this.emit(n,{previous:i,current:s})}updateIsRenderable(){let e;this.worldAlpha===0||!this.checkRenderProps()?e=!1:e=this.renderState>ie.OutOfBounds,this.isRenderable!==e&&(this.isRenderable=e,this.onChangeIsRenderable(e))}onChangeIsRenderable(e){var s;(s=this.texture)==null||s.setRenderableOwner(this,e)}calculateRenderCoords(){const{width:e,height:s,globalTransform:i}=this;M(i);const{tx:n,ty:o,ta:l,tb:h,tc:c,td:u}=i;if(h===0&&c===0){const d=n,p=n+e*l,_=o,g=o+s*u;this.renderCoords=mt.translate(d,_,p,_,p,g,d,g,this.renderCoords)}else this.renderCoords=mt.translate(n,o,n+e*l,o+e*c,n+e*l+s*h,o+e*c+s*u,n+s*h,o+s*u,this.renderCoords)}updateBoundingRect(){const{renderCoords:e,globalTransform:s}=this;M(s),M(e);const{tb:i,tc:n}=s,{x1:o,y1:l,x3:h,y3:c}=e;if(i===0||n===0)this.renderBound=Ze(o,l,h,c,this.renderBound);else{const{x2:u,x4:d,y2:p,y4:_}=e;this.renderBound=Ze(Math.min(o,u,h,d),Math.min(l,p,c,_),Math.max(o,u,h,d),Math.max(l,p,c,_),this.renderBound)}}calculateClippingRect(e){M(this.globalTransform);const{clippingRect:s,props:i,globalTransform:n}=this,{clipping:o}=i,l=n.tb!==0||n.tc!==0;o&&!l?(s.x=n.tx,s.y=n.ty,s.width=this.width*n.ta,s.height=this.height*n.td,s.valid=!0):s.valid=!1,e.valid&&s.valid?Ms(e,s,s):e.valid&&(Is(e,s),s.valid=!0)}calculateZIndex(){var o,l;const e=this.props,s=e.zIndex||0,i=((o=e.parent)==null?void 0:o.zIndex)||0;let n=s;(l=e.parent)!=null&&l.zIndexLocked&&(n=s<i?s:i),this.calcZIndex=n}destroy(){this.unloadTexture(),this.clippingRect.valid=!1,this.isRenderable=!1,delete this.renderCoords,delete this.renderBound,delete this.strictBound,delete this.preloadBound,delete this.globalTransform,delete this.scaleRotateTransform,delete this.localTransform,this.props.texture=null,this.props.shader=this.stage.defShaderCtr;const e=[...this.children];for(let s=0;s<e.length;s++)e[s].destroy();this.parent=null,this.rtt&&this.stage.renderer.removeRTTNode(this),this.removeAllListeners()}renderQuads(e){const{texture:s,width:i,height:n,textureOptions:o,rtt:l,shader:h}=this.props;if(this.parentHasRenderTexture&&(!e.renderToTextureActive||this.parentRenderTexture!==e.activeRttNode))return;const{premultipliedColorTl:c,premultipliedColorTr:u,premultipliedColorBl:d,premultipliedColorBr:p}=this,{zIndex:_,worldAlpha:g,globalTransform:T,clippingRect:R,renderCoords:b}=this;M(T),M(b),e.addQuad({width:i,height:n,colorTl:c,colorTr:u,colorBl:d,colorBr:p,texture:s,textureOptions:o,zIndex:_,shader:h.shader,shaderProps:h.getResolvedProps(),alpha:g,clippingRect:R,tx:T.tx,ty:T.ty,ta:T.ta,tb:T.tb,tc:T.tc,td:T.td,renderCoords:b,rtt:l,parentHasRenderTexture:this.parentHasRenderTexture,framebufferDimensions:this.framebufferDimensions})}get id(){return this._id}get x(){return this.props.x}set x(e){this.props.x!==e&&(this.props.x=e,this.setUpdateType(C.Local))}get absX(){var e,s,i;return this.props.x+(((e=this.props.parent)==null?void 0:e.absX)||((i=(s=this.props.parent)==null?void 0:s.globalTransform)==null?void 0:i.tx)||0)}get absY(){var e;return this.props.y+(((e=this.props.parent)==null?void 0:e.absY)??0)}get y(){return this.props.y}set y(e){this.props.y!==e&&(this.props.y=e,this.setUpdateType(C.Local))}get width(){return this.props.width}set width(e){this.props.width!==e&&(this.props.width=e,this.setUpdateType(C.Local),this.props.rtt&&(this.texture=this.stage.txManager.loadTexture("RenderTexture",{width:this.width,height:this.height}),this.textureOptions.preload=!0,this.setUpdateType(C.RenderTexture)))}get height(){return this.props.height}set height(e){this.props.height!==e&&(this.props.height=e,this.setUpdateType(C.Local),this.props.rtt&&(this.texture=this.stage.txManager.loadTexture("RenderTexture",{width:this.width,height:this.height}),this.textureOptions.preload=!0,this.setUpdateType(C.RenderTexture)))}get scale(){return this.scaleX}set scale(e){this.scaleX=e,this.scaleY=e}get scaleX(){return this.props.scaleX}set scaleX(e){this.props.scaleX!==e&&(this.props.scaleX=e,this.setUpdateType(C.ScaleRotate))}get scaleY(){return this.props.scaleY}set scaleY(e){this.props.scaleY!==e&&(this.props.scaleY=e,this.setUpdateType(C.ScaleRotate))}get mount(){return this.props.mount}set mount(e){(this.props.mountX!==e||this.props.mountY!==e)&&(this.props.mountX=e,this.props.mountY=e,this.props.mount=e,this.setUpdateType(C.Local))}get mountX(){return this.props.mountX}set mountX(e){this.props.mountX!==e&&(this.props.mountX=e,this.setUpdateType(C.Local))}get mountY(){return this.props.mountY}set mountY(e){this.props.mountY!==e&&(this.props.mountY=e,this.setUpdateType(C.Local))}get pivot(){return this.props.pivot}set pivot(e){(this.props.pivotX!==e||this.props.pivotY!==e)&&(this.props.pivotX=e,this.props.pivotY=e,this.props.pivot=e,this.setUpdateType(C.Local))}get pivotX(){return this.props.pivotX}set pivotX(e){this.props.pivotX!==e&&(this.props.pivotX=e,this.setUpdateType(C.Local))}get pivotY(){return this.props.pivotY}set pivotY(e){this.props.pivotY!==e&&(this.props.pivotY=e,this.setUpdateType(C.Local))}get rotation(){return this.props.rotation}set rotation(e){this.props.rotation!==e&&(this.props.rotation=e,this.setUpdateType(C.ScaleRotate))}get alpha(){return this.props.alpha}set alpha(e){this.props.alpha=e,this.setUpdateType(C.PremultipliedColors|C.WorldAlpha)}get autosize(){return this.props.autosize}set autosize(e){this.props.autosize=e}get clipping(){return this.props.clipping}set clipping(e){this.props.clipping=e,this.setUpdateType(C.Clipping)}get color(){return this.props.color}set color(e){this.colorTop=e,this.colorBottom=e,this.colorLeft=e,this.colorRight=e,this.props.color=e,this.setUpdateType(C.PremultipliedColors)}get colorTop(){return this.props.colorTop}set colorTop(e){(this.props.colorTl!==e||this.props.colorTr!==e)&&(this.colorTl=e,this.colorTr=e),this.props.colorTop=e,this.setUpdateType(C.PremultipliedColors)}get colorBottom(){return this.props.colorBottom}set colorBottom(e){(this.props.colorBl!==e||this.props.colorBr!==e)&&(this.colorBl=e,this.colorBr=e),this.props.colorBottom=e,this.setUpdateType(C.PremultipliedColors)}get colorLeft(){return this.props.colorLeft}set colorLeft(e){(this.props.colorTl!==e||this.props.colorBl!==e)&&(this.colorTl=e,this.colorBl=e),this.props.colorLeft=e,this.setUpdateType(C.PremultipliedColors)}get colorRight(){return this.props.colorRight}set colorRight(e){(this.props.colorTr!==e||this.props.colorBr!==e)&&(this.colorTr=e,this.colorBr=e),this.props.colorRight=e,this.setUpdateType(C.PremultipliedColors)}get colorTl(){return this.props.colorTl}set colorTl(e){this.props.colorTl=e,this.setUpdateType(C.PremultipliedColors)}get colorTr(){return this.props.colorTr}set colorTr(e){this.props.colorTr=e,this.setUpdateType(C.PremultipliedColors)}get colorBl(){return this.props.colorBl}set colorBl(e){this.props.colorBl=e,this.setUpdateType(C.PremultipliedColors)}get colorBr(){return this.props.colorBr}set colorBr(e){this.props.colorBr=e,this.setUpdateType(C.PremultipliedColors)}get zIndexLocked(){return this.props.zIndexLocked||0}set zIndexLocked(e){this.props.zIndexLocked=e,this.setUpdateType(C.CalculatedZIndex|C.Children),this.children.forEach(s=>{s.setUpdateType(C.CalculatedZIndex)})}get zIndex(){return this.props.zIndex}set zIndex(e){this.props.zIndex=e,this.setUpdateType(C.CalculatedZIndex|C.Children),this.children.forEach(s=>{s.setUpdateType(C.CalculatedZIndex)})}get parent(){return this.props.parent}set parent(e){const s=this.props.parent;if(s!==e){if(this.props.parent=e,s){const i=s.children.indexOf(this);M(i!==-1,"CoreNode.parent: Node not found in old parent's children!"),s.children.splice(i,1),s.setUpdateType(C.Children|C.ZIndexSortedChildren)}e&&(e.children.push(this),this.setUpdateType(C.All),e.setUpdateType(C.Children|C.ZIndexSortedChildren),(e.rtt||e.parentHasRenderTexture)&&this.setRTTUpdates(C.All)),this.updateScaleRotateTransform()}}get rtt(){return this.props.rtt}set rtt(e){var s,i;if(this.props.rtt===!0&&(this.props.rtt=e,e===!1&&this.texture!==null)){this.unloadTexture(),this.setUpdateType(C.All),this.children.forEach(n=>{n.parentHasRenderTexture=!1}),(s=this.stage.renderer)==null||s.removeRTTNode(this);return}e!==!1&&(this.texture=this.stage.txManager.loadTexture("RenderTexture",{width:this.width,height:this.height}),this.textureOptions.preload=!0,this.props.rtt=!0,this.hasRTTupdates=!0,this.setUpdateType(C.All),this.children.forEach(n=>{n.setUpdateType(C.All)}),(i=this.stage.renderer)==null||i.renderToTexture(this))}get shader(){return this.props.shader}set shader(e){this.props.shader!==e&&(this.props.shader=e,this.setUpdateType(C.IsRenderable))}get src(){return this.props.src}set src(e){if(this.props.src!==e){if(this.props.src=e,!e){this.texture=null;return}this.texture=this.stage.txManager.loadTexture("ImageTexture",{src:e})}}get framebufferDimensions(){return this.parentHasRenderTexture&&!this.rtt&&this.parent?this.parent.framebufferDimensions:{width:this.width,height:this.height}}get parentRenderTexture(){let e=this.parent;for(;e;){if(e.rtt)return e;e=e.parent}return null}get texture(){return this.props.texture}set texture(e){if(this.props.texture===e)return;const s=this.props.texture;s&&(s.setRenderableOwner(this,!1),this.unloadTexture()),this.props.texture=e,e&&(e.setRenderableOwner(this,this.isRenderable),this.loadTexture()),this.setUpdateType(C.IsRenderable)}set textureOptions(e){this.props.textureOptions=e}get textureOptions(){return this.props.textureOptions}setRTTUpdates(e){var s;this.hasRTTupdates=!0,(s=this.parent)==null||s.setRTTUpdates(e)}animate(e,s){const i=new Er(this,e,s);return new Cr(this.stage.animationManager,i)}flush(){}}const at={alpha:r=>r===1?null:{prop:"opacity",value:`${r}`},x:r=>({prop:"left",value:`${r}px`}),y:r=>({prop:"top",value:`${r}px`}),width:r=>r===0?null:{prop:"width",value:`${r}px`},height:r=>r===0?null:{prop:"height",value:`${r}px`},zIndex:()=>"zIndex",fontFamily:()=>"font-family",fontSize:()=>"font-size",fontStyle:()=>"font-style",fontWeight:()=>"font-weight",fontStretch:()=>"font-stretch",lineHeight:()=>"line-height",letterSpacing:()=>"letter-spacing",textAlign:()=>"text-align",overflowSuffix:()=>"overflow-suffix",maxLines:()=>"max-lines",contain:()=>"contain",verticalAlign:()=>"vertical-align",clipping:r=>r===!1?null:{prop:"overflow",value:r?"hidden":"visible"},rotation:r=>r===0?null:{prop:"transform",value:`rotate(${r}rad)`},scale:r=>r===1?null:{prop:"transform",value:`scale(${r})`},scaleX:r=>r===1?null:{prop:"transform",value:`scaleX(${r})`},scaleY:r=>r===1?null:{prop:"transform",value:`scaleY(${r})`},color:r=>r===0?null:{prop:"color",value:Ps(r)}},Ps=r=>{const t=(r&255)/255,e=r>>8&255,s=r>>16&255;return`rgba(${r>>24&255},${s},${e},${t})`},ls={id:"id"};class Ar{constructor(t,e){a(this,"root",null);a(this,"canvas",null);a(this,"height",1080);a(this,"width",1920);a(this,"scaleX",1);a(this,"scaleY",1);if(jt())return;if(!e)throw new Error("settings is required");this.height=Math.ceil(e.appHeight??1080/(e.deviceLogicalPixelRatio??1)),this.width=Math.ceil(e.appWidth??1900/(e.deviceLogicalPixelRatio??1)),this.scaleX=e.deviceLogicalPixelRatio??1,this.scaleY=e.deviceLogicalPixelRatio??1,this.canvas=t,this.root=document.createElement("div"),this.setRootPosition(),document.body.appendChild(this.root),new MutationObserver(this.setRootPosition.bind(this)).observe(t,{attributes:!0,childList:!1,subtree:!1}),new ResizeObserver(this.setRootPosition.bind(this)).observe(t),window.addEventListener("resize",this.setRootPosition.bind(this)),console.warn("Inspector is enabled, this will impact performance")}setRootPosition(){if(this.root===null||this.canvas===null)return;const t=this.canvas.getBoundingClientRect(),e=document.documentElement.scrollTop+t.top,s=document.documentElement.scrollLeft+t.left;this.root.id="root",this.root.style.left=`${s}px`,this.root.style.top=`${e}px`,this.root.style.width=`${this.width}px`,this.root.style.height=`${this.height}px`,this.root.style.position="absolute",this.root.style.transformOrigin="0 0 0",this.root.style.transform=`scale(${this.scaleX}, ${this.scaleY})`,this.root.style.overflow="hidden",this.root.style.zIndex="65534"}createDiv(t,e){const s=document.createElement("div");s.style.position="absolute",s.id=t.toString();for(const i in e)this.updateNodeProperty(s,i,e[i]);return s}createNode(t){const e=this.createDiv(t.id,t.props);return e.node=t,t.div=e,this.createProxy(t,e)}createTextNode(t){const e=this.createDiv(t.id,t.props);return e.node=t,t.div=e,this.createProxy(t,e)}createProxy(t,e){return new Proxy(t,{set:(s,i,n)=>(this.updateNodeProperty(e,i,n),Reflect.set(s,i,n)),get:(s,i,n)=>(i==="destroy"&&this.destroyNode(s.id),i==="animate"?(o,l)=>{const h=s.animate(o,l);return new Proxy(h,{get:(c,u,d)=>(u==="start"&&this.animateNode(e,o,l),Reflect.get(c,u,d))})}:Reflect.get(s,i,n))})}destroyNode(t){const e=document.getElementById(t.toString());e==null||e.remove()}updateNodeProperty(t,e,s){var i;if(!(this.root===null||s===void 0||s===null)){if(e==="parent"){const n=s.id;if(n===1){this.root.appendChild(t);return}const o=document.getElementById(n.toString());o==null||o.appendChild(t);return}if(e==="text"){t.innerHTML=String(s),t.style.visibility="hidden";return}if(e==="src"&&s){t.setAttribute("data-src",String(s));return}if(at[e]){const n=(i=at[e])==null?void 0:i.call(at,s);if(n===null)return;if(typeof n=="string"){t.style.setProperty(n,String(s));return}typeof n=="object"&&t.style.setProperty(n.prop,n.value);return}if(ls[e]){const n=ls[e];if(!n)return;t.setAttribute(String(n),String(s));return}if(e==="data"){for(const n in s){const o=s[n];o===void 0?t.removeAttribute(`data-${n}`):t.setAttribute(`data-${n}`,String(o))}return}}}animateNode(t,e,s){const{duration:i=1e3,delay:n=0}=s,{x:o,y:l,width:h,height:c,alpha:u=1,rotation:d=0,scale:p=1,color:_}=e;function g(){setTimeout(()=>{t.style.top=`${l}px`,t.style.left=`${o}px`,t.style.width=`${h}px`,t.style.height=`${c}px`,t.style.opacity=`${u}`,t.style.rotate=`${d}rad`,t.style.scale=`${p}`,t.style.color=Ps(_)},i)}setTimeout(g,n)}}const Mr=r=>{let t=!1;const e=()=>{if(r.updateFrameTime(),r.updateAnimations(),!r.hasSceneUpdates()){r.calculateFps(),setTimeout(e,16.666666666666668),t||(r.txMemManager.checkCleanup()&&r.txMemManager.cleanup(),r.eventBus.emit("idle"),t=!0),r.flushFrameEvents();return}t=!1,r.drawFrame(),r.flushFrameEvents(),requestAnimationFrame(e)};requestAnimationFrame(e)},Ir=()=>performance?performance.now():Date.now();class Fs{constructor(t,e){a(this,"textureSource");a(this,"memManager");this.memManager=t,this.textureSource=e}setTextureMemUse(t){this.memManager.setTextureMemUse(this.textureSource,t)}get renderable(){return this.textureSource.renderable}}class Bs{constructor(t){a(this,"options");a(this,"mode");a(this,"stage");a(this,"txManager");a(this,"txMemManager");a(this,"shManager");a(this,"rttNodes",[]);this.options=t,this.stage=t.stage,this.txManager=t.txManager,this.txMemManager=t.txMemManager,this.shManager=t.shManager}}class Lr{}class Os{static makeCacheKey(t){return!1}static resolveDefaults(t){return{}}}function hs(r,t,e){const s=r.createShader(t);if(!s)throw new Error;if(r.shaderSource(s,e),r.compileShader(s),r.getShaderParameter(s,r.COMPILE_STATUS))return s;console.log(r.getShaderInfoLog(s)),r.deleteShader(s)}function Pr(r,t,e){const s=r.createProgram();if(!s)throw new Error;if(r.attachShader(s,t),r.attachShader(s,e),r.linkProgram(s),r.getProgramParameter(s,r.LINK_STATUS))return s;console.log(r.getProgramInfoLog(s)),r.deleteProgram(s)}class ce extends Os{constructor(e){super();a(this,"boundBufferCollection",null);a(this,"buffersBound",!1);a(this,"program");a(this,"vao");a(this,"renderer");a(this,"glw");a(this,"attributeBuffers");a(this,"attributeLocations");a(this,"attributeNames");a(this,"uniformLocations");a(this,"uniformTypes");a(this,"supportsIndexedTextures");const s=this.renderer=e.renderer,i=this.glw=this.renderer.glw;this.supportsIndexedTextures=e.supportsIndexedTextures||!1;const n=i.isWebGl2(),o=n&&e.webgl2Extensions||!n&&e.webgl1Extensions||[],l=n?"2.0":"1.0";o.forEach(T=>{if(!i.getExtension(T))throw new Error(`Shader "${this.constructor.name}" requires extension "${T}" for WebGL ${l} but wasn't found`)});const h=e.shaderSources||this.constructor.shaderSources;if(h)n&&(h!=null&&h.webGl2)&&(h.fragment=h.webGl2.fragment,h.vertex=h.webGl2.vertex,delete h.webGl2);else throw new Error(`Shader "${this.constructor.name}" is missing shaderSources.`);const c=s.system.parameters.MAX_VERTEX_TEXTURE_IMAGE_UNITS,u=h.vertex instanceof Function?h.vertex(c):h.vertex,d=h.fragment instanceof Function?h.fragment(c):h.fragment,p=hs(i,i.VERTEX_SHADER,u),_=hs(i,i.FRAGMENT_SHADER,d);if(!p||!_)throw new Error;const g=Pr(i,p,_);if(!g)throw new Error;if(this.program=g,n){const T=i.createVertexArray();if(!T)throw new Error;this.vao=T,i.bindVertexArray(this.vao)}this.attributeLocations={},this.attributeBuffers={},this.attributeNames=[],[...e.attributes].forEach(T=>{const R=i.getAttribLocation(this.program,T);if(R<0)throw new Error(`${this.constructor.name}: Vertex shader must have an attribute "${T}"!`);const b=i.createBuffer();if(!b)throw new Error(`${this.constructor.name}: Could not create buffer for attribute "${T}"`);this.attributeLocations[T]=R,this.attributeBuffers[T]=b,this.attributeNames.push(T)}),this.uniformLocations={},this.uniformTypes={},e.uniforms.forEach(T=>{const R=i.getUniformLocation(this.program,T.name);if(this.uniformTypes[T.name]=T.uniform,!R){console.warn(`Shader "${this.constructor.name}" could not get uniform location for "${T.name}"`);return}this.uniformLocations[T.name]=R})}bindBufferAttribute(e,s,i){const{glw:n}=this;n.enableVertexAttribArray(e),n.vertexAttribPointer(s,e,i.size,i.type,i.normalized,i.stride,i.offset)}disableAttribute(e){this.glw.disableVertexAttribArray(e)}disableAttributes(){for(const e in this.attributeLocations)this.disableAttribute(this.attributeLocations[e]);this.boundBufferCollection=null}canBatchShaderProps(e,s){return!1}bindRenderOp(e,s){this.bindBufferCollection(e.buffers),e.textures.length>0&&this.bindTextures(e.textures);const{glw:i,parentHasRenderTexture:n,renderToTexture:o}=e;if(!(o&&n)){if(n){const{width:l,height:h}=e.framebufferDimensions||{};this.setUniform("u_pixelRatio",1),this.setUniform("u_resolution",new Float32Array([l??0,h??0]))}else this.setUniform("u_pixelRatio",e.options.pixelRatio),this.setUniform("u_resolution",new Float32Array([i.canvas.width,i.canvas.height]));if(s){if(kt(s,"$dimensions")){let l=s.$dimensions;l||(l=e.dimensions),this.setUniform("u_dimensions",[l.width,l.height])}if(kt(s,"$alpha")){let l=s.$alpha;l||(l=e.alpha),this.setUniform("u_alpha",l)}this.bindProps(s)}}}setUniform(e,...s){this.glw.setUniform(this.uniformTypes[e],this.uniformLocations[e],...s)}bindBufferCollection(e){if(this.boundBufferCollection!==e){for(const s in this.attributeLocations){const i=e.getBuffer(s),n=e.getAttributeInfo(s);M(i,`Buffer for "${s}" not found`),M(n),this.bindBufferAttribute(this.attributeLocations[s],i,n)}this.boundBufferCollection=e}}bindProps(e){}bindTextures(e){}attach(){this.glw.useProgram(this.program),this.glw.useProgram(this.program),this.glw.isWebGl2()&&this.vao&&this.glw.bindVertexArray(this.vao)}detach(){this.disableAttributes()}}a(ce,"shaderSources");class Ds extends Lr{constructor(e,s,i,n,o,l,h,c,u,d,p,_,g){super();a(this,"glw");a(this,"options");a(this,"buffers");a(this,"shader");a(this,"shaderProps");a(this,"alpha");a(this,"clippingRect");a(this,"dimensions");a(this,"bufferIdx");a(this,"zIndex");a(this,"renderToTexture");a(this,"parentHasRenderTexture");a(this,"framebufferDimensions");a(this,"length",0);a(this,"numQuads",0);a(this,"textures",[]);a(this,"maxTextures");this.glw=e,this.options=s,this.buffers=i,this.shader=n,this.shaderProps=o,this.alpha=l,this.clippingRect=h,this.dimensions=c,this.bufferIdx=u,this.zIndex=d,this.renderToTexture=p,this.parentHasRenderTexture=_,this.framebufferDimensions=g,this.maxTextures=n.supportsIndexedTextures?e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS):1}addTexture(e){const{textures:s,maxTextures:i}=this,n=s.findIndex(l=>l===e);if(n!==-1)return n;const o=s.length;return o>=i?4294967295:(this.textures.push(e),o)}draw(){const{glw:e,shader:s,shaderProps:i,options:n}=this,{shManager:o}=n;o.useShader(s),s.bindRenderOp(this,i);const l=this.bufferIdx/24*6*2;if(this.clippingRect.valid){const{x:h,y:c,width:u,height:d}=this.clippingRect,p=n.pixelRatio,_=n.canvas.height,g=Math.round(h*p),T=Math.round(u*p),R=Math.round(d*p),b=Math.round(_-R-c*p);e.setScissorTest(!0),e.scissor(g,b,T,R)}else e.setScissorTest(!1);e.drawElements(e.TRIANGLES,6*this.numQuads,e.UNSIGNED_SHORT,l)}}function Fr(r){const t={MAX_RENDERBUFFER_SIZE:0,MAX_TEXTURE_SIZE:0,MAX_VIEWPORT_DIMS:0,MAX_VERTEX_TEXTURE_IMAGE_UNITS:0,MAX_TEXTURE_IMAGE_UNITS:0,MAX_COMBINED_TEXTURE_IMAGE_UNITS:0,MAX_VERTEX_ATTRIBS:0,MAX_VARYING_VECTORS:0,MAX_VERTEX_UNIFORM_VECTORS:0,MAX_FRAGMENT_UNIFORM_VECTORS:0};return Object.keys(t).forEach(s=>{t[s]=r.getParameter(r[s])}),t}function Br(r){const t={ANGLE_instanced_arrays:null,WEBGL_compressed_texture_s3tc:null,WEBGL_compressed_texture_astc:null,WEBGL_compressed_texture_etc:null,WEBGL_compressed_texture_etc1:null,WEBGL_compressed_texture_pvrtc:null,WEBKIT_WEBGL_compressed_texture_pvrtc:null,WEBGL_compressed_texture_s3tc_srgb:null,OES_vertex_array_object:null};return Object.keys(t).forEach(s=>{t[s]=r.getExtension(s)}),t}function Or(r,t){const e=~~(t/80),s=new Uint16Array(e*6);for(let n=0,o=0;n<e;n+=6,o+=4)s[n]=o,s[n+1]=o+1,s[n+2]=o+2,s[n+3]=o+2,s[n+4]=o+1,s[n+5]=o+3;const i=r.createBuffer();r.elementArrayBufferData(i,s,r.STATIC_DRAW)}function Dr(r){return r!==null&&typeof r=="object"&&r.constructor&&r.constructor.name==="HTMLImageElement"}const Lt=new Uint8Array([0,0,0,0]);class xt extends Fs{constructor(e,s,i){super(s,i);a(this,"glw");a(this,"_nativeCtxTexture",null);a(this,"_state","freed");a(this,"_w",0);a(this,"_h",0);this.glw=e}get ctxTexture(){return this._state==="freed"&&this.load(),M(this._nativeCtxTexture),this._nativeCtxTexture}get w(){return this._w}get h(){return this._h}load(){this._state==="loading"||this._state==="loaded"||(this._state="loading",this.textureSource.setState("loading"),this._nativeCtxTexture=this.createNativeCtxTexture(),this.onLoadRequest().then(({width:e,height:s})=>{this._state!=="freed"&&(this._state="loaded",this._w=e,this._h=s,this.textureSource.setState("loaded",{width:e,height:s}))}).catch(e=>{this._state!=="freed"&&(this._state="failed",this.textureSource.setState("failed",e),console.error(e))}))}async onLoadRequest(){var o;const{glw:e}=this;e.texImage2D(0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,null),this.setTextureMemUse(Lt.byteLength);const s=await((o=this.textureSource)==null?void 0:o.getTextureData());if(!this._nativeCtxTexture)return M(this._state==="freed"),{width:0,height:0};let i=0,n=0;if(M(this._nativeCtxTexture),e.activeTexture(0),s.data instanceof ImageBitmap||s.data instanceof ImageData||Dr(s.data)){const l=s.data;i=l.width,n=l.height,e.bindTexture(this._nativeCtxTexture),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!!s.premultiplyAlpha),e.texImage2D(0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,l),this.setTextureMemUse(i*n*4),(e.isWebGl2()||os(i)&&os(n))&&e.generateMipmap()}else if(s.data===null)i=0,n=0,e.bindTexture(this._nativeCtxTexture),e.texImage2D(0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,Lt),this.setTextureMemUse(Lt.byteLength);else if("mipmaps"in s.data&&s.data.mipmaps){const{mipmaps:l,width:h=0,height:c=0,type:u,glInternalFormat:d}=s.data,p=u==="ktx"?new DataView(l[0]??new ArrayBuffer(0)):l[0];e.bindTexture(this._nativeCtxTexture),e.compressedTexImage2D(0,d,h,c,0,p),e.texParameteri(e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_MIN_FILTER,e.LINEAR),this.setTextureMemUse(p.byteLength)}else console.error("WebGlCoreCtxTexture.onLoadRequest: Unexpected textureData returned",s);return{width:i,height:n}}free(){if(this._state==="freed"||(this._state="freed",this.textureSource.setState("freed"),this._w=0,this._h=0,!this._nativeCtxTexture))return;const{glw:e}=this;e.deleteTexture(this._nativeCtxTexture),this.setTextureMemUse(0),this._nativeCtxTexture=null}createNativeCtxTexture(){const{glw:e}=this,s=e.createTexture();if(!s)throw new Error("Could not create WebGL Texture");return e.activeTexture(0),e.bindTexture(s),e.texParameteri(e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),s}}class Ae extends he{constructor(e){super();a(this,"txManager");a(this,"dimensions",null);a(this,"error",null);a(this,"state","freed");a(this,"renderableOwners",new Set);a(this,"renderable",!1);a(this,"lastRenderableChangeTime",0);this.txManager=e}setRenderableOwner(e,s){var n,o;const i=this.renderableOwners.size;if(s){this.renderableOwners.add(e);const l=this.renderableOwners.size;l>i&&l===1&&(this.renderable=!0,this.lastRenderableChangeTime=this.txManager.frameTime,(n=this.onChangeIsRenderable)==null||n.call(this,!0))}else{this.renderableOwners.delete(e);const l=this.renderableOwners.size;l<i&&l===0&&(this.renderable=!1,this.lastRenderableChangeTime=this.txManager.frameTime,(o=this.onChangeIsRenderable)==null||o.call(this,!1))}}get ctxTexture(){const e=this.txManager.renderer.createCtxTexture(this);return Object.defineProperty(this,"ctxTexture",{value:e}),e}setState(e,...s){if(this.state!==e){if(this.state=e,e==="loaded"){const i=s;this.dimensions=i[0]}else if(e==="failed"){const i=s;this.error=i[0]}this.emit(e,...s)}}static makeCacheKey(e){return!1}static resolveDefaults(e){return{}}}const ke=class ke extends Ae{constructor(e,s){super(e);a(this,"props");this.props=ke.resolveDefaults(s||{})}get color(){return this.props.color}set color(e){this.props.color=e}async getTextureData(){const e=new Uint32Array([this.color]),s=new Uint8ClampedArray(e.buffer);return{data:new ImageData(s,1,1),premultiplyAlpha:!0}}static makeCacheKey(e){return`ColorTexture,${ke.resolveDefaults(e).color}`}static resolveDefaults(e){return{color:e.color||4294967295}}};a(ke,"z$__type__Props");let yt=ke;const St=class St extends Ae{constructor(e,s){super(e);a(this,"props");a(this,"parentTexture");a(this,"onParentTxLoaded",()=>{this.setState("loaded",{width:this.props.width,height:this.props.height})});a(this,"onParentTxFailed",(e,s)=>{this.setState("failed",s)});this.props=St.resolveDefaults(s||{}),this.parentTexture=this.props.texture,queueMicrotask(()=>{const i=this.parentTexture;i.state==="loaded"?this.onParentTxLoaded(i,i.dimensions):i.state==="failed"&&this.onParentTxFailed(i,i.error),i.on("loaded",this.onParentTxLoaded),i.on("failed",this.onParentTxFailed)})}onChangeIsRenderable(e){this.parentTexture.setRenderableOwner(this,e)}async getTextureData(){return{data:this.props}}static makeCacheKey(e){return!1}static resolveDefaults(e){return{texture:e.texture,x:e.x||0,y:e.y||0,width:e.width||0,height:e.height||0}}};a(St,"z$__type__Props");let Ce=St;class Ur extends xt{constructor(t,e,s){super(t,e,s)}async onLoadRequest(){var e,s;const t=await this.textureSource.getTextureData();return{width:((e=t.data)==null?void 0:e.width)||0,height:((s=t.data)==null?void 0:s.height)||0}}}class Us extends ce{constructor(t){super({renderer:t,attributes:["a_position","a_textureCoordinate","a_color"],uniforms:[{name:"u_resolution",uniform:"uniform2fv"},{name:"u_pixelRatio",uniform:"uniform1f"},{name:"u_texture",uniform:"uniform2fv"}]})}bindTextures(t){const{glw:e}=this;e.activeTexture(0),e.bindTexture(t[0].ctxTexture)}}a(Us,"shaderSources",{vertex:`
      # ifdef GL_FRAGMENT_PRECISION_HIGH
      precision highp float;
      # else
      precision mediump float;
      # endif

      attribute vec2 a_position;
      attribute vec2 a_textureCoordinate;
      attribute vec4 a_color;

      uniform vec2 u_resolution;
      uniform float u_pixelRatio;


      varying vec4 v_color;
      varying vec2 v_textureCoordinate;

      void main() {
        vec2 normalized = a_position * u_pixelRatio;
        vec2 screenSpace = vec2(2.0 / u_resolution.x, -2.0 / u_resolution.y);

        v_color = a_color;
        v_textureCoordinate = a_textureCoordinate;

        gl_Position = vec4(normalized.x * screenSpace.x - 1.0, normalized.y * -abs(screenSpace.y) + 1.0, 0.0, 1.0);
        gl_Position.y = -sign(screenSpace.y) * gl_Position.y;
      }
    `,fragment:`
      # ifdef GL_FRAGMENT_PRECISION_HIGH
      precision highp float;
      # else
      precision mediump float;
      # endif

      uniform vec2 u_resolution;
      uniform sampler2D u_texture;

      varying vec4 v_color;
      varying vec2 v_textureCoordinate;

      void main() {
          vec4 color = texture2D(u_texture, v_textureCoordinate);
          gl_FragColor = vec4(v_color) * texture2D(u_texture, v_textureCoordinate);
      }
    `});class Ns extends ce{constructor(e){super({renderer:e,attributes:["a_position","a_textureCoordinate","a_color","a_textureIndex"],uniforms:[{name:"u_resolution",uniform:"uniform2fv"},{name:"u_pixelRatio",uniform:"uniform1f"},{name:"u_textures[0]",uniform:"uniform1iv"}]});a(this,"supportsIndexedTextures",!0)}bindTextures(e){const{renderer:s,glw:i}=this;if(e.length>s.system.parameters.MAX_VERTEX_TEXTURE_IMAGE_UNITS)throw new Error(`DefaultShaderBatched: Cannot bind more than ${s.system.parameters.MAX_VERTEX_TEXTURE_IMAGE_UNITS} textures`);e.forEach((o,l)=>{i.activeTexture(l),i.bindTexture(o.ctxTexture)});const n=Array.from(Array(e.length).keys());this.setUniform("u_textures[0]",n)}}a(Ns,"shaderSources",{vertex:`
      # ifdef GL_FRAGMENT_PRECISION_HIGH
      precision highp float;
      # else
      precision mediump float;
      # endif

      attribute vec2 a_textureCoordinate;
      attribute vec2 a_position;
      attribute vec4 a_color;
      attribute float a_textureIndex;
      attribute float a_depth;

      uniform vec2 u_resolution;
      uniform float u_pixelRatio;

      varying vec4 v_color;
      varying vec2 v_textureCoordinate;
      varying float v_textureIndex;

      void main(){
        vec2 normalized = a_position * u_pixelRatio / u_resolution;
        vec2 zero_two = normalized * 2.0;
        vec2 clip_space = zero_two - 1.0;

        // pass to fragment
        v_color = a_color;
        v_textureCoordinate = a_textureCoordinate;
        v_textureIndex = a_textureIndex;

        // flip y
        gl_Position = vec4(clip_space * vec2(1.0, -1.0), 0, 1);
      }
    `,fragment:e=>`
      #define txUnits ${e}
      # ifdef GL_FRAGMENT_PRECISION_HIGH
      precision highp float;
      # else
      precision mediump float;
      # endif

      uniform vec2 u_resolution;
      uniform sampler2D u_image;
      uniform sampler2D u_textures[txUnits];

      varying vec4 v_color;
      varying vec2 v_textureCoordinate;
      varying float v_textureIndex;

      vec4 sampleFromTexture(sampler2D textures[${e}], int idx, vec2 uv) {
        ${Array.from(Array(e).keys()).map(s=>`
          ${s!==0?"else ":""}if (idx == ${s}) {
            return texture2D(textures[${s}], uv);
          }
        `).join("")}
        return texture2D(textures[0], uv);
      }

      void main(){
        gl_FragColor = vec4(v_color) * sampleFromTexture(u_textures, int(v_textureIndex), v_textureCoordinate);
      }
    `});class W{constructor(t){a(this,"priority",1);a(this,"name","");a(this,"ref");a(this,"target");a(this,"passParameters","");a(this,"declaredUniforms","");a(this,"uniformInfo",{});const{ref:e,target:s,props:i={}}=t;this.ref=e,this.target=s;const n={},o=[];let l="";const h=this.constructor.uniforms||{};for(const c in h){const u=h[c],d=u.type,p=`${e}_${c}`;let _="";u.size&&(_=`[${u.size(i)}]`),o.push(p),l+=`uniform ${d} ${p}${_};`,n[c]={name:p,uniform:h[c].method}}this.passParameters=o.join(","),this.declaredUniforms=l,this.uniformInfo=n}static getEffectKey(t){return""}static getMethodParameters(t,e){const s=[];for(const i in t){const n=t[i];let o="";n.size&&(o=`[${n.size(e)}]`),s.push(`${n.type} ${i}${o}`)}return s.join(",")}static resolveDefaults(t){return{}}static makeEffectKey(t){return!1}}a(W,"uniforms",{}),a(W,"methods"),a(W,"onShaderMask"),a(W,"onColorize"),a(W,"onEffectMask");const Pt=new Map,Nr=(r,t)=>{const e=JSON.stringify(r);if(Pt.has(e))return Pt.get(e);r=r??[];const s=[],i=r.length;let n=0;for(;n<i;n++){const{name:o,type:l,props:h}=r[n],c={name:o,type:l,props:{}},u=t[l],d=u.resolveDefaults(h),p=u.uniforms,_=Object.keys(p),g=_.length;let T=0;for(;T<g;T++){const R=_[T],b=p[R],m={value:d[R],programValue:void 0,updateOnBind:b.updateOnBind||!1,hasValidator:b.validator!==void 0,hasProgramValueUpdater:b.updateProgramValue!==void 0},x=m.hasValidator&&b.validator(d[R],d)||d[R];d[R]!==x&&(m.validatedValue=x),m.hasProgramValueUpdater&&b.updateProgramValue(m),m.programValue===void 0&&(m.programValue=m.value),c.props[R]=m}s.push(c)}return Pt.set(e,s),s},ne=class ne extends ce{constructor(e,s,i){const n=ne.createShader(s,i);super({renderer:e,attributes:["a_position","a_textureCoordinate","a_color"],uniforms:[{name:"u_resolution",uniform:"uniform2fv"},{name:"u_pixelRatio",uniform:"uniform1f"},{name:"u_texture",uniform:"uniform2fv"},{name:"u_dimensions",uniform:"uniform2fv"},{name:"u_alpha",uniform:"uniform1f"},...n.uniforms],shaderSources:{vertex:n.vertex,fragment:n.fragment}});a(this,"effects",[]);this.effects=n.effects}bindTextures(e){const{glw:s}=this;s.activeTexture(0),s.bindTexture(e[0].ctxTexture)}bindProps(e){var o;const s=e.effects,i=s.length;let n=0;for(;n<i;n++){const l=s[n],h=this.effects[n].uniformInfo,c=Object.keys(l.props),u=c.length;let d=0;for(;d<u;d++){const p=c[d];if(l.props[p].updateOnBind===!0){const g=(o=this.renderer.shManager.getRegisteredEffects()[l.type])==null?void 0:o.uniforms[p];g==null||g.updateProgramValue(l.props[p],e)}this.setUniform(h[p].name,l.props[p].programValue)}}}canBatchShaderProps(e,s){if(e.$dimensions.width!==s.$dimensions.width||e.$dimensions.height!==s.$dimensions.height||e.effects.length!==s.effects.length)return!1;const i=e.effects.length;let n=0;for(;n<i;n++){const o=e.effects[n],l=s.effects[n];if(o.type!==l.type)return!1;for(const h in o.props)if(l.props&&!l.props[h]||o.props[h].value!==l.props[h].value)return!1}return!0}static createShader(e,s){const i={},n={};let o="";const l=[],h=[],c=e.effects.map(g=>{const T=s[g.type],R=T.getEffectKey(g.props||{});i[R]=i[R]?++i[R]:1;const b=i[R];b===1&&h.push({key:R,type:g.type,props:g.props});const m=new T({ref:`${R}${b===1?"":b}`,target:R,props:g.props});return o+=m.declaredUniforms,l.push(...Object.values(m.uniformInfo)),m});let u="";h==null||h.forEach(g=>{const T=s[g.type],R=T.resolveDefaults(g.props??{}),b=[];for(const S in T.methods){let A=S;const E=T.methods[S];n[S]&&n[S]!==E&&(A=ne.resolveMethodDuplicate(S,E,n)),n[A]=E.replace("function",A),b.push({m:S,cm:A})}let m=T.onShaderMask instanceof Function?T.onShaderMask(R):T.onShaderMask,x=T.onColorize instanceof Function?T.onColorize(R):T.onColorize,f=T.onEffectMask instanceof Function?T.onEffectMask(R):T.onEffectMask;b.forEach(S=>{const{m:A,cm:E}=S,L=new RegExp(`\\$${A}`,"g");m&&(m=m.replace(L,E)),x&&(x=x.replace(L,E)),f&&(f=f.replace(L,E))});const v=T.getMethodParameters(T.uniforms,R),w=v.length>0?`, ${v}`:"";m&&(u+=`
        float fx_${g.key}_onShaderMask(float shaderMask ${w}) {
          ${m}
        }
        `),x&&(u+=`
          vec4 fx_${g.key}_onColorize(float shaderMask, vec4 maskColor, vec4 shaderColor${w}) {
            ${x}
          }
        `),f&&(u+=`
          vec4 fx_${g.key}_onEffectMask(float shaderMask, vec4 maskColor, vec4 shaderColor${w}) {
            ${f}
          }
        `)});let d="";for(const g in n)d+=n[g];let p="mix(shaderColor, maskColor, clamp(-(lng_DefaultMask), 0.0, 1.0))",_=`

    `;for(let g=0;g<c.length;g++){const T=c[g],R=T.passParameters.length>0?`, ${T.passParameters}`:"",b=s[T.name];b.onShaderMask&&(_+=`
        shaderMask = fx_${T.target}_onShaderMask(shaderMask ${R});
        `),b.onColorize&&(_+=`
        maskColor = fx_${T.target}_onColorize(shaderMask, maskColor, shaderColor${R});
        `),b.onEffectMask&&(p=`fx_${T.target}_onEffectMask(shaderMask, maskColor, shaderColor${R})`);const m=c[g+1];(m===void 0||s[m.name].onEffectMask)&&(_+=`
          shaderColor = ${p};
        `)}return{effects:c,uniforms:l,fragment:ne.fragment(o,d,u,_),vertex:ne.vertex()}}static resolveMethodDuplicate(e,s,i,n=0){const o=e+(n>0?n:"");return i[o]&&i[o]!==s?this.resolveMethodDuplicate(e,s,i,++n):o}static resolveDefaults(e,s){return M(s),{effects:Nr(e.effects??[],s),$dimensions:{width:0,height:0},$alpha:0}}static makeCacheKey(e,s){var n;let i="";return(n=e.effects)==null||n.forEach(o=>{const h=s[o.type].getEffectKey(o.props||{});i+=`,${h}`}),`DynamicShader${i}`}};a(ne,"z$__type__Props"),a(ne,"vertex",()=>`
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision mediump float;
    # endif

    attribute vec2 a_textureCoordinate;
    attribute vec2 a_position;
    attribute vec4 a_color;
    attribute float a_textureIndex;

    uniform vec2 u_resolution;
    uniform float u_pixelRatio;

    varying vec4 v_color;
    varying vec2 v_textureCoordinate;
    varying float v_textureIndex;

    void main(){
      vec2 normalized = a_position * u_pixelRatio / u_resolution;
      vec2 zero_two = normalized * 2.0;
      vec2 clip_space = zero_two - 1.0;

      // pass to fragment
      v_color = a_color;
      v_textureCoordinate = a_textureCoordinate;
      v_textureIndex = a_textureIndex;

      // flip y
      gl_Position = vec4(clip_space * vec2(1.0, -1.0), 0, 1);
    }
  `),a(ne,"fragment",(e,s,i,n)=>`
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision mediump float;
    # endif

    #define PI 3.14159265359

    uniform vec2 u_resolution;
    uniform vec2 u_dimensions;
    uniform float u_alpha;
    uniform float u_radius;
    uniform sampler2D u_texture;
    uniform float u_pixelRatio;

    ${e}

    varying vec4 v_color;
    varying vec2 v_textureCoordinate;

    ${s}

    ${i}

    void main() {
      vec2 p = v_textureCoordinate.xy * u_dimensions - u_dimensions * 0.5;
      vec2 d = abs(p) - (u_dimensions) * 0.5;
      float lng_DefaultMask = min(max(d.x, d.y), 0.0) + length(max(d, 0.0));

      vec4 shaderColor = vec4(0.0);
      float shaderMask = lng_DefaultMask;

      vec4 maskColor = texture2D(u_texture, v_textureCoordinate) * v_color;

      shaderColor = mix(shaderColor, maskColor, clamp(-(lng_DefaultMask + 0.5), 0.0, 1.0));

      ${n}

      gl_FragColor = shaderColor * u_alpha;
    }
  `);let be=ne;class zt extends ce{constructor(t){super({renderer:t,attributes:["a_position","a_textureCoordinate","a_color"],uniforms:[{name:"u_resolution",uniform:"uniform2fv"},{name:"u_pixelRatio",uniform:"uniform1f"},{name:"u_texture",uniform:"uniform2f"},{name:"u_dimensions",uniform:"uniform2fv"},{name:"u_radius",uniform:"uniform1f"}]})}static resolveDefaults(t){return{radius:t.radius||10,$dimensions:{width:0,height:0}}}bindTextures(t){const{glw:e}=this;e.activeTexture(0),e.bindTexture(t[0].ctxTexture)}bindProps(t){const e=Math.min(t.$dimensions.width,t.$dimensions.height)/(2*t.radius);this.setUniform("u_radius",t.radius*Math.min(e,1))}canBatchShaderProps(t,e){return t.radius===e.radius&&t.$dimensions.width===e.$dimensions.width&&t.$dimensions.height===e.$dimensions.height}}a(zt,"z$__type__Props"),a(zt,"shaderSources",{vertex:`
      # ifdef GL_FRAGMENT_PRECISION_HIGH
      precision highp float;
      # else
      precision mediump float;
      # endif

      attribute vec2 a_position;
      attribute vec2 a_textureCoordinate;
      attribute vec4 a_color;
      attribute float a_textureIndex;
      attribute float a_depth;

      uniform vec2 u_resolution;
      uniform float u_pixelRatio;

      varying vec4 v_color;
      varying vec2 v_textureCoordinate;

      void main() {
        vec2 normalized = a_position * u_pixelRatio / u_resolution;
        vec2 zero_two = normalized * 2.0;
        vec2 clip_space = zero_two - 1.0;

        // pass to fragment
        v_color = a_color;
        v_textureCoordinate = a_textureCoordinate;

        // flip y
        gl_Position = vec4(clip_space * vec2(1.0, -1.0), 0, 1);
      }
    `,fragment:`
      # ifdef GL_FRAGMENT_PRECISION_HIGH
      precision highp float;
      # else
      precision mediump float;
      # endif

      uniform vec2 u_resolution;
      uniform vec2 u_dimensions;
      uniform float u_radius;
      uniform sampler2D u_texture;

      varying vec4 v_color;
      varying vec2 v_textureCoordinate;

      float boxDist(vec2 p, vec2 size, float radius){
        size -= vec2(radius);
        vec2 d = abs(p) - size;
        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0)) - radius;
      }

      float fillMask(float dist) {
        return clamp(-dist, 0.0, 1.0);
      }

      void main() {
        vec4 color = texture2D(u_texture, v_textureCoordinate) * v_color;
        vec2 halfDimensions = u_dimensions * 0.5;

        float d = boxDist(v_textureCoordinate.xy * u_dimensions - halfDimensions, halfDimensions + 0.5, u_radius);
        gl_FragColor = mix(vec4(0.0), color, fillMask(d));
      }
    `});const kr=new Float32Array([1,0,0,0,1,0,0,0,1]),wt=class wt extends ce{constructor(t){super({renderer:t,attributes:["a_position","a_textureCoordinate"],uniforms:[{name:"u_resolution",uniform:"uniform2fv"},{name:"u_transform",uniform:"uniformMatrix3fv"},{name:"u_scrollY",uniform:"uniform1f"},{name:"u_pixelRatio",uniform:"uniform1f"},{name:"u_texture",uniform:"uniform2f"},{name:"u_color",uniform:"uniform4fv"},{name:"u_size",uniform:"uniform1f"},{name:"u_distanceRange",uniform:"uniform1f"},{name:"u_debug",uniform:"uniform1i"}]})}bindTextures(t){const{glw:e}=this;e.activeTexture(0),e.bindTexture(t[0].ctxTexture)}bindProps(t){const e=wt.resolveDefaults(t);for(const s in e)if(s==="transform")this.setUniform("u_transform",!1,e[s]);else if(s==="scrollY")this.setUniform("u_scrollY",e[s]);else if(s==="color"){const i=He(e.color);this.setUniform("u_color",i)}else s==="size"?this.setUniform("u_size",e[s]):s==="distanceRange"?this.setUniform("u_distanceRange",e[s]):s==="debug"&&this.setUniform("u_debug",e[s]?1:0)}static resolveDefaults(t={}){return{transform:t.transform??kr,scrollY:t.scrollY??0,color:t.color??4294967295,size:t.size??16,distanceRange:t.distanceRange??1,debug:t.debug??!1}}};a(wt,"shaderSources",{vertex:`
      # ifdef GL_FRAGMENT_PRECISION_HIGH
      precision highp float;
      # else
      precision mediump float;
      # endif
      // an attribute is an input (in) to a vertex shader.
      // It will receive data from a buffer
      attribute vec2 a_position;
      attribute vec2 a_textureCoordinate;

      uniform vec2 u_resolution;
      uniform mat3 u_transform;
      uniform float u_scrollY;
      uniform float u_pixelRatio;
      uniform float u_size;

      varying vec2 v_texcoord;

      void main() {
        vec2 scrolledPosition = a_position * u_size - vec2(0, u_scrollY);
        vec2 transformedPosition = (u_transform * vec3(scrolledPosition, 1)).xy;

        // Calculate screen space with pixel ratio
        vec2 screenSpace = (transformedPosition * u_pixelRatio / u_resolution * 2.0 - 1.0) * vec2(1, -1);

        gl_Position = vec4(screenSpace, 0.0, 1.0);
        v_texcoord = a_textureCoordinate;

      }
    `,fragment:`
      # ifdef GL_FRAGMENT_PRECISION_HIGH
      precision highp float;
      # else
      precision mediump float;
      # endif
      uniform vec4 u_color;
      uniform sampler2D u_texture;
      uniform float u_distanceRange;
      uniform float u_pixelRatio;
      uniform int u_debug;

      varying vec2 v_texcoord;

      float median(float r, float g, float b) {
          return max(min(r, g), min(max(r, g), b));
      }

      void main() {
          vec3 sample = texture2D(u_texture, v_texcoord).rgb;
          if (u_debug == 1) {
            gl_FragColor = vec4(sample.r, sample.g, sample.b, 1.0);
            return;
          }
          float scaledDistRange = u_distanceRange * u_pixelRatio;
          float sigDist = scaledDistRange * (median(sample.r, sample.g, sample.b) - 0.5);
          float opacity = clamp(sigDist + 0.5, 0.0, 1.0) * u_color.a;

          // Build the final color.
          // IMPORTANT: We must premultiply the color by the alpha value before returning it.
          gl_FragColor = vec4(u_color.r * opacity, u_color.g * opacity, u_color.b * opacity, opacity);
      }
    `});let Xt=wt;const Me=r=>{r.programValue===void 0&&(r.programValue=new Float32Array(4));const t=r.value,e=r.programValue;e[0]=(t>>>24)/255,e[1]=(t>>>16&255)/255,e[2]=(t>>>8&255)/255,e[3]=(t&255)/255},$r=r=>{const t=r.validatedValue||r.value;if(r.programValue instanceof Float32Array){const e=r.programValue;e[0]=t[0],e[1]=t[1]}else r.programValue=new Float32Array(t)},zr=r=>{const t=r.validatedValue||r.value;if(r.programValue instanceof Float32Array){const e=r.programValue;e[0]=t[0],e[1]=t[1],e[2]=t[1],e[3]=t[1]}else r.programValue=new Float32Array(t)},ks=r=>{const t=r.validatedValue||r.value;if(r.programValue instanceof Float32Array){const e=t.length,s=r.programValue;for(let i=0;i<e;i++)s[i]=t[i]}else r.programValue=new Float32Array(t)},Kt=r=>{const t=Array.isArray(r);if(t){if(t&&r.length===4)return r;if(t&&r.length===2)return[r[0],r[1],r[0],r[1]];if(t&&r.length===3)return[r[0],r[1],r[2],r[0]]}else return[r,r,r,r];return[r[0],r[0],r[0],r[0]]},$s=(r,t)=>{r.programValue===void 0&&(r.programValue=new Float32Array(4));const e=r.programValue,s=r.validatedValue||r.value;if(t===void 0&&r.$dimensions===void 0){e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3];return}let i=r.$dimensions;if(t!==void 0){const{$dimensions:p}=t;if(i!==void 0&&(i.width===p.width||i.height===p.height))return;i===void 0&&(i={width:p==null?void 0:p.width,height:p==null?void 0:p.height},r.$dimensions=i)}const{width:n,height:o}=i,[l,h,c,u]=s,d=Math.min(Math.min(Math.min(n/Math.max(n,l+h),n/Math.max(n,c+u)),Math.min(o/Math.max(o,l+c),o/Math.max(o,h+u))),1);e[0]=l*d,e[1]=h*d,e[2]=c*d,e[3]=u*d};class ye extends W{constructor(){super(...arguments);a(this,"name","radius")}static getEffectKey(){return"radius"}static resolveDefaults(e){return{radius:e.radius??10}}}a(ye,"z$__type__Props"),a(ye,"uniforms",{radius:{value:0,method:"uniform4fv",type:"vec4",updateOnBind:!0,validator:Kt,updateProgramValue:$s}}),a(ye,"methods",{fillMask:`
      float function(float dist) {
        return clamp(-dist, 0.0, 1.0);
      }
    `,boxDist:`
      float function(vec2 p, vec2 size, float radius) {
        size -= vec2(radius);
        vec2 d = abs(p) - size;
        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0)) - radius;
      }
    `}),a(ye,"onShaderMask",`
  vec2 halfDimensions = u_dimensions * 0.5;
  float r = radius[0] * step(v_textureCoordinate.x, 0.5) * step(v_textureCoordinate.y, 0.5);
  r = r + radius[1] * step(0.5, v_textureCoordinate.x) * step(v_textureCoordinate.y, 0.5);
  r = r + radius[2] * step(0.5, v_textureCoordinate.x) * step(0.5, v_textureCoordinate.y);
  r = r + radius[3] * step(v_textureCoordinate.x, 0.5) * step(0.5, v_textureCoordinate.y);
  return $boxDist(v_textureCoordinate.xy * u_dimensions - halfDimensions, halfDimensions, r);
  `),a(ye,"onEffectMask",`
  return mix(vec4(0.0), maskColor, $fillMask(shaderMask));
  `);class Be extends W{constructor(){super(...arguments);a(this,"name","border")}static getEffectKey(){return"border"}static resolveDefaults(e){return{width:e.width??10,color:e.color??4294967295}}}a(Be,"z$__type__Props"),a(Be,"uniforms",{width:{value:0,method:"uniform1f",type:"float"},color:{value:4294967295,updateProgramValue:Me,method:"uniform4fv",type:"vec4"}}),a(Be,"onEffectMask",`
  float intR = shaderMask + 1.0;
  float mask = clamp(intR + width, 0.0, 1.0) - clamp(intR, 0.0, 1.0);
  return mix(shaderColor, mix(shaderColor, maskColor, maskColor.a), mask);
  `),a(Be,"onColorize",`
    return color;
  `);const ae=class ae extends W{constructor(){super(...arguments);a(this,"name","linearGradient")}static getEffectKey(e){return`linearGradient${e.colors.length}`}static resolveDefaults(e){const s=e.colors??[4278190080,4294967295];let i=e.stops||[];if(i.length===0||i.length!==s.length){const n=s.length;let o=0;const l=i;for(;o<n;o++)i[o]?(l[o]=i[o],i[o-1]===void 0&&l[o-2]!==void 0&&(l[o-1]=l[o-2]+(i[o]-l[o-2])/2)):l[o]=o*(1/(s.length-1));i=l}return{colors:s,stops:i,angle:e.angle??0}}};a(ae,"z$__type__Props"),a(ae,"uniforms",{angle:{value:0,method:"uniform1f",type:"float"},colors:{value:4294967295,validator:e=>e.reduce((s,i)=>s.concat(He(i)),[]),updateProgramValue:ks,size:e=>e.colors.length,method:"uniform4fv",type:"vec4"},stops:{value:[],size:e=>e.colors.length,method:"uniform1fv",type:"float"}}),a(ae,"methods",{fromLinear:`
      vec4 function(vec4 linearRGB) {
        vec4 higher = vec4(1.055)*pow(linearRGB, vec4(1.0/2.4)) - vec4(0.055);
        vec4 lower = linearRGB * vec4(12.92);
        return mix(higher, lower, 1.0);
      }
    `,toLinear:`
      vec4 function(vec4 sRGB) {
        vec4 higher = pow((sRGB + vec4(0.055))/vec4(1.055), vec4(2.4));
        vec4 lower = sRGB/vec4(12.92);
        return mix(higher, lower, 1.0);
      }
    `,calcPoint:`
      vec2 function(float d, float angle) {
        return d * vec2(cos(angle), sin(angle)) + (u_dimensions * 0.5);
      }
    `}),a(ae,"ColorLoop",e=>{let s="";for(let i=2;i<e;i++)s+=`colorOut = mix(colorOut, colors[${i}], clamp((dist - stops[${i-1}]) / (stops[${i}] - stops[${i-1}]), 0.0, 1.0));`;return s}),a(ae,"onColorize",e=>{const s=e.colors.length||1;return`
      float a = angle - (PI / 180.0 * 90.0);
      float lineDist = abs(u_dimensions.x * cos(a)) + abs(u_dimensions.y * sin(a));
      vec2 f = $calcPoint(lineDist * 0.5, a);
      vec2 t = $calcPoint(lineDist * 0.5, a + PI);
      vec2 gradVec = t - f;
      float dist = dot(v_textureCoordinate.xy * u_dimensions - f, gradVec) / dot(gradVec, gradVec);

      float stopCalc = (dist - stops[0]) / (stops[1] - stops[0]);
      vec4 colorOut = $fromLinear(mix($toLinear(colors[0]), $toLinear(colors[1]), stopCalc));
      ${ae.ColorLoop(s)}
      return mix(maskColor, colorOut, clamp(colorOut.a, 0.0, 1.0));
    `});let Gt=ae;class Wt extends W{constructor(){super(...arguments);a(this,"name","grayscale")}static getEffectKey(){return"grayscale"}static resolveDefaults(e){return{amount:e.amount??1}}}a(Wt,"uniforms",{amount:{value:1,method:"uniform1f",type:"float"}}),a(Wt,"onColorize",`
    float grayness = 0.2 * maskColor.r + 0.6 * maskColor.g + 0.2 * maskColor.b;
    return vec4(amount * vec3(grayness) + (1.0 - amount) * maskColor.rgb, maskColor.a);
  `);class Te extends W{constructor(){super(...arguments);a(this,"name","borderRight")}static getEffectKey(){return"borderRight"}static resolveDefaults(e){return{width:e.width??10,color:e.color??4294967295}}}a(Te,"z$__type__Props"),a(Te,"uniforms",{width:{value:0,method:"uniform1f",type:"float"},color:{value:4294967295,updateProgramValue:Me,method:"uniform4fv",type:"vec4"}}),a(Te,"methods",{fillMask:`
      float function(float dist) {
        return clamp(-dist, 0.0, 1.0);
      }
    `,rectDist:`
      float function(vec2 p, vec2 size) {
        vec2 d = abs(p) - size;
        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));
      }
    `}),a(Te,"onEffectMask",`
  vec2 pos = vec2(u_dimensions.x - width * 0.5, 0.0);
  float mask = $rectDist(v_textureCoordinate.xy * u_dimensions - pos, vec2(width*0.5, u_dimensions.y));
  return mix(shaderColor, maskColor, $fillMask(mask));
  `),a(Te,"onColorize",`
    return color;
  `);class _e extends W{constructor(){super(...arguments);a(this,"name","borderTop")}static getEffectKey(){return"borderTop"}static resolveDefaults(e){return{width:e.width??10,color:e.color??4294967295}}}a(_e,"z$__type__Props"),a(_e,"uniforms",{width:{value:0,method:"uniform1f",type:"float"},color:{value:4294967295,updateProgramValue:Me,method:"uniform4fv",type:"vec4"}}),a(_e,"methods",{fillMask:`
      float function(float dist) {
        return clamp(-dist, 0.0, 1.0);
      }
    `,rectDist:`
      float function(vec2 p, vec2 size) {
        vec2 d = abs(p) - size;
        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));
      }
    `}),a(_e,"onEffectMask",`
  vec2 pos = vec2(0.0, width * 0.5);
  float mask = $rectDist(v_textureCoordinate.xy * u_dimensions - pos, vec2(u_dimensions.x, width*0.5));
  return mix(shaderColor, maskColor, $fillMask(mask));
  `),a(_e,"onColorize",`
    return color;
  `);class ve extends W{constructor(){super(...arguments);a(this,"name","borderBottom")}static getEffectKey(){return"borderBottom"}static resolveDefaults(e){return{width:e.width??10,color:e.color??4294967295}}}a(ve,"z$__type__Props"),a(ve,"uniforms",{width:{value:0,method:"uniform1f",type:"float"},color:{value:4294967295,updateProgramValue:Me,method:"uniform4fv",type:"vec4"}}),a(ve,"methods",{fillMask:`
      float function(float dist) {
        return clamp(-dist, 0.0, 1.0);
      }
    `,rectDist:`
      float function(vec2 p, vec2 size) {
        vec2 d = abs(p) - size;
        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));
      }
    `}),a(ve,"onEffectMask",`
  vec2 pos = vec2(0.0, u_dimensions.y - width * 0.5);
  float mask = $rectDist(v_textureCoordinate.xy * u_dimensions - pos, vec2(u_dimensions.x, width*0.5));
  return mix(shaderColor, maskColor, $fillMask(mask));
  `),a(ve,"onColorize",`
    return color;
  `);class Re extends W{constructor(){super(...arguments);a(this,"name","borderLeft")}static getEffectKey(){return"borderLeft"}static resolveDefaults(e){return{width:e.width??10,color:e.color??4294967295}}}a(Re,"z$__type__Props"),a(Re,"uniforms",{width:{value:0,method:"uniform1f",type:"float"},color:{value:4294967295,updateProgramValue:Me,method:"uniform4fv",type:"vec4"}}),a(Re,"methods",{fillMask:`
      float function(float dist) {
        return clamp(-dist, 0.0, 1.0);
      }
    `,rectDist:`
      float function(vec2 p, vec2 size) {
        vec2 d = abs(p) - size;
        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));
      }
    `}),a(Re,"onEffectMask",`
  vec2 pos = vec2(width * 0.5, 0.0);
  float mask = $rectDist(v_textureCoordinate.xy * u_dimensions - pos, vec2(width*0.5, u_dimensions.y));
  return mix(shaderColor, maskColor, $fillMask(mask));
  `),a(Re,"onColorize",`
    return color;
  `);class Oe extends W{constructor(){super(...arguments);a(this,"name","glitch")}static getEffectKey(e){return"glitch"}static resolveDefaults(e){return{amplitude:e.amplitude??.2,narrowness:e.narrowness??4,blockiness:e.blockiness??2,minimizer:e.minimizer??8,time:e.time??Date.now()}}}a(Oe,"z$__type__Props"),a(Oe,"uniforms",{amplitude:{value:0,method:"uniform1f",type:"float"},narrowness:{value:0,method:"uniform1f",type:"float"},blockiness:{value:0,method:"uniform1f",type:"float"},minimizer:{value:0,method:"uniform1f",type:"float"},time:{value:0,method:"uniform1f",updateOnBind:!0,updateProgramValue:e=>{const s=e.value=(Date.now()-e.value)%1e3;e.programValue=s},type:"float"}}),a(Oe,"methods",{rand:`
      float function(vec2 p, float time) {
        float t = floor(time * 20.) / 10.;
        return fract(sin(dot(p, vec2(t * 12.9898, t * 78.233))) * 43758.5453);
      }
    `,noise:`
      float function(vec2 uv, float blockiness, float time) {
        vec2 lv = fract(uv);
        vec2 id = floor(uv);

        float n1 = rand(id, time);
        float n2 = rand(id+vec2(1,0), time);
        float n3 = rand(id+vec2(0,1), time);
        float n4 = rand(id+vec2(1,1), time);
        vec2 u = smoothstep(0.0, 1.0 + blockiness, lv);
        return mix(mix(n1, n2, u.x), mix(n3, n4, u.x), u.y);
      }
    `,fbm:`
      float function(vec2 uv, int count, float blockiness, float complexity, float time) {
        float val = 0.0;
        float amp = 0.5;
        const int MAX_ITERATIONS = 10;

        for(int i = 0; i < MAX_ITERATIONS; i++) {
          if(i >= count) {break;}
          val += amp * noise(uv, blockiness, time);
          amp *= 0.5;
          uv *= complexity;
        }
        return val;
      }
    `}),a(Oe,"onColorize",`
    vec2 uv = v_textureCoordinate.xy;
    float aspect = u_dimensions.x / u_dimensions.y;
    vec2 a = vec2(uv.x * aspect , uv.y);
    vec2 uv2 = vec2(a.x / u_dimensions.x, exp(a.y));

    float shift = amplitude * pow($fbm(uv2, 4, blockiness, narrowness, time), minimizer);
    float colR = texture2D(u_texture, vec2(uv.x + shift, uv.y)).r * (1. - shift);
    float colG = texture2D(u_texture, vec2(uv.x - shift, uv.y)).g * (1. - shift);
    float colB = texture2D(u_texture, vec2(uv.x - shift, uv.y)).b * (1. - shift);

    vec3 f = vec3(colR, colG, colB);
    return vec4(f, texture2D(u_texture, vec2(uv.x - shift, uv.y)).a);
  `);class ft extends W{constructor(){super(...arguments);a(this,"name","fadeOut")}static getEffectKey(){return"fadeOut"}static resolveDefaults(e){return{fade:e.fade??10}}}a(ft,"z$__type__Props"),a(ft,"uniforms",{fade:{value:0,method:"uniform4fv",type:"vec4",validator:Kt,updateProgramValue:zr}}),a(ft,"onColorize",`
  vec2 point = v_textureCoordinate.xy * u_dimensions.xy;
  vec2 pos1;
  vec2 pos2;
  vec2 d;
  float c;
  vec4 result = maskColor;


  if(fade[0] > 0.0) {
    pos1 = vec2(point.x, point.y);
    pos2 = vec2(point.x, point.y + fade[0]);
    d = pos2 - pos1;
    c = dot(pos1, d) / dot(d, d);
    result = mix(vec4(0.0), result, smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0)));
  }

  if(fade[1] > 0.0) {
    pos1 = vec2(point.x - u_dimensions.x - fade[1], v_textureCoordinate.y);
    pos2 = vec2(point.x - u_dimensions.x, v_textureCoordinate.y);
    d = pos1 - pos2;
    c = dot(pos2, d) / dot(d, d);
    result = mix(vec4(0.0), result, smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0)));
  }

  if(fade[2] > 0.0) {
    pos1 = vec2(v_textureCoordinate.x, point.y - u_dimensions.y - fade[2]);
    pos2 = vec2(v_textureCoordinate.x, point.y - u_dimensions.y);
    d = pos1 - pos2;
    c = dot(pos2, d) / dot(d, d);
    result = mix(vec4(0.0), result, smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0)));
  }

  if(fade[3] > 0.0) {
    pos1 = vec2(point.x, point.y);
    pos2 = vec2(point.x + fade[3], point.y);
    d = pos2 - pos1;
    c = dot(pos1, d) / dot(d, d);
    result = mix(vec4(0.0), result, smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0)));
  }

  return result;
  `);const ue=class ue extends W{constructor(){super(...arguments);a(this,"name","radialGradient")}static getEffectKey(e){return`radialGradient${e.colors.length}`}static resolveDefaults(e){const s=e.colors??[4278190080,4294967295];let i=e.stops||[];if(i.length===0||i.length!==s.length){const n=s.length;let o=0;const l=i;for(;o<n;o++)i[o]?(l[o]=i[o],i[o-1]===void 0&&l[o-2]!==void 0&&(l[o-1]=l[o-2]+(i[o]-l[o-2])/2)):l[o]=o*(1/(s.length-1));i=l}return{colors:s,stops:i,width:e.width??0,height:e.height??e.width??0,pivot:e.pivot??[.5,.5]}}};a(ue,"z$__type__Props"),a(ue,"uniforms",{width:{value:0,method:"uniform1f",type:"float"},height:{value:0,method:"uniform1f",type:"float"},pivot:{value:[.5,.5],updateProgramValue:$r,method:"uniform2fv",type:"vec2"},colors:{value:4294967295,validator:e=>e.reduce((s,i)=>s.concat(He(i)),[]),updateProgramValue:ks,size:e=>e.colors.length,method:"uniform4fv",type:"vec4"},stops:{value:[],size:e=>e.colors.length,method:"uniform1fv",type:"float"}}),a(ue,"ColorLoop",e=>{let s="";for(let i=2;i<e;i++)s+=`colorOut = mix(colorOut, colors[${i}], clamp((dist - stops[${i-1}]) / (stops[${i}] - stops[${i-1}]), 0.0, 1.0));`;return s}),a(ue,"onColorize",e=>{const s=e.colors.length||1;return`
      vec2 point = v_textureCoordinate.xy * u_dimensions;
      vec2 projection = vec2(pivot.x * u_dimensions.x, pivot.y * u_dimensions.y);

      float dist = length((point - projection) / vec2(width, height));

      float stopCalc = (dist - stops[0]) / (stops[1] - stops[0]);
      vec4 colorOut = mix(colors[0], colors[1], stopCalc);
      ${ue.ColorLoop(s)}
      return mix(maskColor, colorOut, clamp(colorOut.a, 0.0, 1.0));
    `});let Ht=ue;class Se extends W{constructor(){super(...arguments);a(this,"name","radialProgress")}static getEffectKey(){return"radialProgress"}static resolveDefaults(e){return{width:e.width??10,progress:e.progress??.5,offset:e.offset??0,range:e.range??Math.PI*2,rounded:e.rounded??!1,radius:e.radius??1,color:e.color??4294967295}}}a(Se,"z$__type__Props"),a(Se,"uniforms",{width:{value:0,method:"uniform1f",type:"float"},progress:{value:.5,method:"uniform1f",type:"float"},offset:{value:0,method:"uniform1f",type:"float"},range:{value:0,method:"uniform1f",type:"float"},rounded:{value:0,method:"uniform1f",type:"float",validator:e=>e?1:0},radius:{value:1,method:"uniform1f",type:"float"},color:{value:4294967295,updateProgramValue:Me,method:"uniform4fv",type:"vec4"}}),a(Se,"methods",{rotateUV:`
    vec2 function(vec2 uv, float d) {
      float s = sin(d);
      float c = cos(d);
      mat2 rotMatrix = mat2(c, -s, s, c);
      return uv * rotMatrix;
    }
    `,drawDot:`
    float function(vec2 uv, vec2 p, float r) {
      uv += p;
      float circle = length(uv) - r;
      return clamp(-circle, 0.0, 1.0);
    }
    `}),a(Se,"onEffectMask",`
    float outerRadius = radius * u_dimensions.y * 0.5;

    float endAngle = range * progress - 0.0005;

    vec2 uv = v_textureCoordinate.xy * u_dimensions.xy - u_dimensions * 0.5;

    uv = $rotateUV(uv, -(offset));
    float linewidth = width * u_pixelRatio;
    float circle = length(uv) - (outerRadius - linewidth) ;
    circle = abs(circle) - linewidth;
    circle = clamp(-circle, 0.0, 1.0);

    float angle = (atan(uv.x, -uv.y) / 3.14159265359 * 0.5);
    float p = endAngle / (PI * 2.);

    circle *= step(fract(angle), fract(p));

    circle = rounded < 1. ? circle : max(circle, $drawDot(uv, vec2(0, outerRadius - linewidth), linewidth));
    circle = rounded < 1. ? circle : max(circle, $drawDot($rotateUV(uv, -(endAngle)), vec2(0, outerRadius - linewidth), linewidth));

    return mix(shaderColor, maskColor, circle);
  `),a(Se,"onColorize",`
    return color;
  `);class we extends W{constructor(){super(...arguments);a(this,"name","holePunch")}static getEffectKey(){return"holePunch"}static resolveDefaults(e){return{x:e.x||0,y:e.y||0,width:e.width||50,height:e.height||50,radius:e.radius??0}}}a(we,"z$__type__Props"),a(we,"uniforms",{x:{value:0,method:"uniform1f",type:"float"},y:{value:0,method:"uniform1f",type:"float"},width:{value:0,method:"uniform1f",type:"float"},height:{value:0,method:"uniform1f",type:"float"},radius:{value:0,method:"uniform4fv",type:"vec4",updateOnBind:!0,validator:Kt,updateProgramValue:$s}}),a(we,"methods",{fillMask:`
      float function(float dist) {
        return clamp(-dist, 0.0, 1.0);
      }
    `,boxDist:`
      float function(vec2 p, vec2 size, float radius) {
        size -= vec2(radius);
        vec2 d = abs(p) - size;
        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0)) - radius;
      }
    `}),a(we,"onShaderMask",`
  vec2 halfDimensions = u_dimensions * 0.5;
  vec2 size = vec2(width, height) * 0.5;
  vec2 basePos = v_textureCoordinate.xy * u_dimensions.xy - vec2(x, y);
  vec2 pos = basePos - size;
  float r = radius[0] * step(pos.x, 0.5) * step(pos.y, 0.5);
  r = r + radius[1] * step(0.5, pos.x) * step(pos.y, 0.5);
  r = r + radius[2] * step(0.5, pos.x) * step(0.5, pos.y);
  r = r + radius[3] * step(pos.x, 0.5) * step(0.5, pos.y);
  return $boxDist(pos, size, r);
  `),a(we,"onEffectMask",`
  return mix(maskColor, vec4(0.0), $fillMask(shaderMask));
  `);const zs="RoundedRectangle";class Qt extends Os{constructor(e){super();a(this,"shType");this.shType=e,e!==zs&&console.warn("Unsupported shader:",e)}bindRenderOp(){}bindProps(){}attach(){}detach(){}}class Xr{constructor(t,e,s,i){a(this,"type");a(this,"shader");a(this,"resolvedProps");a(this,"props");this.type=t,this.shader=e,this.resolvedProps=s;const n=Object.keys(s),o=n.length,l={};for(let h=0;h<o;h++){const c=n[h];Object.defineProperty(l,c,{get:()=>this.resolvedProps[c],set:u=>{this.resolvedProps[c]=u,i.requestRender()}})}this.props=l}getResolvedProps(){return this.resolvedProps}}class Gr{constructor(t,e,s){a(this,"shader");a(this,"resolvedProps");a(this,"props");a(this,"type");this.shader=t,this.type="DynamicShader",this.resolvedProps=e;const i=s.getRegisteredEffects(),n={},o=e.effects,l=o.length;for(let h=0;h<l;h++){const{name:c,props:u,type:d}=o[h];if(c===void 0)continue;const p={},_=Object.keys(u),g=_.length;for(let T=0;T<g;T++){const R=_[T];Object.defineProperty(p,R,{get:()=>this.resolvedProps.effects[h].props[R].value,set:b=>{var x,f;const m=this.resolvedProps.effects[h].props[R];m.value=b,m.hasValidator&&(b=m.validatedValue=(x=i[d].uniforms[R])==null?void 0:x.validator(b,u)),m.hasProgramValueUpdater?(f=i[d].uniforms[R])==null||f.updateProgramValue(m):m.programValue=b,s.renderer.stage.requestRender()}})}Object.defineProperty(n,c,{get:()=>p})}this.props=n}getResolvedProps(){return this.resolvedProps}}class Wr{constructor(){a(this,"shCache",new Map);a(this,"shConstructors",{});a(this,"attachedShader",null);a(this,"effectConstructors",{});a(this,"renderer");this.registerShaderType("DefaultShader",Us),this.registerShaderType("DefaultShaderBatched",Ns),this.registerShaderType("RoundedRectangle",zt),this.registerShaderType("DynamicShader",be),this.registerShaderType("SdfShader",Xt),this.registerEffectType("border",Be),this.registerEffectType("borderBottom",ve),this.registerEffectType("borderLeft",Re),this.registerEffectType("borderRight",Te),this.registerEffectType("borderTop",_e),this.registerEffectType("fadeOut",ft),this.registerEffectType("linearGradient",Gt),this.registerEffectType("radialGradient",Ht),this.registerEffectType("grayscale",Wt),this.registerEffectType("glitch",Oe),this.registerEffectType("radius",ye),this.registerEffectType("radialProgress",Se),this.registerEffectType("holePunch",we)}registerShaderType(t,e){this.shConstructors[t]=e}registerEffectType(t,e){this.effectConstructors[t]=e}getRegisteredEffects(){return this.effectConstructors}getRegisteredShaders(){return this.shConstructors}loadShader(t,e){if(!this.renderer)throw new Error("Renderer is not been defined");const s=this.shConstructors[t];if(!s)throw new Error(`Shader type "${t}" is not registered`);if(this.renderer.mode==="canvas"&&s.prototype instanceof ce)return this._createShaderCtr(t,new Qt(t),e);if(t==="DynamicShader")return this.loadDynamicShader(e);const i=s.resolveDefaults(e),n=s.makeCacheKey(i)||s.name;if(n&&this.shCache.has(n))return this._createShaderCtr(t,this.shCache.get(n),i);const o=new s(this.renderer,e);return n&&this.shCache.set(n,o),this._createShaderCtr(t,o,i)}loadDynamicShader(t){if(!this.renderer)throw new Error("Renderer is not been defined");const e=be.resolveDefaults(t,this.effectConstructors),s=be.makeCacheKey(e,this.effectConstructors);if(s&&this.shCache.has(s))return this._createDynShaderCtr(this.shCache.get(s),e);const i=new be(this.renderer,t,this.effectConstructors);return s&&this.shCache.set(s,i),this._createDynShaderCtr(i,e)}_createShaderCtr(t,e,s){return new Xr(t,e,s,this.renderer.stage)}_createDynShaderCtr(t,e){return new Gr(t,e,this)}useShader(t){this.attachedShader!==t&&(this.attachedShader&&this.attachedShader.detach(),t.attach(),this.attachedShader=t)}}class Xs{constructor(t){a(this,"config");this.config=t}getBuffer(t){var e;return(e=this.config.find(s=>s.attributes[t]))==null?void 0:e.buffer}getAttributeInfo(t){var e;return(e=this.config.find(s=>s.attributes[t]))==null?void 0:e.attributes[t]}}function Hr(r){return self.WebGL2RenderingContext&&r instanceof self.WebGL2RenderingContext}class Vr{constructor(t){a(this,"gl");a(this,"activeTextureUnit",0);a(this,"texture2dUnits");a(this,"texture2dParams",new WeakMap);a(this,"scissorEnabled");a(this,"scissorX");a(this,"scissorY");a(this,"scissorWidth");a(this,"scissorHeight");a(this,"blendEnabled");a(this,"blendSrcRgb");a(this,"blendDstRgb");a(this,"blendSrcAlpha");a(this,"blendDstAlpha");a(this,"boundArrayBuffer");a(this,"boundElementArrayBuffer");a(this,"curProgram");a(this,"programUniforms",new WeakMap);a(this,"canvas");a(this,"MAX_RENDERBUFFER_SIZE");a(this,"MAX_TEXTURE_SIZE");a(this,"MAX_VIEWPORT_DIMS");a(this,"MAX_VERTEX_TEXTURE_IMAGE_UNITS");a(this,"MAX_TEXTURE_IMAGE_UNITS");a(this,"MAX_COMBINED_TEXTURE_IMAGE_UNITS");a(this,"MAX_VERTEX_ATTRIBS");a(this,"MAX_VARYING_VECTORS");a(this,"MAX_VERTEX_UNIFORM_VECTORS");a(this,"MAX_FRAGMENT_UNIFORM_VECTORS");a(this,"TEXTURE_MAG_FILTER");a(this,"TEXTURE_MIN_FILTER");a(this,"TEXTURE_WRAP_S");a(this,"TEXTURE_WRAP_T");a(this,"LINEAR");a(this,"CLAMP_TO_EDGE");a(this,"RGBA");a(this,"UNSIGNED_BYTE");a(this,"UNPACK_PREMULTIPLY_ALPHA_WEBGL");a(this,"UNPACK_FLIP_Y_WEBGL");a(this,"FLOAT");a(this,"TRIANGLES");a(this,"UNSIGNED_SHORT");a(this,"ONE");a(this,"ONE_MINUS_SRC_ALPHA");a(this,"VERTEX_SHADER");a(this,"FRAGMENT_SHADER");a(this,"STATIC_DRAW");a(this,"COMPILE_STATUS");a(this,"LINK_STATUS");a(this,"DYNAMIC_DRAW");a(this,"COLOR_ATTACHMENT0");this.gl=t,this.activeTextureUnit=t.getParameter(t.ACTIVE_TEXTURE)-t.TEXTURE0;const e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.texture2dUnits=new Array(e).fill(void 0).map((i,n)=>(this.activeTexture(n),t.getParameter(t.TEXTURE_BINDING_2D))),this.activeTexture(this.activeTextureUnit),this.scissorEnabled=t.isEnabled(t.SCISSOR_TEST);const s=t.getParameter(t.SCISSOR_BOX);this.scissorX=s[0],this.scissorY=s[1],this.scissorWidth=s[2],this.scissorHeight=s[3],this.blendEnabled=t.isEnabled(t.BLEND),this.blendSrcRgb=t.getParameter(t.BLEND_SRC_RGB),this.blendDstRgb=t.getParameter(t.BLEND_DST_RGB),this.blendSrcAlpha=t.getParameter(t.BLEND_SRC_ALPHA),this.blendDstAlpha=t.getParameter(t.BLEND_DST_ALPHA),this.boundArrayBuffer=t.getParameter(t.ARRAY_BUFFER_BINDING),this.boundElementArrayBuffer=t.getParameter(t.ELEMENT_ARRAY_BUFFER_BINDING),this.curProgram=t.getParameter(t.CURRENT_PROGRAM),this.canvas=t.canvas,this.MAX_RENDERBUFFER_SIZE=t.MAX_RENDERBUFFER_SIZE,this.MAX_TEXTURE_SIZE=t.MAX_TEXTURE_SIZE,this.MAX_VIEWPORT_DIMS=t.MAX_VIEWPORT_DIMS,this.MAX_VERTEX_TEXTURE_IMAGE_UNITS=t.MAX_VERTEX_TEXTURE_IMAGE_UNITS,this.MAX_TEXTURE_IMAGE_UNITS=t.MAX_TEXTURE_IMAGE_UNITS,this.MAX_COMBINED_TEXTURE_IMAGE_UNITS=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS,this.MAX_VERTEX_ATTRIBS=t.MAX_VERTEX_ATTRIBS,this.MAX_VARYING_VECTORS=t.MAX_VARYING_VECTORS,this.MAX_VERTEX_UNIFORM_VECTORS=t.MAX_VERTEX_UNIFORM_VECTORS,this.MAX_FRAGMENT_UNIFORM_VECTORS=t.MAX_FRAGMENT_UNIFORM_VECTORS,this.TEXTURE_MAG_FILTER=t.TEXTURE_MAG_FILTER,this.TEXTURE_MIN_FILTER=t.TEXTURE_MIN_FILTER,this.TEXTURE_WRAP_S=t.TEXTURE_WRAP_S,this.TEXTURE_WRAP_T=t.TEXTURE_WRAP_T,this.LINEAR=t.LINEAR,this.CLAMP_TO_EDGE=t.CLAMP_TO_EDGE,this.RGBA=t.RGBA,this.UNSIGNED_BYTE=t.UNSIGNED_BYTE,this.UNPACK_PREMULTIPLY_ALPHA_WEBGL=t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.UNPACK_FLIP_Y_WEBGL=t.UNPACK_FLIP_Y_WEBGL,this.FLOAT=t.FLOAT,this.TRIANGLES=t.TRIANGLES,this.UNSIGNED_SHORT=t.UNSIGNED_SHORT,this.ONE=t.ONE,this.ONE_MINUS_SRC_ALPHA=t.ONE_MINUS_SRC_ALPHA,this.MAX_VERTEX_TEXTURE_IMAGE_UNITS=t.MAX_VERTEX_TEXTURE_IMAGE_UNITS,this.TRIANGLES=t.TRIANGLES,this.UNSIGNED_SHORT=t.UNSIGNED_SHORT,this.VERTEX_SHADER=t.VERTEX_SHADER,this.FRAGMENT_SHADER=t.FRAGMENT_SHADER,this.STATIC_DRAW=t.STATIC_DRAW,this.COMPILE_STATUS=t.COMPILE_STATUS,this.LINK_STATUS=t.LINK_STATUS,this.DYNAMIC_DRAW=t.DYNAMIC_DRAW,this.COLOR_ATTACHMENT0=t.COLOR_ATTACHMENT0}isWebGl2(){return Hr(this.gl)}activeTexture(t){const{gl:e}=this;this.activeTextureUnit!==t&&(e.activeTexture(t+e.TEXTURE0),this.activeTextureUnit=t)}bindTexture(t){const{gl:e,activeTextureUnit:s,texture2dUnits:i}=this;i[s]!==t&&(i[s]=t,e.bindTexture(this.gl.TEXTURE_2D,t))}_getActiveTexture(){const{activeTextureUnit:t,texture2dUnits:e}=this;return e[t]}texParameteri(t,e){const{gl:s,texture2dParams:i}=this,n=this._getActiveTexture();if(!n)throw new Error("No active texture");let o=i.get(n);o||(o={},i.set(n,o)),o[t]!==e&&(o[t]=e,s.texParameteri(s.TEXTURE_2D,t,e))}texImage2D(t,e,s,i,n,o,l,h){const{gl:c}=this;o?c.texImage2D(c.TEXTURE_2D,t,e,s,i,n,o,l,h):c.texImage2D(c.TEXTURE_2D,t,e,s,i,n)}compressedTexImage2D(t,e,s,i,n,o){const{gl:l}=this;l.compressedTexImage2D(l.TEXTURE_2D,t,e,s,i,n,o)}pixelStorei(t,e){const{gl:s}=this;s.pixelStorei(t,e)}generateMipmap(){const{gl:t}=this;t.generateMipmap(t.TEXTURE_2D)}createTexture(){const{gl:t}=this;return t.createTexture()}deleteTexture(t){const{gl:e}=this;t&&this.texture2dParams.delete(t),e.deleteTexture(t)}viewport(t,e,s,i){const{gl:n}=this;n.viewport(t,e,s,i)}clearColor(t,e,s,i){const{gl:n}=this;n.clearColor(t,e,s,i)}setScissorTest(t){const{gl:e,scissorEnabled:s}=this;t!==s&&(t?e.enable(e.SCISSOR_TEST):e.disable(e.SCISSOR_TEST),this.scissorEnabled=t)}scissor(t,e,s,i){const{gl:n,scissorX:o,scissorY:l,scissorWidth:h,scissorHeight:c}=this;(t!==o||e!==l||s!==h||i!==c)&&(n.scissor(t,e,s,i),this.scissorX=t,this.scissorY=e,this.scissorWidth=s,this.scissorHeight=i)}setBlend(t){const{gl:e,blendEnabled:s}=this;t!==s&&(t?e.enable(e.BLEND):e.disable(e.BLEND),this.blendEnabled=t)}blendFunc(t,e){const{gl:s,blendSrcRgb:i,blendDstRgb:n,blendSrcAlpha:o,blendDstAlpha:l}=this;(t!==i||e!==n||t!==o||e!==l)&&(s.blendFunc(t,e),this.blendSrcRgb=t,this.blendDstRgb=e,this.blendSrcAlpha=t,this.blendDstAlpha=e)}createBuffer(){const{gl:t}=this;return t.createBuffer()}createFramebuffer(){const{gl:t}=this;return t.createFramebuffer()}bindFramebuffer(t){const{gl:e}=this;e.bindFramebuffer(e.FRAMEBUFFER,t)}framebufferTexture2D(t,e,s){const{gl:i}=this;i.framebufferTexture2D(i.FRAMEBUFFER,t,i.TEXTURE_2D,e,s)}clear(){const{gl:t}=this;t.clear(t.COLOR_BUFFER_BIT)}arrayBufferData(t,e,s){const{gl:i,boundArrayBuffer:n}=this;n!==t&&(i.bindBuffer(i.ARRAY_BUFFER,t),this.boundArrayBuffer=t),i.bufferData(i.ARRAY_BUFFER,e,s)}elementArrayBufferData(t,e,s){const{gl:i,boundElementArrayBuffer:n}=this;n!==t&&(i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,t),this.boundElementArrayBuffer=t),i.bufferData(i.ELEMENT_ARRAY_BUFFER,e,s)}vertexAttribPointer(t,e,s,i,n,o,l){const{gl:h,boundArrayBuffer:c}=this;c!==t&&(h.bindBuffer(h.ARRAY_BUFFER,t),this.boundArrayBuffer=t),h.vertexAttribPointer(e,s,i,n,o,l)}useProgram(t){const{gl:e,curProgram:s}=this;s!==t&&(e.useProgram(t),this.curProgram=t)}setUniform(t,e,...s){const{gl:i,programUniforms:n}=this;let o=n.get(this.curProgram);o||(o=new Map,n.set(this.curProgram,o));const l=o.get(e);(!l||!Yr(l,s))&&(o.set(e,s),i[t](e,...s))}getParameter(t){const{gl:e}=this;return e.getParameter(t)}drawElements(t,e,s,i){const{gl:n}=this;n.drawElements(t,e,s,i)}getExtension(t){const{gl:e}=this;return e.getExtension(t)}createVertexArray(){const{gl:t}=this;return M(t instanceof WebGL2RenderingContext),t.createVertexArray()}bindVertexArray(t){const{gl:e}=this;M(e instanceof WebGL2RenderingContext),e.bindVertexArray(t)}getAttribLocation(t,e){const{gl:s}=this;return s.getAttribLocation(t,e)}getUniformLocation(t,e){const{gl:s}=this;return s.getUniformLocation(t,e)}enableVertexAttribArray(t){const{gl:e}=this;e.enableVertexAttribArray(t)}disableVertexAttribArray(t){const{gl:e}=this;e.disableVertexAttribArray(t)}createShader(t){const{gl:e}=this;return e.createShader(t)}compileShader(t){const{gl:e}=this;e.compileShader(t)}attachShader(t,e){const{gl:s}=this;s.attachShader(t,e)}linkProgram(t){const{gl:e}=this;e.linkProgram(t)}deleteProgram(t){const{gl:e}=this;e.deleteProgram(t)}getShaderParameter(t,e){const{gl:s}=this;return s.getShaderParameter(t,e)}getShaderInfoLog(t){const{gl:e}=this;return e.getShaderInfoLog(t)}createProgram(){const{gl:t}=this;return t.createProgram()}getProgramParameter(t,e){const{gl:s}=this;return s.getProgramParameter(t,e)}getProgramInfoLog(t){const{gl:e}=this;return e.getProgramInfoLog(t)}shaderSource(t,e){const{gl:s}=this;s.shaderSource(t,e)}deleteShader(t){const{gl:e}=this;e.deleteShader(t)}}function Yr(r,t){return r.length!==t.length?!1:r.every((e,s)=>Array.isArray(e)||e instanceof Float32Array?!1:e===t[s])}const bt=class bt extends Ae{constructor(e,s){super(e);a(this,"props");this.props=bt.resolveDefaults(s||{})}get width(){return this.props.width}set width(e){this.props.width=e}get height(){return this.props.height}set height(e){this.props.height=e}async getTextureData(){return{data:null,premultiplyAlpha:null}}static resolveDefaults(e){return{width:e.width||256,height:e.height||256}}};a(bt,"z$__type__Props");let Xe=bt;class cs extends xt{constructor(e,s,i){super(e,s,i);a(this,"framebuffer");const n=e.createFramebuffer();M(n,"Unable to create framebuffer"),this.framebuffer=n}async onLoadRequest(){const{glw:e}=this,s=this._nativeCtxTexture=this.createNativeCtxTexture(),{width:i,height:n}=this.textureSource;return e.texImage2D(0,e.RGBA,i,n,0,e.RGBA,e.UNSIGNED_BYTE,null),this.setTextureMemUse(i*n*4),e.bindFramebuffer(this.framebuffer),e.framebufferTexture2D(e.COLOR_ATTACHMENT0,s,0),e.bindFramebuffer(null),{width:i,height:n}}}function qr(r){return/\.(ktx|pvr)$/.test(r)}const jr=async r=>{const e=await(await fetch(r)).arrayBuffer();return r.indexOf(".ktx")!==-1?Kr(e):Qr(e)},Kr=async r=>{const t=new DataView(r),e=t.getUint32(12)===16909060,s=[],i={glInternalFormat:t.getUint32(28,e),pixelWidth:t.getUint32(36,e),pixelHeight:t.getUint32(40,e),numberOfMipmapLevels:t.getUint32(56,e),bytesOfKeyValueData:t.getUint32(60,e)};let n=64;n+=i.bytesOfKeyValueData;for(let o=0;o<i.numberOfMipmapLevels;o++){const l=t.getUint32(n);n+=4,s.push(t.buffer.slice(n,l)),n+=l}return{data:{glInternalFormat:i.glInternalFormat,mipmaps:s,width:i.pixelWidth||0,height:i.pixelHeight||0,type:"ktx"},premultiplyAlpha:!1}},Qr=async r=>{const l=r,h=new Int32Array(l,0,13),c=h[12]+52,u=new Uint8Array(l,c),d=[],p={pixelWidth:h[7],pixelHeight:h[6],numberOfMipmapLevels:h[11]||0};let _=0,g=p.pixelWidth||0,T=p.pixelHeight||0;for(let R=0;R<p.numberOfMipmapLevels;R++){const b=(g+3>>2)*(T+3>>2)*8,m=new Uint8Array(l,u.byteOffset+_,b);d.push(m),_+=b,g=g>>1,T=T>>1}return{data:{glInternalFormat:36196,mipmaps:d,width:p.pixelWidth||0,height:p.pixelHeight||0,type:"pvr"},premultiplyAlpha:!1}},$e=class $e extends Ae{constructor(e,s){super(e);a(this,"props");this.props=$e.resolveDefaults(s)}hasAlphaChannel(e){return e.indexOf("image/png")!==-1}async getTextureData(){const{src:e,premultiplyAlpha:s}=this.props;if(!e)return{data:null};if(typeof e!="string")return e instanceof ImageData?{data:e,premultiplyAlpha:s}:{data:e(),premultiplyAlpha:s};if(qr(e))return jr(e);const i=vr(e);if(this.txManager.imageWorkerManager)return await this.txManager.imageWorkerManager.getImage(i,s);if(this.txManager.hasCreateImageBitmap){const o=await(await fetch(i)).blob(),l=s??this.hasAlphaChannel(o.type);return{data:await createImageBitmap(o,{premultiplyAlpha:l?"premultiply":"none",colorSpaceConversion:"none",imageOrientation:"none"}),premultiplyAlpha:l}}else{const n=new Image;return e.substr(0,5)!=="data:"&&(n.crossOrigin="Anonymous"),n.src=i,await new Promise((o,l)=>{n.onload=()=>o(),n.onerror=()=>l(new Error("Failed to load image"))}).catch(o=>{console.error(o)}),{data:n,premultiplyAlpha:s??!0}}}static makeCacheKey(e){const s=$e.resolveDefaults(e),i=s.key||s.src;return typeof i!="string"?!1:`ImageTexture,${i},${s.premultiplyAlpha??"true"}`}static resolveDefaults(e){return{src:e.src??"",premultiplyAlpha:e.premultiplyAlpha??!0,key:e.key??null}}};a($e,"z$__type__Props");let Tt=$e;const Zr=24;class Zt extends Bs{constructor(e){super(e);a(this,"glw");a(this,"system");a(this,"quadBuffer");a(this,"fQuadBuffer");a(this,"uiQuadBuffer");a(this,"renderOps",[]);a(this,"curBufferIdx",0);a(this,"curRenderOp",null);a(this,"rttNodes",[]);a(this,"activeRttNode",null);a(this,"defShaderCtrl");a(this,"defaultShader");a(this,"quadBufferCollection");a(this,"defaultTexture");a(this,"quadBufferUsage",0);a(this,"renderToTextureActive",!1);this.quadBuffer=new ArrayBuffer(this.stage.options.quadBufferSize),this.fQuadBuffer=new Float32Array(this.quadBuffer),this.uiQuadBuffer=new Uint32Array(this.quadBuffer),this.mode="webgl";const{canvas:s,clearColor:i,bufferMemory:n}=e;this.defaultTexture=new yt(this.txManager),this.defaultTexture.setRenderableOwner(this,!0),this.defaultTexture.once("loaded",()=>{this.stage.requestRender()});const o=cr(s,e.contextSpy),l=this.glw=new Vr(o),h=He(i);l.viewport(0,0,s.width,s.height),l.clearColor(h[0],h[1],h[2],h[3]),l.setBlend(!0),l.blendFunc(l.ONE,l.ONE_MINUS_SRC_ALPHA),Or(l,n),this.system={parameters:Fr(this.glw),extensions:Br(this.glw)},this.shManager.renderer=this,this.defShaderCtrl=this.shManager.loadShader("DefaultShader"),this.defaultShader=this.defShaderCtrl.shader;const c=l.createBuffer();M(c);const u=6*Float32Array.BYTES_PER_ELEMENT;this.quadBufferCollection=new Xs([{buffer:c,attributes:{a_position:{name:"a_position",size:2,type:l.FLOAT,normalized:!1,stride:u,offset:0},a_textureCoordinate:{name:"a_textureCoordinate",size:2,type:l.FLOAT,normalized:!1,stride:u,offset:2*Float32Array.BYTES_PER_ELEMENT},a_color:{name:"a_color",size:4,type:l.UNSIGNED_BYTE,normalized:!0,stride:u,offset:4*Float32Array.BYTES_PER_ELEMENT},a_textureIndex:{name:"a_textureIndex",size:1,type:l.FLOAT,normalized:!1,stride:u,offset:5*Float32Array.BYTES_PER_ELEMENT}}}])}reset(){const{glw:e}=this;this.curBufferIdx=0,this.curRenderOp=null,this.renderOps.length=0,e.setScissorTest(!1),e.clear()}getShaderManager(){return this.shManager}createCtxTexture(e){return e instanceof Ce?new Ur(this.glw,this.txMemManager,e):e instanceof Xe?new cs(this.glw,this.txMemManager,e):new xt(this.glw,this.txMemManager,e)}addQuad(e){const{fQuadBuffer:s,uiQuadBuffer:i}=this,{width:n,height:o,colorTl:l,colorTr:h,colorBl:c,colorBr:u,textureOptions:d,shader:p,shaderProps:_,alpha:g,clippingRect:T,tx:R,ty:b,ta:m,tb:x,tc:f,td:v,renderCoords:w,rtt:S,parentHasRenderTexture:A,framebufferDimensions:E}=e;let{texture:L}=e;if(_&&kt(_,"$dimensions")){const q=_.$dimensions;q.width=n,q.height=o}L=L??this.defaultTexture,M(L instanceof Ae,"Invalid texture type");let{curBufferIdx:y,curRenderOp:F}=this;const O={width:n,height:o},D=p||this.defaultShader;M(D instanceof ce),this.reuseRenderOp(e)||(this.newRenderOp(D,_,g,O,T,y,S,A,E),F=this.curRenderOp,M(F));const I=(d==null?void 0:d.flipX)??!1;let P=(d==null?void 0:d.flipY)??!1;L instanceof Xe&&(P=!P);let B=0,k=0,z=1,N=1;if(L instanceof Ce){const{x:q,y:j,width:V,height:H}=L.props,{width:U=0,height:Z=0}=L.parentTexture.dimensions||{width:0,height:0};B=q/U,z=B+V/U,k=j/Z,N=k+H/Z,L=L.parentTexture}const te=(d==null?void 0:d.resizeMode)??!1;if(L instanceof Tt&&te&&L.dimensions){const{width:q,height:j}=L.dimensions;if(te.type==="cover"){const V=n/q,H=o/j,U=Math.max(V,H),Z=1/U;if(U&&V&&V<U){const J=Z*n;B=(1-J/q)*(te.clipX??.5),z=B+J/q}if(U&&H&&H<U){const J=Z*o;k=(1-J/j)*(te.clipY??.5),N=k+J/j}}}I&&([B,z]=[z,B]),P&&([k,N]=[N,k]);const se=L.ctxTexture;M(se instanceof xt);const Q=this.addTexture(se,y);if(F=this.curRenderOp,M(F),w){const{x1:q,y1:j,x2:V,y2:H,x3:U,y3:Z,x4:J,y4:re}=w;s[y++]=q,s[y++]=j,s[y++]=B,s[y++]=k,i[y++]=l,s[y++]=Q,s[y++]=V,s[y++]=H,s[y++]=z,s[y++]=k,i[y++]=h,s[y++]=Q,s[y++]=J,s[y++]=re,s[y++]=B,s[y++]=N,i[y++]=c,s[y++]=Q,s[y++]=U,s[y++]=Z,s[y++]=z,s[y++]=N,i[y++]=u,s[y++]=Q}else if(x!==0||f!==0)s[y++]=R,s[y++]=b,s[y++]=B,s[y++]=k,i[y++]=l,s[y++]=Q,s[y++]=R+n*m,s[y++]=b+n*f,s[y++]=z,s[y++]=k,i[y++]=h,s[y++]=Q,s[y++]=R+o*x,s[y++]=b+o*v,s[y++]=B,s[y++]=N,i[y++]=c,s[y++]=Q,s[y++]=R+n*m+o*x,s[y++]=b+n*f+o*v,s[y++]=z,s[y++]=N,i[y++]=u,s[y++]=Q;else{const q=R+n*m,j=b+o*v;s[y++]=R,s[y++]=b,s[y++]=B,s[y++]=k,i[y++]=l,s[y++]=Q,s[y++]=q,s[y++]=b,s[y++]=z,s[y++]=k,i[y++]=h,s[y++]=Q,s[y++]=R,s[y++]=j,s[y++]=B,s[y++]=N,i[y++]=c,s[y++]=Q,s[y++]=q,s[y++]=j,s[y++]=z,s[y++]=N,i[y++]=u,s[y++]=Q}F.length+=Zr,F.numQuads++,this.curBufferIdx=y}newRenderOp(e,s,i,n,o,l,h,c,u){const d=new Ds(this.glw,this.options,this.quadBufferCollection,e,s,i,o,n,l,0,h,c,u);this.curRenderOp=d,this.renderOps.push(d)}addTexture(e,s,i){const{curRenderOp:n}=this;M(n);const o=n.addTexture(e);if(o===4294967295){if(i)throw new Error("Unable to add texture to render op");const{shader:l,shaderProps:h,dimensions:c,clippingRect:u,alpha:d}=n;return this.newRenderOp(l,h,d,c,u,s),this.addTexture(e,s,!0)}return o}reuseRenderOp(e){var c;const{shader:s,shaderProps:i,parentHasRenderTexture:n,rtt:o,clippingRect:l}=e,h=s||this.defaultShader;return!(((c=this.curRenderOp)==null?void 0:c.shader)!==h||!Tr(this.curRenderOp.clippingRect,l)||n||o||this.curRenderOp.shader!==this.defaultShader&&(!i||!this.curRenderOp.shader.canBatchShaderProps(this.curRenderOp.shaderProps,i)))}addRenderOp(e){this.renderOps.push(e),this.curRenderOp=null}render(e="screen"){const{glw:s,quadBuffer:i}=this,n=new Float32Array(i,0,this.curBufferIdx),o=this.quadBufferCollection.getBuffer("a_position")??null;s.arrayBufferData(o,n,s.STATIC_DRAW),this.renderOps.forEach((l,h)=>{l.draw()}),this.quadBufferUsage=this.curBufferIdx*n.BYTES_PER_ELEMENT}renderToTexture(e){for(let s=0;s<this.rttNodes.length;s++)if(this.rttNodes[s]===e)return;this.rttNodes.unshift(e)}renderRTTNodes(){const{glw:e}=this;this.stage;for(let s=0;s<this.rttNodes.length;s++){const i=this.rttNodes[s];if(!i||!i.hasRTTupdates)continue;this.activeRttNode=i,M(i.texture,"RTT node missing texture");const n=i.texture.ctxTexture;M(n instanceof cs),this.renderToTextureActive=!0,e.bindFramebuffer(n.framebuffer),e.viewport(0,0,n.w,n.h),e.clear();for(let o=0;o<i.children.length;o++){const l=i.children[o];l&&(l.update(this.stage.deltaTime,{x:0,y:0,width:0,height:0,valid:!1}),this.stage.addQuads(l),l.hasRTTupdates=!1)}this.render(),this.renderOps.length=0,i.hasRTTupdates=!1}e.bindFramebuffer(null),e.viewport(0,0,this.glw.canvas.width,this.glw.canvas.height),this.renderToTextureActive=!1}removeRTTNode(e){const s=this.rttNodes.indexOf(e);s!==-1&&this.rttNodes.splice(s,1)}getBufferInfo(){return{totalAvailable:this.stage.options.quadBufferSize,totalUsed:this.quadBufferUsage}}getDefShaderCtr(){return this.defShaderCtrl}}class Jr{constructor(){a(this,"activeAnimations",new Set)}registerAnimation(t){this.activeAnimations.add(t)}unregisterAnimation(t){this.activeAnimations.delete(t)}update(t){this.activeAnimations.forEach(e=>{e.update(t)})}}function ei(){function r(e){return e.indexOf("image/png")!==-1}function t(e,s){return new Promise(function(i,n){var o=new XMLHttpRequest;o.open("GET",e,!0),o.responseType="blob",o.onload=function(){if(o.status!==200)return n(new Error("Failed to load image: "+o.statusText));var l=o.response,h=s!==void 0?s:r(l.type);createImageBitmap(l,{premultiplyAlpha:h?"premultiply":"none",colorSpaceConversion:"none",imageOrientation:"none"}).then(function(c){i({data:c,premultiplyAlpha:s})}).catch(function(c){n(c)})},o.onerror=function(){n(new Error("Network error occurred while trying to fetch the image."))},o.send()})}self.onmessage=e=>{var s=e.data.src,i=e.data.id,n=e.data.premultiplyAlpha;t(s,n).then(function(o){self.postMessage({id:i,src:s,data:o})}).catch(function(o){self.postMessage({id:i,src:s,error:o.message})})}}class ti{constructor(t){a(this,"imageWorkersEnabled",!0);a(this,"messageManager",{});a(this,"workers",[]);a(this,"workerIndex",0);a(this,"nextId",0);this.workers=this.createWorkers(t),this.workers.forEach(e=>{e.onmessage=this.handleMessage.bind(this)})}handleMessage(t){const{id:e,data:s,error:i}=t.data,n=this.messageManager[e];if(n){const[o,l]=n;delete this.messageManager[e],i?l(new Error(i)):o(s)}}createWorkers(t=1){const e=`(${ei.toString()})()`,s=new Blob([e.replace('"use strict";',"")],{type:"application/javascript"}),i=(self.URL?URL:webkitURL).createObjectURL(s),n=[];for(let o=0;o<t;o++)n.push(new Worker(i));return n}getNextWorker(){const t=this.workers[this.workerIndex];return this.workerIndex=(this.workerIndex+1)%this.workers.length,t}getImage(t,e){return new Promise((s,i)=>{try{if(this.workers){const n=this.nextId++;this.messageManager[n]=[s,i];const o=this.getNextWorker();o&&o.postMessage({id:n,src:t,premultiplyAlpha:e})}}catch(n){i(n)}})}}const ze=class ze extends Ae{constructor(e,s){super(e);a(this,"props");this.props=ze.resolveDefaults(s)}async getTextureData(){const{width:e,height:s}=this.props,i=e*s*4,n=new Uint8ClampedArray(i);for(let o=0;o<i;o+=4){const l=Math.floor(Math.random()*256);n[o]=l,n[o+1]=l,n[o+2]=l,n[o+3]=255}return{data:new ImageData(n,e,s)}}static makeCacheKey(e){if(e.cacheId===void 0)return!1;const s=ze.resolveDefaults(e);return`NoiseTexture,${s.width},${s.height},${s.cacheId}`}static resolveDefaults(e){return{width:e.width??128,height:e.height??128,cacheId:e.cacheId??0}}};a(ze,"z$__type__Props");let Vt=ze;class si{constructor(t){a(this,"keyCache",new Map);a(this,"inverseKeyCache",new WeakMap);a(this,"txConstructors",{});a(this,"imageWorkerManager",null);a(this,"hasCreateImageBitmap",!!self.createImageBitmap);a(this,"hasWorker",!!self.Worker);a(this,"renderer");a(this,"frameTime",0);this.hasCreateImageBitmap&&this.hasWorker&&t>0&&(this.imageWorkerManager=new ti(t)),this.hasCreateImageBitmap||console.warn("[Lightning] createImageBitmap is not supported on this browser. ImageTexture will be slower."),this.registerTextureType("ImageTexture",Tt),this.registerTextureType("ColorTexture",yt),this.registerTextureType("NoiseTexture",Vt),this.registerTextureType("SubTexture",Ce),this.registerTextureType("RenderTexture",Xe)}registerTextureType(t,e){this.txConstructors[t]=e}loadTexture(t,e){let s;const i=this.txConstructors[t];if(!i)throw new Error(`Texture type "${t}" is not registered`);if(!s){const n=i.makeCacheKey(e);n&&this.keyCache.has(n)?s=this.keyCache.get(n):(s=new i(this,e),n&&this.initTextureToCache(s,n))}return s}initTextureToCache(t,e){const{keyCache:s,inverseKeyCache:i}=this;s.set(e,t),i.set(t,e)}removeTextureFromCache(t){const{inverseKeyCache:e,keyCache:s}=this,i=e.get(t);i&&s.delete(i)}}function ri(r,t){var e=0,s,i;t=t||{};function n(){var o=s,l=arguments.length,h,c;e:for(;o;){if(o.args.length!==arguments.length){o=o.next;continue}for(c=0;c<l;c++)if(o.args[c]!==arguments[c]){o=o.next;continue e}return o!==s&&(o===i&&(i=o.prev),o.prev.next=o.next,o.next&&(o.next.prev=o.prev),o.next=s,o.prev=null,s.prev=o,s=o),o.val}for(h=new Array(l),c=0;c<l;c++)h[c]=arguments[c];return o={args:h,val:r.apply(null,h)},s?(s.prev=o,o.next=s):i=o,e===t.maxSize?(i=i.prev,i.next=null):e++,s=o,o.val}return n.clear=function(){s=null,i=null,e=0},n}const ii={normal:400,bold:700,bolder:900,lighter:100},us=r=>typeof r=="number"?r:ii[r]||400;function ni(r,t,e,s,i){let n=us(e);for(const o of r){const l=o[t];if(!l)continue;if(l.size===1)return console.warn(`TrFontManager: Only one font face found for family: '${t}' - will be used for all weights and styles`),l.values().next().value;const h=new Map;for(const u of l){const d=us(u.descriptors.weight);if(d===n&&u.descriptors.style===s&&u.descriptors.stretch===i)return u;h.set(d,u)}const c=`TrFontManager: No exact match: '${t} Weight: ${n} Style: ${s} Stretch: ${i}'`;if(console.error(c),n===400&&h.has(500))return h.get(500);if(n===500&&h.has(400))return h.get(400);if(n<400){for(;n>0;){if(h.has(n))return h.get(n);n-=100}n=600}for(;n<1e3;){if(h.has(n))return h.get(n);n+=100}for(n=500;n>0;){if(h.has(n))return h.get(n);n-=100}}}const oi=ri(ni);class Jt{constructor(t){a(this,"textRenderers");this.textRenderers=t}addFontFace(t){for(const e in this.textRenderers){const s=this.textRenderers[e];s&&s.isFontFaceSupported(t)&&s.addFontFace(t)}}static resolveFontFace(t,e){const{fontFamily:s,fontWeight:i,fontStyle:n,fontStretch:o}=e;return oi(t,s,i,n,o)}}const ai={x:(r,t)=>{r.props.x=t},y:(r,t)=>{r.props.y=t},width:(r,t)=>{r.props.width=t},height:(r,t)=>{r.props.height=t},color:(r,t)=>{r.props.color=t},zIndex:(r,t)=>{r.props.zIndex=t},fontFamily:(r,t)=>{r.props.fontFamily=t},fontWeight:(r,t)=>{r.props.fontWeight=t},fontStyle:(r,t)=>{r.props.fontStyle=t},fontStretch:(r,t)=>{r.props.fontStretch=t},fontSize:(r,t)=>{r.props.fontSize=t},text:(r,t)=>{r.props.text=t},textAlign:(r,t)=>{r.props.textAlign=t},contain:(r,t)=>{r.props.contain=t},offsetY:(r,t)=>{r.props.offsetY=t},scrollable:(r,t)=>{r.props.scrollable=t},scrollY:(r,t)=>{r.props.scrollY=t},letterSpacing:(r,t)=>{r.props.letterSpacing=t},lineHeight:(r,t)=>{r.props.lineHeight=t},maxLines:(r,t)=>{r.props.maxLines=t},textBaseline:(r,t)=>{r.props.textBaseline=t},verticalAlign:(r,t)=>{r.props.verticalAlign=t},overflowSuffix:(r,t)=>{r.props.overflowSuffix=t},debug:(r,t)=>{r.props.debug=t}};class Gs{constructor(t){a(this,"stage");a(this,"set");this.stage=t;const e={...ai,...this.getPropertySetters()};this.set=Object.freeze(Object.fromEntries(Object.entries(e).map(([s,i])=>[s,(n,o)=>{n.props[s]!==o&&(i(n,o),this.stage.requestRender())}])))}setStatus(t,e,s){t.status!==e&&(t.status=e,t.emitter.emit(e,s))}setIsRenderable(t,e){t.isRenderable=e}destroyState(t){this.setStatus(t,"destroyed"),t.emitter.removeAllListeners()}scheduleUpdateState(t){t.updateScheduled||(t.updateScheduled=!0,queueMicrotask(()=>{t.status!=="destroyed"&&(t.updateScheduled=!1,this.updateState(t))}))}}class Ws extends he{constructor(e){super();a(this,"fontFamily");a(this,"descriptors");a(this,"loaded",!1);a(this,"metrics",null);const{fontFamily:s,descriptors:i,metrics:n}=e;n&&(this.metrics={ascender:n.ascender/n.unitsPerEm,descender:n.descender/n.unitsPerEm,lineGap:n.lineGap/n.unitsPerEm}),this.fontFamily=s,this.descriptors={style:"normal",weight:"normal",stretch:"normal",...i}}static convertToCssFontFaceDescriptors(e){return{style:e.style,weight:typeof e.weight=="number"?`${e.weight}`:e.weight,stretch:e.stretch,unicodeRange:e.unicodeRange,featureSettings:e.featureSettings,display:e.display}}}const li={LINE_FEED:10,CARRIAGE_RETURN:13,SPACE:32,TAB:9,ZERO_WIDTH_SPACE:8203,ZERO_WIDTH_NON_JOINER:8204,ZERO_WIDTH_JOINER:8205,LEFT_TO_RIGHT_MARK:8206,RIGHT_TO_LEFT_MARK:8207,LEFT_TO_RIGHT_EMBEDDING:8234,RIGHT_TO_LEFT_EMBEDDING:8235,POP_DIRECTIONAL_FORMATTING:8236,LEFT_TO_RIGHT_OVERRIDE:8237,RIGHT_TO_LEFT_OVERRIDE:8238,LINE_SEPARATOR:8232,PARAGRAPH_SEPARATOR:8233,OBJECT_REPLACEMENT_CHARACTER:65532,REPLACEMENT_CHARACTER:65533,ZERO_WIDTH_NO_BREAK_SPACE:65279,LEFT_TO_RIGHT_ISOLATE:8294,RIGHT_TO_LEFT_ISOLATE:8295,FIRST_STRONG_ISOLATE:8296,POP_DIRECTIONAL_ISOLATE:8297,INHIBIT_SYMMETRIC_SWAPPING:8298,ACTIVATE_SYMMETRIC_SWAPPING:8299,INHIBIT_ARABIC_FORM_SHAPING:8300,ACTIVATE_ARABIC_FORM_SHAPING:8301,NATIONAL_DIGIT_SHAPES:8302,NOMINAL_DIGIT_SHAPES:8303,LEFT_TO_RIGHT_BOUNDARY:8206,RIGHT_TO_LEFT_BOUNDARY:8207};class hi{}class ci extends hi{constructor(e,s){super();a(this,"data");a(this,"glyphMap");a(this,"kernings");this.data=e,this.glyphMap=s;const i=this.kernings={};e.kernings.forEach(n=>{const o=n.second,l=i[o]=i[o]||{};l[n.first]=n.amount}),this.kernings=i}*shapeText(e,s){var o;let i,n;for(;(i=s.peek())&&!i.done;){const l=i.value,h=this.glyphMap.get(l);if(s.next(),h!==void 0){const c=n!==void 0?(((o=this.kernings[h.id])==null?void 0:o[n])||0)+e.letterSpacing:0;n=h.id,yield{mapped:!0,glyphId:h.id,codepoint:l,cluster:s.lastIndex,xAdvance:h.xadvance+c,yAdvance:0,xOffset:h.xoffset+c,yOffset:h.yoffset,xBearing:0,yBearing:0,width:h.width,height:h.height}}else l===li.LINE_FEED&&(n=void 0),yield{mapped:!1,codepoint:l,cluster:s.lastIndex}}}}class ds extends Ws{constructor(e,s){super(s);a(this,"type");a(this,"texture");a(this,"maxCharHeight",0);a(this,"data");a(this,"shaper");a(this,"glyphMap",new Map);const{atlasUrl:i,atlasDataUrl:n,stage:o}=s;this.type=e;const l=o.renderer;M(l instanceof Zt,"SDF Font Faces can only be used with the WebGL Renderer"),this.texture=o.txManager.loadTexture("ImageTexture",{src:i,premultiplyAlpha:!1}),this.texture.on("loaded",()=>{this.checkLoaded(),o.requestRender()}),this.texture.ctxTexture.load(),fetch(n).then(async h=>{var u;this.data=await h.json(),M(this.data);let c=0;if(this.data.chars.forEach(d=>{this.glyphMap.set(d.id,d);const p=d.yoffset+d.height;p>c&&(c=p)}),this.maxCharHeight=c,this.shaper=new ci(this.data,this.glyphMap),!this.metrics)if((u=this.data)!=null&&u.lightningMetrics){const{ascender:d,descender:p,lineGap:_,unitsPerEm:g}=this.data.lightningMetrics;this.metrics={ascender:d/g,descender:p/g,lineGap:_/g}}else throw new Error(`Font metrics not found in ${this.type} font ${this.fontFamily}. Make sure you are using the latest version of the Lightning 3 \`msdf-generator\` tool to generate your SDF fonts.`);this.checkLoaded()}).catch(console.error)}getAtlasEntry(e){const s=this.glyphMap.get(e);if(s===void 0)throw new Error(`Glyph ${e} not found in font ${this.fontFamily}`);return{x:s.x,y:s.y,width:s.width,height:s.height}}checkLoaded(){this.loaded||this.texture.state==="loaded"&&this.data&&(this.loaded=!0,this.emit("loaded"))}}const ui=24;function di(r,t,e,s,i,n,o,l,h){const c=Math.min(Math.max(o.firstLineIdx,0),l.length),u=0,{metrics:d}=e;M(d,"Font metrics not loaded"),M(e.data,"Font data not loaded");const p=(d.ascender-d.descender)*r;let _=0;s==="middle"?_=(t-p)/2:s==="bottom"&&(_=t-p);const g=i/n,T=e.data.common.base,b=d.ascender*r-T,m=g+b+c*t+_;if(!(h&&m>=h/n))return{sdfX:u,sdfY:m,lineIndex:c}}class De{constructor(t,e=0){a(this,"iterator");a(this,"peekBuffer",[]);a(this,"_lastIndex");this.iterator=t,this.iterator=t,this._lastIndex=e-1,this.peekBuffer=[]}next(){const t=this.peekBuffer.length>0?this.peekBuffer.pop():this.iterator.next();return t.done?this._lastIndex=-1:this._lastIndex++,t}peek(){if(this.peekBuffer.length>0)return this.peekBuffer[0];const t=this.iterator.next();return this.peekBuffer.push(t),t}get lastIndex(){return this._lastIndex}}function*Ue(r,t=0){let e=t;for(;e<r.length;){const s=r.codePointAt(e);if(s===void 0)throw new Error("Invalid Unicode code point");yield s,e+=s<=65535?1:2}}function fi(r,t,e){const s=e.shapeText(t,new De(Ue(r,0),0));let i=0;for(const n of s)n.mapped&&(i+=n.xAdvance);return i}function pi(r,t,e,s,i,n,o,l,h,c,u,d,p,_,g,T,R,b,m){M(g,"Font face must be loaded"),M(g.loaded,"Font face must be loaded"),M(g.data,"Font face must be loaded"),M(g.shaper,"Font face must be loaded");const x=l/g.data.info.size,f=h/x,v=n/x,w=c/x,S=p[r],A=(S==null?void 0:S.codepointIndex)||0,E=(S==null?void 0:S.maxX)||0,L=(S==null?void 0:S.maxY)||0;let y=E,F=L,O=t,D=e,I=0;const P={codepointIndex:-1,bufferOffset:-1,xStart:-1},B=g.shaper,k={letterSpacing:w};let z=B.shapeText(k,new De(Ue(s,A),A)),N,te=-1;const se=[],Q=o/x,q=fi(b,k,B);let j=!0;for(;j;){const V=(m===0||r+1<m)&&(d!=="both"||R||D+f+g.maxCharHeight<=Q),H=V?v:v-q;let U=0;const Z=D+g.maxCharHeight>=_.y1,J=D<=_.y2,re=Z&&J;for(;(N=z.next())&&!N.done;){const G=N.value;if(r===p.length)p.push({codepointIndex:G.cluster,maxY:F,maxX:y});else if(r>p.length)throw new Error("Unexpected lineCache length");if(G.codepoint===32||G.codepoint===10?P.codepointIndex!==-1&&(P.codepointIndex=-1,U=O):P.codepointIndex===-1&&(P.codepointIndex=G.cluster,P.bufferOffset=I,P.xStart=U),G.mapped){const or=O+G.xOffset+G.width;if(d!=="none"&&or>=H&&P.codepointIndex!==-1&&P.xStart>0)if(V){z=B.shapeText(k,new De(Ue(s,P.codepointIndex),P.codepointIndex)),I=P.bufferOffset;break}else z=B.shapeText(k,new De(Ue(b,0),0)),O=P.xStart,I=P.bufferOffset,d="none";else{const Ie=O+G.xOffset,Le=D+G.yOffset;if(re){te===-1&&(te=I);const qe=g.getAtlasEntry(G.glyphId),je=qe.x/g.data.common.scaleW,Ke=qe.y/g.data.common.scaleH,ss=qe.width/g.data.common.scaleW,rs=qe.height/g.data.common.scaleH;u[I++]=Ie,u[I++]=Le,u[I++]=je,u[I++]=Ke,u[I++]=Ie+G.width,u[I++]=Le,u[I++]=je+ss,u[I++]=Ke,u[I++]=Ie,u[I++]=Le+G.height,u[I++]=je,u[I++]=Ke+rs,u[I++]=Ie+G.width,u[I++]=Le+G.height,u[I++]=je+ss,u[I++]=Ke+rs}F=Math.max(F,Le+G.height),y=Math.max(y,Ie+G.width),O+=G.xAdvance}}else if(G.codepoint===10){if(V)break;z=B.shapeText(k,new De(Ue(b,0),0)),d="none"}}te!==-1&&(se.push({bufferStart:te,bufferEnd:I}),te=-1),O=0,D+=f,r++,P.codepointIndex=-1,U=0,!T&&d==="both"&&D>_.y2||N&&N.done?j=!1:V||(j=!1)}if(i==="center"){const V=d==="none"?y:v;for(let H=0;H<se.length;H++){const U=se[H],Z=u[U.bufferEnd-4]-u[U.bufferStart],J=(V-Z)/2;for(let re=U.bufferStart;re<U.bufferEnd;re+=4)u[re]+=J}}else if(i==="right"){const V=d==="none"?y:v;for(let H=0;H<se.length;H++){const U=se[H],Z=U.bufferEnd===U.bufferStart?0:u[U.bufferEnd-4]-u[U.bufferStart],J=V-Z;for(let re=U.bufferStart;re<U.bufferEnd;re+=4)u[re]+=J}}return M(N),{bufferNumFloats:I,bufferNumQuads:I/16,layoutNumCharacters:N.done?s.length-A:N.value.cluster-A+1,fullyProcessed:!!N.done,maxX:y,maxY:F,numLines:p.length}}function gi(r,t){return Math.ceil(r/t)*t}function mi(r,t){return Math.floor(r/t)*t}function xi(r,t,e,s,i,n,o,l){const{screen:h,sdf:c}=r;if(!_r(o))h.x1=0,h.y1=0,h.x2=0,h.y2=0,c.x1=0,c.y1=0,c.x2=0,c.y2=0,r.numLines=0,r.firstLineIdx=0;else{const u=o.x1-t,d=u+(o.x2-o.x1),p=o.y1-e+s,_=mi(p-n,i||1),g=gi(p+(o.y2-o.y1)+n,i||1);h.x1=u,h.y1=_,h.x2=d,h.y2=g,c.x1=u/l,c.y1=_/l,c.x2=d/l,c.y2=g/l,r.numLines=Math.ceil((g-_)/i),r.firstLineIdx=i?Math.floor(_/i):0}r.valid=!0}function Hs(r,t){return t*(r.ascender-r.descender+r.lineGap)}const yi={x:0,y:0,width:0,height:0};class Ti extends Gs{constructor(e){super(e);a(this,"ssdfFontFamilies",{});a(this,"msdfFontFamilies",{});a(this,"fontFamilyArray",[this.ssdfFontFamilies,this.msdfFontFamilies]);a(this,"sdfShader");a(this,"rendererBounds");this.sdfShader=this.stage.shManager.loadShader("SdfShader").shader,this.rendererBounds={x1:0,y1:0,x2:this.stage.options.appWidth,y2:this.stage.options.appHeight}}getPropertySetters(){return{fontFamily:(e,s)=>{e.props.fontFamily=s,this.releaseFontFace(e),this.invalidateLayoutCache(e)},fontWeight:(e,s)=>{e.props.fontWeight=s,this.releaseFontFace(e),this.invalidateLayoutCache(e)},fontStyle:(e,s)=>{e.props.fontStyle=s,this.releaseFontFace(e),this.invalidateLayoutCache(e)},fontStretch:(e,s)=>{e.props.fontStretch=s,this.releaseFontFace(e),this.invalidateLayoutCache(e)},fontSize:(e,s)=>{e.props.fontSize=s,this.invalidateLayoutCache(e)},text:(e,s)=>{e.props.text=s,this.invalidateLayoutCache(e)},textAlign:(e,s)=>{e.props.textAlign=s,this.invalidateLayoutCache(e)},color:(e,s)=>{e.props.color=s},x:(e,s)=>{e.props.x=s,e.elementBounds.valid&&(this.setElementBoundsX(e),!e.renderWindow.valid&&It(e.elementBounds,this.rendererBounds)&&this.scheduleUpdateState(e))},y:(e,s)=>{e.props.y=s,e.elementBounds.valid&&(this.setElementBoundsY(e),!e.renderWindow.valid&&It(e.elementBounds,this.rendererBounds)&&this.scheduleUpdateState(e))},contain:(e,s)=>{e.props.contain=s,this.invalidateLayoutCache(e)},width:(e,s)=>{e.props.width=s,e.props.contain!=="none"&&this.invalidateLayoutCache(e)},height:(e,s)=>{e.props.height=s,e.props.contain==="both"&&this.invalidateLayoutCache(e)},offsetY:(e,s)=>{e.props.offsetY=s,this.invalidateLayoutCache(e)},scrollable:(e,s)=>{e.props.scrollable=s,this.invalidateLayoutCache(e)},scrollY:(e,s)=>{e.props.scrollY=s,this.scheduleUpdateState(e)},letterSpacing:(e,s)=>{e.props.letterSpacing=s,this.invalidateLayoutCache(e)},lineHeight:(e,s)=>{e.props.lineHeight=s,e.resLineHeight=void 0,this.invalidateLayoutCache(e)},maxLines:(e,s)=>{e.props.maxLines=s,this.invalidateLayoutCache(e)},textBaseline:(e,s)=>{e.props.textBaseline=s,this.invalidateLayoutCache(e)},verticalAlign:(e,s)=>{e.props.verticalAlign=s,this.invalidateLayoutCache(e)},overflowSuffix:(e,s)=>{e.props.overflowSuffix=s,this.invalidateLayoutCache(e)},debug:(e,s)=>{e.props.debug=s}}}canRenderFont(e){const{fontFamily:s}=e;return s in this.ssdfFontFamilies||s in this.msdfFontFamilies||s==="$$SDF_FAILURE_TEST$$"}isFontFaceSupported(e){return e instanceof ds}addFontFace(e){M(e instanceof ds);const s=e.fontFamily,i=e.type==="ssdf"?this.ssdfFontFamilies:e.type==="msdf"?this.msdfFontFamilies:void 0;if(!i){console.warn(`Invalid font face type: ${e.type}`);return}let n=i[s];n||(n=new Set,i[s]=n),n.add(e)}createState(e){return{props:e,status:"initialState",updateScheduled:!1,emitter:new he,lineCache:[],forceFullLayoutCalc:!1,renderWindow:{screen:{x1:0,y1:0,x2:0,y2:0},sdf:{x1:0,y1:0,x2:0,y2:0},firstLineIdx:0,numLines:0,valid:!1},elementBounds:{x1:0,y1:0,x2:0,y2:0,valid:!1},clippingRect:{x:0,y:0,width:0,height:0,valid:!1},bufferNumFloats:0,bufferNumQuads:0,vertexBuffer:void 0,webGlBuffers:null,bufferUploaded:!1,textH:void 0,textW:void 0,distanceRange:0,trFontFace:void 0,isRenderable:!1,resLineHeight:void 0,debugData:{updateCount:0,layoutCount:0,lastLayoutNumCharacters:0,layoutSum:0,drawSum:0,drawCount:0,bufferSize:0}}}updateState(e){let{trFontFace:s}=e;const{textH:i,lineCache:n,debugData:o,forceFullLayoutCalc:l}=e;if(o.updateCount++,e.status==="initialState"&&this.setStatus(e,"loading"),!s){if(s=this.resolveFontFace(e.props),e.trFontFace=s,!s){const B=`SdfTextRenderer: Could not resolve font face for family: '${e.props.fontFamily}'`;console.error(B),this.setStatus(e,"failed",new Error(B));return}s.texture.setRenderableOwner(e,!0)}if(!s.loaded){s.once("loaded",()=>{this.scheduleUpdateState(e)});return}M(s.data,"Font face data should be loaded"),M(s.metrics,"Font face metrics should be loaded");const{text:h,fontSize:c,x:u,y:d,contain:p,width:_,height:g,verticalAlign:T,scrollable:R,overflowSuffix:b,maxLines:m}=e.props,x=p==="both"&&R?e.props.scrollY:0,{renderWindow:f}=e,v=s.data.info.size,w=c/v;let S=e.resLineHeight;if(S===void 0){const B=e.props.lineHeight;B===void 0?S=Hs(s.metrics,c):S=B,e.resLineHeight=S}const A=S/w;e.distanceRange=w*s.data.distanceField.distanceRange;const E=h.length*ui;let L=e.vertexBuffer;(!L||L.length<E)&&(L=new Float32Array(E*2));const y=e.elementBounds;if(y.valid||(this.setElementBoundsX(e),this.setElementBoundsY(e),y.valid=!0),!l&&f.valid){const B=f.screen;if(u+B.x1<=y.x1&&u+B.x2>=y.x2&&d-x+B.y1<=y.y1&&d-x+B.y2>=y.y2){this.setStatus(e,"loaded");return}f.valid=!1,this.setStatus(e,"loading")}const{offsetY:F,textAlign:O}=e.props;if(!f.valid){if(!It(y,this.rendererBounds))return;xi(f,u,d,x,S,p==="both"?y.y2-y.y1:0,y,w)}const D=di(v,A,s,T,F,w,f,n,i);if(!D){this.setStatus(e,"loaded");return}const{letterSpacing:I}=e.props,P=pi(D.lineIndex,D.sdfX,D.sdfY,h,O,_,g,c,S,I,L,p,n,f.sdf,s,l,R,b,m);e.bufferUploaded=!1,e.bufferNumFloats=P.bufferNumFloats,e.bufferNumQuads=P.bufferNumQuads,e.vertexBuffer=L,e.renderWindow=f,o.lastLayoutNumCharacters=P.layoutNumCharacters,o.bufferSize=L.byteLength,P.fullyProcessed&&(e.textW=P.maxX*w,e.textH=P.numLines*A*w),this.setStatus(e,"loaded")}renderQuads(e,s,i,n,o,l){var y,F;if(!e.vertexBuffer)return;const h=this.stage.renderer;M(h instanceof Zt);const{fontSize:c,color:u,contain:d,scrollable:p,zIndex:_,debug:g}=e.props,T=d==="both"&&p?e.props.scrollY:0,{textW:R=0,textH:b=0,distanceRange:m,vertexBuffer:x,bufferUploaded:f,trFontFace:v,elementBounds:w}=e;let{webGlBuffers:S}=e;if(!S){const O=h.glw,D=4*Float32Array.BYTES_PER_ELEMENT,I=O.createBuffer();M(I),e.webGlBuffers=new Xs([{buffer:I,attributes:{a_position:{name:"a_position",size:2,type:O.FLOAT,normalized:!1,stride:D,offset:0},a_textureCoordinate:{name:"a_textureCoordinate",size:2,type:O.FLOAT,normalized:!1,stride:D,offset:2*Float32Array.BYTES_PER_ELEMENT}}}]),e.bufferUploaded=!1,M(e.webGlBuffers),S=e.webGlBuffers}if(!f){const O=h.glw,D=(S==null?void 0:S.getBuffer("a_textureCoordinate"))??null;O.arrayBufferData(D,x,O.STATIC_DRAW),e.bufferUploaded=!0}if(M(v),p&&d==="both"){M(w.valid);const O=yr(w,yi);i.valid?(e.clippingRect.valid=!0,i=Ms(i,O,e.clippingRect)):(e.clippingRect.valid=!0,i=Is(O,e.clippingRect))}const A=new Ds(h.glw,h.options,S,this.sdfShader,{transform:s.getFloatArr(),color:ur(u,n),size:c/(((y=v.data)==null?void 0:y.info.size)||0),scrollY:T,distanceRange:m,debug:g.sdfShaderDebug},n,i,{height:b,width:R},0,_,!1,o,l),E=(F=e.trFontFace)==null?void 0:F.texture;M(E);const L=E.ctxTexture;A.addTexture(L),A.length=e.bufferNumFloats,A.numQuads=e.bufferNumQuads,h.addRenderOp(A)}setIsRenderable(e,s){var i;super.setIsRenderable(e,s),(i=e.trFontFace)==null||i.texture.setRenderableOwner(e,s)}destroyState(e){var s;super.destroyState(e),(s=e.trFontFace)==null||s.texture.setRenderableOwner(e,!1)}resolveFontFace(e){return Jt.resolveFontFace(this.fontFamilyArray,e)}releaseFontFace(e){e.resLineHeight=void 0,e.trFontFace&&(e.trFontFace.texture.setRenderableOwner(e,!1),e.trFontFace=void 0)}invalidateLayoutCache(e){e.renderWindow.valid=!1,e.elementBounds.valid=!1,e.textH=void 0,e.textW=void 0,e.lineCache=[],this.setStatus(e,"loading"),this.scheduleUpdateState(e)}setElementBoundsX(e){const{x:s,contain:i,width:n}=e.props,{elementBounds:o}=e;o.x1=s,o.x2=i!=="none"?s+n:1/0}setElementBoundsY(e){const{y:s,contain:i,height:n}=e.props,{elementBounds:o}=e;o.y1=s,o.y2=i==="both"?s+n:1/0}}class Ft extends Ws{constructor(e){super(e);a(this,"fontFace");a(this,"fontUrl");const{fontFamily:s,fontUrl:i}=e,n=i.replace(/\(|\)/g,""),o=this.descriptors,l={style:o.style,weight:typeof o.weight=="number"?`${o.weight}`:o.weight,stretch:o.stretch,unicodeRange:o.unicodeRange,featureSettings:o.featureSettings,display:o.display},h=new FontFace(s,`url(${n})`,l);h.load().then(()=>{this.loaded=!0,this.emit("loaded")}).catch(console.error),this.fontFace=h,this.fontUrl=i}}function _i(r,t,e){if(t.metrics)return t.metrics;const s=r.measureText("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz");console.warn(`Font metrics not provided for Canvas Web font ${t.fontFamily}. Using fallback values. It is HIGHLY recommended you use the latest version of the Lightning 3 \`msdf-generator\` tool to extract the default metrics for the font and provide them in the Canvas Web font definition.`);let i;return s.actualBoundingBoxDescent&&s.actualBoundingBoxAscent?i={ascender:s.actualBoundingBoxAscent/e,descender:-s.actualBoundingBoxDescent/e,lineGap:.2}:i={ascender:.8,descender:-.2,lineGap:.2},t.metrics=i,i}const fs=2048;function ps(r,t,e,s,i){const n=r!=="bottom"?.5*t:0;return e*(s-1)+n+Math.max(e,t)+(i||0)}class vi{constructor(t,e){a(this,"_canvas");a(this,"_context");a(this,"_settings");this._canvas=t,this._context=e,this._settings=this.mergeDefaults({})}set settings(t){this._settings=this.mergeDefaults(t)}get settings(){return this._settings}getPrecision(){return this._settings.precision}setFontProperties(){this._context.font=this._getFontSetting(),this._context.textBaseline=this._settings.textBaseline}_getFontSetting(){const t=[this._settings.fontFamily],e=[];for(let s=0,i=t.length;s<i;s++)t[s]==="serif"||t[s]==="sans-serif"?e.push(t[s]):e.push(`"${t[s]}"`);return`${this._settings.fontStyle} ${this._settings.fontSize*this.getPrecision()}px ${e.join(",")}`}_load(){if(document.fonts){const t=this._getFontSetting();try{if(!document.fonts.check(t,this._settings.text))return document.fonts.load(t,this._settings.text).catch(e=>{console.warn("[Lightning] Font load error",e,t)}).then(()=>{document.fonts.check(t,this._settings.text)||console.warn("[Lightning] Font not found",t)})}catch{console.warn("[Lightning] Can't check font loading for "+t)}}}calculateRenderInfo(){const t={},e=this.getPrecision(),s=this._settings.paddingLeft*e,i=this._settings.paddingRight*e,n=this._settings.fontSize*e;let o=this._settings.offsetY===null?null:this._settings.offsetY*e;const l=this._settings.w*e,h=this._settings.h*e;let c=this._settings.wordWrapWidth*e;const u=this._settings.cutSx*e,d=this._settings.cutEx*e,p=this._settings.cutSy*e,_=this._settings.cutEy*e,g=(this._settings.letterSpacing||0)*e,T=this._settings.textIndent*e,R=this._settings.trFontFace;this.setFontProperties(),M(R);const b=_i(this._context,R,n),m=Hs(b,n)*e,x=this._settings.lineHeight!==null?this._settings.lineHeight*e:m,f=this._settings.maxHeight,v=f!==null&&x>0?Math.floor(f/x):0,w=this._settings.maxLines,S=v>0&&w>0?Math.min(v,w):Math.max(v,w);let A=l||2048/this.getPrecision(),E=A-s;if(E<10&&(A+=10-E,E=10),c||(c=E),this._settings.textOverflow&&!this._settings.wordWrap){let I;switch(this._settings.textOverflow){case"clip":I="";break;case"ellipsis":I=this._settings.overflowSuffix;break;default:I=this._settings.textOverflow}this._settings.text=this.wrapWord(this._settings.text,c-T,I)}let L;if(this._settings.wordWrap)L=this.wrapText(this._settings.text,c,g,T);else{L={l:this._settings.text.split(/(?:\r\n|\r|\n)/),n:[]};const I=L.l.length;for(let P=0;P<I-1;P++)L.n.push(P)}let y=L.l;if(S&&y.length>S){const I=y.slice(0,S);let P=null;if(this._settings.overflowSuffix){const te=this._settings.overflowSuffix?this.measureText(this._settings.overflowSuffix):0,se=this.wrapText(I[I.length-1],c-te,g,T);I[I.length-1]=`${se.l[0]}${this._settings.overflowSuffix}`,P=[se.l.length>1?se.l[1]:""]}else P=[""];let B;const k=y.length;let z=0;const N=L.n.length;for(B=S;B<k;B++)P[z]+=`${P[z]?" ":""}${y[B]}`,B+1<N&&L.n[B+1]&&z++;t.remainingText=P.join(`
`),t.moreTextLines=!0,y=I}else t.moreTextLines=!1,t.remainingText="";let F=0;const O=[];for(let I=0;I<y.length;I++){const P=this.measureText(y[I],g)+(I===0?T:0);O.push(P),F=Math.max(F,P)}t.lineWidths=O,l||(A=F+s+i,E=F);let D;return h?D=h:D=ps(this._settings.textBaseline,n,x,y.length,o),o===null&&(o=n),t.w=A,t.h=D,t.lines=y,t.precision=e,A||(A=1),D||(D=1),(u||d)&&(A=Math.min(A,d-u)),(p||_)&&(D=Math.min(D,_-p)),t.width=A,t.innerWidth=E,t.height=D,t.fontSize=n,t.cutSx=u,t.cutSy=p,t.cutEx=d,t.cutEy=_,t.lineHeight=x,t.defLineHeight=m,t.lineWidths=O,t.offsetY=o,t.paddingLeft=s,t.paddingRight=i,t.letterSpacing=g,t.textIndent=T,t.metrics=b,t}draw(t,e){const s=this.getPrecision(),i=(e==null?void 0:e.lines)||t.lines,n=(e==null?void 0:e.lineWidths)||t.lineWidths,o=e?ps(this._settings.textBaseline,t.fontSize,t.lineHeight,e.lines.length,this._settings.offsetY===null?null:this._settings.offsetY*s):t.height;this._canvas.width=Math.min(Math.ceil(t.width+this._settings.textRenderIssueMargin),fs),this._canvas.height=Math.min(Math.ceil(o),fs),this.setFontProperties(),t.fontSize>=128&&(this._context.globalAlpha=.01,this._context.fillRect(0,0,.01,.01),this._context.globalAlpha=1),(t.cutSx||t.cutSy)&&this._context.translate(-t.cutSx,-t.cutSy);let l,h;const c=[],{metrics:u}=t,d=u?u.ascender*t.fontSize:t.fontSize,p=(u.ascender-u.descender)*t.fontSize;for(let g=0,T=i.length;g<T;g++)l=g===0?t.textIndent:0,h=g*t.lineHeight+d,this._settings.verticalAlign=="middle"?h+=(t.lineHeight-p)/2:this._settings.verticalAlign=="bottom"&&(h+=t.lineHeight-p),this._settings.textAlign==="right"?l+=t.innerWidth-n[g]:this._settings.textAlign==="center"&&(l+=(t.innerWidth-n[g])/2),l+=t.paddingLeft,c.push({text:i[g],x:l,y:h,w:n[g]});if(this._settings.highlight){const g=this._settings.highlightColor,T=this._settings.highlightHeight*s||t.fontSize*1.5,R=this._settings.highlightOffset*s,b=this._settings.highlightPaddingLeft!==null?this._settings.highlightPaddingLeft*s:t.paddingLeft,m=this._settings.highlightPaddingRight!==null?this._settings.highlightPaddingRight*s:t.paddingRight;this._context.fillStyle=Mt(g);for(let x=0;x<c.length;x++){const f=c[x];this._context.fillRect(f.x-b,f.y-t.offsetY+R,f.w+m+b,T)}}let _=null;this._settings.shadow&&(_=[this._context.shadowColor,this._context.shadowOffsetX,this._context.shadowOffsetY,this._context.shadowBlur],this._context.shadowColor=Mt(this._settings.shadowColor),this._context.shadowOffsetX=this._settings.shadowOffsetX*s,this._context.shadowOffsetY=this._settings.shadowOffsetY*s,this._context.shadowBlur=this._settings.shadowBlur*s),this._context.fillStyle=Mt(this._settings.textColor);for(let g=0,T=c.length;g<T;g++){const R=c[g];if(t.letterSpacing===0)this._context.fillText(R.text,R.x,R.y);else{const b=R.text.split("");let m=R.x;for(let x=0,f=b.length;x<f;x++)this._context.fillText(b[x],m,R.y),m+=this.measureText(b[x],t.letterSpacing)}}_&&(this._context.shadowColor=_[0],this._context.shadowOffsetX=_[1],this._context.shadowOffsetY=_[2],this._context.shadowBlur=_[3]),(t.cutSx||t.cutSy)&&this._context.translate(t.cutSx,t.cutSy)}wrapWord(t,e,s){const i=this._context.measureText(s).width,n=t.length,o=this._context.measureText(t).width;if(o<=e)return t;let l=Math.floor(e*n/o),h=this._context.measureText(t.substring(0,l)).width+i;if(h>e)for(;l>0&&(h=this._context.measureText(t.substring(0,l)).width+i,h>e);)l-=1;else for(;l<n;)if(h=this._context.measureText(t.substring(0,l)).width+i,h<e)l+=1;else{l-=1;break}return t.substring(0,l)+(e>=i?s:"")}wrapText(t,e,s,i=0){const n=t.split(/\r?\n/g);let o=[];const l=[];for(let h=0;h<n.length;h++){const c=[];let u="",d=e-i;const p=n[h].split(" ");for(let _=0;_<p.length;_++){const g=this.measureText(p[_],s),T=g+this.measureText(" ",s);_===0||T>d?(_>0&&(c.push(u),u=""),u+=p[_],d=e-g-(_===0?i:0)):(d-=T,u+=` ${p[_]}`)}c.push(u),u="",o=o.concat(c),h<n.length-1&&l.push(o.length)}return{l:o,n:l}}measureText(t,e=0){return e?t.split("").reduce((s,i)=>s+this._context.measureText(i).width+e,0):this._context.measureText(t).width}mergeDefaults(t){return{text:"",w:0,h:0,fontStyle:"normal",fontSize:40,fontFamily:null,trFontFace:null,wordWrap:!0,wordWrapWidth:0,wordBreak:!1,textOverflow:"",lineHeight:null,textBaseline:"alphabetic",textAlign:"left",verticalAlign:"top",offsetY:null,maxLines:0,maxHeight:null,overflowSuffix:"...",textColor:[1,1,1,1],paddingLeft:0,paddingRight:0,shadow:!1,shadowColor:[0,0,0,1],shadowOffsetX:0,shadowOffsetY:0,shadowBlur:5,highlight:!1,highlightHeight:0,highlightColor:[0,0,0,1],highlightOffset:0,highlightPaddingLeft:0,highlightPaddingRight:0,letterSpacing:0,textIndent:0,cutSx:0,cutEx:0,cutSy:0,cutEy:0,advancedRenderer:!1,fontBaselineRatio:0,precision:1,textRenderIssueMargin:0,...t}}}const gs=typeof self>"u"?globalThis:self;var Cs;const ms=((Cs=gs.document)==null?void 0:Cs.fonts)||gs.fonts;function Ri(r){const{fontFamily:t,fontStyle:e,fontWeight:s,fontStretch:i,fontSize:n}=r;return[e,s,i,`${n}px`,t].join(" ")}class xs extends Gs{constructor(e){super(e);a(this,"canvas");a(this,"context");a(this,"fontFamilies",{});a(this,"fontFamilyArray",[this.fontFamilies]);a(this,"loadFont",e=>{const s=Ri(e.props),i=Jt.resolveFontFace(this.fontFamilyArray,e.props);if(M(i,`Could not resolve font face for ${s}`),e.fontInfo={fontFace:i,cssString:s,loaded:!1},!e.fontInfo.loaded){ms.load(s).then(this.onFontLoaded.bind(this,e,s)).catch(this.onFontLoadError.bind(this,e,s));return}});typeof OffscreenCanvas<"u"?this.canvas=new OffscreenCanvas(0,0):this.canvas=document.createElement("canvas");let s=this.canvas.getContext("2d",{willReadFrequently:!0});s||(this.canvas=document.createElement("canvas"),s=this.canvas.getContext("2d",{willReadFrequently:!0})),M(s),this.context=s,this.addFontFace(new Ft({fontFamily:"sans-serif",descriptors:{},fontUrl:""}))}getPropertySetters(){return{fontFamily:(e,s)=>{e.props.fontFamily=s,e.fontInfo=void 0,this.invalidateLayoutCache(e)},fontWeight:(e,s)=>{e.props.fontWeight=s,e.fontInfo=void 0,this.invalidateLayoutCache(e)},fontStyle:(e,s)=>{e.props.fontStyle=s,e.fontInfo=void 0,this.invalidateLayoutCache(e)},fontStretch:(e,s)=>{e.props.fontStretch=s,e.fontInfo=void 0,this.invalidateLayoutCache(e)},fontSize:(e,s)=>{e.props.fontSize=s,e.fontInfo=void 0,this.invalidateLayoutCache(e)},text:(e,s)=>{e.props.text=s,this.invalidateLayoutCache(e)},textAlign:(e,s)=>{e.props.textAlign=s,this.invalidateLayoutCache(e)},color:(e,s)=>{e.props.color=s,this.invalidateLayoutCache(e)},x:(e,s)=>{e.props.x=s},y:(e,s)=>{e.props.y=s},contain:(e,s)=>{e.props.contain=s,this.invalidateLayoutCache(e)},width:(e,s)=>{e.props.width=s,e.props.contain!=="none"&&this.invalidateLayoutCache(e)},height:(e,s)=>{e.props.height=s,e.props.contain==="both"&&this.invalidateLayoutCache(e)},offsetY:(e,s)=>{e.props.offsetY=s,this.invalidateLayoutCache(e)},scrollY:(e,s)=>{e.props.scrollY=s},letterSpacing:(e,s)=>{e.props.letterSpacing=s,this.invalidateLayoutCache(e)},lineHeight:(e,s)=>{e.props.lineHeight=s,this.invalidateLayoutCache(e)},maxLines:(e,s)=>{e.props.maxLines=s,this.invalidateLayoutCache(e)},textBaseline:(e,s)=>{e.props.textBaseline=s,this.invalidateLayoutCache(e)},verticalAlign:(e,s)=>{e.props.verticalAlign=s,this.invalidateLayoutCache(e)},overflowSuffix:(e,s)=>{e.props.overflowSuffix=s,this.invalidateLayoutCache(e)}}}canRenderFont(e){return!0}isFontFaceSupported(e){return e instanceof Ft}addFontFace(e){M(e instanceof Ft),e.fontFamily!=="sans-serif"&&ms.add(e.fontFace);const{fontFamilies:s}=this,i=e.fontFace.family;let n=s[i];n||(n=new Set,s[i]=n),n.add(e)}createState(e,s){return{node:s,props:e,status:"initialState",updateScheduled:!1,emitter:new he,textureNode:void 0,lightning2TextRenderer:new vi(this.canvas,this.context),renderInfo:void 0,forceFullLayoutCalc:!1,textW:0,textH:0,fontInfo:void 0,isRenderable:!1,debugData:{updateCount:0,layoutCount:0,drawCount:0,lastLayoutNumCharacters:0,layoutSum:0,drawSum:0,bufferSize:0}}}updateState(e){if(e.status==="initialState"&&this.setStatus(e,"loading"),e.status!=="loaded"){if(!e.fontInfo)return this.loadFont(e);e.fontInfo.loaded&&(e.renderInfo||(e.renderInfo=this.calculateRenderInfo(e),e.textH=e.renderInfo.lineHeight*e.renderInfo.lines.length,e.textW=e.renderInfo.width,this.renderSingleCanvasPage(e)))}}renderSingleCanvasPage(e){M(e.renderInfo);const s=e.node,i=this.stage.txManager.loadTexture("ImageTexture",{src:(function(n,o){return M(o),n.draw(o,{lines:o.lines,lineWidths:o.lineWidths}),this.canvas.width===0||this.canvas.height===0?null:this.context.getImageData(0,0,this.canvas.width,this.canvas.height)}).bind(this,e.lightning2TextRenderer,e.renderInfo)});if(e.textureNode)e.textureNode.texture=i;else{const n=this.stage.createNode({parent:s,texture:i,autosize:!0,alpha:xr(e.props.color)});e.textureNode=n}this.setStatus(e,"loaded")}calculateRenderInfo(e){var s;return e.lightning2TextRenderer.settings={text:e.props.text,textAlign:e.props.textAlign,fontFamily:e.props.fontFamily,trFontFace:(s=e.fontInfo)==null?void 0:s.fontFace,fontSize:e.props.fontSize,fontStyle:[e.props.fontStretch,e.props.fontStyle,e.props.fontWeight].join(" "),textColor:He(e.props.color),offsetY:e.props.offsetY,wordWrap:e.props.contain!=="none",wordWrapWidth:e.props.contain==="none"?void 0:e.props.width,letterSpacing:e.props.letterSpacing,lineHeight:e.props.lineHeight??null,maxLines:e.props.maxLines,maxHeight:e.props.contain==="both"?e.props.height-e.props.offsetY:null,textBaseline:e.props.textBaseline,verticalAlign:e.props.verticalAlign,overflowSuffix:e.props.overflowSuffix,w:e.props.contain!=="none"?e.props.width:void 0},e.renderInfo=e.lightning2TextRenderer.calculateRenderInfo(),e.renderInfo}renderQuads(){}destroyState(e){e.status!=="destroyed"&&(super.destroyState(e),e.textureNode&&(e.textureNode.destroy(),delete e.textureNode),delete e.renderInfo)}invalidateLayoutCache(e){e.renderInfo=void 0,this.setStatus(e,"loading"),this.scheduleUpdateState(e)}onFontLoaded(e,s){var i;s!==((i=e.fontInfo)==null?void 0:i.cssString)||!e.fontInfo||(e.fontInfo.loaded=!0,this.scheduleUpdateState(e))}onFontLoadError(e,s,i){var n;s!==((n=e.fontInfo)==null?void 0:n.cssString)||!e.fontInfo||(e.fontInfo.loaded=!0,console.error(`CanvasTextRenderer: Error loading font '${e.fontInfo.cssString}'`,i),this.scheduleUpdateState(e))}}class Si{constructor(){a(this,"data",{})}reset(){this.data={}}increment(t){this.data[t]||(this.data[t]=0),this.data[t]++}getData(){return{...this.data}}}class wi{constructor(t,e){a(this,"stage");a(this,"memUsed",0);a(this,"loadedTextures",new Map);a(this,"criticalThreshold");a(this,"targetThreshold");a(this,"cleanupInterval");a(this,"debugLogging");a(this,"lastCleanupTime",0);a(this,"criticalCleanupRequested",!1);a(this,"frameTime",0);this.stage=t;const{criticalThreshold:s}=e;this.criticalThreshold=Math.round(s);const i=Math.max(0,Math.min(1,e.targetThresholdLevel));if(this.targetThreshold=Math.round(s*i),this.cleanupInterval=e.cleanupInterval,this.debugLogging=e.debugLogging,e.debugLogging){let n=0;setInterval(()=>{n!==this.memUsed&&(n=this.memUsed,console.log(`[TextureMemoryManager] Memory used: ${as(this.memUsed)} mb / ${as(this.criticalThreshold)} mb (${(this.memUsed/this.criticalThreshold*100).toFixed(1)}%)`))},1e3)}s===0&&(this.setTextureMemUse=()=>{})}setTextureMemUse(t,e){if(this.loadedTextures.has(t)&&(this.memUsed-=this.loadedTextures.get(t)),e===0){this.loadedTextures.delete(t);return}else this.memUsed+=e,this.loadedTextures.set(t,e);this.memUsed>this.criticalThreshold&&(this.criticalCleanupRequested=!0)}checkCleanup(){return this.criticalCleanupRequested||this.memUsed>this.targetThreshold&&this.frameTime-this.lastCleanupTime>=this.cleanupInterval}cleanup(){const t=this.criticalCleanupRequested;this.lastCleanupTime=this.frameTime,this.criticalCleanupRequested=!1,t&&this.stage.queueFrameEvent("criticalCleanup",{memUsed:this.memUsed,criticalThreshold:this.criticalThreshold}),this.debugLogging&&console.log(`[TextureMemoryManager] Cleaning up textures. Critical: ${t}`);const e=[...this.loadedTextures.keys()].sort((n,o)=>{const l=n.renderable,h=o.renderable;return l===h?n.lastRenderableChangeTime-o.lastRenderableChangeTime:l?1:h?-1:0}),s=this.targetThreshold,i=this.stage.txManager;for(const n of e)if(n.renderable||(n.ctxTexture.free(),i.removeTextureFromCache(n),this.memUsed<=s))break;this.memUsed>=this.criticalThreshold&&(this.stage.queueFrameEvent("criticalCleanupFailed",{memUsed:this.memUsed,criticalThreshold:this.criticalThreshold}),console.warn(`[TextureMemoryManager] Memory usage above critical threshold after cleanup: ${this.memUsed}`))}getMemoryInfo(){let t=0;const e=[...this.loadedTextures.keys()].reduce((s,i)=>(t+=i.renderable?1:0,s+(i.renderable?this.loadedTextures.get(i):0)),0);return{criticalThreshold:this.criticalThreshold,targetThreshold:this.targetThreshold,renderableMemUsed:e,memUsed:this.memUsed,renderableTexturesLoaded:t,loadedTextures:this.loadedTextures.size}}}const bi={isWhite:!0,a:1,r:255,g:255,b:255};function Bt(r){if(r===4294967295)return bi;const t=(r>>>24&255)/255,e=r>>>16&255&255,s=r>>>8&255&255,i=r&255&255;return{isWhite:!1,a:t,r:i,g:s,b:e}}function pt({a:r,r:t,g:e,b:s}){return`rgba(${t},${e},${s},${r})`}class Ei extends Fs{constructor(){super(...arguments);a(this,"image");a(this,"tintCache")}load(){this.textureSource.state==="freed"&&(this.textureSource.setState("loading"),this.onLoadRequest().then(e=>{this.textureSource.setState("loaded",e),this.updateMemSize()}).catch(e=>{this.textureSource.setState("failed",e)}))}free(){this.image=void 0,this.tintCache=void 0,this.textureSource.setState("freed"),this.setTextureMemUse(0)}updateMemSize(){const e=this.tintCache?8:4;if(this.textureSource.dimensions){const{width:s,height:i}=this.textureSource.dimensions;this.setTextureMemUse(s*i*e)}}hasImage(){return this.image!==void 0}getImage(e){var o;const s=this.image;if(M(s,"Attempt to get unloaded image texture"),e.isWhite)return this.tintCache&&(this.tintCache=void 0,this.updateMemSize()),s;const i=pt(e);if(((o=this.tintCache)==null?void 0:o.key)===i)return this.tintCache.image;const n=this.tintTexture(s,i);return this.tintCache={key:i,image:n},this.updateMemSize(),n}tintTexture(e,s){const{width:i,height:n}=e,o=document.createElement("canvas");o.width=i,o.height=n;const l=o.getContext("2d");return l&&(l.fillStyle=s,l.globalCompositeOperation="copy",l.fillRect(0,0,i,n),l.globalCompositeOperation="multiply",l.drawImage(e,0,0,i,n,0,0,i,n),l.globalCompositeOperation="destination-in",l.drawImage(e,0,0,i,n,0,0,i,n)),o}async onLoadRequest(){const{data:e}=await this.textureSource.getTextureData();if(e instanceof ImageData){const s=document.createElement("canvas");s.width=e.width,s.height=e.height;const i=s.getContext("2d");return i&&i.putImageData(e,0,0),this.image=s,{width:e.width,height:e.height}}else if(e instanceof ImageBitmap)return this.image=e,{width:e.width,height:e.height};return{width:0,height:0}}}function Ci(r){var t;return r.shader instanceof Qt&&r.shader.shType===zs?((t=r.shaderProps)==null?void 0:t.radius)??0:0}class Ai extends Bs{constructor(e){super(e);a(this,"context");a(this,"canvas");a(this,"pixelRatio");a(this,"clearColor");a(this,"renderToTextureActive",!1);a(this,"activeRttNode",null);a(this,"defShaderCtr");this.mode="canvas",this.shManager.renderer=this;const{canvas:s,pixelRatio:i,clearColor:n}=e;this.canvas=s,this.context=s.getContext("2d"),this.pixelRatio=i,this.clearColor=n?mr(n):void 0,this.defShaderCtr={type:"DefaultShader",props:{},shader:new Qt("DefaultShader"),getResolvedProps:()=>()=>({})}}reset(){this.canvas.width=this.canvas.width;const e=this.context;if(this.clearColor){const[s,i,n,o]=this.clearColor;e.fillStyle=`rgba(${s}, ${i}, ${n}, ${o/255})`,e.fillRect(0,0,this.canvas.width,this.canvas.height)}e.scale(this.pixelRatio,this.pixelRatio)}render(){}addQuad(e){const s=this.context,{tx:i,ty:n,width:o,height:l,alpha:h,colorTl:c,colorTr:u,colorBr:d,ta:p,tb:_,tc:g,td:T,clippingRect:R}=e;let b=e.texture,m,x;if(b){if(b instanceof Ce&&(x=b.props,b=b.parentTexture),m=b.ctxTexture,b.state==="freed"){m.load();return}if(b.state!=="loaded"||!m.hasImage())return}const f=Bt(c),v=p!==1,w=R.width!==0&&R.height!==0,S=c!==u||c!==d,A=e.shader?Ci(e):0;if((v||w||A)&&s.save(),w){const E=new Path2D,{x:L,y,width:F,height:O}=R;E.rect(L,y,F,O),s.clip(E)}if(v){const E=this.pixelRatio;s.setTransform(p,g,_,T,i*E,n*E),s.scale(E,E),s.translate(-i,-n)}if(A){const E=new Path2D;E.roundRect(i,n,o,l,A),s.clip(E)}if(m){const E=m.getImage(f);s.globalAlpha=h,x?s.drawImage(E,x.x,x.y,x.width,x.height,i,n,o,l):s.drawImage(E,i,n,o,l),s.globalAlpha=1}else if(S){let E=i,L=n,y;c===u?(E=i,L=n+l,y=Bt(d)):(E=i+o,L=n,y=Bt(u));const F=s.createLinearGradient(i,n,E,L);F.addColorStop(0,pt(f)),F.addColorStop(1,pt(y)),s.fillStyle=F,s.fillRect(i,n,o,l)}else s.fillStyle=pt(f),s.fillRect(i,n,o,l);(v||w||A)&&s.restore()}createCtxTexture(e){return new Ei(this.txMemManager,e)}getShaderManager(){return this.shManager}getDefShaderCtr(){return this.defShaderCtr}renderRTTNodes(){}removeRTTNode(e){}renderToTexture(e){}getBufferInfo(){return null}}class Mi extends $t{constructor(e,s){super(e,s);a(this,"textRenderer");a(this,"trState");a(this,"_textRendererOverride",null);a(this,"onTextLoaded",()=>{const{contain:e}=this,s=this.trState.props.width,i=this.trState.props.height,n=this.trState.textW||0,o=this.trState.textH||0;e==="both"?(this.props.width=s,this.props.height=i):e==="width"?(this.props.width=s,this.props.height=o):e==="none"&&(this.props.width=n,this.props.height=o),this.updateLocalTransform(),this.stage.requestRender(),this.emit("loaded",{type:"text",dimensions:{width:this.trState.textW||0,height:this.trState.textH||0}})});a(this,"onTextFailed",(e,s)=>{this.emit("failed",{type:"text",error:s})});this._textRendererOverride=s.textRendererOverride;const{resolvedTextRenderer:i,textRendererState:n}=this.resolveTextRendererAndState({x:this.absX,y:this.absY,width:s.width,height:s.height,textAlign:s.textAlign,color:s.color,zIndex:s.zIndex,contain:s.contain,scrollable:s.scrollable,scrollY:s.scrollY,offsetY:s.offsetY,letterSpacing:s.letterSpacing,debug:s.debug,fontFamily:s.fontFamily,fontSize:s.fontSize,fontStretch:s.fontStretch,fontStyle:s.fontStyle,fontWeight:s.fontWeight,text:s.text,lineHeight:s.lineHeight,maxLines:s.maxLines,textBaseline:s.textBaseline,verticalAlign:s.verticalAlign,overflowSuffix:s.overflowSuffix});this.textRenderer=i,this.trState=n}get width(){return this.props.width}set width(e){this.props.width=e,this.textRenderer.set.width(this.trState,e),this.contain==="none"&&this.setUpdateType(C.Local)}get height(){return this.props.height}set height(e){this.props.height=e,this.textRenderer.set.height(this.trState,e),this.contain!=="both"&&this.setUpdateType(C.Local)}get color(){return this.trState.props.color}set color(e){this.textRenderer.set.color(this.trState,e)}get text(){return this.trState.props.text}set text(e){this.textRenderer.set.text(this.trState,e)}get textRendererOverride(){return this._textRendererOverride}set textRendererOverride(e){this._textRendererOverride=e,this.textRenderer.destroyState(this.trState);const{resolvedTextRenderer:s,textRendererState:i}=this.resolveTextRendererAndState(this.trState.props);this.textRenderer=s,this.trState=i}get fontSize(){return this.trState.props.fontSize}set fontSize(e){this.textRenderer.set.fontSize(this.trState,e)}get fontFamily(){return this.trState.props.fontFamily}set fontFamily(e){this.textRenderer.set.fontFamily(this.trState,e)}get fontStretch(){return this.trState.props.fontStretch}set fontStretch(e){this.textRenderer.set.fontStretch(this.trState,e)}get fontStyle(){return this.trState.props.fontStyle}set fontStyle(e){this.textRenderer.set.fontStyle(this.trState,e)}get fontWeight(){return this.trState.props.fontWeight}set fontWeight(e){this.textRenderer.set.fontWeight(this.trState,e)}get textAlign(){return this.trState.props.textAlign}set textAlign(e){this.textRenderer.set.textAlign(this.trState,e)}get contain(){return this.trState.props.contain}set contain(e){this.textRenderer.set.contain(this.trState,e)}get scrollable(){return this.trState.props.scrollable}set scrollable(e){this.textRenderer.set.scrollable(this.trState,e)}get scrollY(){return this.trState.props.scrollY}set scrollY(e){this.textRenderer.set.scrollY(this.trState,e)}get offsetY(){return this.trState.props.offsetY}set offsetY(e){this.textRenderer.set.offsetY(this.trState,e)}get letterSpacing(){return this.trState.props.letterSpacing}set letterSpacing(e){this.textRenderer.set.letterSpacing(this.trState,e)}get lineHeight(){return this.trState.props.lineHeight}set lineHeight(e){this.textRenderer.set.lineHeight&&this.textRenderer.set.lineHeight(this.trState,e)}get maxLines(){return this.trState.props.maxLines}set maxLines(e){this.textRenderer.set.maxLines&&this.textRenderer.set.maxLines(this.trState,e)}get textBaseline(){return this.trState.props.textBaseline}set textBaseline(e){this.textRenderer.set.textBaseline&&this.textRenderer.set.textBaseline(this.trState,e)}get verticalAlign(){return this.trState.props.verticalAlign}set verticalAlign(e){this.textRenderer.set.verticalAlign&&this.textRenderer.set.verticalAlign(this.trState,e)}get overflowSuffix(){return this.trState.props.overflowSuffix}set overflowSuffix(e){this.textRenderer.set.overflowSuffix&&this.textRenderer.set.overflowSuffix(this.trState,e)}get debug(){return this.trState.props.debug}set debug(e){this.textRenderer.set.debug(this.trState,e)}update(e,s){super.update(e,s),M(this.globalTransform),this.textRenderer.set.x(this.trState,this.globalTransform.tx),this.textRenderer.set.y(this.trState,this.globalTransform.ty)}checkRenderProps(){return this.trState.props.text!==""?!0:super.checkRenderProps()}onChangeIsRenderable(e){super.onChangeIsRenderable(e),this.textRenderer.setIsRenderable(this.trState,e)}renderQuads(e){var s;if(M(this.globalTransform),!this.textRenderer.renderQuads){super.renderQuads(e);return}this.parentHasRenderTexture&&(!e.renderToTextureActive||this.parentRenderTexture!==e.activeRttNode)||(this.parentHasRenderTexture&&((s=this.props.parent)!=null&&s.rtt)&&(this.globalTransform=K.identity(),this.localTransform&&this.globalTransform.multiply(this.localTransform)),M(this.globalTransform),this.textRenderer.renderQuads(this.trState,this.globalTransform,this.clippingRect,this.worldAlpha,this.parentHasRenderTexture,this.framebufferDimensions))}destroy(){super.destroy(),this.textRenderer.destroyState(this.trState)}resolveTextRendererAndState(e){const s=this.stage.resolveTextRenderer(e,this._textRendererOverride),i=s.createState(e,this);return i.emitter.on("loaded",this.onTextLoaded),i.emitter.on("failed",this.onTextFailed),s.scheduleUpdateState(i),{resolvedTextRenderer:s,textRendererState:i}}}function Ii(r){const t={boolean:!0,string:!0,number:!0,undefined:!0},e=Object.keys(r);for(let s=0;s<e.length;s++){const i=e[s];if(!i)continue;const n=r[i],o=typeof n;o==="string"&&n.length>2048&&(console.warn(`Custom Data value for ${i} is too long, it will be truncated to 2048 characters`),r[i]=n.substring(0,2048)),t[o]||(console.warn(`Custom Data value for ${i} is not a boolean, string, or number, it will be ignored`),delete r[i])}return r}const Li=2e6;class Pi{constructor(t){a(this,"options");a(this,"animationManager");a(this,"txManager");a(this,"txMemManager");a(this,"fontManager");a(this,"textRenderers");a(this,"shManager");a(this,"renderer");a(this,"root");a(this,"boundsMargin");a(this,"defShaderCtr");a(this,"eventBus");a(this,"deltaTime",0);a(this,"lastFrameTime",0);a(this,"currentFrameTime",0);a(this,"fpsNumFrames",0);a(this,"fpsElapsedTime",0);a(this,"renderRequested",!1);a(this,"frameEventQueue",[]);a(this,"contextSpy",null);this.options=t;const{canvas:e,clearColor:s,appWidth:i,appHeight:n,boundsMargin:o,enableContextSpy:l,numImageWorkers:h,textureMemory:c,renderMode:u}=t;this.eventBus=t.eventBus,this.txManager=new si(h),this.txMemManager=new wi(this,c),this.shManager=new Wr,this.animationManager=new Jr,this.contextSpy=l?new Si:null;let d=[0,0,0,0];o&&(d=Array.isArray(o)?o:[o,o,o,o]),this.boundsMargin=d;const p={stage:this,canvas:e,pixelRatio:t.devicePhysicalPixelRatio*t.deviceLogicalPixelRatio,clearColor:s??4278190080,bufferMemory:Li,txManager:this.txManager,txMemManager:this.txMemManager,shManager:this.shManager,contextSpy:this.contextSpy};u==="canvas"?this.renderer=new Ai(p):this.renderer=new Zt(p),this.defShaderCtr=this.renderer.getDefShaderCtr(),dr(u),this.txManager.renderer=this.renderer,this.textRenderers=u==="webgl"?{canvas:new xs(this),sdf:new Ti(this)}:{canvas:new xs(this)},this.fontManager=new Jt(this.textRenderers);const _=new $t(this,{x:0,y:0,width:i,height:n,alpha:1,autosize:!1,clipping:!1,color:0,colorTop:0,colorBottom:0,colorLeft:0,colorRight:0,colorTl:0,colorTr:0,colorBl:0,colorBr:0,zIndex:0,zIndexLocked:0,scaleX:1,scaleY:1,mountX:0,mountY:0,mount:0,pivot:.5,pivotX:.5,pivotY:.5,rotation:0,parent:null,texture:null,textureOptions:{},shader:this.defShaderCtr,rtt:!1,src:null,scale:1});this.root=_,Mr(this)}updateFrameTime(){const t=Ir();this.lastFrameTime=this.currentFrameTime,this.currentFrameTime=t,this.deltaTime=this.lastFrameTime?t-this.lastFrameTime:100/6,this.txManager.frameTime=t,this.txMemManager.frameTime=t,this.eventBus.emit("frameTick",{time:this.currentFrameTime,delta:this.deltaTime})}updateAnimations(){const{animationManager:t}=this;this.root&&t.update(this.deltaTime)}hasSceneUpdates(){return!!this.root.updateType||this.renderRequested}drawFrame(){const{renderer:t,renderRequested:e}=this;M(t),this.root.updateType!==0&&this.root.update(this.deltaTime,this.root.clippingRect),t.reset(),this.txMemManager.criticalCleanupRequested&&this.txMemManager.cleanup(),t.rttNodes.length>0&&t.renderRTTNodes(),this.addQuads(this.root),t==null||t.render(),this.calculateFps(),e&&(this.renderRequested=!1)}queueFrameEvent(t,e){this.frameEventQueue.push([t,e])}flushFrameEvents(){for(const[t,e]of this.frameEventQueue)this.eventBus.emit(t,e);this.frameEventQueue=[]}calculateFps(){var e,s;const{fpsUpdateInterval:t}=this.options;if(t&&(this.fpsNumFrames++,this.fpsElapsedTime+=this.deltaTime,this.fpsElapsedTime>=t)){const i=Math.round(this.fpsNumFrames*1e3/this.fpsElapsedTime);this.fpsNumFrames=0,this.fpsElapsedTime=0,this.queueFrameEvent("fpsUpdate",{fps:i,contextSpyData:((e=this.contextSpy)==null?void 0:e.getData())??null}),(s=this.contextSpy)==null||s.reset()}}addQuads(t){M(this.renderer&&t.globalTransform),t.isRenderable&&t.renderQuads(this.renderer);for(let e=0;e<t.children.length;e++){const s=t.children[e];s&&(s==null?void 0:s.worldAlpha)!==0&&this.addQuads(s)}}requestRender(){this.renderRequested=!0}resolveTextRenderer(t,e=null){let s=e,i=!1;if(s){const o=this.textRenderers[s];o?o.canRenderFont(t)||(console.warn(`Cannot use override text renderer '${s}' for font`,t),s=null,i=!0):(console.warn(`Text renderer override '${s}' not found.`),s=null,i=!0)}if(!s){for(const[o,l]of Object.entries(this.textRenderers))if(o!=="canvas"&&l.canRenderFont(t)){s=o;break}s||(s="canvas")}i&&console.warn(`Falling back to text renderer ${String(s)}`);const n=this.textRenderers[s];return M(n,"resolvedTextRenderer undefined"),n}createShaderCtr(t,e){return this.shManager.loadShader(t,e)}createNode(t){const e=this.resolveNodeDefaults(t);return new $t(this,e)}createTextNode(t){const e=t.fontSize??16,s={...this.resolveNodeDefaults(t),text:t.text??"",textRendererOverride:t.textRendererOverride??null,fontSize:e,fontFamily:t.fontFamily??"sans-serif",fontStyle:t.fontStyle??"normal",fontWeight:t.fontWeight??"normal",fontStretch:t.fontStretch??"normal",textAlign:t.textAlign??"left",contain:t.contain??"none",scrollable:t.scrollable??!1,scrollY:t.scrollY??0,offsetY:t.offsetY??0,letterSpacing:t.letterSpacing??0,lineHeight:t.lineHeight,maxLines:t.maxLines??0,textBaseline:t.textBaseline??"alphabetic",verticalAlign:t.verticalAlign??"middle",overflowSuffix:t.overflowSuffix??"...",debug:t.debug??{},shaderProps:null};return new Mi(this,s)}resolveNodeDefaults(t){const e=t.color??4294967295,s=t.colorTl??t.colorTop??t.colorLeft??e,i=t.colorTr??t.colorTop??t.colorRight??e,n=t.colorBl??t.colorBottom??t.colorLeft??e,o=t.colorBr??t.colorBottom??t.colorRight??e,l=Ii(t.data??{});return{x:t.x??0,y:t.y??0,width:t.width??0,height:t.height??0,alpha:t.alpha??1,autosize:t.autosize??!1,clipping:t.clipping??!1,color:e,colorTop:t.colorTop??e,colorBottom:t.colorBottom??e,colorLeft:t.colorLeft??e,colorRight:t.colorRight??e,colorBl:n,colorBr:o,colorTl:s,colorTr:i,zIndex:t.zIndex??0,zIndexLocked:t.zIndexLocked??0,parent:t.parent??null,texture:t.texture??null,textureOptions:t.textureOptions??{},shader:t.shader??this.defShaderCtr,src:t.src??null,scale:t.scale??null,scaleX:t.scaleX??t.scale??1,scaleY:t.scaleY??t.scale??1,mount:t.mount??0,mountX:t.mountX??t.mount??0,mountY:t.mountY??t.mount??0,pivot:t.pivot??.5,pivotX:t.pivotX??t.pivot??.5,pivotY:t.pivotY??t.pivot??.5,rotation:t.rotation??0,rtt:t.rtt??!1,data:l}}}class Fi extends he{constructor(e,s){var T,R,b,m;super();a(this,"root");a(this,"canvas");a(this,"settings");a(this,"stage");a(this,"inspector",null);const i={criticalThreshold:((T=e.textureMemory)==null?void 0:T.criticalThreshold)||124e6,targetThresholdLevel:((R=e.textureMemory)==null?void 0:R.targetThresholdLevel)||.5,cleanupInterval:((b=e.textureMemory)==null?void 0:b.cleanupInterval)||3e4,debugLogging:((m=e.textureMemory)==null?void 0:m.debugLogging)||!1},n={appWidth:e.appWidth||1920,appHeight:e.appHeight||1080,textureMemory:i,boundsMargin:e.boundsMargin||0,deviceLogicalPixelRatio:e.deviceLogicalPixelRatio||1,devicePhysicalPixelRatio:e.devicePhysicalPixelRatio||window.devicePixelRatio,clearColor:e.clearColor??0,fpsUpdateInterval:e.fpsUpdateInterval||0,numImageWorkers:e.numImageWorkers!==void 0?e.numImageWorkers:2,enableContextSpy:e.enableContextSpy??!1,enableInspector:e.enableInspector??!1,renderMode:e.renderMode??"webgl",quadBufferSize:e.quadBufferSize??4*1024*1024};this.settings=n;const{appWidth:o,appHeight:l,deviceLogicalPixelRatio:h,devicePhysicalPixelRatio:c,enableInspector:u}=n,d=o*h,p=l*h,_=document.createElement("canvas");this.canvas=_,_.width=d*c,_.height=p*c,_.style.width=`${d}px`,_.style.height=`${p}px`,this.stage=new Pi({appWidth:this.settings.appWidth,appHeight:this.settings.appHeight,boundsMargin:this.settings.boundsMargin,clearColor:this.settings.clearColor,canvas:this.canvas,deviceLogicalPixelRatio:this.settings.deviceLogicalPixelRatio,devicePhysicalPixelRatio:this.settings.devicePhysicalPixelRatio,enableContextSpy:this.settings.enableContextSpy,fpsUpdateInterval:this.settings.fpsUpdateInterval,numImageWorkers:this.settings.numImageWorkers,renderMode:this.settings.renderMode,textureMemory:i,eventBus:this,quadBufferSize:this.settings.quadBufferSize}),this.root=this.stage.root;let g;if(typeof s=="string"?g=document.getElementById(s):g=s,!g)throw new Error("Could not find target element");g.appendChild(_),u&&!jt()&&(this.inspector=new Ar(_,n))}createNode(e){M(this.stage,"Stage is not initialized");const s=this.stage.createNode(e);return this.inspector?this.inspector.createNode(s):s}createTextNode(e){const s=this.stage.createTextNode(e);return this.inspector?this.inspector.createTextNode(s):s}destroyNode(e){return this.inspector&&this.inspector.destroyNode(e.id),e.destroy()}createTexture(e,s){return this.stage.txManager.loadTexture(e,s)}createShader(e,s){return this.stage.shManager.loadShader(e,s)}createDynamicShader(e){return this.stage.shManager.loadDynamicShader({effects:e})}createEffect(e,s,i){return{name:i,type:e,props:s}}getNodeById(e){var n;const s=(n=this.stage)==null?void 0:n.root;if(!s)return null;const i=o=>{if(o.id===e)return o;for(const l of o.children){const h=i(l);if(h)return h}return null};return i(s)}toggleFreeze(){throw new Error("Not implemented")}advanceFrame(){throw new Error("Not implemented")}getBufferInfo(){return this.stage.renderer.getBufferInfo()}rerender(){throw new Error("Not implemented")}}let Ee,es;function Bi(r={},t="app"){return Ee=new Fi(r,t),es=Ee.createShader.bind(Ee),Ee}var Oi={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1};function Di(){return!!(Oi&&!1)}const Ui=Di()||!1,ee={debug:!1,animationsEnabled:!0,animationSettings:{duration:250,easing:"ease-in-out"},fontSettings:{fontFamily:"Ubuntu",fontSize:100},setActiveElement:()=>{}};function ys(r){return Ni(r)&&r.debug}function de(r,t,...e){Ui&&(ee.debug||ys(t)||ys(e[0]))&&console.log(r,t,...e)}const xe=r=>r instanceof Function;function Ni(r){return typeof r=="object"}function Ge(r){return Array.isArray(r)}function Ts(r){return typeof r=="string"}function ki(r){return typeof r=="number"}function $i(r){return Number.isInteger(r)}function zi(r){return"destroy"in r&&typeof r.destroy=="function"}function lt(r){return r instanceof fe}function Xi(r,t){for(const e of t)if(e in r)return!0;return!1}function Vs(r,t={}){if(Ge(r))r.forEach(e=>{Vs(e,t)});else if(r)for(const e in r)t[e]===void 0&&(t[e]=r[e]);return t}class _s extends Array{constructor(e,s={}){var t=(...Ln)=>(super(...Ln),a(this,"onChange"),this);return Ge(s)?t(...s):Ts(s)?t(s):t(...Object.entries(s).filter(([i,n])=>n).map(([i])=>i)),this.onChange=e,this}has(e){return this.indexOf(e)>=0}is(e){return this.indexOf(e)>=0}add(e){this.has(e)||(this.push(e),this.onChange())}toggle(e,s){s===!0?this.add(e):s===!1?this.remove(e):this.has(e)?this.remove(e):this.add(e)}merge(e){if(Ge(e))this.length=0,this.push(...e);else if(Ts(e))this.length=0,this.push(e);else for(const s in e)this.toggle(s,e[s]);return this}remove(e){const s=this.indexOf(e);s>=0&&(this.splice(s,1),this.onChange())}}const le={Element:"element",TextNode:"textNode",Text:"text"};function Gi(r){const t=[];let e=!1,s=0;for(let f=0;f<r.children.length;f++){const v=r.children[f];if(v._type!==le.Text&&v.flexItem!==!1){if(v._type===le.TextNode&&v.text&&!(v.width||v.height))return!1;v.flexOrder!==void 0&&(e=!0),v.flexGrow!==void 0&&(s+=v.flexGrow),t.push(v)}}e&&t.sort((f,v)=>(f.flexOrder||0)-(v.flexOrder||0));const i=t.length,o=(r.flexDirection||"row")==="row",l=o?"width":"height",h=o?"height":"width",c=o?"marginLeft":"marginTop",u=o?"marginRight":"marginBottom",d=o?"x":"y",p=o?"y":"x",_=r[l]||0,g=r[h]||0,T=r.gap||0,R=r.justifyContent||"flexStart",b=r.alignItems;if(s){const f=t.reduce((w,S)=>w+(S.flexGrow?0:S[l]||0)+(S[c]||0)+(S[u]||0),0),v=(_-f-T*(i-1))/s;for(let w=0;w<t.length;w++){const S=t[w];S.flexGrow!==void 0&&S.flexGrow>0&&(S[l]=S.flexGrow*v)}}let m=0;["center","spaceBetween","spaceEvenly"].includes(R)&&(m=t.reduce((f,v)=>f+(v[l]||0)+(v[c]||0)+(v[u]||0),0));const x=g&&b?f=>{b==="flexStart"?f[p]=0:b==="center"?f[p]=(g-(f[h]||0))/2:b==="flexEnd"&&(f[p]=g-(f[h]||0))}:f=>f;if(R==="flexStart"){let f=0;for(let v=0;v<t.length;v++){const w=t[v];w[d]=f+(w[c]||0),f+=(w[l]||0)+T+(w[c]||0)+(w[u]||0),x(w)}if(r.flexBoundary!=="fixed"){const v=f-T;if(v!==r[l])return r[l]=v,!0}}else if(R==="flexEnd"){let f=_;for(let v=i-1;v>=0;v--){const w=t[v];w[d]=f-(w[l]||0)-(w[u]||0),f-=(w[l]||0)+T+(w[c]||0)+(w[u]||0),x(w)}if(r.flexBoundary!=="fixed"){const v=f-T;if(v!==r[l])return r[l]=v,!0}}else if(R==="center"){let f=(_-(m+T*(i-1)))/2;for(let v=0;v<t.length;v++){const w=t[v];w[d]=f+(w[c]||0),f+=(w[l]||0)+T+(w[c]||0)+(w[u]||0),x(w)}}else if(R==="spaceBetween"){const f=(_-m)/(i-1);let v=0;for(let w=0;w<t.length;w++){const S=t[w];S[d]=v+(S[c]||0),v+=(S[l]||0)+f+(S[c]||0)+(S[u]||0),x(S)}}else if(R==="spaceEvenly"){const f=(_-m)/(i+1);let v=f;for(let w=0;w<t.length;w++){const S=t[w];S[d]=v+(S[c]||0),v+=(S[l]||0)+f+(S[c]||0)+(S[u]||0),x(S)}}return!1}let vs;const Wi=r=>{Hi(r,vs),vs=r,ee.setActiveElement(r)};let Rs=[];const Hi=(r,t)=>{var i,n;let e=r;const s=[];for(;e;)(!e.states.has("focus")||e===r)&&(e.states.add("focus"),(i=e.onFocus)==null||i.call(e,r,t),(n=e.onFocusChanged)==null||n.call(e,!0,r,t)),s.push(e),e=e.parent;return Rs.forEach(o=>{var l,h;s.includes(o)||(o.states.remove("focus"),(l=o.onBlur)==null||l.call(o,r,t),(h=o.onFocusChanged)==null||h.call(o,!1,r,t))}),Rs=s,s},ht=new Set;let Ot=!0;function Ss(r){const t=[];let e=0;for(const[s,i]of Object.entries(r))t.push({name:`effect${e}`,type:s,props:i}),e++;return es("DynamicShader",{effects:t})}function Pe(r=""){return{set(t){ki(t)&&(t={width:t,color:255}),this.effects=this.effects?{...this.effects||{},[`border${r}`]:t}:{[`border${r}`]:t}},get(){var t;return(t=this.effects)==null?void 0:t[`border${r}`]}}}const Vi=["alpha","color","colorTop","colorRight","colorLeft","colorBottom","colorTl","colorTr","colorBl","colorBr","height","fontSize","lineHeight","mount","mountX","mountY","pivot","pivotX","pivotY","rotation","scale","scaleX","scaleY","width","worldX","worldY","x","y","zIndex","zIndexLocked"],Yi=["absX","absY","autosize","clipping","contain","data","fontFamily","fontStretch","fontStyle","fontWeight","letterSpacing","maxLines","offsetY","overflowSuffix","rtt","scrollable","scrollY","src","text","textAlign","textBaseline","textOverflow","texture","textureOptions","verticalAlign","wordWrap"];class fe extends Object{constructor(t){super(),this._type=t==="text"?le.TextNode:le.Element,this.rendered=!1,this.lng={},this.children=[]}get effects(){return this._effects}set effects(t){this._effects=t,this.rendered&&(this.shader=Ss(t))}get parent(){return this._parent}set parent(t){this._parent=t,this.rendered&&(this.lng.parent=(t==null?void 0:t.lng)??null)}insertChild(t,e){if(t.parent=this,e){this.removeChild(t);const s=this.children.indexOf(e);if(s>=0){this.children.splice(s,0,t);return}}this.children.push(t)}removeChild(t){const e=this.children.indexOf(t);e>=0&&this.children.splice(e,1)}get selectedNode(){const t=this.selected||0;for(let e=t;e<this.children.length;e++){const s=this.children[e];if(lt(s))return this.selected=e,s}}set shader(t){let e=t;Ge(t)&&(e=es(...t)),this.lng.shader=e}_sendToLightningAnimatable(t,e){if(this.transition&&this.rendered&&ee.animationsEnabled&&(this.transition===!0||this.transition[t])){const s=this.transition===!0||this.transition[t]===!0?void 0:this.transition[t],i=this.animate({[t]:e},s);return xe(this.onAnimationStarted)&&i.once("animating",n=>{var o;(o=this.onAnimationStarted)==null||o.call(this,n,t,e)}),xe(this.onAnimationFinished)&&i.once("stopped",n=>{var o;(o=this.onAnimationFinished)==null||o.call(this,n,t,e)}),i.start()}this.lng[t]=e}animate(t,e){return M(this.rendered,"Node must be rendered before animating"),this.lng.animate(t,e||this.animationSettings)}chain(t,e){return this._animationRunning&&(this._animationQueue=[],this._animationRunning=!1),e?this._animationQueueSettings=e:this._animationQueueSettings||(this._animationQueueSettings=e||this.animationSettings),e=e||this._animationQueueSettings,this._animationQueue=this._animationQueue||[],this._animationQueue.push({props:t,animationSettings:e}),this}async start(){let t=this._animationQueue.shift();for(;t;)this._animationRunning=!0,await this.animate(t.props,t.animationSettings).start().waitUntilStopped(),t=this._animationQueue.shift();this._animationRunning=!1,this._animationQueueSettings=void 0}setFocus(){if(!this.skipFocus)if(this.rendered){if(this.forwardFocus!==void 0)if(xe(this.forwardFocus)){if(this.forwardFocus.call(this,this)!==!1)return}else{const t=typeof this.forwardFocus=="number"?this.forwardFocus:null,e=this.children;if(t!==null&&t<e.length){const s=e[t];lt(s)&&s.setFocus();return}}queueMicrotask(()=>Wi(this))}else this._autofocus=!0}isTextNode(){return this._type===le.TextNode}_layoutOnLoad(){this.lng.on("loaded",(t,e)=>{const{dimensions:s}=e;this.parent.updateLayout(this,s)})}getText(){let t="";for(let e=0;e<this.children.length;e++)t+=this.children[e].text;return t}destroy(){this._queueDelete&&zi(this.lng)&&(this.lng.destroy(),this.parent&&this.parent.requiresLayout()&&this.parent.updateLayout())}set onEvents(t){this._events=t}get onEvents(){return this._events}set style(t){Ge(t)?this._style=Vs(t):this._style=t;for(const e in this._style)this[e]===void 0&&(this[e]=this._style[e])}get style(){return this._style}get hasChildren(){return this.children.length>0}getChildById(t){return this.children.find(e=>e.id===t)}searchChildrenById(t){for(let e=0;e<this.children.length;e++){const s=this.children[e];if(lt(s)){if(s.id===t)return s;const i=s.searchChildrenById(t);if(i)return i}}}set states(t){this._states=this._states?this._states.merge(t):new _s(this._stateChanged.bind(this),t),this.rendered&&this._stateChanged()}get states(){return this._states=this._states||new _s(this._stateChanged.bind(this)),this._states}get animationSettings(){return this._animationSettings||ee.animationSettings}set animationSettings(t){this._animationSettings=t}set hidden(t){this.alpha=t?0:1}get hidden(){return this.alpha===0}set autofocus(t){this._autofocus=!!t,this._autofocus&&this.setFocus()}get autofocus(){return this._autofocus}requiresLayout(){return this.display==="flex"||this.onBeforeLayout}set updateLayoutOn(t){this.updateLayout()}get updateLayoutOn(){return null}updateLayout(t,e){var s,i;if(this.hasChildren){de("Layout: ",this);let n=!1;xe(this.onBeforeLayout)&&(n=this.onBeforeLayout.call(this,this,t,e)||!1),this.display==="flex"?(Gi(this)||n)&&((s=this.parent)==null||s.updateLayout()):n&&((i=this.parent)==null||i.updateLayout()),xe(this.onLayout)&&this.onLayout.call(this,this,t,e)}}_stateChanged(){if(de("State Changed: ",this,this.states),this.forwardStates){const e=this.states.slice();this.children.forEach(s=>{s.states=e})}const t=this.states;if(this._undoStyles||this.style&&Xi(this.style,t)){this._undoStyles=this._undoStyles||[];const e={};this._undoStyles.forEach(i=>{e[i]=this.style[i]});const s=t.reduce((i,n)=>{const o=this.style[n];return o&&(i={...i,...o}),i},{});this._undoStyles=Object.keys(s),s.transition!==void 0&&(this.transition=s.transition),Object.assign(this,e,s)}}render(){var i;const t=this,e=this.parent;if(!e){console.warn("Parent not set - no node created for: ",this);return}if(!e.rendered){console.warn("Parent not rendered yet: ",this);return}if(e.requiresLayout()&&!ht.has(e)&&(ht.add(e),Ot&&(Ot=!1,queueMicrotask(()=>{Ot=!0;const n=[...ht];ht.clear();for(let o=n.length-1;o>=0;o--)n[o].updateLayout()}))),this.rendered)return;this._states&&this._stateChanged();const s=t.lng;if(s.x=s.x||0,s.y=s.y||0,e.rendered&&(s.parent=e.lng),t._effects&&(s.shader=Ss(t._effects)),t.isTextNode()){const n=s;if(ee.fontSettings)for(const o in ee.fontSettings)n[o]===void 0&&(n[o]=ee.fontSettings[o]);n.text=n.text||t.getText(),n.textAlign&&!n.contain&&console.warn("Text align requires contain: ",t.getText()),n.contain&&(n.width||(n.width=(e.width||0)-n.x-(n.marginRight||0)),n.contain==="both"&&!n.height&&!n.maxLines?n.height=(e.height||0)-n.y-(n.marginBottom||0):n.maxLines===1&&(n.height=n.height||n.lineHeight||n.fontSize)),de("Rendering: ",this,s),t.lng=Ee.createTextNode(s),e.requiresLayout()&&(!s.width||!s.height)&&t._layoutOnLoad()}else s.texture||(isNaN(s.width)&&(s.width=(e.width||0)-s.x),isNaN(s.height)&&(s.height=(e.height||0)-s.y),s.rtt&&!s.color&&(s.color=4294967295),!s.color&&!s.src&&(s.color=0)),de("Rendering: ",this,s),t.lng=Ee.createNode(s);if(t.rendered=!0,t.autosize&&e.requiresLayout()&&t._layoutOnLoad(),t.onFail&&t.lng.on("failed",t.onFail),t.onLoad&&t.lng.on("loaded",t.onLoad),xe(this.onCreate)&&this.onCreate.call(this,t),t.onEvents&&t.onEvents.forEach(([n,o])=>{t.lng.on(n,(l,h)=>o(t,h))}),(i=t.lng)!=null&&i.div&&(t.lng.div.element=t),t._type===le.Element)for(let n=0;n<t.children.length;n++){const o=t.children[n];M(o,"Child is undefined"),lt(o)?o.render():o.text&&o._type===le.Text&&console.warn("TextNode outside of <Text>: ",o)}t._autofocus&&t.setFocus()}}for(const r of Vi)Object.defineProperty(fe.prototype,r,{get(){return this.lng[r]},set(t){this._sendToLightningAnimatable(r,t)}});for(const r of Yi)Object.defineProperty(fe.prototype,r,{get(){return this.lng[r]},set(t){this.lng[r]=t}});Object.defineProperties(fe.prototype,{borderRadius:{set(r){this.effects=this.effects?{...this.effects,radius:{radius:r}}:{radius:{radius:r}}},get(){var r,t;return(t=(r=this.effects)==null?void 0:r.radius)==null?void 0:t.radius}},border:Pe(),borderLeft:Pe("Left"),borderRight:Pe("Right"),borderTop:Pe("Top"),borderBottom:Pe("Bottom"),linearGradient:{set(r={}){this.effects=this.effects?{...this.effects,linearGradient:r}:{linearGradient:r}},get(){var r;return(r=this.effects)==null?void 0:r.linearGradient}},radialGradient:{set(r={}){this.effects=this.effects?{...this.effects,radialGradient:r}:{radialGradient:r}},get(){var r;return(r=this.effects)==null?void 0:r.radialGradient}},radialProgress:{set(r={}){this.effects=this.effects?{...this.effects,radialProgressGradient:r}:{radialProgressGradient:r}},get(){var r;return(r=this.effects)==null?void 0:r.radialProgress}}});const qi=(r,t)=>r===t,Yt=Symbol("solid-proxy"),ji=Symbol("solid-track"),_t={equals:qi};let Ki=Zs;const me=1,vt=2,Ys={owned:null,cleanups:null,context:null,owner:null};var X=null;let Dt=null,Qi=null,$=null,Y=null,pe=null,Et=0;function qt(r,t){const e=$,s=X,i=r.length===0,n=s,o=i?Ys:{owned:null,cleanups:null,context:n?n.context:null,owner:n},l=i?r:()=>r(()=>ge(()=>At(o)));X=o,$=null;try{return Ye(l,!0)}finally{$=e,X=s}}function ts(r,t){t=t?Object.assign({},_t,t):_t;const e={value:r,observers:null,observerSlots:null,comparator:t.equals||void 0},s=i=>(typeof i=="function"&&(i=i(e.value)),js(e,i));return[qs.bind(e),s]}function oe(r,t,e){const s=Ks(r,t,!1,me);Ct(s)}function We(r,t,e){e=e?Object.assign({},_t,e):_t;const s=Ks(r,t,!0,0);return s.observers=null,s.observerSlots=null,s.comparator=e.equals||void 0,Ct(s),qs.bind(s)}function ge(r){if($===null)return r();const t=$;$=null;try{return r()}finally{$=t}}function Zi(r){return X===null||(X.cleanups===null?X.cleanups=[r]:X.cleanups.push(r)),r}function qs(){if(this.sources&&this.state)if(this.state===me)Ct(this);else{const r=Y;Y=null,Ye(()=>Rt(this),!1),Y=r}if($){const r=this.observers?this.observers.length:0;$.sources?($.sources.push(this),$.sourceSlots.push(r)):($.sources=[this],$.sourceSlots=[r]),this.observers?(this.observers.push($),this.observerSlots.push($.sources.length-1)):(this.observers=[$],this.observerSlots=[$.sources.length-1])}return this.value}function js(r,t,e){let s=r.value;return(!r.comparator||!r.comparator(s,t))&&(r.value=t,r.observers&&r.observers.length&&Ye(()=>{for(let i=0;i<r.observers.length;i+=1){const n=r.observers[i],o=Dt&&Dt.running;o&&Dt.disposed.has(n),(o?!n.tState:!n.state)&&(n.pure?Y.push(n):pe.push(n),n.observers&&Js(n)),o||(n.state=me)}if(Y.length>1e6)throw Y=[],new Error},!1)),t}function Ct(r){if(!r.fn)return;At(r);const t=Et;Ji(r,r.value,t)}function Ji(r,t,e){let s;const i=X,n=$;$=X=r;try{s=r.fn(t)}catch(o){return r.pure&&(r.state=me,r.owned&&r.owned.forEach(At),r.owned=null),r.updatedAt=e+1,er(o)}finally{$=n,X=i}(!r.updatedAt||r.updatedAt<=e)&&(r.updatedAt!=null&&"observers"in r?js(r,s):r.value=s,r.updatedAt=e)}function Ks(r,t,e,s=me,i){const n={fn:r,state:s,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:X,context:X?X.context:null,pure:e};return X===null||X!==Ys&&(X.owned?X.owned.push(n):X.owned=[n]),n}function Qs(r){if(r.state===0)return;if(r.state===vt)return Rt(r);if(r.suspense&&ge(r.suspense.inFallback))return r.suspense.effects.push(r);const t=[r];for(;(r=r.owner)&&(!r.updatedAt||r.updatedAt<Et);)r.state&&t.push(r);for(let e=t.length-1;e>=0;e--)if(r=t[e],r.state===me)Ct(r);else if(r.state===vt){const s=Y;Y=null,Ye(()=>Rt(r,t[0]),!1),Y=s}}function Ye(r,t){if(Y)return r();let e=!1;t||(Y=[]),pe?e=!0:pe=[],Et++;try{const s=r();return en(e),s}catch(s){e||(pe=null),Y=null,er(s)}}function en(r){if(Y&&(Zs(Y),Y=null),r)return;const t=pe;pe=null,t.length&&Ye(()=>Ki(t),!1)}function Zs(r){for(let t=0;t<r.length;t++)Qs(r[t])}function Rt(r,t){r.state=0;for(let e=0;e<r.sources.length;e+=1){const s=r.sources[e];if(s.sources){const i=s.state;i===me?s!==t&&(!s.updatedAt||s.updatedAt<Et)&&Qs(s):i===vt&&Rt(s,t)}}}function Js(r){for(let t=0;t<r.observers.length;t+=1){const e=r.observers[t];e.state||(e.state=vt,e.pure?Y.push(e):pe.push(e),e.observers&&Js(e))}}function At(r){let t;if(r.sources)for(;r.sources.length;){const e=r.sources.pop(),s=r.sourceSlots.pop(),i=e.observers;if(i&&i.length){const n=i.pop(),o=e.observerSlots.pop();s<i.length&&(n.sourceSlots[o]=s,i[s]=n,e.observerSlots[s]=o)}}if(r.owned){for(t=r.owned.length-1;t>=0;t--)At(r.owned[t]);r.owned=null}if(r.cleanups){for(t=r.cleanups.length-1;t>=0;t--)r.cleanups[t]();r.cleanups=null}r.state=0}function tn(r){return r instanceof Error?r:new Error(typeof r=="string"?r:"Unknown error",{cause:r})}function er(r,t=X){throw tn(r)}const ws=Symbol("fallback");function bs(r){for(let t=0;t<r.length;t++)r[t]()}function sn(r,t,e={}){let s=[],i=[],n=[],o=[],l=0,h;return Zi(()=>bs(n)),()=>{const c=r()||[],u=c.length;return c[ji],ge(()=>{if(u===0)return l!==0&&(bs(n),n=[],s=[],i=[],l=0,o=[]),e.fallback&&(s=[ws],i[0]=qt(p=>(n[0]=p,e.fallback())),l=1),i;for(s[0]===ws&&(n[0](),n=[],s=[],i=[],l=0),h=0;h<u;h++)h<s.length&&s[h]!==c[h]?o[h](()=>c[h]):h>=s.length&&(i[h]=qt(d));for(;h<s.length;h++)n[h]();return l=o.length=n.length=u,s=c.slice(0),i=i.slice(0,l)});function d(p){n[h]=p;const[_,g]=ts(c[h]);return o[h]=g,t(_,h)}}}function rn(r,t){return ge(()=>r(t||{}))}function ct(){return!0}const nn={get(r,t,e){return t===Yt?e:r.get(t)},has(r,t){return t===Yt?!0:r.has(t)},set:ct,deleteProperty:ct,getOwnPropertyDescriptor(r,t){return{configurable:!0,enumerable:!0,get(){return r.get(t)},set:ct,deleteProperty:ct}},ownKeys(r){return r.keys()}};function Ut(r){return(r=typeof r=="function"?r():r)?r:{}}function on(){for(let r=0,t=this.length;r<t;++r){const e=this[r]();if(e!==void 0)return e}}function tr(...r){let t=!1;for(let o=0;o<r.length;o++){const l=r[o];t=t||!!l&&Yt in l,r[o]=typeof l=="function"?(t=!0,We(l)):l}if(t)return new Proxy({get(o){for(let l=r.length-1;l>=0;l--){const h=Ut(r[l])[o];if(h!==void 0)return h}},has(o){for(let l=r.length-1;l>=0;l--)if(o in Ut(r[l]))return!0;return!1},keys(){const o=[];for(let l=0;l<r.length;l++)o.push(...Object.keys(Ut(r[l])));return[...new Set(o)]}},nn);const e={},s=Object.create(null);for(let o=r.length-1;o>=0;o--){const l=r[o];if(!l)continue;const h=Object.getOwnPropertyNames(l);for(let c=h.length-1;c>=0;c--){const u=h[c];if(u==="__proto__"||u==="constructor")continue;const d=Object.getOwnPropertyDescriptor(l,u);if(!s[u])s[u]=d.get?{enumerable:!0,configurable:!0,get:on.bind(e[u]=[d.get.bind(l)])}:d.value!==void 0?d:void 0;else{const p=e[u];p&&(d.get?p.push(d.get.bind(l)):d.value!==void 0&&p.push(()=>d.value))}}}const i={},n=Object.keys(s);for(let o=n.length-1;o>=0;o--){const l=n[o],h=s[l];h&&h.get?Object.defineProperty(i,l,h):i[l]=h?h.value:void 0}return i}const an=r=>`Stale read from <${r}>.`;function ln(r){const t="fallback"in r&&{fallback:()=>r.fallback};return We(sn(()=>r.each,r.children,t||void 0))}function hn(r){const t=r.keyed,e=We(()=>r.when,void 0,{equals:(s,i)=>t?s===i:!s==!i});return We(()=>{const s=e();if(s){const i=r.children;return typeof i=="function"&&i.length>0?ge(()=>i(t?s:()=>{if(!ge(e))throw an("Show");return r.when})):i}return r.fallback},void 0,void 0)}const[Rn,cn]=ts(void 0);function un(r=""){return $i(r)?r:typeof r=="string"?r.startsWith("#")?+(r.replace("#","0x")+(r.length===7?"ff":"")):r.startsWith("0x")?Number(r):+("0x"+(r.length===6?r+"ff":r)):0}function dn({createElement:r,createTextNode:t,isTextNode:e,replaceText:s,insertNode:i,removeNode:n,setProperty:o,getParentNode:l,getFirstChild:h,getNextSibling:c}){function u(m,x,f,v){if(f!==void 0&&!v&&(v=[]),typeof x!="function")return d(m,x,v,f);oe(w=>d(m,x(),w,f),v)}function d(m,x,f,v,w){for(;typeof f=="function";)f=f();if(x===f)return f;const S=typeof x,A=v!==void 0;if(S==="string"||S==="number")if(S==="number"&&(x=x.toString()),A){let E=f[0];E&&e(E)?s(E,x):E=t(x),f=g(m,f,v,E)}else f!==""&&typeof f=="string"?s(h(m),f=x):(g(m,f,v,t(x)),f=x);else if(x==null||S==="boolean")f=g(m,f,v);else{if(S==="function")return oe(()=>{let E=x();for(;typeof E=="function";)E=E();f=d(m,E,f,v)}),()=>f;if(Array.isArray(x)){const E=[];if(p(E,x,w))return oe(()=>f=d(m,E,f,v,!0)),()=>f;if(E.length===0){const L=g(m,f,v);if(A)return f=L}else Array.isArray(f)?f.length===0?T(m,E,v):_(m,f,E):f==null||f===""?T(m,E):_(m,A&&f||[h(m)],E);f=E}else{if(Array.isArray(f)){if(A)return f=g(m,f,v,x);g(m,f,null,x)}else f==null||f===""||!h(m)?i(m,x):R(m,x,h(m));f=x}}return f}function p(m,x,f){let v=!1;for(let w=0,S=x.length;w<S;w++){let A=x[w],E;if(!(A==null||A===!0||A===!1))if(Array.isArray(A))v=p(m,A)||v;else if((E=typeof A)=="string"||E==="number")m.push(t(A));else if(E==="function")if(f){for(;typeof A=="function";)A=A();v=p(m,Array.isArray(A)?A:[A])||v}else m.push(A),v=!0;else m.push(A)}return v}function _(m,x,f){let v=f.length,w=x.length,S=v,A=0,E=0,L=c(x[w-1]),y=null;for(;A<w||E<S;){if(x[A]===f[E]){A++,E++;continue}for(;x[w-1]===f[S-1];)w--,S--;if(w===A){const F=S<v?E?c(f[E-1]):f[S-E]:L;for(;E<S;)i(m,f[E++],F)}else if(S===E)for(;A<w;)(!y||!y.has(x[A]))&&n(m,x[A]),A++;else if(x[A]===f[S-1]&&f[E]===x[w-1]){const F=c(x[--w]);i(m,f[E++],c(x[A++])),i(m,f[--S],F),x[w]=f[S]}else{if(!y){y=new Map;let O=E;for(;O<S;)y.set(f[O],O++)}const F=y.get(x[A]);if(F!=null)if(E<F&&F<S){let O=A,D=1,I;for(;++O<w&&O<S&&!((I=y.get(x[O]))==null||I!==F+D);)D++;if(D>F-E){const P=x[A];for(;E<F;)i(m,f[E++],P)}else R(m,f[E++],x[A++])}else A++;else n(m,x[A++])}}}function g(m,x,f,v){if(f===void 0){let S;for(;S=h(m);)n(m,S);return v&&i(m,v),""}const w=v||t("");if(x.length){let S=!1;for(let A=x.length-1;A>=0;A--){const E=x[A];if(w!==E){const L=l(E)===m;!S&&!A?L?R(m,w,E):i(m,w,f):L&&n(m,E)}else S=!0}}else i(m,w,f);return[w]}function T(m,x,f){for(let v=0,w=x.length;v<w;v++)i(m,x[v],f)}function R(m,x,f){i(m,x,f),n(m,f)}function b(m,x,f={},v){return x||(x={}),v||oe(()=>f.children=d(m,x.children,f.children)),oe(()=>x.ref&&x.ref(m)),oe(()=>{for(const w in x){if(w==="children"||w==="ref")continue;const S=x[w];S!==f[w]&&(o(m,w,S,f[w]),f[w]=S)}}),f}return{render(m,x){let f;return qt(v=>{f=v,u(x,m())}),f},insert:u,spread(m,x,f){typeof x=="function"?oe(v=>b(m,x(),v,f)):b(m,x,void 0,f)},createElement:r,createTextNode:t,insertNode:i,setProp(m,x,f,v){return o(m,x,f,v),f},mergeProps:tr,effect:oe,memo:We,createComponent:rn,use(m,x,f){return ge(()=>m(x,f))}}}function fn(r){const t=dn(r);return t.mergeProps=tr,t}const sr={createElement(r){return new fe(r)},createTextNode(r){return{_type:le.Text,text:r,parent:void 0}},replaceText(r,t){de("Replace Text: ",r,t),r.text=t;const e=r.parent;M(e),e.text=e.getText()},setProperty(r,t,e=!0){r[t]=e},insertNode(r,t,e){de("INSERT: ",r,t,e),r.insertChild(t,e),t._queueDelete=!1,t instanceof fe?r.rendered&&t.render():r.isTextNode()&&(r.text=r.getText())},isTextNode(r){return r.isTextNode()},removeNode(r,t){de("REMOVE: ",r,t),r.removeChild(t),t._queueDelete=!0,t instanceof fe&&queueMicrotask(()=>t.destroy())},getParentNode(r){return r.parent},getFirstChild(r){return r.children[0]},getNextSibling(r){const t=r.parent.children||[],e=t.indexOf(r)+1;if(e<t.length)return t[e]}},rr=fn(sr);let Nt;const gt=sr.createElement("App"),pn=function(r){return rr.render(r,gt)};function gn(r=ee.rendererOptions,t){return Nt=Bi(r,"app"),ee.setActiveElement=cn,gt.lng=Nt.root,gt.rendered=!0,{renderer:Nt,rootNode:gt,render:pn}}const{effect:Sn,memo:wn,createComponent:Ne,createElement:ir,createTextNode:bn,insertNode:En,insert:Cn,spread:nr,setProp:An,mergeProps:Mn,use:In}=rr,Es=r=>{const t=ir("node");return nr(t,r,!1),t};function Fe(r,t){return Math.floor(Math.random()*(t-r+1))+r}const mn=()=>"0x"+Math.floor(Math.random()*16777215).toString(16)+"FF",xn=()=>{const[r,t]=ts([]);let e;const s=()=>{const i=[];for(let n=0;n<1e3;n++)i.push({width:Fe(50,100),height:Fe(50,100),x:Fe(0,Tn),y:Fe(0,yn),borderRadius:Fe(0,50),color:mn()});t(i)};return setInterval(()=>{s()},2e3),Ne(Es,{get style(){return{color:un("#f0f0f0")}},get children(){return Ne(hn,{get when(){return r().length>0},get children(){return Ne(Es,{ref(i){var n=e;typeof n=="function"?n(i):e=i},get children(){return Ne(ln,{get each(){return r()},children:i=>(()=>{var n=ir("node");return nr(n,i,!1),n})()})}})}})}})},yn=600,Tn=800;ee.debug=!1;ee.fontSettings.fontFamily="Ubuntu";ee.fontSettings.color=4294967295;ee.rendererOptions={numImageWorkers:2,enableInspector:!1};const{render:_n}=gn();_n(()=>Ne(xn,{}));
//# sourceMappingURL=index-P0QgJhKr.js.map
