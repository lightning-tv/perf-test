var ps=Object.defineProperty;var gs=(s,t,e)=>t in s?ps(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var l=(s,t,e)=>gs(s,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function e(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(i){if(i.ep)return;i.ep=!0;const n=e(i);fetch(i.href,n)}})();const ms={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1};function xs(s,t=!1,e){const r={alpha:!0,antialias:!1,depth:!1,stencil:!0,desynchronized:!1,powerPreference:"high-performance",premultipliedAlpha:!0,preserveDrawingBuffer:!1},i=s.getContext(t?"webgl2":"webgl",r)||s.getContext("experimental-webgl",r);if(!i)throw new Error("Unable to create WebGL context");return e?new Proxy(i,{get(n,o){const a=n[o];return typeof a=="function"?(e.increment(String(o)),a.bind(n)):a}}):i}function A(s,t){if(Xr()!==!0&&!s)throw new Error(t||"Assertion failed")}function vr(s,t,e){const r=Math.trunc(s>>>24),i=Math.trunc(s>>>16&255),n=Math.trunc(s>>>8&255),o=Math.trunc(s&255),a=Math.trunc(t>>>24),c=Math.trunc(t>>>16&255),h=Math.trunc(t>>>8&255),d=Math.trunc(t&255),u=Math.round(a*e+r*(1-e)),g=Math.round(c*e+i*(1-e)),p=Math.round(h*e+n*(1-e)),T=Math.round(d*e+o*(1-e));return(u<<24|g<<16|p<<8|T)>>>0}let Nr=!0;function ys(s){Nr=s==="webgl"}function He(s,t,e=!1){const r=(s&255)/255*t,i=Nr?r:1,n=Math.trunc((s>>>24)*i),o=Math.trunc((s>>>16&255)*i),a=Math.trunc((s>>>8&255)*i),c=Math.trunc(r*255);return e?(c<<24|a<<16|o<<8|n)>>>0:(n<<24|o<<16|a<<8|c)>>>0}function ft(s,t){return Object.prototype.hasOwnProperty.call(s,t)}function Xr(){return ms&&!0}let vs=1;function Ts(){return vs++}class Ne{constructor(){l(this,"eventListeners",{})}on(t,e){let r=this.eventListeners[t];r||(r=[]),r.push(e),this.eventListeners[t]=r}off(t,e){const r=this.eventListeners[t];if(!r)return;if(!e){delete this.eventListeners[t];return}const i=r.indexOf(e);i>=0&&r.splice(i,1)}once(t,e){const r=(i,n)=>{this.off(t,r),e(i,n)};this.on(t,r)}emit(t,e){const r=this.eventListeners[t];r&&[...r].forEach(i=>{i(this,e)})}removeAllListeners(){this.eventListeners={}}}const _s=/^(data|ftps?|https?):/,De=s=>{const t=s>>>24,e=s>>>16&255,r=s>>>8&255,i=s&255;return[t/255,e/255,r/255,i/255]};function de(s,t,e,r,i){return i?(i.x1=s,i.y1=t,i.x2=e,i.y2=r,i):{x1:s,y1:t,x2:e,y2:r}}function Rs(s,t,e){const r=Math.max(s.x,t.x),i=Math.max(s.y,t.y),n=Math.min(s.x+s.width,t.x+t.width)-r,o=Math.min(s.y+s.height,t.y+t.height)-i;return n>0&&o>0?e?(e.x=r,e.y=i,e.width=n,e.height=o,e):{x:r,y:i,width:n,height:o}:e?(e.x=0,e.y=0,e.width=0,e.height=0,e):{x:0,y:0,width:0,height:0}}function bs(s,t){return t?(t.x=s.x,t.y=s.y,t.width=s.width,t.height=s.height,t):{x:s.x,y:s.y,width:s.width,height:s.height}}function ws(s,t){return s===t?!0:s===null||t===null?!1:s.x===t.x&&s.y===t.y&&s.width===t.width&&s.height===t.height}function Tr(s,t){return s.x1<=t.x2&&s.y1<=t.y2&&s.x2>=t.x1&&s.y2>=t.y1}function Ss(s,t){return s.x1<t.x1&&s.x2>t.x2&&s.y1<t.y1&&s.y2>t.y2}function Es(s){if(self.location.protocol==="file:"&&!_s.test(s)){const e=self.location.pathname.split("/");e.pop();const r=e.join("/"),i=self.location.protocol+"//"+r;return s.charAt(0)==="."&&(s=s.slice(1)),s.charAt(0)==="/"&&(s=s.slice(1)),i+"/"+s}return new URL(s,self.location.href).href}class X{constructor(){l(this,"ta");l(this,"tb");l(this,"tx");l(this,"tc");l(this,"td");l(this,"ty");l(this,"_floatArr",null);l(this,"mutation");this.ta=0,this.tb=0,this.tx=0,this.tc=0,this.td=0,this.ty=0,this.mutation=!0}static get temp(){return Cs}static multiply(t,e,r){const i=t.ta*e.ta+t.tb*e.tc,n=t.ta*e.tb+t.tb*e.td,o=t.ta*e.tx+t.tb*e.ty+t.tx,a=t.tc*e.ta+t.td*e.tc,c=t.tc*e.tb+t.td*e.td,h=t.tc*e.tx+t.td*e.ty+t.ty;return r||(r=new X),r.ta=i,r.tb=n,r.tx=o,r.tc=a,r.td=c,r.ty=h,r.mutation=!0,r}static identity(t){return t||(t=new X),t.ta=1,t.tb=0,t.tx=0,t.tc=0,t.td=1,t.ty=0,t.mutation=!0,t}static translate(t,e,r){return r||(r=new X),r.ta=1,r.tb=0,r.tx=t,r.tc=0,r.td=1,r.ty=e,r.mutation=!0,r}static scale(t,e,r){return r||(r=new X),r.ta=t,r.tb=0,r.tx=0,r.tc=0,r.td=e,r.ty=0,r.mutation=!0,r}static rotate(t,e){const r=Math.cos(t),i=Math.sin(t);return e||(e=new X),e.ta=r,e.tb=-i,e.tx=0,e.tc=i,e.td=r,e.ty=0,e.mutation=!0,e}static copy(t,e){return e||(e=new X),e.ta=t.ta,e.tc=t.tc,e.tb=t.tb,e.td=t.td,e.tx=t.tx,e.ty=t.ty,e.mutation=!0,e}translate(t,e){return this.tx=this.ta*t+this.tb*e+this.tx,this.ty=this.tc*t+this.td*e+this.ty,this.mutation=!0,this}scale(t,e){return this.ta=this.ta*t,this.tb=this.tb*e,this.tc=this.tc*t,this.td=this.td*e,this.mutation=!0,this}rotate(t){if(t===0||!(t%Math.PI*2))return this;const e=Math.cos(t),r=Math.sin(t),i=this.ta*e+this.tb*r,n=this.tb*e-this.ta*r,o=this.tc*e+this.td*r,a=this.td*e-this.tc*r;return this.ta=i,this.tb=n,this.tc=o,this.td=a,this.mutation=!0,this}multiply(t){return X.multiply(this,t,this)}getFloatArr(){return this._floatArr||(this._floatArr=new Float32Array(9)),this.mutation&&(this._floatArr[0]=this.ta,this._floatArr[1]=this.tc,this._floatArr[2]=0,this._floatArr[3]=this.tb,this._floatArr[4]=this.td,this._floatArr[5]=0,this._floatArr[6]=this.tx,this._floatArr[7]=this.ty,this._floatArr[8]=1,this.mutation=!1),this._floatArr}}const Cs=new X,qe=0,je=2,Ke=4,Qe=6,Ze=1,Je=3,et=5,tt=7;class pt{constructor(t){l(this,"data");this.data=new Float32Array(8),t&&(this.data[qe]=t[qe],this.data[je]=t[je],this.data[Ke]=t[Ke],this.data[Qe]=t[Qe],this.data[Ze]=t[Ze],this.data[Je]=t[Je],this.data[et]=t[et],this.data[tt]=t[tt])}static translate(t,e,r,i,n,o,a,c,h){return h||(h=new pt),h.data[qe]=t,h.data[je]=r,h.data[Ke]=n,h.data[Qe]=a,h.data[Ze]=e,h.data[Je]=i,h.data[et]=o,h.data[tt]=c,h}get x1(){return this.data[qe]}get x2(){return this.data[je]}get x3(){return this.data[Ke]}get x4(){return this.data[Qe]}get y1(){return this.data[Ze]}get y2(){return this.data[Je]}get y3(){return this.data[et]}get y4(){return this.data[tt]}}const _r=s=>s&&!(s&s-1),zr=(s,t,e,r)=>{const i=3*s,n=3*(e-s)-i,o=1-i-n,a=3*t,c=3*(r-t)-a,h=1-a-c;return function(d){if(d>=1)return 1;if(d<=0)return 0;let u=.5,g,p,T;for(let w=0;w<20;w++){if(g=u*(u*(u*o+n)+i),T=d-g,T>-1e-8&&T<1e-8)return u*(u*(u*h+c)+a);if(p=u*(u*(3*o)+2*n)+i,p>1e-10&&p<1e-10)break;u+=T/p}let v=0,R=1;for(let w=0;w<20;w++){if(u=.5*(v+R),g=u*(u*(u*o+n)+i),T=d-g,T>-1e-8&&T<1e-8)return u*(u*(u*h+c)+a);T<0?R=u:v=u}}},lt={},As={ease:[.25,.1,.25,1],"ease-in":[.42,0,1,1],"ease-out":[0,0,.58,1],"ease-in-out":[.42,0,.58,1],"ease-in-sine":[.12,0,.39,0],"ease-out-sine":[.12,0,.39,0],"ease-in-out-sine":[.37,0,.63,1],"ease-in-cubic":[.32,0,.67,0],"ease-out-cubic":[.33,1,.68,1],"ease-in-out-cubic":[.65,0,.35,1],"ease-in-circ":[.55,0,1,.45],"ease-out-circ":[0,.55,.45,1],"ease-in-out-circ":[.85,0,.15,1],"ease-in-back":[.36,0,.66,-.56],"ease-out-back":[.34,1.56,.64,1],"ease-in-out-back":[.68,-.6,.32,1.6]},ct=s=>s,Ms=s=>{const t=/-?\d*\.?\d+/g,e=s.match(t);if(e){const[r,i,n,o]=e,a=parseFloat(r||"0.42"),c=parseFloat(i||"0"),h=parseFloat(n||"1"),d=parseFloat(o||"1"),u=zr(a,c,h,d);return lt[s]=u,u}return console.warn("Unknown cubic-bezier timing: "+s),ct},Is=s=>{if(s==="linear")return ct;if(lt[s]!==void 0)return lt[s]||ct;if(s==="step-start")return()=>1;if(s==="step-end")return e=>e===1?1:0;const t=As[s];if(t!==void 0){const[e,r,i,n]=t,o=zr(e,r,i,n);return lt[s]=o,o}return s.startsWith("cubic-bezier")?Ms(s):(console.warn("Unknown timing function: "+s),ct)};function Rr(s){return(s/1024/1024).toFixed(2)}class Ps extends Ne{constructor(e,r,i){super();l(this,"node");l(this,"props");l(this,"settings");l(this,"progress",0);l(this,"delayFor",0);l(this,"delay",0);l(this,"timingFunction");l(this,"propValuesMap",{});l(this,"dynPropValuesMap");this.node=e,this.props=r;for(const a in r)if(a!=="shaderProps")this.propValuesMap.props===void 0&&(this.propValuesMap.props={}),this.propValuesMap.props[a]={start:e[a]||0,target:r[a]};else if(e.shader.type!=="DynamicShader"){this.propValuesMap.shaderProps={};for(const c in r.shaderProps)this.propValuesMap.shaderProps[c]={start:e.shader.props[c],target:r.shaderProps[c]}}else{const c=Object.keys(r.shaderProps),h=c.length;this.dynPropValuesMap={};for(let d=0;d<h;d++){const u=c[d],g=r.shaderProps[u];this.dynPropValuesMap[u]={};const p=Object.entries(g),T=p.length;for(let v=0;v<T;v++){const[R,w]=p[v];this.dynPropValuesMap[u][R]={start:e.shader.props[u][R],target:w}}}}const n=i.easing||"linear",o=i.delay??0;this.settings={duration:i.duration??0,delay:o,easing:n,loop:i.loop??!1,repeat:i.repeat??0,repeatDelay:i.repeatDelay??0,stopMethod:i.stopMethod??!1},this.timingFunction=Is(n),this.delayFor=o,this.delay=o}reset(){this.progress=0,this.delayFor=this.settings.delay||0,this.update(0)}restoreValues(e,r){const i=Object.entries(r),n=i.length;for(let o=0;o<n;o++){const[a,c]=i[o];e[a]=c.start}}restore(){if(this.reset(),this.propValuesMap.props!==void 0&&this.restoreValues(this.node,this.propValuesMap.props),this.propValuesMap.shaderProps!==void 0&&this.restoreValues(this.node.shader.props,this.propValuesMap.shaderProps),this.dynPropValuesMap!==void 0){const e=Object.keys(this.dynPropValuesMap),r=e.length;if(r>0)for(let i=0;i<r;i++){const n=e[i];this.restoreValues(this.node.shader.props[n],this.dynPropValuesMap[n])}}}reverseValues(e){const r=Object.entries(e),i=r.length;for(let n=0;n<i;n++){const[o,a]=r[n];e[o]={start:a.target,target:a.start}}}reverse(){if(this.progress=0,this.propValuesMap.props!==void 0&&this.reverseValues(this.propValuesMap.props),this.propValuesMap.shaderProps!==void 0&&this.reverseValues(this.propValuesMap.shaderProps),this.dynPropValuesMap!==void 0){const e=Object.keys(this.dynPropValuesMap),r=e.length;if(r>0)for(let i=0;i<r;i++){const n=e[i];this.reverseValues(this.dynPropValuesMap[n])}}this.settings.loop||(this.settings.stopMethod=!1)}applyEasing(e,r,i){return(this.timingFunction(e)||e)*(i-r)+r}updateValue(e,r,i,n){if(this.progress===1)return r;if(this.progress===0)return i;const o=r;if(e.indexOf("color")!==-1){if(i===o)return i;if(n){const a=this.timingFunction(this.progress)||this.progress;return vr(i,o,a)}return vr(i,o,this.progress)}return n?this.applyEasing(this.progress,i,o):i+(o-i)*this.progress}updateValues(e,r,i){const n=Object.entries(r),o=n.length;for(let a=0;a<o;a++){const[c,h]=n[a];e[c]=this.updateValue(c,h.target,h.start,i)}}update(e){const{duration:r,loop:i,easing:n,stopMethod:o}=this.settings,{delayFor:a}=this;if(r===0&&a===0){this.emit("finished",{});return}if(this.delayFor>0){if(this.delayFor-=e,this.delayFor>=0)return;e=-this.delayFor,this.delayFor=0}if(r===0){this.emit("finished",{});return}if(this.progress===0&&this.emit("animating",{}),this.progress+=e/r,this.progress>1&&(this.progress=i?0:1,this.delayFor=this.delay,o)){this.emit("finished",{});return}if(this.propValuesMap.props!==void 0&&this.updateValues(this.node,this.propValuesMap.props,n),this.propValuesMap.shaderProps!==void 0&&this.updateValues(this.node.shader.props,this.propValuesMap.shaderProps,n),this.dynPropValuesMap!==void 0){const c=Object.keys(this.dynPropValuesMap),h=c.length;if(h>0)for(let d=0;d<h;d++){const u=c[d];this.updateValues(this.node.shader.props[u],this.dynPropValuesMap[u],n)}}this.progress<1&&this.emit("tick",{progress:this.progress}),this.progress===1&&this.emit("finished",{})}}class Ls extends Ne{constructor(e,r){super();l(this,"manager");l(this,"animation");l(this,"stoppedPromise");l(this,"stoppedResolve",null);l(this,"state");this.manager=e,this.animation=r,this.state="stopped",this.stoppedPromise=Promise.resolve(),this.onAnimating=this.onAnimating.bind(this),this.onFinished=this.onFinished.bind(this),this.onTick=this.onTick.bind(this)}start(){return this.state!=="running"&&this.state!=="scheduled"&&(this.makeStoppedPromise(),this.registerAnimation(),this.state="scheduled"),this}stop(){return this.unregisterAnimation(),this.stoppedResolve!==null&&(this.stoppedResolve(),this.stoppedResolve=null,this.emit("stopped",this)),this.animation.reset(),this.state="stopped",this}pause(){return this.unregisterAnimation(),this.state="paused",this}restore(){return this.stoppedResolve=null,this.animation.restore(),this}waitUntilStopped(){return this.stoppedPromise}registerAnimation(){this.animation.once("finished",this.onFinished),this.animation.on("animating",this.onAnimating),this.animation.on("tick",this.onTick),this.manager.registerAnimation(this.animation)}unregisterAnimation(){this.manager.unregisterAnimation(this.animation),this.animation.off("finished",this.onFinished),this.animation.off("animating",this.onAnimating),this.animation.off("tick",this.onTick)}makeStoppedPromise(){this.stoppedResolve===null&&(this.stoppedPromise=new Promise(e=>{this.stoppedResolve=e}))}onFinished(){A(this.stoppedResolve);const{loop:e,stopMethod:r}=this.animation.settings;if(r==="reverse"){this.animation.once("finished",this.onFinished),this.animation.reverse();return}e||(this.unregisterAnimation(),this.stoppedResolve(),this.stoppedResolve=null,this.emit("stopped",this),this.state="stopped")}onAnimating(){this.state="running",this.emit("animating",this)}onTick(e,r){this.emit("tick",r)}}var F;(function(s){s[s.Init=0]="Init",s[s.OutOfBounds=2]="OutOfBounds",s[s.InBounds=4]="InBounds",s[s.InViewport=8]="InViewport"})(F||(F={}));const Xe=new Map;Xe.set(F.Init,"init");Xe.set(F.OutOfBounds,"outOfBounds");Xe.set(F.InBounds,"inBounds");Xe.set(F.InViewport,"inViewport");var y;(function(s){s[s.Children=1]="Children",s[s.ScaleRotate=2]="ScaleRotate",s[s.Local=4]="Local",s[s.Global=8]="Global",s[s.Clipping=16]="Clipping",s[s.CalculatedZIndex=32]="CalculatedZIndex",s[s.ZIndexSortedChildren=64]="ZIndexSortedChildren",s[s.PremultipliedColors=128]="PremultipliedColors",s[s.WorldAlpha=256]="WorldAlpha",s[s.RenderState=512]="RenderState",s[s.IsRenderable=1024]="IsRenderable",s[s.RenderTexture=2048]="RenderTexture",s[s.ParentRenderTexture=4096]="ParentRenderTexture",s[s.RenderBounds=8192]="RenderBounds",s[s.None=0]="None",s[s.All=14335]="All"})(y||(y={}));class Yt extends Ne{constructor(e,r){super();l(this,"stage");l(this,"children",[]);l(this,"_id",Ts());l(this,"props");l(this,"updateType",y.All);l(this,"childUpdateType",y.None);l(this,"globalTransform");l(this,"scaleRotateTransform");l(this,"localTransform");l(this,"renderCoords");l(this,"renderBound");l(this,"strictBound");l(this,"preloadBound");l(this,"clippingRect",{x:0,y:0,width:0,height:0,valid:!1});l(this,"isRenderable",!1);l(this,"renderState",F.Init);l(this,"worldAlpha",1);l(this,"premultipliedColorTl",0);l(this,"premultipliedColorTr",0);l(this,"premultipliedColorBl",0);l(this,"premultipliedColorBr",0);l(this,"calcZIndex",0);l(this,"hasRTTupdates",!1);l(this,"parentHasRenderTexture",!1);l(this,"onTextureLoaded",(e,r)=>{var i,n;this.autosizeNode(r),this.stage.requestRender(),this.parentHasRenderTexture&&this.setRTTUpdates(1),this.emit("loaded",{type:"texture",dimensions:r}),((n=(i=this.props.textureOptions)==null?void 0:i.resizeMode)==null?void 0:n.type)==="contain"&&this.setUpdateType(y.Local)});l(this,"onTextureFailed",(e,r)=>{this.emit("failed",{type:"texture",error:r})});l(this,"onTextureFreed",()=>{this.emit("freed",{type:"texture"})});this.stage=e,this.props={...r,parent:null,texture:null,src:null,rtt:!1},this.parent=r.parent,this.texture=r.texture,this.src=r.src,this.rtt=r.rtt,this.setUpdateType(y.ScaleRotate|y.Local|y.RenderBounds|y.RenderState)}loadTexture(){const{texture:e}=this.props;A(e),queueMicrotask(()=>{e.preventCleanup=this.props.preventCleanup,this.textureOptions.preload&&e.ctxTexture.load(),e.state==="loaded"?(A(e.dimensions),this.onTextureLoaded(e,e.dimensions)):e.state==="failed"?(A(e.error),this.onTextureFailed(e,e.error)):e.state==="freed"&&this.onTextureFreed(e),e.on("loaded",this.onTextureLoaded),e.on("failed",this.onTextureFailed),e.on("freed",this.onTextureFreed)})}unloadTexture(){this.texture!==null&&(this.texture.off("loaded",this.onTextureLoaded),this.texture.off("failed",this.onTextureFailed),this.texture.off("freed",this.onTextureFreed),this.texture.setRenderableOwner(this,!1))}autosizeNode(e){this.autosize&&(this.width=e.width,this.height=e.height)}setUpdateType(e){this.updateType|=e;const r=this.props.parent;r!==null&&!(r.updateType&y.Children)&&r.setUpdateType(y.Children),this.parentHasRenderTexture&&(this.setRTTUpdates(e),r!==null&&r.setUpdateType(y.RenderTexture))}sortChildren(){this.children.sort((e,r)=>e.calcZIndex-r.calcZIndex)}updateScaleRotateTransform(){const{rotation:e,scaleX:r,scaleY:i}=this.props;if(e===0&&r===1&&i===1){this.scaleRotateTransform=void 0;return}this.scaleRotateTransform=X.rotate(e,this.scaleRotateTransform).scale(r,i)}updateLocalTransform(){var h,d;const{x:e,y:r,width:i,height:n}=this.props,o=this.props.mountX*i,a=this.props.mountY*n;if(this.scaleRotateTransform){const u=this.props.pivotX*i,g=this.props.pivotY*n;this.localTransform=X.translate(e-o+u,r-a+g,this.localTransform).multiply(this.scaleRotateTransform).translate(-u,-g)}else this.localTransform=X.translate(e-o,r-a,this.localTransform);const c=this.props.texture;if(c&&c.dimensions&&((d=(h=this.props.textureOptions)==null?void 0:h.resizeMode)==null?void 0:d.type)==="contain"){let u=1,g=1,p=0,T=0;const{width:v,height:R}=c.dimensions,w=v/R,m=i/n;if(w>m){const x=i/v,f=R*x;T=(n-f)/2,g=f/n}else{const x=n/R,f=v*x;p=(i-f)/2,u=f/i}this.localTransform.translate(p,T).scale(u,g)}this.setUpdateType(y.Global)}update(e,r){var o,a;this.updateType&y.ScaleRotate&&(this.updateScaleRotateTransform(),this.setUpdateType(y.Local)),this.updateType&y.Local&&(this.updateLocalTransform(),this.setUpdateType(y.Global));const i=this.props.parent;let n=null;if(this.updateType&y.ParentRenderTexture){let c=this.parent;for(;c;)c.rtt&&(this.parentHasRenderTexture=!0),c=c.parent}if(this.updateType^y.All&&this.updateType&y.RenderTexture)for(let c=0,h=this.children.length;c<h;c++)(o=this.children[c])==null||o.setUpdateType(y.All);if(this.updateType&y.Global&&(A(this.localTransform),this.globalTransform=X.copy((i==null?void 0:i.globalTransform)||this.localTransform,this.globalTransform),this.parentHasRenderTexture&&((a=this.props.parent)!=null&&a.rtt)&&(this.globalTransform=X.identity()),i&&this.globalTransform.multiply(this.localTransform),this.calculateRenderCoords(),this.updateBoundingRect(),this.setUpdateType(y.RenderState|y.Children),this.childUpdateType|=y.Global,this.clipping===!0&&(this.setUpdateType(y.Clipping|y.RenderBounds),this.childUpdateType|=y.RenderBounds)),this.updateType&y.RenderBounds&&(this.createRenderBounds(),this.setUpdateType(y.RenderState),this.setUpdateType(y.Children)),this.updateType&y.RenderState&&(n=this.checkRenderBounds(),this.setUpdateType(y.IsRenderable),n!==F.OutOfBounds&&this.updateRenderState(n)),this.updateType&y.WorldAlpha&&(i?this.worldAlpha=i.worldAlpha*this.props.alpha:this.worldAlpha=this.props.alpha,this.setUpdateType(y.Children|y.PremultipliedColors|y.IsRenderable),this.childUpdateType|=y.WorldAlpha),this.updateType&y.IsRenderable&&this.updateIsRenderable(),this.updateType&y.Clipping&&(this.calculateClippingRect(r),this.setUpdateType(y.Children),this.childUpdateType|=y.Clipping,this.childUpdateType|=y.RenderBounds),this.updateType&y.PremultipliedColors&&(this.premultipliedColorTl=He(this.props.colorTl,this.worldAlpha,!0),this.props.colorTl===this.props.colorTr&&this.props.colorBl===this.props.colorBr&&this.props.colorTl===this.props.colorBl?this.premultipliedColorTr=this.premultipliedColorBl=this.premultipliedColorBr=this.premultipliedColorTl:(this.premultipliedColorTr=He(this.props.colorTr,this.worldAlpha,!0),this.premultipliedColorBl=He(this.props.colorBl,this.worldAlpha,!0),this.premultipliedColorBr=He(this.props.colorBr,this.worldAlpha,!0))),i!==null&&this.updateType&y.CalculatedZIndex&&(this.calculateZIndex(),i.setUpdateType(y.ZIndexSortedChildren)),!(this.props.strictBounds===!0&&this.renderState===F.OutOfBounds)){if(this.updateType&y.Children&&this.children.length>0&&this.rtt===!1)for(let c=0,h=this.children.length;c<h;c++){const d=this.children[c];d.setUpdateType(this.childUpdateType),d.updateType!==0&&d.update(e,this.clippingRect)}this.updateType&y.ZIndexSortedChildren&&this.sortChildren(),n===F.OutOfBounds&&this.updateRenderState(n),this.updateType=0,this.childUpdateType=0}}checkRenderProps(){return this.props.texture?!0:!this.props.width||!this.props.height?!1:!!(this.props.shader!==this.stage.defShaderCtr||this.props.clipping||this.props.color!==0||this.props.colorTop!==0||this.props.colorBottom!==0||this.props.colorLeft!==0||this.props.colorRight!==0||this.props.colorTl!==0||this.props.colorTr!==0||this.props.colorBl!==0||this.props.colorBr!==0)}checkRenderBounds(){return A(this.renderBound),A(this.strictBound),A(this.preloadBound),Tr(this.renderBound,this.strictBound)?F.InViewport:Tr(this.renderBound,this.preloadBound)?F.InBounds:Ss(this.renderBound,this.strictBound)?F.InViewport:this.parent!==null&&(this.props.width===0||this.props.height===0)?this.parent.renderState:F.OutOfBounds}createPreloadBounds(e){const r=this.stage.boundsMargin;return de(e.x1-r[3],e.y1-r[0],e.x2+r[1],e.y2+r[2])}updateBoundingRect(){const{renderCoords:e,globalTransform:r}=this;A(r),A(e);const{tb:i,tc:n}=r,{x1:o,y1:a,x3:c,y3:h}=e;if(i===0||n===0)this.renderBound=de(o,a,c,h,this.renderBound);else{const{x2:d,x4:u,y2:g,y4:p}=e;this.renderBound=de(Math.min(o,d,c,u),Math.min(a,g,h,p),Math.max(o,d,c,u),Math.max(a,g,h,p),this.renderBound)}}createRenderBounds(){if(A(this.stage),this.clipping===!1)if(this.parent!==null&&this.parent.strictBound!==void 0){this.strictBound=de(this.parent.strictBound.x1,this.parent.strictBound.y1,this.parent.strictBound.x2,this.parent.strictBound.y2),this.preloadBound=this.createPreloadBounds(this.strictBound);return}else{this.strictBound=de(0,0,this.stage.root.width,this.stage.root.height),this.preloadBound=this.createPreloadBounds(this.strictBound);return}const{x:e,y:r,width:i,height:n}=this.props,{tx:o,ty:a}=this.globalTransform||{},c=o??e,h=a??r;this.strictBound=de(c,h,c+i,h+n,this.strictBound),this.preloadBound=this.createPreloadBounds(this.strictBound)}updateRenderState(e){if(e===this.renderState)return;const r=this.renderState;this.renderState=e;const i=Xe.get(e);A(i),this.emit(i,{previous:r,current:e})}updateIsRenderable(){let e;this.worldAlpha===0||!this.checkRenderProps()?e=!1:e=this.renderState>F.OutOfBounds,this.isRenderable!==e&&(this.isRenderable=e,this.onChangeIsRenderable(e))}onChangeIsRenderable(e){var r;(r=this.texture)==null||r.setRenderableOwner(this,e)}calculateRenderCoords(){const{width:e,height:r,globalTransform:i}=this;A(i);const{tx:n,ty:o,ta:a,tb:c,tc:h,td:d}=i;if(c===0&&h===0){const u=n,g=n+e*a,p=o,T=o+r*d;this.renderCoords=pt.translate(u,p,g,p,g,T,u,T,this.renderCoords)}else this.renderCoords=pt.translate(n,o,n+e*a,o+e*h,n+e*a+r*c,o+e*h+r*d,n+r*c,o+r*d,this.renderCoords)}calculateClippingRect(e){A(this.globalTransform);const{clippingRect:r,props:i,globalTransform:n}=this,{clipping:o}=i,a=n.tb!==0||n.tc!==0;o===!0&&a===!1?(r.x=n.tx,r.y=n.ty,r.width=this.width*n.ta,r.height=this.height*n.td,r.valid=!0):r.valid=!1,e.valid===!0&&r.valid===!0?Rs(e,r,r):e.valid===!0&&(bs(e,r),r.valid=!0)}calculateZIndex(){var o,a;const e=this.props,r=e.zIndex||0,i=((o=e.parent)==null?void 0:o.zIndex)||0;let n=r;(a=e.parent)!=null&&a.zIndexLocked&&(n=r<i?r:i),this.calcZIndex=n}destroy(){var e;for(this.unloadTexture(),this.clippingRect.valid=!1,this.isRenderable=!1,this.renderCoords=void 0,this.renderBound=void 0,this.strictBound=void 0,this.preloadBound=void 0,this.globalTransform=void 0,this.scaleRotateTransform=void 0,this.localTransform=void 0,this.props.texture=null,this.props.shader=this.stage.defShaderCtr;this.children.length>0;)(e=this.children[0])==null||e.destroy();this.parent=null,this.rtt&&this.stage.renderer.removeRTTNode(this),this.removeAllListeners()}renderQuads(e){this.parentHasRenderTexture&&(!e.renderToTextureActive||this.parentRenderTexture!==e.activeRttNode)||(A(this.globalTransform),A(this.renderCoords),e.addQuad({width:this.props.width,height:this.props.height,colorTl:this.premultipliedColorTl,colorTr:this.premultipliedColorTr,colorBl:this.premultipliedColorBl,colorBr:this.premultipliedColorBr,texture:this.texture,textureOptions:this.textureOptions,zIndex:this.zIndex,shader:this.shader.shader,shaderProps:this.shader.getResolvedProps(),alpha:this.worldAlpha,clippingRect:this.clippingRect,tx:this.globalTransform.tx,ty:this.globalTransform.ty,ta:this.globalTransform.ta,tb:this.globalTransform.tb,tc:this.globalTransform.tc,td:this.globalTransform.td,renderCoords:this.renderCoords,rtt:this.rtt,parentHasRenderTexture:this.parentHasRenderTexture,framebufferDimensions:this.framebufferDimensions}))}get id(){return this._id}get data(){return this.props.data}set data(e){this.props.data=e}get x(){return this.props.x}set x(e){this.props.x!==e&&(this.props.x=e,this.setUpdateType(y.Local))}get absX(){var e,r,i;return this.props.x+-this.props.width*this.props.mountX+(((e=this.props.parent)==null?void 0:e.absX)||((i=(r=this.props.parent)==null?void 0:r.globalTransform)==null?void 0:i.tx)||0)}get absY(){var e;return this.props.y+-this.props.height*this.props.mountY+(((e=this.props.parent)==null?void 0:e.absY)??0)}get y(){return this.props.y}set y(e){this.props.y!==e&&(this.props.y=e,this.setUpdateType(y.Local))}get width(){return this.props.width}set width(e){this.props.width!==e&&(this.props.width=e,this.setUpdateType(y.Local),this.props.rtt&&(this.texture=this.stage.txManager.loadTexture("RenderTexture",{width:this.width,height:this.height}),this.textureOptions.preload=!0,this.setUpdateType(y.RenderTexture)))}get height(){return this.props.height}set height(e){this.props.height!==e&&(this.props.height=e,this.setUpdateType(y.Local),this.props.rtt&&(this.texture=this.stage.txManager.loadTexture("RenderTexture",{width:this.width,height:this.height}),this.textureOptions.preload=!0,this.setUpdateType(y.RenderTexture)))}get scale(){return this.scaleX}set scale(e){this.scaleX=e,this.scaleY=e}get scaleX(){return this.props.scaleX}set scaleX(e){this.props.scaleX!==e&&(this.props.scaleX=e,this.setUpdateType(y.ScaleRotate))}get scaleY(){return this.props.scaleY}set scaleY(e){this.props.scaleY!==e&&(this.props.scaleY=e,this.setUpdateType(y.ScaleRotate))}get mount(){return this.props.mount}set mount(e){(this.props.mountX!==e||this.props.mountY!==e)&&(this.props.mountX=e,this.props.mountY=e,this.props.mount=e,this.setUpdateType(y.Local))}get mountX(){return this.props.mountX}set mountX(e){this.props.mountX!==e&&(this.props.mountX=e,this.setUpdateType(y.Local))}get mountY(){return this.props.mountY}set mountY(e){this.props.mountY!==e&&(this.props.mountY=e,this.setUpdateType(y.Local))}get pivot(){return this.props.pivot}set pivot(e){(this.props.pivotX!==e||this.props.pivotY!==e)&&(this.props.pivotX=e,this.props.pivotY=e,this.props.pivot=e,this.setUpdateType(y.Local))}get pivotX(){return this.props.pivotX}set pivotX(e){this.props.pivotX!==e&&(this.props.pivotX=e,this.setUpdateType(y.Local))}get pivotY(){return this.props.pivotY}set pivotY(e){this.props.pivotY!==e&&(this.props.pivotY=e,this.setUpdateType(y.Local))}get rotation(){return this.props.rotation}set rotation(e){this.props.rotation!==e&&(this.props.rotation=e,this.setUpdateType(y.ScaleRotate))}get alpha(){return this.props.alpha}set alpha(e){this.props.alpha=e,this.setUpdateType(y.PremultipliedColors|y.WorldAlpha|y.Children|y.IsRenderable),this.childUpdateType|=y.WorldAlpha}get autosize(){return this.props.autosize}set autosize(e){this.props.autosize=e}get clipping(){return this.props.clipping}set clipping(e){this.props.clipping=e,this.setUpdateType(y.Clipping|y.RenderBounds|y.Children),this.childUpdateType|=y.Global|y.Clipping}get color(){return this.props.color}set color(e){this.colorTop=e,this.colorBottom=e,this.colorLeft=e,this.colorRight=e,this.props.color=e,this.setUpdateType(y.PremultipliedColors)}get colorTop(){return this.props.colorTop}set colorTop(e){(this.props.colorTl!==e||this.props.colorTr!==e)&&(this.colorTl=e,this.colorTr=e),this.props.colorTop=e,this.setUpdateType(y.PremultipliedColors)}get colorBottom(){return this.props.colorBottom}set colorBottom(e){(this.props.colorBl!==e||this.props.colorBr!==e)&&(this.colorBl=e,this.colorBr=e),this.props.colorBottom=e,this.setUpdateType(y.PremultipliedColors)}get colorLeft(){return this.props.colorLeft}set colorLeft(e){(this.props.colorTl!==e||this.props.colorBl!==e)&&(this.colorTl=e,this.colorBl=e),this.props.colorLeft=e,this.setUpdateType(y.PremultipliedColors)}get colorRight(){return this.props.colorRight}set colorRight(e){(this.props.colorTr!==e||this.props.colorBr!==e)&&(this.colorTr=e,this.colorBr=e),this.props.colorRight=e,this.setUpdateType(y.PremultipliedColors)}get colorTl(){return this.props.colorTl}set colorTl(e){this.props.colorTl=e,this.setUpdateType(y.PremultipliedColors)}get colorTr(){return this.props.colorTr}set colorTr(e){this.props.colorTr=e,this.setUpdateType(y.PremultipliedColors)}get colorBl(){return this.props.colorBl}set colorBl(e){this.props.colorBl=e,this.setUpdateType(y.PremultipliedColors)}get colorBr(){return this.props.colorBr}set colorBr(e){this.props.colorBr=e,this.setUpdateType(y.PremultipliedColors)}get zIndexLocked(){return this.props.zIndexLocked||0}set zIndexLocked(e){this.props.zIndexLocked=e,this.setUpdateType(y.CalculatedZIndex|y.Children);for(let r=0,i=this.children.length;r<i;r++)this.children[r].setUpdateType(y.CalculatedZIndex)}get zIndex(){return this.props.zIndex}set zIndex(e){this.props.zIndex=e,this.setUpdateType(y.CalculatedZIndex|y.Children);for(let r=0,i=this.children.length;r<i;r++)this.children[r].setUpdateType(y.CalculatedZIndex)}get parent(){return this.props.parent}set parent(e){const r=this.props.parent;if(r!==e){if(this.props.parent=e,r){const i=r.children.indexOf(this);A(i!==-1,"CoreNode.parent: Node not found in old parent's children!"),r.children.splice(i,1),r.setUpdateType(y.Children|y.ZIndexSortedChildren)}e&&(e.children.push(this),this.setUpdateType(y.All),e.setUpdateType(y.Children|y.ZIndexSortedChildren),(e.rtt||e.parentHasRenderTexture)&&this.setRTTUpdates(y.All)),this.updateScaleRotateTransform(),this.setUpdateType(y.RenderBounds|y.Children)}}get preventCleanup(){return this.props.preventCleanup}set preventCleanup(e){this.props.preventCleanup=e}get rtt(){return this.props.rtt}set rtt(e){var r,i;if(this.props.rtt===!0&&(this.props.rtt=e,e===!1&&this.texture!==null)){this.unloadTexture(),this.setUpdateType(y.All);for(let n=0,o=this.children.length;n<o;n++)this.children[n].parentHasRenderTexture=!1;(r=this.stage.renderer)==null||r.removeRTTNode(this);return}if(e!==!1){this.texture=this.stage.txManager.loadTexture("RenderTexture",{width:this.width,height:this.height}),this.textureOptions.preload=!0,this.props.rtt=!0,this.hasRTTupdates=!0,this.setUpdateType(y.All);for(let n=0,o=this.children.length;n<o;n++)this.children[n].setUpdateType(y.All);(i=this.stage.renderer)==null||i.renderToTexture(this)}}get shader(){return this.props.shader}set shader(e){this.props.shader!==e&&(this.props.shader=e,this.setUpdateType(y.IsRenderable))}get src(){return this.props.src}set src(e){if(this.props.src!==e){if(this.props.src=e,!e){this.texture=null;return}this.texture=this.stage.txManager.loadTexture("ImageTexture",{src:e,width:this.props.width,height:this.props.height,type:this.props.imageType,sx:this.props.srcX,sy:this.props.srcY,sw:this.props.srcWidth,sh:this.props.srcHeight})}}set imageType(e){this.props.imageType!==e&&(this.props.imageType=e)}get imageType(){return this.props.imageType||null}get srcHeight(){return this.props.srcHeight}set srcHeight(e){this.props.srcHeight=e}get srcWidth(){return this.props.srcWidth}set srcWidth(e){this.props.srcWidth=e}get srcX(){return this.props.srcX}set srcX(e){this.props.srcX=e}get srcY(){return this.props.srcY}set srcY(e){this.props.srcY=e}get framebufferDimensions(){return this.parentHasRenderTexture&&!this.rtt&&this.parent?this.parent.framebufferDimensions:{width:this.width,height:this.height}}get parentRenderTexture(){let e=this.parent;for(;e;){if(e.rtt)return e;e=e.parent}return null}get texture(){return this.props.texture}set texture(e){if(this.props.texture===e)return;const r=this.props.texture;r&&(r.setRenderableOwner(this,!1),this.unloadTexture()),this.props.texture=e,e&&(e.setRenderableOwner(this,this.isRenderable),this.loadTexture()),this.setUpdateType(y.IsRenderable)}set textureOptions(e){this.props.textureOptions=e}get textureOptions(){return this.props.textureOptions}get strictBounds(){return this.props.strictBounds}set strictBounds(e){e!==this.props.strictBounds&&(this.props.strictBounds=e,this.setUpdateType(y.RenderBounds|y.Children),this.childUpdateType|=y.RenderBounds|y.Children)}setRTTUpdates(e){var r;this.hasRTTupdates=!0,(r=this.parent)==null||r.setRTTUpdates(e)}animate(e,r){const i=new Ps(this,e,r);return new Ls(this.stage.animationManager,i)}flush(){}}const Bs=s=>{let t=!1;const e=()=>{if(s.updateFrameTime(),s.updateAnimations(),!s.hasSceneUpdates()){s.calculateFps(),setTimeout(e,16.666666666666668),t||(s.txMemManager.checkCleanup()&&s.txMemManager.cleanup(),s.eventBus.emit("idle"),t=!0),s.flushFrameEvents();return}t=!1,s.drawFrame(),s.flushFrameEvents(),requestAnimationFrame(e)};requestAnimationFrame(e)},Os=()=>performance?performance.now():Date.now();class Us{constructor(){l(this,"activeAnimations",new Set)}registerAnimation(t){this.activeAnimations.add(t)}unregisterAnimation(t){this.activeAnimations.delete(t)}update(t){this.activeAnimations.forEach(e=>{e.update(t)})}}var Y;(function(s){s[s.generic=0]="generic",s[s.color=1]="color",s[s.image=2]="image",s[s.noise=3]="noise",s[s.renderToTexture=4]="renderToTexture",s[s.subTexture=5]="subTexture"})(Y||(Y={}));class ze extends Ne{constructor(e){super();l(this,"txManager");l(this,"dimensions",null);l(this,"error",null);l(this,"state","freed");l(this,"renderableOwners",new Set);l(this,"renderable",!1);l(this,"lastRenderableChangeTime",0);l(this,"type",Y.generic);l(this,"preventCleanup",!1);this.txManager=e}setRenderableOwner(e,r){var n,o;const i=this.renderableOwners.size;if(r){this.renderableOwners.add(e);const a=this.renderableOwners.size;a>i&&a===1&&(this.renderable=!0,this.lastRenderableChangeTime=this.txManager.frameTime,(n=this.onChangeIsRenderable)==null||n.call(this,!0))}else{this.renderableOwners.delete(e);const a=this.renderableOwners.size;a<i&&a===0&&(this.renderable=!1,this.lastRenderableChangeTime=this.txManager.frameTime,(o=this.onChangeIsRenderable)==null||o.call(this,!1))}}get ctxTexture(){const e=this.txManager.renderer.createCtxTexture(this);return Object.defineProperty(this,"ctxTexture",{value:e}),e}setState(e,...r){if(this.state!==e){if(this.state=e,e==="loaded"){const i=r;this.dimensions=i[0]}else if(e==="failed"){const i=r;this.error=i[0]}this.emit(e,...r)}}static makeCacheKey(e){return!1}static resolveDefaults(e){return{}}}function ks(){function s(e){return e.indexOf("image/png")!==-1}function t(e,r,i,n,o,a){return new Promise(function(c,h){var d=new XMLHttpRequest;d.open("GET",e,!0),d.responseType="blob",d.onload=function(){if(d.status!==200)return h(new Error("Failed to load image: "+d.statusText));var u=d.response,g=r!==void 0?r:s(u.type);if(o!==null&&a!==null){createImageBitmap(u,i||0,n||0,o,a,{premultiplyAlpha:g?"premultiply":"none",colorSpaceConversion:"none",imageOrientation:"none"}).then(function(p){c({data:p,premultiplyAlpha:r})}).catch(function(p){h(p)});return}createImageBitmap(u,{premultiplyAlpha:g?"premultiply":"none",colorSpaceConversion:"none",imageOrientation:"none"}).then(function(p){c({data:p,premultiplyAlpha:r})}).catch(function(p){h(p)})},d.onerror=function(){h(new Error("Network error occurred while trying to fetch the image."))},d.send()})}self.onmessage=e=>{var r=e.data.src,i=e.data.id,n=e.data.premultiplyAlpha,o=e.data.sx,a=e.data.sy,c=e.data.sw,h=e.data.sh;t(r,n,o,a,c,h).then(function(d){self.postMessage({id:i,src:r,data:d})}).catch(function(d){self.postMessage({id:i,src:r,error:d.message})})}}class Ds{constructor(t){l(this,"imageWorkersEnabled",!0);l(this,"messageManager",{});l(this,"workers",[]);l(this,"workerIndex",0);l(this,"nextId",0);this.workers=this.createWorkers(t),this.workers.forEach(e=>{e.onmessage=this.handleMessage.bind(this)})}handleMessage(t){const{id:e,data:r,error:i}=t.data,n=this.messageManager[e];if(n){const[o,a]=n;delete this.messageManager[e],i?a(new Error(i)):o(r)}}createWorkers(t=1){const e=`(${ks.toString()})()`,r=new Blob([e.replace('"use strict";',"")],{type:"application/javascript"}),i=(self.URL?URL:webkitURL).createObjectURL(r),n=[];for(let o=0;o<t;o++)n.push(new Worker(i));return n}getNextWorker(){const t=this.workers[this.workerIndex];return this.workerIndex=(this.workerIndex+1)%this.workers.length,t}getImage(t,e,r,i,n,o){return new Promise((a,c)=>{try{if(this.workers){const h=this.nextId++;this.messageManager[h]=[a,c];const d=this.getNextWorker();d&&d.postMessage({id:h,src:t,premultiplyAlpha:e,sx:r,sy:i,sw:n,sh:o})}}catch(h){c(h)}})}}const Oe=class Oe extends ze{constructor(e,r){super(e);l(this,"type",Y.color);l(this,"props");this.props=Oe.resolveDefaults(r||{})}get color(){return this.props.color}set color(e){this.props.color=e}async getTextureData(){const e=new Uint32Array([this.color]),r=new Uint8ClampedArray(e.buffer);return{data:new ImageData(r,1,1),premultiplyAlpha:!0}}static makeCacheKey(e){return`ColorTexture,${Oe.resolveDefaults(e).color}`}static resolveDefaults(e){return{color:e.color||4294967295}}};l(Oe,"z$__type__Props");let gt=Oe;function Fs(s){return/\.(ktx|pvr)$/.test(s)}const br=async s=>{const e=await(await fetch(s)).arrayBuffer();return s.indexOf(".ktx")!==-1?Ns(e):Xs(e)},Ns=async s=>{const t=new DataView(s),e=t.getUint32(12)===16909060,r=[],i={glInternalFormat:t.getUint32(28,e),pixelWidth:t.getUint32(36,e),pixelHeight:t.getUint32(40,e),numberOfMipmapLevels:t.getUint32(56,e),bytesOfKeyValueData:t.getUint32(60,e)};let n=64;n+=i.bytesOfKeyValueData;for(let o=0;o<i.numberOfMipmapLevels;o++){const a=t.getUint32(n);n+=4,r.push(t.buffer.slice(n,a)),n+=a}return{data:{glInternalFormat:i.glInternalFormat,mipmaps:r,width:i.pixelWidth||0,height:i.pixelHeight||0,type:"ktx"},premultiplyAlpha:!1}},Xs=async s=>{const a=s,c=new Int32Array(a,0,13),h=c[12]+52,d=new Uint8Array(a,h),u=[],g={pixelWidth:c[7],pixelHeight:c[6],numberOfMipmapLevels:c[11]||0};let p=0,T=g.pixelWidth||0,v=g.pixelHeight||0;for(let R=0;R<g.numberOfMipmapLevels;R++){const w=(T+3>>2)*(v+3>>2)*8,m=new Uint8Array(a,d.byteOffset+p,w);u.push(m),p+=w,T=T>>1,v=v>>1}return{data:{glInternalFormat:36196,mipmaps:u,width:g.pixelWidth||0,height:g.pixelHeight||0,type:"pvr"},premultiplyAlpha:!1}};function zs(s){return/\.(svg)$/.test(s)}const wr=(s,t,e,r,i,n,o)=>new Promise((a,c)=>{const h=document.createElement("canvas"),d=h.getContext("2d");A(d),d.imageSmoothingEnabled=!0;const u=new Image;u.onload=()=>{const g=r??0,p=i??0,T=t||u.width,v=e||u.height;h.width=T,h.height=v,d.drawImage(u,0,0,T,v),a({data:d.getImageData(g,p,n??T,o??v),premultiplyAlpha:!1})},u.onerror=g=>{c(g)},u.src=s}),Ue=class Ue extends ze{constructor(e,r){super(e);l(this,"props");l(this,"type",Y.image);this.props=Ue.resolveDefaults(r)}hasAlphaChannel(e){return e.indexOf("image/png")!==-1}async loadImage(e){const{premultiplyAlpha:r,sx:i,sy:n,sw:o,sh:a,width:c,height:h}=this.props;if(this.txManager.imageWorkerManager!==null)return await this.txManager.imageWorkerManager.getImage(e,r,i,n,o,a);if(this.txManager.hasCreateImageBitmap===!0){const u=await(await fetch(e)).blob(),g=r??this.hasAlphaChannel(u.type);return o!==null&&a!==null?{data:await createImageBitmap(u,i??0,n??0,o,a,{premultiplyAlpha:g?"premultiply":"none",colorSpaceConversion:"none",imageOrientation:"none"}),premultiplyAlpha:g}:{data:await createImageBitmap(u,{premultiplyAlpha:g?"premultiply":"none",colorSpaceConversion:"none",imageOrientation:"none"}),premultiplyAlpha:g}}else{const d=new Image;return e.startsWith("data:")||(d.crossOrigin="Anonymous"),d.src=e,await new Promise((u,g)=>{d.onload=()=>u(),d.onerror=()=>g(new Error("Failed to load image"))}).catch(u=>{console.error(u)}),{data:d,premultiplyAlpha:r??!0}}}async getTextureData(){const{src:e,premultiplyAlpha:r,type:i}=this.props;if(e===null)return{data:null};if(typeof e!="string")return e instanceof ImageData?{data:e,premultiplyAlpha:r}:{data:e(),premultiplyAlpha:r};const n=Es(e);return i==="regular"?this.loadImage(n):i==="svg"?wr(n,this.props.width,this.props.height,this.props.sx,this.props.sy,this.props.sw,this.props.sh):zs(e)===!0?wr(n,this.props.width,this.props.height,this.props.sx,this.props.sy,this.props.sw,this.props.sh):i==="compressed"||Fs(e)===!0?br(n):this.loadImage(n)}static makeCacheKey(e){const r=Ue.resolveDefaults(e),i=r.key||r.src;if(typeof i!="string")return!1;let n="";return r.sh!==null&&r.sw!==null&&(n+=",",n+=r.sx??"",n+=r.sy??"",n+=r.sw||"",n+=r.sh||""),`ImageTexture,${i},${r.premultiplyAlpha??"true"}${n}`}static resolveDefaults(e){return{src:e.src??"",premultiplyAlpha:e.premultiplyAlpha??!0,key:e.key??null,type:e.type??null,width:e.width??null,height:e.height??null,sx:e.sx??null,sy:e.sy??null,sw:e.sw??null,sh:e.sh??null}}};l(Ue,"z$__type__Props");let Ht=Ue;const ke=class ke extends ze{constructor(e,r){super(e);l(this,"props");l(this,"type",Y.noise);this.props=ke.resolveDefaults(r)}async getTextureData(){const{width:e,height:r}=this.props,i=e*r*4,n=new Uint8ClampedArray(i);for(let o=0;o<i;o+=4){const a=Math.floor(Math.random()*256);n[o]=a,n[o+1]=a,n[o+2]=a,n[o+3]=255}return{data:new ImageData(n,e,r)}}static makeCacheKey(e){if(e.cacheId===void 0)return!1;const r=ke.resolveDefaults(e);return`NoiseTexture,${r.width},${r.height},${r.cacheId}`}static resolveDefaults(e){return{width:e.width??128,height:e.height??128,cacheId:e.cacheId??0}}};l(ke,"z$__type__Props");let qt=ke;const wt=class wt extends ze{constructor(e,r){super(e);l(this,"props");l(this,"parentTexture");l(this,"type",Y.subTexture);l(this,"onParentTxLoaded",()=>{this.setState("loaded",{width:this.props.width,height:this.props.height})});l(this,"onParentTxFailed",(e,r)=>{this.setState("failed",r)});this.props=wt.resolveDefaults(r||{}),this.parentTexture=this.props.texture,queueMicrotask(()=>{const i=this.parentTexture;i.state==="loaded"?this.onParentTxLoaded(i,i.dimensions):i.state==="failed"&&this.onParentTxFailed(i,i.error),i.on("loaded",this.onParentTxLoaded),i.on("failed",this.onParentTxFailed)})}onChangeIsRenderable(e){this.parentTexture.setRenderableOwner(this,e)}async getTextureData(){return{data:this.props}}static makeCacheKey(e){return!1}static resolveDefaults(e){return{texture:e.texture,x:e.x||0,y:e.y||0,width:e.width||0,height:e.height||0}}};l(wt,"z$__type__Props");let mt=wt;const St=class St extends ze{constructor(e,r){super(e);l(this,"props");l(this,"type",Y.renderToTexture);this.props=St.resolveDefaults(r||{})}get width(){return this.props.width}set width(e){this.props.width=e}get height(){return this.props.height}set height(e){this.props.height=e}async getTextureData(){return{data:null,premultiplyAlpha:null}}static resolveDefaults(e){return{width:e.width||256,height:e.height||256}}};l(St,"z$__type__Props");let xt=St;class $s{constructor(t){l(this,"keyCache",new Map);l(this,"inverseKeyCache",new WeakMap);l(this,"txConstructors",{});l(this,"imageWorkerManager",null);l(this,"hasCreateImageBitmap",!!self.createImageBitmap);l(this,"hasWorker",!!self.Worker);l(this,"renderer");l(this,"frameTime",0);this.hasCreateImageBitmap&&this.hasWorker&&t>0&&(this.imageWorkerManager=new Ds(t)),this.hasCreateImageBitmap||console.warn("[Lightning] createImageBitmap is not supported on this browser. ImageTexture will be slower."),this.registerTextureType("ImageTexture",Ht),this.registerTextureType("ColorTexture",gt),this.registerTextureType("NoiseTexture",qt),this.registerTextureType("SubTexture",mt),this.registerTextureType("RenderTexture",xt)}registerTextureType(t,e){this.txConstructors[t]=e}loadTexture(t,e){let r;const i=this.txConstructors[t];if(!i)throw new Error(`Texture type "${t}" is not registered`);if(!r){const n=i.makeCacheKey(e);n&&this.keyCache.has(n)?r=this.keyCache.get(n):(r=new i(this,e),n&&this.initTextureToCache(r,n))}return r}initTextureToCache(t,e){const{keyCache:r,inverseKeyCache:i}=this;r.set(e,t),i.set(t,e)}removeTextureFromCache(t){const{inverseKeyCache:e,keyCache:r}=this,i=e.get(t);i&&r.delete(i)}}const Vs={normal:400,bold:700,bolder:900,lighter:100},Sr=s=>typeof s=="number"?s:Vs[s]||400;function Gs(s,t,e,r,i){let n=Sr(e);for(const o of s){const a=o[t];if(!a)continue;if(a.size===1)return console.warn(`TrFontManager: Only one font face found for family: '${t}' - will be used for all weights and styles`),a.values().next().value;const c=new Map;for(const d of a){const u=Sr(d.descriptors.weight);if(u===n&&d.descriptors.style===r&&d.descriptors.stretch===i)return d;c.set(u,d)}const h=`TrFontManager: No exact match: '${t} Weight: ${n} Style: ${r} Stretch: ${i}'`;if(console.error(h),n===400&&c.has(500))return c.get(500);if(n===500&&c.has(400))return c.get(400);if(n<400){for(;n>0;){if(c.has(n))return c.get(n);n-=100}n=600}for(;n<1e3;){if(c.has(n))return c.get(n);n+=100}for(n=500;n>0;){if(c.has(n))return c.get(n);n-=100}}}class Ws{constructor(t){l(this,"textRenderers");l(this,"fontCache",new Map);this.textRenderers=t}addFontFace(t){for(const e in this.textRenderers){const r=this.textRenderers[e];r&&r.isFontFaceSupported(t)&&r.addFontFace(t)}}resolveFontFace(t,e,r){const{fontFamily:i,fontWeight:n,fontStyle:o,fontStretch:a}=e,c=`${r}_${i}_${o}_${n}_${a}`;if(this.fontCache.has(c)===!0)return this.fontCache.get(c);const h=Gs(t,i,n,o,a);return h!==void 0&&this.fontCache.set(c,h),h}}class $r{static makeCacheKey(t){return!1}static resolveDefaults(t){return{}}}function Er(s,t,e){const r=s.createShader(t);if(!r)throw new Error;if(s.shaderSource(r,e),s.compileShader(r),s.getShaderParameter(r,s.COMPILE_STATUS))return r;console.log(s.getShaderInfoLog(r)),s.deleteShader(r)}function Ys(s,t,e){const r=s.createProgram();if(!r)throw new Error;if(s.attachShader(r,t),s.attachShader(r,e),s.linkProgram(r),s.getProgramParameter(r,s.LINK_STATUS))return r;console.log(s.getProgramInfoLog(r)),s.deleteProgram(r)}class ce extends $r{constructor(e){super();l(this,"boundBufferCollection",null);l(this,"buffersBound",!1);l(this,"program");l(this,"vao");l(this,"renderer");l(this,"glw");l(this,"attributeBuffers");l(this,"attributeLocations");l(this,"attributeNames");l(this,"uniformLocations");l(this,"uniformTypes");l(this,"supportsIndexedTextures");const r=this.renderer=e.renderer,i=this.glw=this.renderer.glw;this.supportsIndexedTextures=e.supportsIndexedTextures||!1;const n=i.isWebGl2(),o=n&&e.webgl2Extensions||!n&&e.webgl1Extensions||[],a=n?"2.0":"1.0";o.forEach(v=>{if(!i.getExtension(v))throw new Error(`Shader "${this.constructor.name}" requires extension "${v}" for WebGL ${a} but wasn't found`)});const c=e.shaderSources||this.constructor.shaderSources;if(c)n&&(c!=null&&c.webGl2)&&(c.fragment=c.webGl2.fragment,c.vertex=c.webGl2.vertex,delete c.webGl2);else throw new Error(`Shader "${this.constructor.name}" is missing shaderSources.`);const h=r.system.parameters.MAX_VERTEX_TEXTURE_IMAGE_UNITS,d=c.vertex instanceof Function?c.vertex(h):c.vertex,u=c.fragment instanceof Function?c.fragment(h):c.fragment,g=Er(i,i.VERTEX_SHADER,d),p=Er(i,i.FRAGMENT_SHADER,u);if(!g||!p)throw new Error;const T=Ys(i,g,p);if(!T)throw new Error;this.program=T,this.attributeLocations={},this.attributeBuffers={},this.attributeNames=[],[...e.attributes].forEach(v=>{const R=i.getAttribLocation(this.program,v);if(R<0)throw new Error(`${this.constructor.name}: Vertex shader must have an attribute "${v}"!`);const w=i.createBuffer();if(!w)throw new Error(`${this.constructor.name}: Could not create buffer for attribute "${v}"`);this.attributeLocations[v]=R,this.attributeBuffers[v]=w,this.attributeNames.push(v)}),this.uniformLocations={},this.uniformTypes={},e.uniforms.forEach(v=>{const R=i.getUniformLocation(this.program,v.name);if(this.uniformTypes[v.name]=v.uniform,!R){console.warn(`Shader "${this.constructor.name}" could not get uniform location for "${v.name}"`);return}this.uniformLocations[v.name]=R})}bindBufferAttribute(e,r,i){const{glw:n}=this;n.enableVertexAttribArray(e),n.vertexAttribPointer(r,e,i.size,i.type,i.normalized,i.stride,i.offset)}disableAttribute(e){this.glw.disableVertexAttribArray(e)}disableAttributes(){for(const e in this.attributeLocations)this.disableAttribute(this.attributeLocations[e]);this.boundBufferCollection=null}canBatchShaderProps(e,r){return!1}bindRenderOp(e,r){this.bindBufferCollection(e.buffers),e.textures.length>0&&this.bindTextures(e.textures);const{glw:i,parentHasRenderTexture:n,renderToTexture:o}=e;if(!(o&&n)){if(n){const{width:a,height:c}=e.framebufferDimensions||{};i.uniform1f(this.getUniformLocation("u_pixelRatio"),1),i.uniform2f(this.getUniformLocation("u_resolution"),a??0,c??0)}else i.uniform1f(this.getUniformLocation("u_pixelRatio"),e.options.pixelRatio),i.uniform2f(this.getUniformLocation("u_resolution"),i.canvas.width,i.canvas.height);if(r){if(ft(r,"$dimensions")){let a=r.$dimensions;a||(a=e.dimensions),i.uniform2f(this.getUniformLocation("u_dimensions"),a.width,a.height)}if(ft(r,"$alpha")){let a=r.$alpha;a||(a=e.alpha),i.uniform1f(this.getUniformLocation("u_alpha"),a)}this.bindProps(r)}}}getUniformLocation(e){return this.uniformLocations[e]||null}bindBufferCollection(e){if(this.boundBufferCollection!==e){for(const r in this.attributeLocations){const i=e.getBuffer(r),n=e.getAttributeInfo(r);A(i,`Buffer for "${r}" not found`),A(n),this.bindBufferAttribute(this.attributeLocations[r],i,n)}this.boundBufferCollection=e}}bindProps(e){}bindTextures(e){}attach(){this.glw.useProgram(this.program),this.glw.isWebGl2()&&this.vao&&this.glw.bindVertexArray(this.vao)}detach(){this.disableAttributes()}}l(ce,"shaderSources");class Vr extends ce{constructor(t){super({renderer:t,attributes:["a_position","a_textureCoordinate","a_color"],uniforms:[{name:"u_resolution",uniform:"uniform2fv"},{name:"u_pixelRatio",uniform:"uniform1f"},{name:"u_texture",uniform:"uniform2fv"}]})}bindTextures(t){const{glw:e}=this;e.activeTexture(0),e.bindTexture(t[0].ctxTexture)}}l(Vr,"shaderSources",{vertex:`
      # ifdef GL_FRAGMENT_PRECISION_HIGH
      precision highp float;
      # else
      precision mediump float;
      # endif

      attribute vec2 a_position;
      attribute vec2 a_textureCoordinate;
      attribute vec4 a_color;

      uniform vec2 u_resolution;
      uniform float u_pixelRatio;


      varying vec4 v_color;
      varying vec2 v_textureCoordinate;

      void main() {
        vec2 normalized = a_position * u_pixelRatio;
        vec2 screenSpace = vec2(2.0 / u_resolution.x, -2.0 / u_resolution.y);

        v_color = a_color;
        v_textureCoordinate = a_textureCoordinate;

        gl_Position = vec4(normalized.x * screenSpace.x - 1.0, normalized.y * -abs(screenSpace.y) + 1.0, 0.0, 1.0);
        gl_Position.y = -sign(screenSpace.y) * gl_Position.y;
      }
    `,fragment:`
      # ifdef GL_FRAGMENT_PRECISION_HIGH
      precision highp float;
      # else
      precision mediump float;
      # endif

      uniform vec2 u_resolution;
      uniform sampler2D u_texture;

      varying vec4 v_color;
      varying vec2 v_textureCoordinate;

      void main() {
          vec4 color = texture2D(u_texture, v_textureCoordinate);
          gl_FragColor = vec4(v_color) * texture2D(u_texture, v_textureCoordinate);
      }
    `});class Gr extends ce{constructor(e){super({renderer:e,attributes:["a_position","a_textureCoordinate","a_color","a_textureIndex"],uniforms:[{name:"u_resolution",uniform:"uniform2fv"},{name:"u_pixelRatio",uniform:"uniform1f"},{name:"u_textures[0]",uniform:"uniform1iv"}]});l(this,"supportsIndexedTextures",!0)}bindTextures(e){const{renderer:r,glw:i}=this;if(e.length>r.system.parameters.MAX_VERTEX_TEXTURE_IMAGE_UNITS)throw new Error(`DefaultShaderBatched: Cannot bind more than ${r.system.parameters.MAX_VERTEX_TEXTURE_IMAGE_UNITS} textures`);e.forEach((o,a)=>{i.activeTexture(a),i.bindTexture(o.ctxTexture)});const n=Array.from(Array(e.length).keys());this.glw.uniform1iv(this.getUniformLocation("u_textures[0]"),n)}}l(Gr,"shaderSources",{vertex:`
      # ifdef GL_FRAGMENT_PRECISION_HIGH
      precision highp float;
      # else
      precision mediump float;
      # endif

      attribute vec2 a_textureCoordinate;
      attribute vec2 a_position;
      attribute vec4 a_color;
      attribute float a_textureIndex;
      attribute float a_depth;

      uniform vec2 u_resolution;
      uniform float u_pixelRatio;

      varying vec4 v_color;
      varying vec2 v_textureCoordinate;
      varying float v_textureIndex;

      void main(){
        vec2 normalized = a_position * u_pixelRatio / u_resolution;
        vec2 zero_two = normalized * 2.0;
        vec2 clip_space = zero_two - 1.0;

        // pass to fragment
        v_color = a_color;
        v_textureCoordinate = a_textureCoordinate;
        v_textureIndex = a_textureIndex;

        // flip y
        gl_Position = vec4(clip_space * vec2(1.0, -1.0), 0, 1);
      }
    `,fragment:e=>`
      #define txUnits ${e}
      # ifdef GL_FRAGMENT_PRECISION_HIGH
      precision highp float;
      # else
      precision mediump float;
      # endif

      uniform vec2 u_resolution;
      uniform sampler2D u_image;
      uniform sampler2D u_textures[txUnits];

      varying vec4 v_color;
      varying vec2 v_textureCoordinate;
      varying float v_textureIndex;

      vec4 sampleFromTexture(sampler2D textures[${e}], int idx, vec2 uv) {
        ${Array.from(Array(e).keys()).map(r=>`
          ${r!==0?"else ":""}if (idx == ${r}) {
            return texture2D(textures[${r}], uv);
          }
        `).join("")}
        return texture2D(textures[0], uv);
      }

      void main(){
        gl_FragColor = vec4(v_color) * sampleFromTexture(u_textures, int(v_textureIndex), v_textureCoordinate);
      }
    `});class D{constructor(t){l(this,"priority",1);l(this,"name","");l(this,"ref");l(this,"target");l(this,"passParameters","");l(this,"declaredUniforms","");l(this,"uniformInfo",{});const{ref:e,target:r,props:i={}}=t;this.ref=e,this.target=r;const n={},o=[];let a="";const c=this.constructor.uniforms||{};for(const h in c){const d=c[h],u=d.type,g=`${e}_${h}`;let p="";d.size&&(p=`[${d.size(i)}]`),o.push(g),a+=`uniform ${u} ${g}${p};`,n[h]={name:g,uniform:c[h].method}}this.passParameters=o.join(","),this.declaredUniforms=a,this.uniformInfo=n}static getEffectKey(t){return""}static getMethodParameters(t,e){const r=[];for(const i in t){const n=t[i];let o="";n.size&&(o=`[${n.size(e)}]`),r.push(`${n.type} ${i}${o}`)}return r.join(",")}static resolveDefaults(t){return{}}static makeEffectKey(t){return!1}}l(D,"uniforms",{}),l(D,"methods"),l(D,"onShaderMask"),l(D,"onColorize"),l(D,"onEffectMask");const Ot=new Map,Hs=(s,t)=>{const e=JSON.stringify(s);if(Ot.has(e))return Ot.get(e);s=s??[];const r=[],i=s.length;let n=0;for(;n<i;n++){const{name:o,type:a,props:c}=s[n],h={name:o,type:a,props:{}},d=t[a],u=d.resolveDefaults(c),g=d.uniforms,p=Object.keys(g),T=p.length;let v=0;for(;v<T;v++){const R=p[v],w=g[R],m={value:u[R],programValue:void 0,method:w.method,updateOnBind:w.updateOnBind||!1,hasValidator:w.validator!==void 0,hasProgramValueUpdater:w.updateProgramValue!==void 0},x=m.hasValidator&&w.validator(u[R],u)||u[R];u[R]!==x&&(m.validatedValue=x),m.hasProgramValueUpdater&&w.updateProgramValue(m),m.programValue===void 0&&(m.programValue=m.value),h.props[R]=m}r.push(h)}return Ot.set(e,r),r},K=class K extends ce{constructor(e,r,i){const n=K.createShader(r,i);super({renderer:e,attributes:["a_position","a_textureCoordinate","a_color"],uniforms:[{name:"u_resolution",uniform:"uniform2fv"},{name:"u_pixelRatio",uniform:"uniform1f"},{name:"u_texture",uniform:"uniform2fv"},{name:"u_dimensions",uniform:"uniform2fv"},{name:"u_alpha",uniform:"uniform1f"},...n.uniforms],shaderSources:{vertex:n.vertex,fragment:n.fragment}});l(this,"effects",[]);this.effects=n.effects}bindTextures(e){const{glw:r}=this;r.activeTexture(0),r.bindTexture(e[0].ctxTexture)}bindUniformMethods(e){const r=this.glw,i=e.effects,n=i.length;for(let o=0;o<n;o++){const a=this.effects[o].uniformInfo,c=i[o],h=Object.keys(c.props),d=h.length;for(let u=0;u<d;u++){const g=h[u],p=c.props[g].method,T=this.getUniformLocation(a[g].name);if(p==="uniform2fv"||p==="uniform2iv"||p==="uniform3iv"||p==="uniform4fv"||p==="uniform4iv"||p==="uniformMatrix2fv"||p==="uniformMatrix3fv"||p==="uniformMatrix4fv"||p==="uniform1f"||p==="uniform1fv"||p==="uniform1i"||p==="uniform1iv"){c.props[g].setUniformValue=function(){r[p](T,this.programValue)};continue}if(p==="uniform2f"||p==="uniform2i"){c.props[g].setUniformValue=function(){r[p](T,this.programValue[0],this.programValue[1])};continue}if(p==="uniform3f"||p==="uniform3i"){c.props[g].setUniformValue=function(){r[p](T,this.programValue[0],this.programValue[1],this.programValue[2])};continue}if(p==="uniform4f"||p==="uniform4i"){c.props[g].setUniformValue=function(){r[p](T,this.programValue[0],this.programValue[1],this.programValue[2],this.programValue[3])};continue}}}}bindProps(e){var o;const r=e.effects,i=r.length;let n=0;for(;n<i;n++){const a=r[n],c=Object.keys(a.props),h=c.length;let d=0;for(;d<h;d++){const u=c[d],g=a.props[u];if(g.updateOnBind===!0){const p=(o=this.renderer.shManager.getRegisteredEffects()[a.type])==null?void 0:o.uniforms[u];p==null||p.updateProgramValue(a.props[u],e)}g.setUniformValue()}}}canBatchShaderProps(e,r){if(e.$alpha!==r.$alpha||e.$dimensions.width!==r.$dimensions.width||e.$dimensions.height!==r.$dimensions.height||e.effects.length!==r.effects.length)return!1;const i=e.effects.length;let n=0;for(;n<i;n++){const o=e.effects[n],a=r.effects[n];if(o.type!==a.type)return!1;for(const c in o.props)if(a.props&&!a.props[c]||o.props[c].value!==a.props[c].value)return!1}return!0}static createShader(e,r){const i={},n={};let o="";const a=[],c=[],h=e.effects.map(T=>{const v=r[T.type],R=v.getEffectKey(T.props||{});i[R]=i[R]?++i[R]:1;const w=i[R];w===1&&c.push({key:R,type:T.type,props:T.props});const m=new v({ref:`${R}${w===1?"":w}`,target:R,props:T.props});return o+=m.declaredUniforms,a.push(...Object.values(m.uniformInfo)),m});let d="";c==null||c.forEach(T=>{const v=r[T.type],R=v.resolveDefaults(T.props??{}),w=[];for(const S in v.methods){let E=S;const C=v.methods[S];n[S]&&n[S]!==C&&(E=K.resolveMethodDuplicate(S,C,n)),n[E]=C.replace("function",E),w.push({m:S,cm:E})}let m=v.onShaderMask instanceof Function?v.onShaderMask(R):v.onShaderMask,x=v.onColorize instanceof Function?v.onColorize(R):v.onColorize,f=v.onEffectMask instanceof Function?v.onEffectMask(R):v.onEffectMask;w.forEach(S=>{const{m:E,cm:C}=S,V=new RegExp(`\\$${E}`,"g");m&&(m=m.replace(V,C)),x&&(x=x.replace(V,C)),f&&(f=f.replace(V,C))});const _=v.getMethodParameters(v.uniforms,R),b=_.length>0?`, ${_}`:"";m&&(d+=`
        float fx_${T.key}_onShaderMask(float shaderMask ${b}) {
          ${m}
        }
        `),x&&(d+=`
          vec4 fx_${T.key}_onColorize(float shaderMask, vec4 maskColor, vec4 shaderColor${b}) {
            ${x}
          }
        `),f&&(d+=`
          vec4 fx_${T.key}_onEffectMask(float shaderMask, vec4 maskColor, vec4 shaderColor${b}) {
            ${f}
          }
        `)});let u="";for(const T in n)u+=n[T];let g="mix(shaderColor, maskColor, clamp(-(lng_DefaultMask), 0.0, 1.0))",p=`

    `;for(let T=0;T<h.length;T++){const v=h[T],R=v.passParameters.length>0?`, ${v.passParameters}`:"",w=r[v.name];w.onShaderMask&&(p+=`
        shaderMask = fx_${v.target}_onShaderMask(shaderMask ${R});
        `),w.onColorize&&(p+=`
        maskColor = fx_${v.target}_onColorize(shaderMask, maskColor, shaderColor${R});
        `),w.onEffectMask&&(g=`fx_${v.target}_onEffectMask(shaderMask, maskColor, shaderColor${R})`);const m=h[T+1];(m===void 0||r[m.name].onEffectMask)&&(p+=`
          shaderColor = ${g};
        `)}return{effects:h,uniforms:a,fragment:K.fragment(o,u,d,p),vertex:K.vertex()}}static resolveMethodDuplicate(e,r,i,n=0){const o=e+(n>0?n:"");return i[o]&&i[o]!==r?this.resolveMethodDuplicate(e,r,i,++n):o}static resolveDefaults(e,r){return A(r),{effects:Hs(e.effects??[],r),$dimensions:{width:0,height:0},$alpha:0}}static makeCacheKey(e,r){var n;let i="";return(n=e.effects)==null||n.forEach(o=>{const c=r[o.type].getEffectKey(o.props||{});i+=`,${c}`}),`DynamicShader${i}`}};l(K,"z$__type__Props"),l(K,"vertex",()=>`
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision mediump float;
    # endif

    attribute vec2 a_textureCoordinate;
    attribute vec2 a_position;
    attribute vec4 a_color;
    attribute float a_textureIndex;

    uniform vec2 u_resolution;
    uniform float u_pixelRatio;

    varying vec4 v_color;
    varying vec2 v_textureCoordinate;
    varying float v_textureIndex;

    void main(){
      vec2 normalized = a_position * u_pixelRatio / u_resolution;
      vec2 zero_two = normalized * 2.0;
      vec2 clip_space = zero_two - 1.0;

      // pass to fragment
      v_color = a_color;
      v_textureCoordinate = a_textureCoordinate;
      v_textureIndex = a_textureIndex;

      // flip y
      gl_Position = vec4(clip_space * vec2(1.0, -1.0), 0, 1);
    }
  `),l(K,"fragment",(e,r,i,n)=>`
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision mediump float;
    # endif

    #define PI 3.14159265359

    uniform vec2 u_resolution;
    uniform vec2 u_dimensions;
    uniform float u_alpha;
    uniform float u_radius;
    uniform sampler2D u_texture;
    uniform float u_pixelRatio;

    ${e}

    varying vec4 v_color;
    varying vec2 v_textureCoordinate;

    ${r}

    ${i}

    void main() {
      vec2 p = v_textureCoordinate.xy * u_dimensions - u_dimensions * 0.5;
      vec2 d = abs(p) - (u_dimensions) * 0.5;
      float lng_DefaultMask = min(max(d.x, d.y), 0.0) + length(max(d, 0.0));

      vec4 shaderColor = vec4(0.0);
      float shaderMask = lng_DefaultMask;

      vec4 maskColor = texture2D(u_texture, v_textureCoordinate) * v_color;

      shaderColor = mix(shaderColor, maskColor, clamp(-(lng_DefaultMask + 0.5), 0.0, 1.0));

      ${n}

      gl_FragColor = shaderColor * u_alpha;
    }
  `);let Te=K;class jt extends ce{constructor(t){super({renderer:t,attributes:["a_position","a_textureCoordinate","a_color"],uniforms:[{name:"u_resolution",uniform:"uniform2fv"},{name:"u_pixelRatio",uniform:"uniform1f"},{name:"u_texture",uniform:"uniform2f"},{name:"u_dimensions",uniform:"uniform2fv"},{name:"u_radius",uniform:"uniform1f"}]})}static resolveDefaults(t){return{radius:t.radius||10,$dimensions:{width:0,height:0}}}bindTextures(t){const{glw:e}=this;e.activeTexture(0),e.bindTexture(t[0].ctxTexture)}bindProps(t){const e=Math.min(t.$dimensions.width,t.$dimensions.height)/(2*t.radius);this.glw.uniform1f(this.getUniformLocation("u_radius"),t.radius*Math.min(e,1))}canBatchShaderProps(t,e){return t.radius===e.radius&&t.$dimensions.width===e.$dimensions.width&&t.$dimensions.height===e.$dimensions.height}}l(jt,"z$__type__Props"),l(jt,"shaderSources",{vertex:`
      # ifdef GL_FRAGMENT_PRECISION_HIGH
      precision highp float;
      # else
      precision mediump float;
      # endif

      attribute vec2 a_position;
      attribute vec2 a_textureCoordinate;
      attribute vec4 a_color;
      attribute float a_textureIndex;
      attribute float a_depth;

      uniform vec2 u_resolution;
      uniform float u_pixelRatio;

      varying vec4 v_color;
      varying vec2 v_textureCoordinate;

      void main() {
        vec2 normalized = a_position * u_pixelRatio / u_resolution;
        vec2 zero_two = normalized * 2.0;
        vec2 clip_space = zero_two - 1.0;

        // pass to fragment
        v_color = a_color;
        v_textureCoordinate = a_textureCoordinate;

        // flip y
        gl_Position = vec4(clip_space * vec2(1.0, -1.0), 0, 1);
      }
    `,fragment:`
      # ifdef GL_FRAGMENT_PRECISION_HIGH
      precision highp float;
      # else
      precision mediump float;
      # endif

      uniform vec2 u_resolution;
      uniform vec2 u_dimensions;
      uniform float u_radius;
      uniform sampler2D u_texture;

      varying vec4 v_color;
      varying vec2 v_textureCoordinate;

      float boxDist(vec2 p, vec2 size, float radius){
        size -= vec2(radius);
        vec2 d = abs(p) - size;
        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0)) - radius;
      }

      float fillMask(float dist) {
        return clamp(-dist, 0.0, 1.0);
      }

      void main() {
        vec4 color = texture2D(u_texture, v_textureCoordinate) * v_color;
        vec2 halfDimensions = u_dimensions * 0.5;

        float d = boxDist(v_textureCoordinate.xy * u_dimensions - halfDimensions, halfDimensions + 0.5, u_radius);
        gl_FragColor = mix(vec4(0.0), color, fillMask(d));
      }
    `});const qs=new Float32Array([1,0,0,0,1,0,0,0,1]),Et=class Et extends ce{constructor(t){super({renderer:t,attributes:["a_position","a_textureCoordinate"],uniforms:[{name:"u_resolution",uniform:"uniform2fv"},{name:"u_transform",uniform:"uniformMatrix3fv"},{name:"u_scrollY",uniform:"uniform1f"},{name:"u_pixelRatio",uniform:"uniform1f"},{name:"u_texture",uniform:"uniform2f"},{name:"u_color",uniform:"uniform4fv"},{name:"u_size",uniform:"uniform1f"},{name:"u_distanceRange",uniform:"uniform1f"},{name:"u_debug",uniform:"uniform1i"}]})}bindTextures(t){const{glw:e}=this;e.activeTexture(0),e.bindTexture(t[0].ctxTexture)}bindProps(t){const e=Et.resolveDefaults(t);for(const r in e)if(r==="transform")this.glw.uniformMatrix3fv(this.getUniformLocation("u_transform"),e[r]);else if(r==="scrollY")this.glw.uniform1f(this.getUniformLocation("u_scrollY"),e[r]);else if(r==="color"){const i=De(e.color);this.glw.uniform4fv(this.getUniformLocation("u_color"),i)}else r==="size"?this.glw.uniform1f(this.getUniformLocation("u_size"),e[r]):r==="distanceRange"?this.glw.uniform1f(this.getUniformLocation("u_distanceRange"),e[r]):r==="debug"&&this.glw.uniform1i(this.getUniformLocation("u_debug"),e[r]?1:0)}static resolveDefaults(t={}){return{transform:t.transform??qs,scrollY:t.scrollY??0,color:t.color??4294967295,size:t.size??16,distanceRange:t.distanceRange??1,debug:t.debug??!1}}};l(Et,"shaderSources",{vertex:`
      # ifdef GL_FRAGMENT_PRECISION_HIGH
      precision highp float;
      # else
      precision mediump float;
      # endif
      // an attribute is an input (in) to a vertex shader.
      // It will receive data from a buffer
      attribute vec2 a_position;
      attribute vec2 a_textureCoordinate;

      uniform vec2 u_resolution;
      uniform mat3 u_transform;
      uniform float u_scrollY;
      uniform float u_pixelRatio;
      uniform float u_size;

      varying vec2 v_texcoord;

      void main() {
        vec2 scrolledPosition = a_position * u_size - vec2(0, u_scrollY);
        vec2 transformedPosition = (u_transform * vec3(scrolledPosition, 1)).xy;

        // Calculate screen space with pixel ratio
        vec2 screenSpace = (transformedPosition * u_pixelRatio / u_resolution * 2.0 - 1.0) * vec2(1, -1);

        gl_Position = vec4(screenSpace, 0.0, 1.0);
        v_texcoord = a_textureCoordinate;

      }
    `,fragment:`
      # ifdef GL_FRAGMENT_PRECISION_HIGH
      precision highp float;
      # else
      precision mediump float;
      # endif
      uniform vec4 u_color;
      uniform sampler2D u_texture;
      uniform float u_distanceRange;
      uniform float u_pixelRatio;
      uniform int u_debug;

      varying vec2 v_texcoord;

      float median(float r, float g, float b) {
          return max(min(r, g), min(max(r, g), b));
      }

      void main() {
          vec3 sample = texture2D(u_texture, v_texcoord).rgb;
          if (u_debug == 1) {
            gl_FragColor = vec4(sample.r, sample.g, sample.b, 1.0);
            return;
          }
          float scaledDistRange = u_distanceRange * u_pixelRatio;
          float sigDist = scaledDistRange * (median(sample.r, sample.g, sample.b) - 0.5);
          float opacity = clamp(sigDist + 0.5, 0.0, 1.0) * u_color.a;

          // Build the final color.
          // IMPORTANT: We must premultiply the color by the alpha value before returning it.
          gl_FragColor = vec4(u_color.r * opacity, u_color.g * opacity, u_color.b * opacity, opacity);
      }
    `});let Kt=Et;const we=s=>{s.programValue===void 0&&(s.programValue=new Float32Array(4));const t=s.value,e=s.programValue;e[0]=(t>>>24)/255,e[1]=(t>>>16&255)/255,e[2]=(t>>>8&255)/255,e[3]=(t&255)/255},js=s=>{const t=s.validatedValue||s.value;if(s.programValue instanceof Float32Array){const e=s.programValue;e[0]=t[0],e[1]=t[1]}else s.programValue=new Float32Array(t)},Ks=s=>{const t=s.validatedValue||s.value;if(s.programValue instanceof Float32Array){const e=s.programValue;e[0]=t[0],e[1]=t[1],e[2]=t[1],e[3]=t[1]}else s.programValue=new Float32Array(t)},Wr=s=>{const t=s.validatedValue||s.value;if(s.programValue instanceof Float32Array){const e=t.length,r=s.programValue;for(let i=0;i<e;i++)r[i]=t[i]}else s.programValue=new Float32Array(t)},cr=s=>{const t=Array.isArray(s);if(t){if(t&&s.length===4)return s;if(t&&s.length===2)return[s[0],s[1],s[0],s[1]];if(t&&s.length===3)return[s[0],s[1],s[2],s[0]]}else return[s,s,s,s];return[s[0],s[0],s[0],s[0]]},Yr=(s,t)=>{s.programValue===void 0&&(s.programValue=new Float32Array(4));const e=s.programValue,r=s.validatedValue||s.value;if(t===void 0&&s.$dimensions===void 0){e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3];return}let i=s.$dimensions;if(t!==void 0){const{$dimensions:g}=t;if(i!==void 0&&(i.width===g.width||i.height===g.height))return;i===void 0&&(i={width:g==null?void 0:g.width,height:g==null?void 0:g.height},s.$dimensions=i)}const{width:n,height:o}=i,[a,c,h,d]=r,u=Math.min(Math.min(Math.min(n/Math.max(n,a+c),n/Math.max(n,h+d)),Math.min(o/Math.max(o,a+h),o/Math.max(o,c+d))),1);e[0]=a*u,e[1]=c*u,e[2]=h*u,e[3]=d*u};class fe extends D{constructor(){super(...arguments);l(this,"name","radius")}static getEffectKey(){return"radius"}static resolveDefaults(e){return{radius:e.radius??10}}}l(fe,"z$__type__Props"),l(fe,"uniforms",{radius:{value:0,method:"uniform4fv",type:"vec4",updateOnBind:!0,validator:cr,updateProgramValue:Yr}}),l(fe,"methods",{fillMask:`
      float function(float dist) {
        return clamp(-dist, 0.0, 1.0);
      }
    `,boxDist:`
      float function(vec2 p, vec2 size, float radius) {
        size -= vec2(radius);
        vec2 d = abs(p) - size;
        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0)) - radius;
      }
    `}),l(fe,"onShaderMask",`
  vec2 halfDimensions = u_dimensions * 0.5;
  float r = radius[0] * step(v_textureCoordinate.x, 0.5) * step(v_textureCoordinate.y, 0.5);
  r = r + radius[1] * step(0.5, v_textureCoordinate.x) * step(v_textureCoordinate.y, 0.5);
  r = r + radius[2] * step(0.5, v_textureCoordinate.x) * step(0.5, v_textureCoordinate.y);
  r = r + radius[3] * step(v_textureCoordinate.x, 0.5) * step(0.5, v_textureCoordinate.y);
  return $boxDist(v_textureCoordinate.xy * u_dimensions - halfDimensions, halfDimensions, r);
  `),l(fe,"onEffectMask",`
  return mix(vec4(0.0), maskColor, $fillMask(shaderMask));
  `);class Ae extends D{constructor(){super(...arguments);l(this,"name","border")}static getEffectKey(){return"border"}static resolveDefaults(e){return{width:e.width??10,color:e.color??4294967295}}}l(Ae,"z$__type__Props"),l(Ae,"uniforms",{width:{value:0,method:"uniform1f",type:"float"},color:{value:4294967295,updateProgramValue:we,method:"uniform4fv",type:"vec4"}}),l(Ae,"onEffectMask",`
  float intR = shaderMask + 1.0;
  float mask = clamp(intR + width, 0.0, 1.0) - clamp(intR, 0.0, 1.0);
  return mix(shaderColor, mix(shaderColor, maskColor, maskColor.a), mask);
  `),l(Ae,"onColorize",`
    return color;
  `);const te=class te extends D{constructor(){super(...arguments);l(this,"name","linearGradient")}static getEffectKey(e){return e.colors.value?`linearGradient${e.colors.value.length}`:`linearGradient${e.colors.length}`}static resolveDefaults(e){const r=e.colors??[4278190080,4294967295];let i=e.stops||[];if(i.length===0||i.length!==r.length){const n=r.length;let o=0;const a=i;for(;o<n;o++)i[o]?(a[o]=i[o],i[o-1]===void 0&&a[o-2]!==void 0&&(a[o-1]=a[o-2]+(i[o]-a[o-2])/2)):a[o]=o*(1/(r.length-1));i=a}return{colors:r,stops:i,angle:e.angle??0}}};l(te,"z$__type__Props"),l(te,"uniforms",{angle:{value:0,method:"uniform1f",type:"float"},colors:{value:4294967295,validator:e=>e.reduce((r,i)=>r.concat(De(i)),[]),updateProgramValue:Wr,size:e=>e.colors.length,method:"uniform4fv",type:"vec4"},stops:{value:[],size:e=>e.colors.length,method:"uniform1fv",type:"float"}}),l(te,"methods",{fromLinear:`
      vec4 function(vec4 linearRGB) {
        vec4 higher = vec4(1.055)*pow(linearRGB, vec4(1.0/2.4)) - vec4(0.055);
        vec4 lower = linearRGB * vec4(12.92);
        return mix(higher, lower, 1.0);
      }
    `,toLinear:`
      vec4 function(vec4 sRGB) {
        vec4 higher = pow((sRGB + vec4(0.055))/vec4(1.055), vec4(2.4));
        vec4 lower = sRGB/vec4(12.92);
        return mix(higher, lower, 1.0);
      }
    `,calcPoint:`
      vec2 function(float d, float angle) {
        return d * vec2(cos(angle), sin(angle)) + (u_dimensions * 0.5);
      }
    `}),l(te,"ColorLoop",e=>{let r="";for(let i=2;i<e;i++)r+=`colorOut = mix(colorOut, colors[${i}], clamp((dist - stops[${i-1}]) / (stops[${i}] - stops[${i-1}]), 0.0, 1.0));`;return r}),l(te,"onColorize",e=>{const r=e.colors.length||1;return`
      float a = angle - (PI / 180.0 * 90.0);
      float lineDist = abs(u_dimensions.x * cos(a)) + abs(u_dimensions.y * sin(a));
      vec2 f = $calcPoint(lineDist * 0.5, a);
      vec2 t = $calcPoint(lineDist * 0.5, a + PI);
      vec2 gradVec = t - f;
      float dist = dot(v_textureCoordinate.xy * u_dimensions - f, gradVec) / dot(gradVec, gradVec);

      float stopCalc = (dist - stops[0]) / (stops[1] - stops[0]);
      vec4 colorOut = $fromLinear(mix($toLinear(colors[0]), $toLinear(colors[1]), stopCalc));
      ${te.ColorLoop(r)}
      return mix(maskColor, colorOut, clamp(colorOut.a, 0.0, 1.0));
    `});let Qt=te;class Zt extends D{constructor(){super(...arguments);l(this,"name","grayscale")}static getEffectKey(){return"grayscale"}static resolveDefaults(e){return{amount:e.amount??1}}}l(Zt,"uniforms",{amount:{value:1,method:"uniform1f",type:"float"}}),l(Zt,"onColorize",`
    float grayness = 0.2 * maskColor.r + 0.6 * maskColor.g + 0.2 * maskColor.b;
    return vec4(amount * vec3(grayness) + (1.0 - amount) * maskColor.rgb, maskColor.a);
  `);class pe extends D{constructor(){super(...arguments);l(this,"name","borderRight")}static getEffectKey(){return"borderRight"}static resolveDefaults(e){return{width:e.width??10,color:e.color??4294967295}}}l(pe,"z$__type__Props"),l(pe,"uniforms",{width:{value:0,method:"uniform1f",type:"float"},color:{value:4294967295,updateProgramValue:we,method:"uniform4fv",type:"vec4"}}),l(pe,"methods",{fillMask:`
      float function(float dist) {
        return clamp(-dist, 0.0, 1.0);
      }
    `,rectDist:`
      float function(vec2 p, vec2 size) {
        vec2 d = abs(p) - size;
        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));
      }
    `}),l(pe,"onEffectMask",`
  vec2 pos = vec2(u_dimensions.x - width * 0.5, 0.0);
  float mask = $rectDist(v_textureCoordinate.xy * u_dimensions - pos, vec2(width*0.5, u_dimensions.y));
  return mix(shaderColor, maskColor, $fillMask(mask));
  `),l(pe,"onColorize",`
    return color;
  `);class ge extends D{constructor(){super(...arguments);l(this,"name","borderTop")}static getEffectKey(){return"borderTop"}static resolveDefaults(e){return{width:e.width??10,color:e.color??4294967295}}}l(ge,"z$__type__Props"),l(ge,"uniforms",{width:{value:0,method:"uniform1f",type:"float"},color:{value:4294967295,updateProgramValue:we,method:"uniform4fv",type:"vec4"}}),l(ge,"methods",{fillMask:`
      float function(float dist) {
        return clamp(-dist, 0.0, 1.0);
      }
    `,rectDist:`
      float function(vec2 p, vec2 size) {
        vec2 d = abs(p) - size;
        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));
      }
    `}),l(ge,"onEffectMask",`
  vec2 pos = vec2(0.0, width * 0.5);
  float mask = $rectDist(v_textureCoordinate.xy * u_dimensions - pos, vec2(u_dimensions.x, width*0.5));
  return mix(shaderColor, maskColor, $fillMask(mask));
  `),l(ge,"onColorize",`
    return color;
  `);class me extends D{constructor(){super(...arguments);l(this,"name","borderBottom")}static getEffectKey(){return"borderBottom"}static resolveDefaults(e){return{width:e.width??10,color:e.color??4294967295}}}l(me,"z$__type__Props"),l(me,"uniforms",{width:{value:0,method:"uniform1f",type:"float"},color:{value:4294967295,updateProgramValue:we,method:"uniform4fv",type:"vec4"}}),l(me,"methods",{fillMask:`
      float function(float dist) {
        return clamp(-dist, 0.0, 1.0);
      }
    `,rectDist:`
      float function(vec2 p, vec2 size) {
        vec2 d = abs(p) - size;
        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));
      }
    `}),l(me,"onEffectMask",`
  vec2 pos = vec2(0.0, u_dimensions.y - width * 0.5);
  float mask = $rectDist(v_textureCoordinate.xy * u_dimensions - pos, vec2(u_dimensions.x, width*0.5));
  return mix(shaderColor, maskColor, $fillMask(mask));
  `),l(me,"onColorize",`
    return color;
  `);class xe extends D{constructor(){super(...arguments);l(this,"name","borderLeft")}static getEffectKey(){return"borderLeft"}static resolveDefaults(e){return{width:e.width??10,color:e.color??4294967295}}}l(xe,"z$__type__Props"),l(xe,"uniforms",{width:{value:0,method:"uniform1f",type:"float"},color:{value:4294967295,updateProgramValue:we,method:"uniform4fv",type:"vec4"}}),l(xe,"methods",{fillMask:`
      float function(float dist) {
        return clamp(-dist, 0.0, 1.0);
      }
    `,rectDist:`
      float function(vec2 p, vec2 size) {
        vec2 d = abs(p) - size;
        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));
      }
    `}),l(xe,"onEffectMask",`
  vec2 pos = vec2(width * 0.5, 0.0);
  float mask = $rectDist(v_textureCoordinate.xy * u_dimensions - pos, vec2(width*0.5, u_dimensions.y));
  return mix(shaderColor, maskColor, $fillMask(mask));
  `),l(xe,"onColorize",`
    return color;
  `);class Me extends D{constructor(){super(...arguments);l(this,"name","glitch")}static getEffectKey(e){return"glitch"}static resolveDefaults(e){return{amplitude:e.amplitude??.2,narrowness:e.narrowness??4,blockiness:e.blockiness??2,minimizer:e.minimizer??8,time:e.time??Date.now()}}}l(Me,"z$__type__Props"),l(Me,"uniforms",{amplitude:{value:0,method:"uniform1f",type:"float"},narrowness:{value:0,method:"uniform1f",type:"float"},blockiness:{value:0,method:"uniform1f",type:"float"},minimizer:{value:0,method:"uniform1f",type:"float"},time:{value:0,method:"uniform1f",updateOnBind:!0,updateProgramValue:e=>{const r=e.value=(Date.now()-e.value)%1e3;e.programValue=r},type:"float"}}),l(Me,"methods",{rand:`
      float function(vec2 p, float time) {
        float t = floor(time * 20.) / 10.;
        return fract(sin(dot(p, vec2(t * 12.9898, t * 78.233))) * 43758.5453);
      }
    `,noise:`
      float function(vec2 uv, float blockiness, float time) {
        vec2 lv = fract(uv);
        vec2 id = floor(uv);

        float n1 = rand(id, time);
        float n2 = rand(id+vec2(1,0), time);
        float n3 = rand(id+vec2(0,1), time);
        float n4 = rand(id+vec2(1,1), time);
        vec2 u = smoothstep(0.0, 1.0 + blockiness, lv);
        return mix(mix(n1, n2, u.x), mix(n3, n4, u.x), u.y);
      }
    `,fbm:`
      float function(vec2 uv, int count, float blockiness, float complexity, float time) {
        float val = 0.0;
        float amp = 0.5;
        const int MAX_ITERATIONS = 10;

        for(int i = 0; i < MAX_ITERATIONS; i++) {
          if(i >= count) {break;}
          val += amp * noise(uv, blockiness, time);
          amp *= 0.5;
          uv *= complexity;
        }
        return val;
      }
    `}),l(Me,"onColorize",`
    vec2 uv = v_textureCoordinate.xy;
    float aspect = u_dimensions.x / u_dimensions.y;
    vec2 a = vec2(uv.x * aspect , uv.y);
    vec2 uv2 = vec2(a.x / u_dimensions.x, exp(a.y));

    float shift = amplitude * pow($fbm(uv2, 4, blockiness, narrowness, time), minimizer);
    float colR = texture2D(u_texture, vec2(uv.x + shift, uv.y)).r * (1. - shift);
    float colG = texture2D(u_texture, vec2(uv.x - shift, uv.y)).g * (1. - shift);
    float colB = texture2D(u_texture, vec2(uv.x - shift, uv.y)).b * (1. - shift);

    vec3 f = vec3(colR, colG, colB);
    return vec4(f, texture2D(u_texture, vec2(uv.x - shift, uv.y)).a);
  `);class ht extends D{constructor(){super(...arguments);l(this,"name","fadeOut")}static getEffectKey(){return"fadeOut"}static resolveDefaults(e){return{fade:e.fade??10}}}l(ht,"z$__type__Props"),l(ht,"uniforms",{fade:{value:0,method:"uniform4fv",type:"vec4",validator:cr,updateProgramValue:Ks}}),l(ht,"onColorize",`
  vec2 point = v_textureCoordinate.xy * u_dimensions.xy;
  vec2 pos1;
  vec2 pos2;
  vec2 d;
  float c;
  vec4 result = maskColor;


  if(fade[0] > 0.0) {
    pos1 = vec2(point.x, point.y);
    pos2 = vec2(point.x, point.y + fade[0]);
    d = pos2 - pos1;
    c = dot(pos1, d) / dot(d, d);
    result = mix(vec4(0.0), result, smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0)));
  }

  if(fade[1] > 0.0) {
    pos1 = vec2(point.x - u_dimensions.x - fade[1], v_textureCoordinate.y);
    pos2 = vec2(point.x - u_dimensions.x, v_textureCoordinate.y);
    d = pos1 - pos2;
    c = dot(pos2, d) / dot(d, d);
    result = mix(vec4(0.0), result, smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0)));
  }

  if(fade[2] > 0.0) {
    pos1 = vec2(v_textureCoordinate.x, point.y - u_dimensions.y - fade[2]);
    pos2 = vec2(v_textureCoordinate.x, point.y - u_dimensions.y);
    d = pos1 - pos2;
    c = dot(pos2, d) / dot(d, d);
    result = mix(vec4(0.0), result, smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0)));
  }

  if(fade[3] > 0.0) {
    pos1 = vec2(point.x, point.y);
    pos2 = vec2(point.x + fade[3], point.y);
    d = pos2 - pos1;
    c = dot(pos1, d) / dot(d, d);
    result = mix(vec4(0.0), result, smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0)));
  }

  return result;
  `);const oe=class oe extends D{constructor(){super(...arguments);l(this,"name","radialGradient")}static getEffectKey(e){return e.colors.value?`linearGradient${e.colors.value.length}`:`linearGradient${e.colors.length}`}static resolveDefaults(e){const r=e.colors??[4278190080,4294967295];let i=e.stops||[];if(i.length===0||i.length!==r.length){const n=r.length;let o=0;const a=i;for(;o<n;o++)i[o]?(a[o]=i[o],i[o-1]===void 0&&a[o-2]!==void 0&&(a[o-1]=a[o-2]+(i[o]-a[o-2])/2)):a[o]=o*(1/(r.length-1));i=a}return{colors:r,stops:i,width:e.width??0,height:e.height??e.width??0,pivot:e.pivot??[.5,.5]}}};l(oe,"z$__type__Props"),l(oe,"uniforms",{width:{value:0,method:"uniform1f",type:"float"},height:{value:0,method:"uniform1f",type:"float"},pivot:{value:[.5,.5],updateProgramValue:js,method:"uniform2fv",type:"vec2"},colors:{value:4294967295,validator:e=>e.reduce((r,i)=>r.concat(De(i)),[]),updateProgramValue:Wr,size:e=>e.colors.length,method:"uniform4fv",type:"vec4"},stops:{value:[],size:e=>e.colors.length,method:"uniform1fv",type:"float"}}),l(oe,"ColorLoop",e=>{let r="";for(let i=2;i<e;i++)r+=`colorOut = mix(colorOut, colors[${i}], clamp((dist - stops[${i-1}]) / (stops[${i}] - stops[${i-1}]), 0.0, 1.0));`;return r}),l(oe,"onColorize",e=>{const r=e.colors.length||1;return`
      vec2 point = v_textureCoordinate.xy * u_dimensions;
      vec2 projection = vec2(pivot.x * u_dimensions.x, pivot.y * u_dimensions.y);

      float dist = length((point - projection) / vec2(width, height));

      float stopCalc = (dist - stops[0]) / (stops[1] - stops[0]);
      vec4 colorOut = mix(colors[0], colors[1], stopCalc);
      ${oe.ColorLoop(r)}
      return mix(maskColor, colorOut, clamp(colorOut.a, 0.0, 1.0));
    `});let Jt=oe;class ye extends D{constructor(){super(...arguments);l(this,"name","radialProgress")}static getEffectKey(){return"radialProgress"}static resolveDefaults(e){return{width:e.width??10,progress:e.progress??.5,offset:e.offset??0,range:e.range??Math.PI*2,rounded:e.rounded??!1,radius:e.radius??1,color:e.color??4294967295}}}l(ye,"z$__type__Props"),l(ye,"uniforms",{width:{value:0,method:"uniform1f",type:"float"},progress:{value:.5,method:"uniform1f",type:"float"},offset:{value:0,method:"uniform1f",type:"float"},range:{value:0,method:"uniform1f",type:"float"},rounded:{value:0,method:"uniform1f",type:"float",validator:e=>e?1:0},radius:{value:1,method:"uniform1f",type:"float"},color:{value:4294967295,updateProgramValue:we,method:"uniform4fv",type:"vec4"}}),l(ye,"methods",{rotateUV:`
    vec2 function(vec2 uv, float d) {
      float s = sin(d);
      float c = cos(d);
      mat2 rotMatrix = mat2(c, -s, s, c);
      return uv * rotMatrix;
    }
    `,drawDot:`
    float function(vec2 uv, vec2 p, float r) {
      uv += p;
      float circle = length(uv) - r;
      return clamp(-circle, 0.0, 1.0);
    }
    `}),l(ye,"onEffectMask",`
    float outerRadius = radius * u_dimensions.y * 0.5;

    float endAngle = range * progress - 0.0005;

    vec2 uv = v_textureCoordinate.xy * u_dimensions.xy - u_dimensions * 0.5;

    uv = $rotateUV(uv, -(offset));
    float linewidth = width * u_pixelRatio;
    float circle = length(uv) - (outerRadius - linewidth) ;
    circle = abs(circle) - linewidth;
    circle = clamp(-circle, 0.0, 1.0);

    float angle = (atan(uv.x, -uv.y) / 3.14159265359 * 0.5);
    float p = endAngle / (PI * 2.);

    circle *= step(fract(angle), fract(p));

    circle = rounded < 1. ? circle : max(circle, $drawDot(uv, vec2(0, outerRadius - linewidth), linewidth));
    circle = rounded < 1. ? circle : max(circle, $drawDot($rotateUV(uv, -(endAngle)), vec2(0, outerRadius - linewidth), linewidth));

    return mix(shaderColor, maskColor, circle);
  `),l(ye,"onColorize",`
    return color;
  `);class ve extends D{constructor(){super(...arguments);l(this,"name","holePunch")}static getEffectKey(){return"holePunch"}static resolveDefaults(e){return{x:e.x||0,y:e.y||0,width:e.width||50,height:e.height||50,radius:e.radius??0}}}l(ve,"z$__type__Props"),l(ve,"uniforms",{x:{value:0,method:"uniform1f",type:"float"},y:{value:0,method:"uniform1f",type:"float"},width:{value:0,method:"uniform1f",type:"float"},height:{value:0,method:"uniform1f",type:"float"},radius:{value:0,method:"uniform4fv",type:"vec4",updateOnBind:!0,validator:cr,updateProgramValue:Yr}}),l(ve,"methods",{fillMask:`
      float function(float dist) {
        return clamp(-dist, 0.0, 1.0);
      }
    `,boxDist:`
      float function(vec2 p, vec2 size, float radius) {
        size -= vec2(radius);
        vec2 d = abs(p) - size;
        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0)) - radius;
      }
    `}),l(ve,"onShaderMask",`
  vec2 halfDimensions = u_dimensions * 0.5;
  vec2 size = vec2(width, height) * 0.5;
  vec2 basePos = v_textureCoordinate.xy * u_dimensions.xy - vec2(x, y);
  vec2 pos = basePos - size;
  float r = radius[0] * step(pos.x, 0.5) * step(pos.y, 0.5);
  r = r + radius[1] * step(0.5, pos.x) * step(pos.y, 0.5);
  r = r + radius[2] * step(0.5, pos.x) * step(0.5, pos.y);
  r = r + radius[3] * step(pos.x, 0.5) * step(0.5, pos.y);
  return $boxDist(pos, size, r);
  `),l(ve,"onEffectMask",`
  return mix(maskColor, vec4(0.0), $fillMask(shaderMask));
  `);const Qs="RoundedRectangle";class Zs extends $r{constructor(e){super();l(this,"shType");this.shType=e,e!==Qs&&console.warn("Unsupported shader:",e)}bindRenderOp(){}bindProps(){}attach(){}detach(){}}class Js{constructor(t,e,r,i){l(this,"type");l(this,"shader");l(this,"resolvedProps");l(this,"props");this.type=t,this.shader=e,this.resolvedProps=r;const n=Object.keys(r),o=n.length,a={};for(let c=0;c<o;c++){const h=n[c];Object.defineProperty(a,h,{get:()=>this.resolvedProps[h],set:d=>{this.resolvedProps[h]=d,i.requestRender()}})}this.props=a}getResolvedProps(){return this.resolvedProps}}class ei{constructor(t,e,r){l(this,"shader");l(this,"resolvedProps");l(this,"props");l(this,"type");this.shader=t,this.type="DynamicShader",this.resolvedProps=e;const i=r.getRegisteredEffects(),n={},o=e.effects,a=o.length;for(let c=0;c<a;c++){const{name:h,props:d,type:u}=o[c];if(h===void 0)continue;const g={},p=Object.keys(d),T=p.length;for(let v=0;v<T;v++){const R=p[v];Object.defineProperty(g,R,{get:()=>this.resolvedProps.effects[c].props[R].value,set:w=>{var x,f;const m=this.resolvedProps.effects[c].props[R];m.value=w,m.hasValidator&&(w=m.validatedValue=(x=i[u].uniforms[R])==null?void 0:x.validator(w,d)),m.hasProgramValueUpdater?(f=i[u].uniforms[R])==null||f.updateProgramValue(m):m.programValue=w,r.renderer.stage.requestRender()}})}Object.defineProperty(n,h,{get:()=>g})}this.props=n}getResolvedProps(){return this.resolvedProps}}class ti{constructor(){l(this,"shCache",new Map);l(this,"shConstructors",{});l(this,"attachedShader",null);l(this,"effectConstructors",{});l(this,"renderer");this.registerShaderType("DefaultShader",Vr),this.registerShaderType("DefaultShaderBatched",Gr),this.registerShaderType("RoundedRectangle",jt),this.registerShaderType("DynamicShader",Te),this.registerShaderType("SdfShader",Kt),this.registerEffectType("border",Ae),this.registerEffectType("borderBottom",me),this.registerEffectType("borderLeft",xe),this.registerEffectType("borderRight",pe),this.registerEffectType("borderTop",ge),this.registerEffectType("fadeOut",ht),this.registerEffectType("linearGradient",Qt),this.registerEffectType("radialGradient",Jt),this.registerEffectType("grayscale",Zt),this.registerEffectType("glitch",Me),this.registerEffectType("radius",fe),this.registerEffectType("radialProgress",ye),this.registerEffectType("holePunch",ve)}registerShaderType(t,e){this.shConstructors[t]=e}registerEffectType(t,e){this.effectConstructors[t]=e}getRegisteredEffects(){return this.effectConstructors}getRegisteredShaders(){return this.shConstructors}loadShader(t,e){if(!this.renderer)throw new Error("Renderer is not been defined");const r=this.shConstructors[t];if(!r)throw new Error(`Shader type "${t}" is not registered`);if(this.renderer.mode==="canvas"&&r.prototype instanceof ce)return this._createShaderCtr(t,new Zs(t),e);if(t==="DynamicShader")return this.loadDynamicShader(e);const i=r.resolveDefaults(e),n=r.makeCacheKey(i)||r.name;if(n&&this.shCache.has(n))return this._createShaderCtr(t,this.shCache.get(n),i);const o=new r(this.renderer,e);return n&&this.shCache.set(n,o),this._createShaderCtr(t,o,i)}loadDynamicShader(t){if(!this.renderer)throw new Error("Renderer is not been defined");const e=Te.resolveDefaults(t,this.effectConstructors),r=Te.makeCacheKey(e,this.effectConstructors);if(r&&this.shCache.has(r))return this._createDynShaderCtr(this.shCache.get(r),e);const i=new Te(this.renderer,t,this.effectConstructors);return r&&this.shCache.set(r,i),this._createDynShaderCtr(i,e)}_createShaderCtr(t,e,r){return new Js(t,e,r,this.renderer.stage)}_createDynShaderCtr(t,e){return t.bindUniformMethods(e),new ei(t,e,this)}useShader(t){this.attachedShader!==t&&(this.attachedShader&&this.attachedShader.detach(),t.attach(),this.attachedShader=t)}}const ri={x:(s,t)=>{s.props.x=t},y:(s,t)=>{s.props.y=t},width:(s,t)=>{s.props.width=t},height:(s,t)=>{s.props.height=t},color:(s,t)=>{s.props.color=t},zIndex:(s,t)=>{s.props.zIndex=t},fontFamily:(s,t)=>{s.props.fontFamily=t},fontWeight:(s,t)=>{s.props.fontWeight=t},fontStyle:(s,t)=>{s.props.fontStyle=t},fontStretch:(s,t)=>{s.props.fontStretch=t},fontSize:(s,t)=>{s.props.fontSize=t},text:(s,t)=>{s.props.text=t},textAlign:(s,t)=>{s.props.textAlign=t},contain:(s,t)=>{s.props.contain=t},offsetY:(s,t)=>{s.props.offsetY=t},scrollable:(s,t)=>{s.props.scrollable=t},scrollY:(s,t)=>{s.props.scrollY=t},letterSpacing:(s,t)=>{s.props.letterSpacing=t},lineHeight:(s,t)=>{s.props.lineHeight=t},maxLines:(s,t)=>{s.props.maxLines=t},textBaseline:(s,t)=>{s.props.textBaseline=t},verticalAlign:(s,t)=>{s.props.verticalAlign=t},overflowSuffix:(s,t)=>{s.props.overflowSuffix=t},debug:(s,t)=>{s.props.debug=t}};class si{constructor(t){l(this,"stage");l(this,"set");this.stage=t;const e={...ri,...this.getPropertySetters()},r={};Object.keys(e).forEach(i=>{Object.defineProperty(r,i,{value:(n,o)=>{n.props[i]!==o&&(e[i](n,o),this.stage.requestRender())},writable:!1,configurable:!1})}),this.set=r}setStatus(t,e,r){t.status!==e&&(t.status=e,t.emitter.emit(e,r))}setIsRenderable(t,e){t.isRenderable=e}destroyState(t){this.setStatus(t,"destroyed"),t.emitter.removeAllListeners()}scheduleUpdateState(t){t.updateScheduled||(t.updateScheduled=!0,queueMicrotask(()=>{t.status!=="destroyed"&&(t.updateScheduled=!1,this.updateState(t))}))}}class ii{constructor(){l(this,"data",{})}reset(){this.data={}}increment(t){this.data[t]||(this.data[t]=0),this.data[t]++}getData(){return{...this.data}}}class ni{constructor(t,e){l(this,"stage");l(this,"memUsed",0);l(this,"loadedTextures",new Map);l(this,"criticalThreshold");l(this,"targetThreshold");l(this,"cleanupInterval");l(this,"debugLogging");l(this,"lastCleanupTime",0);l(this,"criticalCleanupRequested",!1);l(this,"frameTime",0);this.stage=t;const{criticalThreshold:r}=e;this.criticalThreshold=Math.round(r);const i=Math.max(0,Math.min(1,e.targetThresholdLevel));if(this.targetThreshold=Math.round(r*i),this.cleanupInterval=e.cleanupInterval,this.debugLogging=e.debugLogging,e.debugLogging){let n=0;setInterval(()=>{n!==this.memUsed&&(n=this.memUsed,console.log(`[TextureMemoryManager] Memory used: ${Rr(this.memUsed)} mb / ${Rr(this.criticalThreshold)} mb (${(this.memUsed/this.criticalThreshold*100).toFixed(1)}%)`))},1e3)}r===0&&(this.setTextureMemUse=()=>{})}setTextureMemUse(t,e){if(this.loadedTextures.has(t)&&(this.memUsed-=this.loadedTextures.get(t)),e===0){this.loadedTextures.delete(t);return}else this.memUsed+=e,this.loadedTextures.set(t,e);this.memUsed>this.criticalThreshold&&(this.criticalCleanupRequested=!0)}checkCleanup(){return this.criticalCleanupRequested||this.memUsed>this.targetThreshold&&this.frameTime-this.lastCleanupTime>=this.cleanupInterval}cleanup(){const t=this.criticalCleanupRequested;this.lastCleanupTime=this.frameTime,this.criticalCleanupRequested=!1,t&&this.stage.queueFrameEvent("criticalCleanup",{memUsed:this.memUsed,criticalThreshold:this.criticalThreshold}),this.debugLogging&&console.log(`[TextureMemoryManager] Cleaning up textures. Critical: ${t}`);const e=[...this.loadedTextures.keys()].sort((n,o)=>{const a=n.renderable,c=o.renderable;return a===c?n.lastRenderableChangeTime-o.lastRenderableChangeTime:a?1:c?-1:0}),r=this.targetThreshold,i=this.stage.txManager;for(const n of e)if(n.renderable||(n.preventCleanup===!1&&(n.ctxTexture.free(),i.removeTextureFromCache(n)),this.memUsed<=r))break;this.memUsed>=this.criticalThreshold&&(this.stage.queueFrameEvent("criticalCleanupFailed",{memUsed:this.memUsed,criticalThreshold:this.criticalThreshold}),console.warn(`[TextureMemoryManager] Memory usage above critical threshold after cleanup: ${this.memUsed}`))}getMemoryInfo(){let t=0;const e=[...this.loadedTextures.keys()].reduce((r,i)=>(t+=i.renderable?1:0,r+(i.renderable?this.loadedTextures.get(i):0)),0);return{criticalThreshold:this.criticalThreshold,targetThreshold:this.targetThreshold,renderableMemUsed:e,memUsed:this.memUsed,renderableTexturesLoaded:t,loadedTextures:this.loadedTextures.size}}}class oi{constructor(t,e){l(this,"textureSource");l(this,"memManager");this.memManager=t,this.textureSource=e}setTextureMemUse(t){this.memManager.setTextureMemUse(this.textureSource,t)}get renderable(){return this.textureSource.renderable}}class ai{constructor(t){l(this,"options");l(this,"mode");l(this,"stage");l(this,"txManager");l(this,"txMemManager");l(this,"shManager");l(this,"rttNodes",[]);this.options=t,this.stage=t.stage,this.txManager=t.txManager,this.txMemManager=t.txMemManager,this.shManager=t.shManager}}class li extends Yt{constructor(e,r,i){super(e,r);l(this,"textRenderer");l(this,"trState");l(this,"_textRendererOverride",null);l(this,"onTextLoaded",()=>{const{contain:e}=this,r=this.trState.props.width,i=this.trState.props.height,n=this.trState.textW||0,o=this.trState.textH||0;e==="both"?(this.props.width=r,this.props.height=i):e==="width"?(this.props.width=r,this.props.height=o):e==="none"&&(this.props.width=n,this.props.height=o),this.updateLocalTransform(),this.stage.requestRender(),this.emit("loaded",{type:"text",dimensions:{width:this.trState.textW||0,height:this.trState.textH||0}})});l(this,"onTextFailed",(e,r)=>{this.emit("failed",{type:"text",error:r})});this._textRendererOverride=r.textRendererOverride,this.textRenderer=i;const n=this.createState({x:this.absX,y:this.absY,width:r.width,height:r.height,textAlign:r.textAlign,color:r.color,zIndex:r.zIndex,contain:r.contain,scrollable:r.scrollable,scrollY:r.scrollY,offsetY:r.offsetY,letterSpacing:r.letterSpacing,debug:r.debug,fontFamily:r.fontFamily,fontSize:r.fontSize,fontStretch:r.fontStretch,fontStyle:r.fontStyle,fontWeight:r.fontWeight,text:r.text,lineHeight:r.lineHeight,maxLines:r.maxLines,textBaseline:r.textBaseline,verticalAlign:r.verticalAlign,overflowSuffix:r.overflowSuffix});this.trState=n}get width(){return this.props.width}set width(e){this.props.width=e,this.textRenderer.set.width(this.trState,e),this.contain==="none"&&this.setUpdateType(y.Local)}get height(){return this.props.height}set height(e){this.props.height=e,this.textRenderer.set.height(this.trState,e),this.contain!=="both"&&this.setUpdateType(y.Local)}get color(){return this.trState.props.color}set color(e){this.textRenderer.set.color(this.trState,e)}get text(){return this.trState.props.text}set text(e){this.textRenderer.set.text(this.trState,e)}get textRendererOverride(){return this._textRendererOverride}set textRendererOverride(e){this._textRendererOverride=e,this.textRenderer.destroyState(this.trState);const r=this.stage.resolveTextRenderer(this.trState.props,this._textRendererOverride);if(!r){console.warn("Text Renderer not found for font",this.trState.props.fontFamily);return}this.textRenderer=r,this.trState=this.createState(this.trState.props)}get fontSize(){return this.trState.props.fontSize}set fontSize(e){this.textRenderer.set.fontSize(this.trState,e)}get fontFamily(){return this.trState.props.fontFamily}set fontFamily(e){this.textRenderer.set.fontFamily(this.trState,e)}get fontStretch(){return this.trState.props.fontStretch}set fontStretch(e){this.textRenderer.set.fontStretch(this.trState,e)}get fontStyle(){return this.trState.props.fontStyle}set fontStyle(e){this.textRenderer.set.fontStyle(this.trState,e)}get fontWeight(){return this.trState.props.fontWeight}set fontWeight(e){this.textRenderer.set.fontWeight(this.trState,e)}get textAlign(){return this.trState.props.textAlign}set textAlign(e){this.textRenderer.set.textAlign(this.trState,e)}get contain(){return this.trState.props.contain}set contain(e){this.textRenderer.set.contain(this.trState,e)}get scrollable(){return this.trState.props.scrollable}set scrollable(e){this.textRenderer.set.scrollable(this.trState,e)}get scrollY(){return this.trState.props.scrollY}set scrollY(e){this.textRenderer.set.scrollY(this.trState,e)}get offsetY(){return this.trState.props.offsetY}set offsetY(e){this.textRenderer.set.offsetY(this.trState,e)}get letterSpacing(){return this.trState.props.letterSpacing}set letterSpacing(e){this.textRenderer.set.letterSpacing(this.trState,e)}get lineHeight(){return this.trState.props.lineHeight}set lineHeight(e){this.textRenderer.set.lineHeight(this.trState,e)}get maxLines(){return this.trState.props.maxLines}set maxLines(e){this.textRenderer.set.maxLines(this.trState,e)}get textBaseline(){return this.trState.props.textBaseline}set textBaseline(e){this.textRenderer.set.textBaseline(this.trState,e)}get verticalAlign(){return this.trState.props.verticalAlign}set verticalAlign(e){this.textRenderer.set.verticalAlign(this.trState,e)}get overflowSuffix(){return this.trState.props.overflowSuffix}set overflowSuffix(e){this.textRenderer.set.overflowSuffix(this.trState,e)}get debug(){return this.trState.props.debug}set debug(e){this.textRenderer.set.debug(this.trState,e)}update(e,r){super.update(e,r),A(this.globalTransform),this.textRenderer.set.x(this.trState,this.globalTransform.tx),this.textRenderer.set.y(this.trState,this.globalTransform.ty)}checkRenderProps(){return this.trState&&this.trState.props.text!==""?!0:super.checkRenderProps()}onChangeIsRenderable(e){super.onChangeIsRenderable(e),this.textRenderer.setIsRenderable(this.trState,e)}renderQuads(e){var r;if(A(this.globalTransform),!this.textRenderer.renderQuads){super.renderQuads(e);return}this.parentHasRenderTexture&&(!e.renderToTextureActive||this.parentRenderTexture!==e.activeRttNode)||(this.parentHasRenderTexture&&((r=this.props.parent)!=null&&r.rtt)&&(this.globalTransform=X.identity(),this.localTransform&&this.globalTransform.multiply(this.localTransform)),A(this.globalTransform),this.textRenderer.renderQuads(this.trState,this.globalTransform,this.clippingRect,this.worldAlpha,this.parentHasRenderTexture,this.framebufferDimensions))}destroy(){super.destroy(),this.textRenderer.destroyState(this.trState)}createState(e){const r=this.textRenderer.createState(e,this);return r.emitter.on("loaded",this.onTextLoaded),r.emitter.on("failed",this.onTextFailed),this.textRenderer.scheduleUpdateState(r),r}}function ci(s){const t={boolean:!0,string:!0,number:!0,undefined:!0},e=Object.keys(s);for(let r=0;r<e.length;r++){const i=e[r];if(!i)continue;const n=s[i],o=typeof n;o==="string"&&n.length>2048&&(console.warn(`Custom Data value for ${i} is too long, it will be truncated to 2048 characters`),s[i]=n.substring(0,2048)),t[o]||(console.warn(`Custom Data value for ${i} is not a boolean, string, or number, it will be ignored`),delete s[i])}return s}const hi=2e6;class ui{constructor(t){l(this,"options");l(this,"animationManager");l(this,"txManager");l(this,"txMemManager");l(this,"fontManager");l(this,"textRenderers");l(this,"shManager");l(this,"renderer");l(this,"root");l(this,"boundsMargin");l(this,"defShaderCtr");l(this,"eventBus");l(this,"deltaTime",0);l(this,"lastFrameTime",0);l(this,"currentFrameTime",0);l(this,"fpsNumFrames",0);l(this,"fpsElapsedTime",0);l(this,"renderRequested",!1);l(this,"frameEventQueue",[]);l(this,"fontResolveMap",{});l(this,"contextSpy",null);this.options=t;const{canvas:e,clearColor:r,appWidth:i,appHeight:n,boundsMargin:o,enableContextSpy:a,forceWebGL2:c,numImageWorkers:h,textureMemory:d,renderEngine:u,fontEngines:g}=t;this.eventBus=t.eventBus,this.txManager=new $s(h),this.txMemManager=new ni(this,d),this.shManager=new ti,this.animationManager=new Us,this.contextSpy=a?new ii:null;let p=[0,0,0,0];o&&(p=Array.isArray(o)?o:[o,o,o,o]),this.boundsMargin=p;const T={stage:this,canvas:e,pixelRatio:t.devicePhysicalPixelRatio*t.deviceLogicalPixelRatio,clearColor:r??4278190080,bufferMemory:hi,txManager:this.txManager,txMemManager:this.txMemManager,shManager:this.shManager,contextSpy:this.contextSpy,forceWebGL2:c};this.renderer=new u(T);const v=this.renderer.mode||"webgl";this.defShaderCtr=this.renderer.getDefShaderCtr(),ys(v),this.txManager.renderer=this.renderer,this.textRenderers={},g.forEach(w=>{const m=new w(this),x=m.type;if(x==="sdf"&&v==="canvas"){console.warn("SdfTextRenderer is not compatible with Canvas renderer. Skipping...");return}m instanceof si&&(x==="canvas"?this.textRenderers.canvas=m:x==="sdf"&&(this.textRenderers.sdf=m))}),Object.keys(this.textRenderers).length===0&&console.warn("No text renderers available. Your text will not render."),this.fontManager=new Ws(this.textRenderers);const R=new Yt(this,{x:0,y:0,width:i,height:n,alpha:1,autosize:!1,clipping:!1,color:0,colorTop:0,colorBottom:0,colorLeft:0,colorRight:0,colorTl:0,colorTr:0,colorBl:0,colorBr:0,zIndex:0,zIndexLocked:0,scaleX:1,scaleY:1,mountX:0,mountY:0,mount:0,pivot:.5,pivotX:.5,pivotY:.5,rotation:0,parent:null,texture:null,textureOptions:{},shader:this.defShaderCtr,rtt:!1,src:null,scale:1,preventCleanup:!1,strictBounds:!1});this.root=R,Bs(this)}updateFrameTime(){const t=Os();this.lastFrameTime=this.currentFrameTime,this.currentFrameTime=t,this.deltaTime=this.lastFrameTime?t-this.lastFrameTime:100/6,this.txManager.frameTime=t,this.txMemManager.frameTime=t,this.eventBus.emit("frameTick",{time:this.currentFrameTime,delta:this.deltaTime})}updateAnimations(){const{animationManager:t}=this;this.root&&t.update(this.deltaTime)}hasSceneUpdates(){return!!this.root.updateType||this.renderRequested}drawFrame(){const{renderer:t,renderRequested:e}=this;A(t),this.root.updateType!==0&&this.root.update(this.deltaTime,this.root.clippingRect),t.reset(),this.txMemManager.criticalCleanupRequested&&this.txMemManager.cleanup(),t.rttNodes.length>0&&t.renderRTTNodes(),this.addQuads(this.root),t==null||t.render(),this.calculateFps(),e&&(this.renderRequested=!1)}queueFrameEvent(t,e){this.frameEventQueue.push([t,e])}flushFrameEvents(){for(const[t,e]of this.frameEventQueue)this.eventBus.emit(t,e);this.frameEventQueue=[]}calculateFps(){var e,r;const{fpsUpdateInterval:t}=this.options;if(t&&(this.fpsNumFrames++,this.fpsElapsedTime+=this.deltaTime,this.fpsElapsedTime>=t)){const i=Math.round(this.fpsNumFrames*1e3/this.fpsElapsedTime);this.fpsNumFrames=0,this.fpsElapsedTime=0,this.queueFrameEvent("fpsUpdate",{fps:i,contextSpyData:((e=this.contextSpy)==null?void 0:e.getData())??null}),(r=this.contextSpy)==null||r.reset()}}addQuads(t){A(this.renderer),t.isRenderable===!0&&t.renderQuads(this.renderer);for(let e=0;e<t.children.length;e++){const r=t.children[e];r!==void 0&&(r.worldAlpha===0||r.strictBounds===!0&&r.renderState===F.OutOfBounds||this.addQuads(r))}}requestRender(){this.renderRequested=!0}resolveTextRenderer(t,e=null){const r=`${t.fontFamily}${t.fontStyle}${t.fontWeight}${t.fontStretch}${e||""}`;if(this.fontResolveMap[r]!==void 0)return this.fontResolveMap[r];let i=e,n=!1;if(i){const a=this.textRenderers[i];a?a.canRenderFont(t)||(console.warn(`Cannot use override text renderer '${i}' for font`,t),i=null,n=!0):(console.warn(`Text renderer override '${i}' not found.`),i=null,n=!0)}if(!i){for(const[a,c]of Object.entries(this.textRenderers))if(c.canRenderFont(t)){i=a;break}!i&&this.textRenderers.canvas!==void 0&&(i="canvas")}if(n&&console.warn(`Falling back to text renderer ${String(i)}`),!i)return null;const o=this.textRenderers[i];return A(o,"resolvedTextRenderer undefined"),this.fontResolveMap[r]=o,o}createShaderCtr(t,e){return this.shManager.loadShader(t,e)}createNode(t){const e=this.resolveNodeDefaults(t);return new Yt(this,e)}createTextNode(t){const e=t.fontSize??16,r={...this.resolveNodeDefaults(t),text:t.text??"",textRendererOverride:t.textRendererOverride??null,fontSize:e,fontFamily:t.fontFamily??"sans-serif",fontStyle:t.fontStyle??"normal",fontWeight:t.fontWeight??"normal",fontStretch:t.fontStretch??"normal",textAlign:t.textAlign??"left",contain:t.contain??"none",scrollable:t.scrollable??!1,scrollY:t.scrollY??0,offsetY:t.offsetY??0,letterSpacing:t.letterSpacing??0,lineHeight:t.lineHeight,maxLines:t.maxLines??0,textBaseline:t.textBaseline??"alphabetic",verticalAlign:t.verticalAlign??"middle",overflowSuffix:t.overflowSuffix??"...",debug:t.debug??{},shaderProps:null},i=this.resolveTextRenderer(r,t.textRendererOverride);if(!i)throw new Error(`No compatible text renderer found for ${r.fontFamily}`);return new li(this,r,i)}resolveNodeDefaults(t){const e=t.color??4294967295,r=t.colorTl??t.colorTop??t.colorLeft??e,i=t.colorTr??t.colorTop??t.colorRight??e,n=t.colorBl??t.colorBottom??t.colorLeft??e,o=t.colorBr??t.colorBottom??t.colorRight??e;let a={};return this.options.inspector===!0&&(a=ci(t.data??{})),{x:t.x??0,y:t.y??0,width:t.width??0,height:t.height??0,alpha:t.alpha??1,autosize:t.autosize??!1,clipping:t.clipping??!1,color:e,colorTop:t.colorTop??e,colorBottom:t.colorBottom??e,colorLeft:t.colorLeft??e,colorRight:t.colorRight??e,colorBl:n,colorBr:o,colorTl:r,colorTr:i,zIndex:t.zIndex??0,zIndexLocked:t.zIndexLocked??0,parent:t.parent??null,texture:t.texture??null,textureOptions:t.textureOptions??{},shader:t.shader??this.defShaderCtr,src:t.src??null,srcHeight:t.srcHeight,srcWidth:t.srcWidth,srcX:t.srcX,srcY:t.srcY,scale:t.scale??null,scaleX:t.scaleX??t.scale??1,scaleY:t.scaleY??t.scale??1,mount:t.mount??0,mountX:t.mountX??t.mount??0,mountY:t.mountY??t.mount??0,pivot:t.pivot??.5,pivotX:t.pivotX??t.pivot??.5,pivotY:t.pivotY??t.pivot??.5,rotation:t.rotation??0,rtt:t.rtt??!1,data:a,preventCleanup:t.preventCleanup??!1,imageType:t.imageType,strictBounds:t.strictBounds??!1}}}class di extends Ne{constructor(e,r){var v,R,w,m;super();l(this,"root");l(this,"canvas");l(this,"settings");l(this,"stage");l(this,"inspector",null);const i={criticalThreshold:((v=e.textureMemory)==null?void 0:v.criticalThreshold)||124e6,targetThresholdLevel:((R=e.textureMemory)==null?void 0:R.targetThresholdLevel)||.5,cleanupInterval:((w=e.textureMemory)==null?void 0:w.cleanupInterval)||3e4,debugLogging:((m=e.textureMemory)==null?void 0:m.debugLogging)||!1},n={appWidth:e.appWidth||1920,appHeight:e.appHeight||1080,textureMemory:i,boundsMargin:e.boundsMargin||0,deviceLogicalPixelRatio:e.deviceLogicalPixelRatio||1,devicePhysicalPixelRatio:e.devicePhysicalPixelRatio||window.devicePixelRatio,clearColor:e.clearColor??0,fpsUpdateInterval:e.fpsUpdateInterval||0,numImageWorkers:e.numImageWorkers!==void 0?e.numImageWorkers:2,enableContextSpy:e.enableContextSpy??!1,forceWebGL2:e.forceWebGL2??!1,inspector:e.inspector??!1,renderEngine:e.renderEngine,quadBufferSize:e.quadBufferSize??4*1024*1024,fontEngines:e.fontEngines};this.settings=n;const{appWidth:o,appHeight:a,deviceLogicalPixelRatio:c,devicePhysicalPixelRatio:h,inspector:d}=n,u=o*c,g=a*c,p=document.createElement("canvas");this.canvas=p,p.width=u*h,p.height=g*h,p.style.width=`${u}px`,p.style.height=`${g}px`,this.stage=new ui({appWidth:this.settings.appWidth,appHeight:this.settings.appHeight,boundsMargin:this.settings.boundsMargin,clearColor:this.settings.clearColor,canvas:this.canvas,deviceLogicalPixelRatio:this.settings.deviceLogicalPixelRatio,devicePhysicalPixelRatio:this.settings.devicePhysicalPixelRatio,enableContextSpy:this.settings.enableContextSpy,forceWebGL2:this.settings.forceWebGL2,fpsUpdateInterval:this.settings.fpsUpdateInterval,numImageWorkers:this.settings.numImageWorkers,renderEngine:this.settings.renderEngine,textureMemory:i,eventBus:this,quadBufferSize:this.settings.quadBufferSize,fontEngines:this.settings.fontEngines,inspector:this.settings.inspector!==null}),this.root=this.stage.root;let T;if(typeof r=="string"?T=document.getElementById(r):T=r,!T)throw new Error("Could not find target element");T.appendChild(p),d&&!Xr()&&(this.inspector=new d(p,n))}createNode(e){A(this.stage,"Stage is not initialized");const r=this.stage.createNode(e);return this.inspector?this.inspector.createNode(r):r}createTextNode(e){const r=this.stage.createTextNode(e);return this.inspector?this.inspector.createTextNode(r):r}destroyNode(e){return this.inspector&&this.inspector.destroyNode(e.id),e.destroy()}createTexture(e,r){return this.stage.txManager.loadTexture(e,r)}createShader(e,r){return this.stage.shManager.loadShader(e,r)}createDynamicShader(e){return this.stage.shManager.loadDynamicShader({effects:e})}createEffect(e,r,i){return{name:i,type:e,props:r}}getNodeById(e){var n;const r=(n=this.stage)==null?void 0:n.root;if(!r)return null;const i=o=>{if(o.id===e)return o;for(const a of o.children){const c=i(a);if(c)return c}return null};return i(r)}toggleFreeze(){throw new Error("Not implemented")}advanceFrame(){throw new Error("Not implemented")}getBufferInfo(){return this.stage.renderer.getBufferInfo()}rerender(){throw new Error("Not implemented")}}class fi{}class pi extends fi{constructor(e,r,i,n,o,a,c,h,d,u,g,p,T){super();l(this,"glw");l(this,"options");l(this,"buffers");l(this,"shader");l(this,"shaderProps");l(this,"alpha");l(this,"clippingRect");l(this,"dimensions");l(this,"bufferIdx");l(this,"zIndex");l(this,"renderToTexture");l(this,"parentHasRenderTexture");l(this,"framebufferDimensions");l(this,"length",0);l(this,"numQuads",0);l(this,"textures",[]);l(this,"maxTextures");this.glw=e,this.options=r,this.buffers=i,this.shader=n,this.shaderProps=o,this.alpha=a,this.clippingRect=c,this.dimensions=h,this.bufferIdx=d,this.zIndex=u,this.renderToTexture=g,this.parentHasRenderTexture=p,this.framebufferDimensions=T,this.maxTextures=n.supportsIndexedTextures?e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS):1}addTexture(e){const{textures:r,maxTextures:i}=this;let n=-1;const o=r.length;for(let a=0;a<o;a++)if(r[a]===e){n=a;break}return n!==-1?n:o>=i?4294967295:(this.textures.push(e),o)}draw(){const{glw:e,shader:r,shaderProps:i,options:n}=this,{shManager:o}=n;o.useShader(r),r.bindRenderOp(this,i);const a=this.bufferIdx/24*6*2;if(this.clippingRect.valid){const{x:c,y:h,width:d,height:u}=this.clippingRect,g=n.pixelRatio,p=n.canvas.height,T=Math.round(c*g),v=Math.round(d*g),R=Math.round(u*g),w=Math.round(p-R-h*g);e.setScissorTest(!0),e.scissor(T,w,v,R)}else e.setScissorTest(!1);e.drawElements(e.TRIANGLES,6*this.numQuads,e.UNSIGNED_SHORT,a)}}function gi(s){const t={MAX_RENDERBUFFER_SIZE:0,MAX_TEXTURE_SIZE:0,MAX_VIEWPORT_DIMS:0,MAX_VERTEX_TEXTURE_IMAGE_UNITS:0,MAX_TEXTURE_IMAGE_UNITS:0,MAX_COMBINED_TEXTURE_IMAGE_UNITS:0,MAX_VERTEX_ATTRIBS:0,MAX_VARYING_VECTORS:0,MAX_VERTEX_UNIFORM_VECTORS:0,MAX_FRAGMENT_UNIFORM_VECTORS:0};return Object.keys(t).forEach(r=>{t[r]=s.getParameter(s[r])}),t}function mi(s){const t={ANGLE_instanced_arrays:null,WEBGL_compressed_texture_s3tc:null,WEBGL_compressed_texture_astc:null,WEBGL_compressed_texture_etc:null,WEBGL_compressed_texture_etc1:null,WEBGL_compressed_texture_pvrtc:null,WEBKIT_WEBGL_compressed_texture_pvrtc:null,WEBGL_compressed_texture_s3tc_srgb:null,OES_vertex_array_object:null};return Object.keys(t).forEach(r=>{t[r]=s.getExtension(r)}),t}function xi(s,t){const e=~~(t/80),r=new Uint16Array(e*6);for(let n=0,o=0;n<e;n+=6,o+=4)r[n]=o,r[n+1]=o+1,r[n+2]=o+2,r[n+3]=o+2,r[n+4]=o+1,r[n+5]=o+3;const i=s.createBuffer();s.elementArrayBufferData(i,r,s.STATIC_DRAW)}function yi(s){return s!==null&&typeof s=="object"&&s.constructor&&s.constructor.name==="HTMLImageElement"}const Ut=new Uint8Array([0,0,0,0]);class hr extends oi{constructor(e,r,i){super(r,i);l(this,"glw");l(this,"_nativeCtxTexture",null);l(this,"_state","freed");l(this,"_w",0);l(this,"_h",0);this.glw=e}get ctxTexture(){return this._state==="freed"&&this.load(),A(this._nativeCtxTexture),this._nativeCtxTexture}get w(){return this._w}get h(){return this._h}load(){if(!(this._state==="loading"||this._state==="loaded")){if(this._state="loading",this.textureSource.setState("loading"),this._nativeCtxTexture=this.createNativeCtxTexture(),this._nativeCtxTexture===null){this._state="failed",this.textureSource.setState("failed",new Error("Could not create WebGL Texture")),console.error("Could not create WebGL Texture");return}this.onLoadRequest().then(({width:e,height:r})=>{this._state!=="freed"&&(this._state="loaded",this._w=e,this._h=r,this.textureSource.setState("loaded",{width:e,height:r}))}).catch(e=>{this._state!=="freed"&&(this._state="failed",this.textureSource.setState("failed",e),console.error(e))})}}async onLoadRequest(){var o;const{glw:e}=this;e.texImage2D(0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,null),this.setTextureMemUse(Ut.byteLength);const r=await((o=this.textureSource)==null?void 0:o.getTextureData());if(!this._nativeCtxTexture)return A(this._state==="freed"),{width:0,height:0};let i=0,n=0;if(A(this._nativeCtxTexture),e.activeTexture(0),typeof ImageBitmap<"u"&&r.data instanceof ImageBitmap||r.data instanceof ImageData||yi(r.data)){const a=r.data;i=a.width,n=a.height,e.bindTexture(this._nativeCtxTexture),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!!r.premultiplyAlpha),e.texImage2D(0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,a),this.setTextureMemUse(i*n*4),(e.isWebGl2()||_r(i)&&_r(n))&&e.generateMipmap()}else if(r.data===null)i=0,n=0,e.bindTexture(this._nativeCtxTexture),e.texImage2D(0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,Ut),this.setTextureMemUse(Ut.byteLength);else if("mipmaps"in r.data&&r.data.mipmaps){const{mipmaps:a,width:c=0,height:h=0,type:d,glInternalFormat:u}=r.data,g=d==="ktx"?new DataView(a[0]??new ArrayBuffer(0)):a[0];e.bindTexture(this._nativeCtxTexture),e.compressedTexImage2D(0,u,c,h,0,g),e.texParameteri(e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_MIN_FILTER,e.LINEAR),this.setTextureMemUse(g.byteLength)}else console.error("WebGlCoreCtxTexture.onLoadRequest: Unexpected textureData returned",r);return{width:i,height:n}}free(){if(this._state==="freed"||(this._state="freed",this.textureSource.setState("freed"),this._w=0,this._h=0,!this._nativeCtxTexture))return;const{glw:e}=this;e.deleteTexture(this._nativeCtxTexture),this.setTextureMemUse(0),this._nativeCtxTexture=null}createNativeCtxTexture(){const{glw:e}=this,r=e.createTexture();return r?(e.activeTexture(0),e.bindTexture(r),e.texParameteri(e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),r):null}}class vi extends hr{constructor(t,e,r){super(t,e,r)}async onLoadRequest(){var e,r;const t=await this.textureSource.getTextureData();return{width:((e=t.data)==null?void 0:e.width)||0,height:((r=t.data)==null?void 0:r.height)||0}}}class Ti{constructor(t){l(this,"config");this.config=t}getBuffer(t){var e;return(e=this.config.find(r=>r.attributes[t]))==null?void 0:e.buffer}getAttributeInfo(t){var e;return(e=this.config.find(r=>r.attributes[t]))==null?void 0:e.attributes[t]}}function _i(s){return self.WebGL2RenderingContext&&s instanceof self.WebGL2RenderingContext}class Ri{constructor(t){l(this,"gl");l(this,"activeTextureUnit",0);l(this,"texture2dUnits");l(this,"texture2dParams",new WeakMap);l(this,"scissorEnabled");l(this,"scissorX");l(this,"scissorY");l(this,"scissorWidth");l(this,"scissorHeight");l(this,"blendEnabled");l(this,"blendSrcRgb");l(this,"blendDstRgb");l(this,"blendSrcAlpha");l(this,"blendDstAlpha");l(this,"boundArrayBuffer");l(this,"boundElementArrayBuffer");l(this,"curProgram");l(this,"canvas");l(this,"MAX_RENDERBUFFER_SIZE");l(this,"MAX_TEXTURE_SIZE");l(this,"MAX_VIEWPORT_DIMS");l(this,"MAX_VERTEX_TEXTURE_IMAGE_UNITS");l(this,"MAX_TEXTURE_IMAGE_UNITS");l(this,"MAX_COMBINED_TEXTURE_IMAGE_UNITS");l(this,"MAX_VERTEX_ATTRIBS");l(this,"MAX_VARYING_VECTORS");l(this,"MAX_VERTEX_UNIFORM_VECTORS");l(this,"MAX_FRAGMENT_UNIFORM_VECTORS");l(this,"TEXTURE_MAG_FILTER");l(this,"TEXTURE_MIN_FILTER");l(this,"TEXTURE_WRAP_S");l(this,"TEXTURE_WRAP_T");l(this,"LINEAR");l(this,"CLAMP_TO_EDGE");l(this,"RGBA");l(this,"UNSIGNED_BYTE");l(this,"UNPACK_PREMULTIPLY_ALPHA_WEBGL");l(this,"UNPACK_FLIP_Y_WEBGL");l(this,"FLOAT");l(this,"TRIANGLES");l(this,"UNSIGNED_SHORT");l(this,"ONE");l(this,"ONE_MINUS_SRC_ALPHA");l(this,"VERTEX_SHADER");l(this,"FRAGMENT_SHADER");l(this,"STATIC_DRAW");l(this,"COMPILE_STATUS");l(this,"LINK_STATUS");l(this,"DYNAMIC_DRAW");l(this,"COLOR_ATTACHMENT0");this.gl=t,this.activeTextureUnit=t.getParameter(t.ACTIVE_TEXTURE)-t.TEXTURE0;const e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.texture2dUnits=new Array(e).fill(void 0).map((i,n)=>(this.activeTexture(n),t.getParameter(t.TEXTURE_BINDING_2D))),this.activeTexture(this.activeTextureUnit),this.scissorEnabled=t.isEnabled(t.SCISSOR_TEST);const r=t.getParameter(t.SCISSOR_BOX);this.scissorX=r[0],this.scissorY=r[1],this.scissorWidth=r[2],this.scissorHeight=r[3],this.blendEnabled=t.isEnabled(t.BLEND),this.blendSrcRgb=t.getParameter(t.BLEND_SRC_RGB),this.blendDstRgb=t.getParameter(t.BLEND_DST_RGB),this.blendSrcAlpha=t.getParameter(t.BLEND_SRC_ALPHA),this.blendDstAlpha=t.getParameter(t.BLEND_DST_ALPHA),this.boundArrayBuffer=t.getParameter(t.ARRAY_BUFFER_BINDING),this.boundElementArrayBuffer=t.getParameter(t.ELEMENT_ARRAY_BUFFER_BINDING),this.curProgram=t.getParameter(t.CURRENT_PROGRAM),this.canvas=t.canvas,this.MAX_RENDERBUFFER_SIZE=t.MAX_RENDERBUFFER_SIZE,this.MAX_TEXTURE_SIZE=t.MAX_TEXTURE_SIZE,this.MAX_VIEWPORT_DIMS=t.MAX_VIEWPORT_DIMS,this.MAX_VERTEX_TEXTURE_IMAGE_UNITS=t.MAX_VERTEX_TEXTURE_IMAGE_UNITS,this.MAX_TEXTURE_IMAGE_UNITS=t.MAX_TEXTURE_IMAGE_UNITS,this.MAX_COMBINED_TEXTURE_IMAGE_UNITS=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS,this.MAX_VERTEX_ATTRIBS=t.MAX_VERTEX_ATTRIBS,this.MAX_VARYING_VECTORS=t.MAX_VARYING_VECTORS,this.MAX_VERTEX_UNIFORM_VECTORS=t.MAX_VERTEX_UNIFORM_VECTORS,this.MAX_FRAGMENT_UNIFORM_VECTORS=t.MAX_FRAGMENT_UNIFORM_VECTORS,this.TEXTURE_MAG_FILTER=t.TEXTURE_MAG_FILTER,this.TEXTURE_MIN_FILTER=t.TEXTURE_MIN_FILTER,this.TEXTURE_WRAP_S=t.TEXTURE_WRAP_S,this.TEXTURE_WRAP_T=t.TEXTURE_WRAP_T,this.LINEAR=t.LINEAR,this.CLAMP_TO_EDGE=t.CLAMP_TO_EDGE,this.RGBA=t.RGBA,this.UNSIGNED_BYTE=t.UNSIGNED_BYTE,this.UNPACK_PREMULTIPLY_ALPHA_WEBGL=t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.UNPACK_FLIP_Y_WEBGL=t.UNPACK_FLIP_Y_WEBGL,this.FLOAT=t.FLOAT,this.TRIANGLES=t.TRIANGLES,this.UNSIGNED_SHORT=t.UNSIGNED_SHORT,this.ONE=t.ONE,this.ONE_MINUS_SRC_ALPHA=t.ONE_MINUS_SRC_ALPHA,this.MAX_VERTEX_TEXTURE_IMAGE_UNITS=t.MAX_VERTEX_TEXTURE_IMAGE_UNITS,this.TRIANGLES=t.TRIANGLES,this.UNSIGNED_SHORT=t.UNSIGNED_SHORT,this.VERTEX_SHADER=t.VERTEX_SHADER,this.FRAGMENT_SHADER=t.FRAGMENT_SHADER,this.STATIC_DRAW=t.STATIC_DRAW,this.COMPILE_STATUS=t.COMPILE_STATUS,this.LINK_STATUS=t.LINK_STATUS,this.DYNAMIC_DRAW=t.DYNAMIC_DRAW,this.COLOR_ATTACHMENT0=t.COLOR_ATTACHMENT0}isWebGl2(){return _i(this.gl)}activeTexture(t){const{gl:e}=this;this.activeTextureUnit!==t&&(e.activeTexture(t+e.TEXTURE0),this.activeTextureUnit=t)}bindTexture(t){const{gl:e,activeTextureUnit:r,texture2dUnits:i}=this;i[r]!==t&&(i[r]=t,e.bindTexture(this.gl.TEXTURE_2D,t))}_getActiveTexture(){const{activeTextureUnit:t,texture2dUnits:e}=this;return e[t]}texParameteri(t,e){const{gl:r,texture2dParams:i}=this,n=this._getActiveTexture();if(!n)throw new Error("No active texture");let o=i.get(n);o||(o={},i.set(n,o)),o[t]!==e&&(o[t]=e,r.texParameteri(r.TEXTURE_2D,t,e))}texImage2D(t,e,r,i,n,o,a,c){const{gl:h}=this;o?h.texImage2D(h.TEXTURE_2D,t,e,r,i,n,o,a,c):h.texImage2D(h.TEXTURE_2D,t,e,r,i,n)}compressedTexImage2D(t,e,r,i,n,o){const{gl:a}=this;a.compressedTexImage2D(a.TEXTURE_2D,t,e,r,i,n,o)}pixelStorei(t,e){const{gl:r}=this;r.pixelStorei(t,e)}generateMipmap(){const{gl:t}=this;t.generateMipmap(t.TEXTURE_2D)}createTexture(){const{gl:t}=this;return t.createTexture()}deleteTexture(t){const{gl:e}=this;t&&this.texture2dParams.delete(t),e.deleteTexture(t)}viewport(t,e,r,i){const{gl:n}=this;n.viewport(t,e,r,i)}clearColor(t,e,r,i){const{gl:n}=this;n.clearColor(t,e,r,i)}setScissorTest(t){const{gl:e,scissorEnabled:r}=this;t!==r&&(t?e.enable(e.SCISSOR_TEST):e.disable(e.SCISSOR_TEST),this.scissorEnabled=t)}scissor(t,e,r,i){const{gl:n,scissorX:o,scissorY:a,scissorWidth:c,scissorHeight:h}=this;(t!==o||e!==a||r!==c||i!==h)&&(n.scissor(t,e,r,i),this.scissorX=t,this.scissorY=e,this.scissorWidth=r,this.scissorHeight=i)}setBlend(t){const{gl:e,blendEnabled:r}=this;t!==r&&(t?e.enable(e.BLEND):e.disable(e.BLEND),this.blendEnabled=t)}blendFunc(t,e){const{gl:r,blendSrcRgb:i,blendDstRgb:n,blendSrcAlpha:o,blendDstAlpha:a}=this;(t!==i||e!==n||t!==o||e!==a)&&(r.blendFunc(t,e),this.blendSrcRgb=t,this.blendDstRgb=e,this.blendSrcAlpha=t,this.blendDstAlpha=e)}createBuffer(){const{gl:t}=this;return t.createBuffer()}createFramebuffer(){const{gl:t}=this;return t.createFramebuffer()}bindFramebuffer(t){const{gl:e}=this;e.bindFramebuffer(e.FRAMEBUFFER,t)}framebufferTexture2D(t,e,r){const{gl:i}=this;i.framebufferTexture2D(i.FRAMEBUFFER,t,i.TEXTURE_2D,e,r)}clear(){const{gl:t}=this;t.clear(t.COLOR_BUFFER_BIT)}arrayBufferData(t,e,r){const{gl:i,boundArrayBuffer:n}=this;n!==t&&(i.bindBuffer(i.ARRAY_BUFFER,t),this.boundArrayBuffer=t),i.bufferData(i.ARRAY_BUFFER,e,r)}elementArrayBufferData(t,e,r){const{gl:i,boundElementArrayBuffer:n}=this;n!==t&&(i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,t),this.boundElementArrayBuffer=t),i.bufferData(i.ELEMENT_ARRAY_BUFFER,e,r)}vertexAttribPointer(t,e,r,i,n,o,a){const{gl:c,boundArrayBuffer:h}=this;h!==t&&(c.bindBuffer(c.ARRAY_BUFFER,t),this.boundArrayBuffer=t),c.vertexAttribPointer(e,r,i,n,o,a)}useProgram(t){const{gl:e,curProgram:r}=this;r!==t&&(e.useProgram(t),this.curProgram=t)}uniform1f(t,e){const{gl:r}=this;r.uniform1f(t,e)}uniform1fv(t,e){const{gl:r}=this;r.uniform1fv(t,e)}uniform1i(t,e){const{gl:r}=this;r.uniform1i(t,e)}uniform1iv(t,e){const{gl:r}=this;r.uniform1iv(t,e)}uniform2f(t,e,r){const{gl:i}=this;i.uniform2f(t,e,r)}uniform2fv(t,e){const{gl:r}=this;r.uniform2fv(t,e)}uniform2i(t,e,r){const{gl:i}=this;i.uniform2i(t,e,r)}uniform2iv(t,e){const{gl:r}=this;r.uniform2iv(t,e)}uniform3f(t,e,r,i){const{gl:n}=this;n.uniform3f(t,e,r,i)}uniform3fv(t,e){const{gl:r}=this;r.uniform3fv(t,e)}uniform3i(t,e,r,i){const{gl:n}=this;n.uniform3i(t,e,r,i)}uniform3iv(t,e){const{gl:r}=this;r.uniform3iv(t,e)}uniform4f(t,e,r,i,n){const{gl:o}=this;o.uniform4f(t,e,r,i,n)}uniform4fv(t,e){const{gl:r}=this;r.uniform4fv(t,e)}uniform4i(t,e,r,i,n){const{gl:o}=this;o.uniform4i(t,e,r,i,n)}uniform4iv(t,e){const{gl:r}=this;r.uniform4iv(t,e)}uniformMatrix2fv(t,e){const{gl:r}=this;r.uniformMatrix2fv(t,!1,e)}uniformMatrix3fv(t,e){const{gl:r}=this;r.uniformMatrix3fv(t,!1,e)}uniformMatrix4fv(t,e){const{gl:r}=this;r.uniformMatrix4fv(t,!1,e)}getParameter(t){const{gl:e}=this;return e.getParameter(t)}drawElements(t,e,r,i){const{gl:n}=this;n.drawElements(t,e,r,i)}getExtension(t){const{gl:e}=this;return e.getExtension(t)}createVertexArray(){const{gl:t}=this;return A(t instanceof WebGL2RenderingContext),t.createVertexArray()}bindVertexArray(t){const{gl:e}=this;A(e instanceof WebGL2RenderingContext),e.bindVertexArray(t)}getAttribLocation(t,e){const{gl:r}=this;return r.getAttribLocation(t,e)}getUniformLocation(t,e){const{gl:r}=this;return r.getUniformLocation(t,e)}enableVertexAttribArray(t){const{gl:e}=this;e.enableVertexAttribArray(t)}disableVertexAttribArray(t){const{gl:e}=this;e.disableVertexAttribArray(t)}createShader(t){const{gl:e}=this;return e.createShader(t)}compileShader(t){const{gl:e}=this;e.compileShader(t)}attachShader(t,e){const{gl:r}=this;r.attachShader(t,e)}linkProgram(t){const{gl:e}=this;e.linkProgram(t)}deleteProgram(t){const{gl:e}=this;e.deleteProgram(t)}getShaderParameter(t,e){const{gl:r}=this;return r.getShaderParameter(t,e)}getShaderInfoLog(t){const{gl:e}=this;return e.getShaderInfoLog(t)}createProgram(){const{gl:t}=this;return t.createProgram()}getProgramParameter(t,e){const{gl:r}=this;return r.getProgramParameter(t,e)}getProgramInfoLog(t){const{gl:e}=this;return e.getProgramInfoLog(t)}shaderSource(t,e){const{gl:r}=this;r.shaderSource(t,e)}deleteShader(t){const{gl:e}=this;e.deleteShader(t)}}class Cr extends hr{constructor(e,r,i){super(e,r,i);l(this,"framebuffer");const n=e.createFramebuffer();A(n,"Unable to create framebuffer"),this.framebuffer=n}async onLoadRequest(){const{glw:e}=this,r=this._nativeCtxTexture=this.createNativeCtxTexture(),{width:i,height:n}=this.textureSource;return e.texImage2D(0,e.RGBA,i,n,0,e.RGBA,e.UNSIGNED_BYTE,null),this.setTextureMemUse(i*n*4),e.bindFramebuffer(this.framebuffer),e.framebufferTexture2D(e.COLOR_ATTACHMENT0,r,0),e.bindFramebuffer(null),{width:i,height:n}}}const bi=24;class wi extends ai{constructor(e){super(e);l(this,"glw");l(this,"system");l(this,"quadBuffer");l(this,"fQuadBuffer");l(this,"uiQuadBuffer");l(this,"renderOps",[]);l(this,"curBufferIdx",0);l(this,"curRenderOp",null);l(this,"rttNodes",[]);l(this,"activeRttNode",null);l(this,"defShaderCtrl");l(this,"defaultShader");l(this,"quadBufferCollection");l(this,"defaultTexture");l(this,"quadBufferUsage",0);l(this,"renderToTextureActive",!1);this.quadBuffer=new ArrayBuffer(this.stage.options.quadBufferSize),this.fQuadBuffer=new Float32Array(this.quadBuffer),this.uiQuadBuffer=new Uint32Array(this.quadBuffer),this.mode="webgl";const{canvas:r,clearColor:i,bufferMemory:n}=e;this.defaultTexture=new gt(this.txManager),this.defaultTexture.setRenderableOwner(this,!0),this.defaultTexture.once("loaded",()=>{this.stage.requestRender()});const o=xs(r,e.forceWebGL2,e.contextSpy),a=this.glw=new Ri(o),c=De(i);a.viewport(0,0,r.width,r.height),a.clearColor(c[0],c[1],c[2],c[3]),a.setBlend(!0),a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA),xi(a,n),this.system={parameters:gi(this.glw),extensions:mi(this.glw)},this.shManager.renderer=this,this.defShaderCtrl=this.shManager.loadShader("DefaultShader"),this.defaultShader=this.defShaderCtrl.shader;const h=a.createBuffer();A(h);const d=6*Float32Array.BYTES_PER_ELEMENT;this.quadBufferCollection=new Ti([{buffer:h,attributes:{a_position:{name:"a_position",size:2,type:a.FLOAT,normalized:!1,stride:d,offset:0},a_textureCoordinate:{name:"a_textureCoordinate",size:2,type:a.FLOAT,normalized:!1,stride:d,offset:2*Float32Array.BYTES_PER_ELEMENT},a_color:{name:"a_color",size:4,type:a.UNSIGNED_BYTE,normalized:!0,stride:d,offset:4*Float32Array.BYTES_PER_ELEMENT},a_textureIndex:{name:"a_textureIndex",size:1,type:a.FLOAT,normalized:!1,stride:d,offset:5*Float32Array.BYTES_PER_ELEMENT}}}])}reset(){const{glw:e}=this;this.curBufferIdx=0,this.curRenderOp=null,this.renderOps.length=0,e.setScissorTest(!1),e.clear()}getShaderManager(){return this.shManager}createCtxTexture(e){return e instanceof mt?new vi(this.glw,this.txMemManager,e):e instanceof xt?new Cr(this.glw,this.txMemManager,e):new hr(this.glw,this.txMemManager,e)}addQuad(e){const{fQuadBuffer:r,uiQuadBuffer:i}=this;let n=e.texture||this.defaultTexture;if(e.shaderProps!==null){if(ft(e.shaderProps,"$dimensions")==!0){const w=e.shaderProps.$dimensions;w.width=e.width,w.height=e.height}ft(e.shaderProps,"$alpha")===!0&&(e.shaderProps.$alpha=e.alpha)}A(n.ctxTexture!==void 0,"Invalid texture type");let{curBufferIdx:o,curRenderOp:a}=this;const c={width:-1,height:-1};c.width=e.width,c.height=e.height;const h=e.shader||this.defaultShader;A(h.getUniformLocation!==void 0,"Invalid WebGL shader"),this.reuseRenderOp(e)===!1&&(this.newRenderOp(h,e.shaderProps,e.alpha,c,e.clippingRect,o,e.rtt,e.parentHasRenderTexture,e.framebufferDimensions),a=this.curRenderOp,A(a));let d=0,u=0,g=1,p=1;if(n.type===Y.subTexture){const{x:w,y:m,width:x,height:f}=n.props,{width:_=0,height:b=0}=n.parentTexture.dimensions||{width:0,height:0};d=w/_,g=d+x/_,u=m/b,p=u+f/b,n=n.parentTexture}if(n.type===Y.image&&e.textureOptions!==null&&e.textureOptions.resizeMode!==void 0&&n.dimensions!==null){const w=e.textureOptions.resizeMode,{width:m,height:x}=n.dimensions;if(w.type==="cover"){const f=e.width/m,_=e.height/x,b=Math.max(f,_),S=1/b;if(b&&f&&f<b){const E=S*e.width;d=(1-E/m)*(w.clipX??.5),g=d+E/m}if(b&&_&&_<b){const E=S*e.height;u=(1-E/x)*(w.clipY??.5),p=u+E/x}}}let T=0;e.textureOptions!==null&&(e.textureOptions.flipX===!0&&([d,g]=[g,d]),T=+(e.textureOptions.flipY||!1)),T^+(n.type===Y.renderToTexture)&&([u,p]=[p,u]);const v=n.ctxTexture;A(v.ctxTexture!==void 0);const R=this.addTexture(v,o);if(A(this.curRenderOp!==null),e.renderCoords)r[o++]=e.renderCoords.x1,r[o++]=e.renderCoords.y1,r[o++]=d,r[o++]=u,i[o++]=e.colorTl,r[o++]=R,r[o++]=e.renderCoords.x2,r[o++]=e.renderCoords.y2,r[o++]=g,r[o++]=u,i[o++]=e.colorTr,r[o++]=R,r[o++]=e.renderCoords.x4,r[o++]=e.renderCoords.y4,r[o++]=d,r[o++]=p,i[o++]=e.colorBl,r[o++]=R,r[o++]=e.renderCoords.x3,r[o++]=e.renderCoords.y3,r[o++]=g,r[o++]=p,i[o++]=e.colorBr,r[o++]=R;else if(e.tb!==0||e.tc!==0)r[o++]=e.tx,r[o++]=e.ty,r[o++]=d,r[o++]=u,i[o++]=e.colorTl,r[o++]=R,r[o++]=e.tx+e.width*e.ta,r[o++]=e.ty+e.width*e.tc,r[o++]=g,r[o++]=u,i[o++]=e.colorTr,r[o++]=R,r[o++]=e.tx+e.height*e.tb,r[o++]=e.ty+e.height*e.td,r[o++]=d,r[o++]=p,i[o++]=e.colorBl,r[o++]=R,r[o++]=e.tx+e.width*e.ta+e.height*e.tb,r[o++]=e.ty+e.width*e.tc+e.height*e.td,r[o++]=g,r[o++]=p,i[o++]=e.colorBr,r[o++]=R;else{const w=e.tx+e.width*e.ta,m=e.ty+e.height*e.td;r[o++]=e.tx,r[o++]=e.ty,r[o++]=d,r[o++]=u,i[o++]=e.colorTl,r[o++]=R,r[o++]=w,r[o++]=e.ty,r[o++]=g,r[o++]=u,i[o++]=e.colorTr,r[o++]=R,r[o++]=e.tx,r[o++]=m,r[o++]=d,r[o++]=p,i[o++]=e.colorBl,r[o++]=R,r[o++]=w,r[o++]=m,r[o++]=g,r[o++]=p,i[o++]=e.colorBr,r[o++]=R}this.curRenderOp.length+=bi,this.curRenderOp.numQuads++,this.curBufferIdx=o}newRenderOp(e,r,i,n,o,a,c,h,d){const u=new pi(this.glw,this.options,this.quadBufferCollection,e,r,i,o,n,a,0,c,h,d);this.curRenderOp=u,this.renderOps.push(u)}addTexture(e,r,i){const{curRenderOp:n}=this;A(n);const o=n.addTexture(e);if(o===4294967295){if(i)throw new Error("Unable to add texture to render op");return this.newRenderOp(n.shader,n.shaderProps,n.alpha,n.dimensions,n.clippingRect,r),this.addTexture(e,r,!0)}return o}reuseRenderOp(e){var h;const{shader:r,shaderProps:i,parentHasRenderTexture:n,rtt:o,clippingRect:a}=e,c=r||this.defaultShader;return!(((h=this.curRenderOp)==null?void 0:h.shader)!==c||!ws(this.curRenderOp.clippingRect,a)||n||o||this.curRenderOp.shader!==this.defaultShader&&(!i||!this.curRenderOp.shader.canBatchShaderProps(this.curRenderOp.shaderProps,i)))}addRenderOp(e){this.renderOps.push(e),this.curRenderOp=null}render(e="screen"){const{glw:r,quadBuffer:i}=this,n=new Float32Array(i,0,this.curBufferIdx),o=this.quadBufferCollection.getBuffer("a_position")??null;r.arrayBufferData(o,n,r.STATIC_DRAW);for(let a=0,c=this.renderOps.length;a<c;a++)this.renderOps[a].draw();this.quadBufferUsage=this.curBufferIdx*n.BYTES_PER_ELEMENT}renderToTexture(e){for(let r=0;r<this.rttNodes.length;r++)if(this.rttNodes[r]===e)return;this.rttNodes.unshift(e)}renderRTTNodes(){const{glw:e}=this;this.stage;for(let i=0;i<this.rttNodes.length;i++){const n=this.rttNodes[i];if(!n||!n.hasRTTupdates)continue;this.activeRttNode=n,A(n.texture,"RTT node missing texture");const o=n.texture.ctxTexture;A(o instanceof Cr),this.renderToTextureActive=!0,e.bindFramebuffer(o.framebuffer),e.viewport(0,0,o.w,o.h),e.clearColor(0,0,0,0),e.clear();for(let a=0;a<n.children.length;a++){const c=n.children[a];c&&(c.update(this.stage.deltaTime,{x:0,y:0,width:0,height:0,valid:!1}),this.stage.addQuads(c),c.hasRTTupdates=!1)}this.render(),this.renderOps.length=0,n.hasRTTupdates=!1}const r=De(this.stage.options.clearColor);e.clearColor(r[0],r[1],r[2],r[3]),e.bindFramebuffer(null),e.viewport(0,0,this.glw.canvas.width,this.glw.canvas.height),this.renderToTextureActive=!1}removeRTTNode(e){const r=this.rttNodes.indexOf(e);r!==-1&&this.rttNodes.splice(r,1)}getBufferInfo(){return{totalAvailable:this.stage.options.quadBufferSize,totalUsed:this.quadBufferUsage}}getDefShaderCtr(){return this.defShaderCtrl}}let _e,ur;function Si(s,t="app"){return _e=new di(s,t),ur=_e.createShader.bind(_e),_e}const Ei={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1};function Ci(){return!!(Ei&&!1)}const Pe=Ci()||!1,k={debug:!1,focusDebug:!1,animationsEnabled:!0,animationSettings:{duration:250,easing:"ease-in-out"},fontSettings:{fontFamily:"Ubuntu",fontSize:100},enableShaderCaching:!0,setActiveElement:()=>{}},Re={Element:"element",TextNode:"textNode",Text:"text"};function Ar(s){return Ai(s)&&s.debug}function ae(s,t,...e){Pe&&(k.debug||Ar(t)||Ar(e[0]))&&console.log(s,t,...e)}const kt=s=>s instanceof Function;function Ai(s){return typeof s=="object"}function be(s){return Array.isArray(s)}function Mr(s){return typeof s=="string"}function Mi(s){return typeof s=="number"}function Ii(s){return Number.isInteger(s)}function Pi(s){return"destroy"in s&&typeof s.destroy=="function"}function rt(s){return s instanceof re}function er(s){return s._type===Re.TextNode}function Hr(s){return s._type===Re.Text}function Li(s,t){for(const e of t)if(e in s)return!0;return!1}function tr(s,t={}){if(be(s))s.forEach(e=>{tr(e,t)});else if(s)for(const e in s)t[e]===void 0&&(t[e]=s[e]);return t}function Bi(s){const t=[s];let e=s.parent;for(;e;)t.push(e),e=e.parent;t.reverse();let r=`
function convertEffectsToShader(styleEffects) {
  const effects = [];
  let index = 0;

  for (const [type, props] of Object.entries(styleEffects)) {
    effects.push({ type, props });
    index++;
  }
  return createShader('DynamicShader', { effects });
}
`;return t.forEach((i,n)=>{if(!i._rendererProps)return;i._rendererProps.parent=void 0,i._rendererProps.shader=void 0;const o=JSON.stringify(i._rendererProps,null,2),a=i._effects?`props${n}.shader = convertEffectsToShader(${JSON.stringify(i._effects,null,2)});`:"",c=n===0?"rootNode":`node${n-1}`;r+=`
const props${n} = ${o};
props${n}.parent = ${c};
${a}
const node${n} = renderer.createNode(props${n});
`}),r}class Ir extends Array{constructor(e,r={}){var t=(...To)=>(super(...To),l(this,"onChange"),this);return be(r)?t(...r):Mr(r)?t(r):t(...Object.entries(r).filter(([i,n])=>n).map(([i])=>i)),this.onChange=e,this}has(e){return this.indexOf(e)>=0}is(e){return this.indexOf(e)>=0}add(e){this.has(e)||(this.push(e),this.onChange())}toggle(e,r){r===!0?this.add(e):r===!1?this.remove(e):this.has(e)?this.remove(e):this.add(e)}merge(e){if(be(e))this.length=0,this.push(...e);else if(Mr(e))this.length=0,this.push(e);else for(const r in e)if(e[r])this.has(r)||this.push(r);else{const n=this.indexOf(r);n>=0&&this.splice(n,1)}return this}remove(e){const r=this.indexOf(e);r>=0&&(this.splice(r,1),this.onChange())}}function Oi(s){const t=[];let e=!1,r=0;for(let f=0;f<s.children.length;f++){const _=s.children[f];Hr(_)||_.flexItem===!1||(_.flexOrder!==void 0&&(e=!0),_.flexGrow!==void 0&&(r+=_.flexGrow),t.push(_))}e&&t.sort((f,_)=>(f.flexOrder||0)-(_.flexOrder||0));const i=t.length,o=(s.flexDirection||"row")==="row",a=o?"width":"height",c=o?"height":"width",h=o?"marginLeft":"marginTop",d=o?"marginRight":"marginBottom",u=o?"x":"y",g=o?"y":"x",p=s[a]||0,T=s[c]||0,v=s.gap||0,R=s.justifyContent||"flexStart",w=s.alignItems;if(r){const f=t.reduce((b,S)=>b+(S.flexGrow?0:S[a]||0)+(S[h]||0)+(S[d]||0),0),_=(p-f-v*(i-1))/r;for(let b=0;b<t.length;b++){const S=t[b];S.flexGrow!==void 0&&S.flexGrow>0&&(S[a]=S.flexGrow*_)}}let m=0;["center","spaceBetween","spaceEvenly"].includes(R)&&(m=t.reduce((f,_)=>f+(_[a]||0)+(_[h]||0)+(_[d]||0),0));const x=T&&w?f=>{w==="flexStart"?f[g]=0:w==="center"?f[g]=(T-(f[c]||0))/2:w==="flexEnd"&&(f[g]=T-(f[c]||0))}:f=>f;if(R==="flexStart"){let f=0;for(let _=0;_<t.length;_++){const b=t[_];b[u]=f+(b[h]||0),f+=(b[a]||0)+v+(b[h]||0)+(b[d]||0),x(b)}if(s.flexBoundary!=="fixed"){const _=f-v;if(_!==s[a])return s[`preFlex${a}`]=s[a],s[a]=_,!0}}else if(R==="flexEnd"){let f=p;for(let _=i-1;_>=0;_--){const b=t[_];b[u]=f-(b[a]||0)-(b[d]||0),f-=(b[a]||0)+v+(b[h]||0)+(b[d]||0),x(b)}}else if(R==="center"){let f=(p-(m+v*(i-1)))/2;for(let _=0;_<t.length;_++){const b=t[_];b[u]=f+(b[h]||0),f+=(b[a]||0)+v+(b[h]||0)+(b[d]||0),x(b)}}else if(R==="spaceBetween"){const f=(p-m)/(i-1);let _=0;for(let b=0;b<t.length;b++){const S=t[b];S[u]=_+(S[h]||0),_+=(S[a]||0)+f+(S[h]||0)+(S[d]||0),x(S)}}else if(R==="spaceEvenly"){const f=(p-m)/(i+1);let _=f;for(let b=0;b<t.length;b++){const S=t[b];S[u]=_+(S[h]||0),_+=(S[a]||0)+f+(S[h]||0)+(S[d]||0),x(S)}}return!1}const Ie={ArrowLeft:"Left",ArrowRight:"Right",ArrowUp:"Up",ArrowDown:"Down",Enter:"Enter",l:"Last"," ":"Space",Backspace:"Back",Escape:"Escape"},rr={},Pr=(s,t)=>{for(const[e,r]of Object.entries(s))Array.isArray(r)?r.forEach(i=>{t[i]=e}):r===null?delete t[e]:t[r]=e};let Lr=!0;const Ui=(s,t)=>{if(Lr){const e=document.createElement("style");e.type="text/css",e.innerHTML=`
      [data-focus="3"] {
        border: 2px solid rgba(255, 33, 33, 0.2);
        border-radius: 5px;
        transition: border-color 0.3s ease;
      }

      [data-focus="2"] {
        border: 2px solid rgba(255, 33, 33, 0.4);
        border-radius: 5px;
        transition: border-color 0.3s ease;
      }

      [data-focus="1"] {
        border: 4px solid rgba(255, 33, 33, 0.9);
        border-radius: 5px;
        transition: border-color 0.5s ease;
      }
    `,document.head.appendChild(e),Lr=!1}s.forEach(e=>{e.data={...e.data,focus:void 0}}),t.forEach((e,r)=>{e.data={...e.data,focus:r+1}})};let Br;const ki=s=>{Di(s,Br),Br=s,k.setActiveElement(s)};let Le=[];const Di=(s,t)=>{var i,n;let e=s;const r=[];for(;e;)(!e.states.has("focus")||e===s)&&(e.states.add("focus"),(i=e.onFocus)==null||i.call(e,s,t),(n=e.onFocusChanged)==null||n.call(e,!0,s,t)),r.push(e),e=e.parent;return Le.forEach(o=>{var a,c;r.includes(o)||(o.states.remove("focus"),(a=o.onBlur)==null||a.call(o,s,t),(c=o.onFocusChanged)==null||c.call(o,!1,s,t))}),k.focusDebug&&Ui(Le,r),Le=r,r},sr=(s,t,e)=>{let r;for(const i of Le){if(r=r||i,t){const o=i[`on${t}`];if((o==null?void 0:o.call(i,s,i,r))===!0)break}else console.log(`Unhandled key event: ${s.key||s.keyCode}`);const n=e?i.onKeyHold:i.onKeyPress;if((n==null?void 0:n.call(i,s,t,i,r))===!0)break}return!1},Fi=200,ee={},Ni=(s,t)=>{delete ee[s.key||s.keyCode],sr(s,t,!0)},Xi=(s,t,e)=>{if(t){const r=t.key||t.keyCode,i=rr[t.key]||rr[t.keyCode],n=Ie[t.key]||Ie[t.keyCode];i?(ee[r]&&clearTimeout(ee[r]),ee[r]=window.setTimeout(()=>Ni(t,i),s)):sr(t,n,!1)}if(e){const r=e.key||e.keyCode,i=Ie[e.key]||Ie[e.keyCode];ee[r]&&(clearTimeout(ee[r]),delete ee[r],sr(e,i,!1))}},zi=({userKeyMap:s,keyHoldOptions:t,ownerContext:e=r=>{r()}}={})=>{s&&Pr(s,Ie),t!=null&&t.userKeyHoldMap&&Pr(t.userKeyHoldMap,rr);const r=(t==null?void 0:t.holdThreshold)||Fi,i=Xi.bind(null,r),n=a=>e(()=>{i(a,void 0)}),o=a=>e(()=>{i(void 0,a)});return document.addEventListener("keyup",o),document.addEventListener("keydown",n),{cleanup:()=>{document.removeEventListener("keydown",n),document.removeEventListener("keyup",o);for(const[a,c]of Object.entries(ee))c&&clearTimeout(c)},focusPath:()=>Le}},yt=new Set;let ir=0,Dt=!1;function Or(){Dt||(Dt=!0,setTimeout(()=>{const s=[...yt];yt.clear();for(let t=s.length-1;t>=0;t--)s[t].updateLayout();Dt=!1,ir=0},0))}const Ft=new Map;function Nt(s,t){let e;if(k.enableShaderCaching){const n=Math.round((s.alpha||0)*10)/10;if(e=`${s.width},${s.height},${n}`+JSON.stringify(t),Ft.has(e))return Ft.get(e)}const r=[];for(const[n,o]of Object.entries(t))r.push({type:n,props:o});const i=ur("DynamicShader",{effects:r});return k.enableShaderCaching&&e&&Ft.set(e,i),i}function Ee(s=""){return{set(t){Mi(t)&&(t={width:t,color:255}),this.effects=this.effects?{...this.effects||{},[`border${s}`]:t}:{[`border${s}`]:t}},get(){var t;return(t=this.effects)==null?void 0:t[`border${s}`]}}}const $i=["alpha","color","colorTop","colorRight","colorLeft","colorBottom","colorTl","colorTr","colorBl","colorBr","height","fontSize","lineHeight","mount","mountX","mountY","pivot","pivotX","pivotY","rotation","scale","scaleX","scaleY","width","worldX","worldY","x","y","zIndex","zIndexLocked"],Vi=["absX","absY","autosize","clipping","contain","data","fontFamily","fontStretch","fontStyle","fontWeight","imageType","letterSpacing","maxLines","offsetY","overflowSuffix","preventCleanup","rtt","scrollable","scrollY","src","srcHeight","srcWidth","srcX","srcY","strictBounds","text","textAlign","textBaseline","textOverflow","texture","textureOptions","verticalAlign","wordWrap"];class re extends Object{constructor(t){super(),this._type=t==="text"?Re.TextNode:Re.Element,this.rendered=!1,this.lng={},this.children=[]}get effects(){return this._effects}set effects(t){this._effects=t,this.rendered&&(this.shader=Nt(this,t))}set id(t){var e;this._id=t,(e=k.rendererOptions)!=null&&e.inspector&&(this.data={...this.data,testId:t})}get id(){return this._id}get parent(){return this._parent}set parent(t){this._parent=t,this.rendered&&(this.lng.parent=(t==null?void 0:t.lng)??null)}insertChild(t,e){if(t.parent=this,e){this.removeChild(t);const r=this.children.indexOf(e);if(r>=0){this.children.splice(r,0,t);return}}this.children.push(t)}removeChild(t){const e=this.children.indexOf(t);e>=0&&this.children.splice(e,1)}get selectedNode(){const t=this.selected||0;for(let e=t;e<this.children.length;e++){const r=this.children[e];if(rt(r))return this.selected=e,r}}set shader(t){let e=t;be(t)&&(e=ur(...t)),this.lng.shader=e}_sendToLightningAnimatable(t,e){if(this.transition&&this.rendered&&k.animationsEnabled&&(this.transition===!0||this.transition[t])){const r=this.transition===!0||this.transition[t]===!0?void 0:this.transition[t],i=this.animate({[t]:e},r);if(this.onAnimation){const n=Object.keys(this.onAnimation);for(const o of n){const a=this.onAnimation[o];i.on(o,(c,h)=>{a.call(this,c,t,e,h)})}}return i.start()}this.lng[t]=e}animate(t,e){return A(this.rendered,"Node must be rendered before animating"),this.lng.animate(t,e||this.animationSettings||{})}chain(t,e){return this._animationRunning&&(this._animationQueue=[],this._animationRunning=!1),e?this._animationQueueSettings=e:this._animationQueueSettings||(this._animationQueueSettings=e||this.animationSettings),e=e||this._animationQueueSettings,this._animationQueue=this._animationQueue||[],this._animationQueue.push({props:t,animationSettings:e}),this}async start(){let t=this._animationQueue.shift();for(;t;)this._animationRunning=!0,await this.animate(t.props,t.animationSettings).start().waitUntilStopped(),t=this._animationQueue.shift();this._animationRunning=!1,this._animationQueueSettings=void 0}setFocus(){if(this.rendered){if(this.forwardFocus!==void 0)if(kt(this.forwardFocus)){if(this.forwardFocus.call(this,this)!==!1)return}else{const t=typeof this.forwardFocus=="number"?this.forwardFocus:null,e=this.children;if(t!==null&&t<e.length){const r=e[t];rt(r)&&r.setFocus();return}}queueMicrotask(()=>ki(this))}else this._autofocus=!0}_layoutOnLoad(){ir++,this.lng.on("loaded",()=>{yt.add(this.parent),Or()})}getText(){let t="";for(let e=0;e<this.children.length;e++)t+=this.children[e].text;return t}destroy(){if(this.onDestroy){const t=this.onDestroy(this);t instanceof Promise?t.then(()=>this._destroy()):this._destroy()}else this._destroy()}_destroy(){var t;this._queueDelete&&Pi(this.lng)&&(this.lng.destroy(),(t=this.parent)!=null&&t.requiresLayout()&&this.parent.updateLayout())}set style(t){if(Pe&&this._style&&console.warn("Style already set: https://lightning-tv.github.io/solid/#/essentials/styling?id=style-patterns-to-avoid"),be(t)){console.warn("Array style values are deprecated, use combineStyles: https://lightning-tv.github.io/solid/#/essentials/styling?id=style-patterns-to-avoid");const e=t.filter(Boolean);if(e.length===0)return;e.length===1?this._style=be(e[0])?tr(e[0]):e[0]:this._style=tr(e)}else this._style=t;for(const e in this._style)this[e]===void 0&&(this[e]=this._style[e])}get style(){return this._style}get hasChildren(){return this.children.length>0}getChildById(t){return this.children.find(e=>e.id===t)}searchChildrenById(t){for(let e=0;e<this.children.length;e++){const r=this.children[e];if(rt(r)){if(r.id===t)return r;const i=r.searchChildrenById(t);if(i)return i}}}set states(t){this._states=this._states?this._states.merge(t):new Ir(this._stateChanged.bind(this),t),this.rendered&&this._stateChanged()}get states(){return this._states=this._states||new Ir(this._stateChanged.bind(this)),this._states}get animationSettings(){return this._animationSettings||k.animationSettings}set animationSettings(t){this._animationSettings=t}set hidden(t){this.alpha=t?0:1}get hidden(){return this.alpha===0}set autofocus(t){this._autofocus=!!t,this._autofocus&&this.setFocus()}get autofocus(){return this._autofocus}requiresLayout(){return this.display==="flex"||this.onLayout}set updateLayoutOn(t){this.updateLayout()}get updateLayoutOn(){return null}updateLayout(){var t;this.hasChildren&&(ae("Layout: ",this),this.display==="flex"&&Oi(this)&&((t=this.parent)==null||t.updateLayout()),kt(this.onLayout)&&this.onLayout.call(this,this))}_stateChanged(){if(ae("State Changed: ",this,this.states),this.forwardStates){const e=this.states.slice();this.children.forEach(r=>{r.states=e})}const t=this.states;if(this._undoStyles||this.style&&Li(this.style,t)){let e;this._undoStyles&&this._undoStyles.length&&(e={},this._undoStyles.forEach(n=>{Pe&&this.style[n]===void 0&&console.warn("fallback style key not found: ",n),e[n]=this.style[n]}));const r=t.length;if(r===0){Object.assign(this,e),this._undoStyles=[];return}let i;r===1?(i=this.style[t[0]],i=e?{...e,...i}:i):i=t.reduce((n,o)=>{const a=this.style[o];return a?{...n,...a}:n},e||{}),i?(this._undoStyles=Object.keys(i),i.transition!==void 0&&(this.transition=i.transition),Object.assign(this,i)):this._undoStyles=[]}}render(t){var n;const e=this,r=this.parent;if(!r){console.warn("Parent not set - no node created for: ",this);return}if(!r.rendered){console.warn("Parent not rendered yet: ",this);return}if(r.requiresLayout()&&yt.add(r),this.rendered)return;this._states&&this._stateChanged();const i=e.lng;if((this.right||this.right===0)&&(i.x=(r.width||0)-this.right,i.mountX=1),(this.bottom||this.bottom===0)&&(i.y=(r.height||0)-this.bottom,i.mountY=1),i.x=i.x||0,i.y=i.y||0,i.parent=r.lng,er(e)){const o=i;if(k.fontSettings)for(const a in k.fontSettings)o[a]===void 0&&(o[a]=k.fontSettings[a]);o.text=o.text||e.getText(),o.textAlign&&!o.contain&&console.warn("Text align requires contain: ",e.getText()),o.contain&&(o.width||(o.width=(r.width||0)-o.x-(o.marginRight||0)),o.contain==="both"&&!o.height&&!o.maxLines?o.height=(r.height||0)-o.y-(o.marginBottom||0):o.maxLines===1&&(o.height=o.height||o.lineHeight||o.fontSize)),e._effects&&(i.shader=Nt(e,e._effects)),ae("Rendering: ",this,i),e.lng=_e.createTextNode(i),r.requiresLayout()&&(!i.width||!i.height)&&e._layoutOnLoad()}else i.texture||(isNaN(i.width)&&(i.width=(r.width||0)-i.x),isNaN(i.height)&&(i.height=(r.height||0)-i.y),i.rtt&&!i.color&&(i.color=4294967295),!i.color&&!i.src&&(i.color=0)),e._effects&&(i.shader=Nt(e,e._effects)),ae("Rendering: ",this,i),e.lng=_e.createNode(i);if(e.rendered=!0,Pe&&(e._rendererProps=i),e.autosize&&r.requiresLayout()&&e._layoutOnLoad(),e.onFail&&e.lng.on("failed",e.onFail),e.onLoad&&e.lng.on("loaded",e.onLoad),kt(this.onCreate)&&this.onCreate.call(this,e),e.onEvent)for(const[o,a]of Object.entries(e.onEvent))e.lng.on(o,(c,h)=>a(e,h));if((n=e.lng)!=null&&n.div&&(e.lng.div.element=e),e._type===Re.Element){const o=e.children.length;for(let a=0;a<o;a++){const c=e.children[a];A(c,"Child is undefined"),rt(c)?c.render():Hr(c)&&console.warn("TextNode outside of <Text>: ",c)}}t&&!ir&&Or(),e._autofocus&&e.setFocus()}}for(const s of $i)Object.defineProperty(re.prototype,s,{get(){return this.lng[s]},set(t){this._sendToLightningAnimatable(s,t)}});for(const s of Vi)Object.defineProperty(re.prototype,s,{get(){return this.lng[s]},set(t){this.lng[s]=t}});function Xt(s){return{set(t){this.effects=this.effects?{...this.effects,[s]:t}:{[s]:t}},get(){var t;return(t=this.effects)==null?void 0:t[s]}}}Pe&&(re.prototype.lngTree=function(){return Bi(this)});Object.defineProperties(re.prototype,{border:Ee(),borderLeft:Ee("Left"),borderRight:Ee("Right"),borderTop:Ee("Top"),borderBottom:Ee("Bottom"),linearGradient:Xt("linearGradient"),radialGradient:Xt("radialGradient"),radialProgress:Xt("radialProgressGradient"),borderRadius:{set(s){this.effects=this.effects?{...this.effects,radius:{radius:s}}:{radius:{radius:s}}},get(){var s,t;return(t=(s=this.effects)==null?void 0:s.radius)==null?void 0:t.radius}}});const Gi=(s,t)=>s===t,nr=Symbol("solid-proxy"),Wi=typeof Proxy=="function",qr=Symbol("solid-track"),vt={equals:Gi};let jr=es;const se=1,Tt=2,Kr={owned:null,cleanups:null,context:null,owner:null};var I=null;let zt=null,Yi=null,L=null,N=null,Q=null,Ct=0;function le(s,t){const e=L,r=I,i=s.length===0,n=r,o=i?Kr:{owned:null,cleanups:null,context:n?n.context:null,owner:n},a=i?s:()=>s(()=>W(()=>Fe(o)));I=o,L=null;try{return ie(a,!0)}finally{L=e,I=r}}function z(s,t){t=t?Object.assign({},vt,t):vt;const e={value:s,observers:null,observerSlots:null,comparator:t.equals||void 0},r=i=>(typeof i=="function"&&(i=i(e.value)),Jr(e,i));return[Zr.bind(e),r]}function H(s,t,e){const r=fr(s,t,!1,se);$e(r)}function Hi(s,t,e){jr=Ji;const r=fr(s,t,!1,se);r.user=!0,Q?Q.push(r):$e(r)}function U(s,t,e){e=e?Object.assign({},vt,e):vt;const r=fr(s,t,!0,0);return r.observers=null,r.observerSlots=null,r.comparator=e.equals||void 0,$e(r),Zr.bind(r)}function qi(s){return ie(s,!1)}function W(s){if(L===null)return s();const t=L;L=null;try{return s()}finally{L=t}}function At(s,t,e){const r=Array.isArray(s);let i,n=e&&e.defer;return o=>{let a;if(r){a=Array(s.length);for(let h=0;h<s.length;h++)a[h]=s[h]()}else a=s();if(n)return n=!1,o;const c=W(()=>t(a,i,o));return i=a,c}}function Z(s){return I===null||(I.cleanups===null?I.cleanups=[s]:I.cleanups.push(s)),s}function Mt(){return I}function It(s,t){const e=I,r=L;I=s,L=null;try{return ie(t,!0)}catch(i){pr(i)}finally{I=e,L=r}}function ji(s){const t=L,e=I;return Promise.resolve().then(()=>{L=t,I=e;let r;return ie(s,!1),L=I=null,r?r.done:void 0})}function Qr(s,t){const e=Symbol("context");return{id:e,Provider:tn(e),defaultValue:s}}function Ki(s){let t;return I&&I.context&&(t=I.context[s.id])!==void 0?t:s.defaultValue}function dr(s){const t=U(s),e=U(()=>or(t()));return e.toArray=()=>{const r=e();return Array.isArray(r)?r:r!=null?[r]:[]},e}function Zr(){if(this.sources&&this.state)if(this.state===se)$e(this);else{const s=N;N=null,ie(()=>Rt(this),!1),N=s}if(L){const s=this.observers?this.observers.length:0;L.sources?(L.sources.push(this),L.sourceSlots.push(s)):(L.sources=[this],L.sourceSlots=[s]),this.observers?(this.observers.push(L),this.observerSlots.push(L.sources.length-1)):(this.observers=[L],this.observerSlots=[L.sources.length-1])}return this.value}function Jr(s,t,e){let r=s.value;return(!s.comparator||!s.comparator(r,t))&&(s.value=t,s.observers&&s.observers.length&&ie(()=>{for(let i=0;i<s.observers.length;i+=1){const n=s.observers[i],o=zt&&zt.running;o&&zt.disposed.has(n),(o?!n.tState:!n.state)&&(n.pure?N.push(n):Q.push(n),n.observers&&ts(n)),o||(n.state=se)}if(N.length>1e6)throw N=[],new Error},!1)),t}function $e(s){if(!s.fn)return;Fe(s);const t=Ct;Qi(s,s.value,t)}function Qi(s,t,e){let r;const i=I,n=L;L=I=s;try{r=s.fn(t)}catch(o){return s.pure&&(s.state=se,s.owned&&s.owned.forEach(Fe),s.owned=null),s.updatedAt=e+1,pr(o)}finally{L=n,I=i}(!s.updatedAt||s.updatedAt<=e)&&(s.updatedAt!=null&&"observers"in s?Jr(s,r):s.value=r,s.updatedAt=e)}function fr(s,t,e,r=se,i){const n={fn:s,state:r,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:I,context:I?I.context:null,pure:e};return I===null||I!==Kr&&(I.owned?I.owned.push(n):I.owned=[n]),n}function _t(s){if(s.state===0)return;if(s.state===Tt)return Rt(s);if(s.suspense&&W(s.suspense.inFallback))return s.suspense.effects.push(s);const t=[s];for(;(s=s.owner)&&(!s.updatedAt||s.updatedAt<Ct);)s.state&&t.push(s);for(let e=t.length-1;e>=0;e--)if(s=t[e],s.state===se)$e(s);else if(s.state===Tt){const r=N;N=null,ie(()=>Rt(s,t[0]),!1),N=r}}function ie(s,t){if(N)return s();let e=!1;t||(N=[]),Q?e=!0:Q=[],Ct++;try{const r=s();return Zi(e),r}catch(r){e||(Q=null),N=null,pr(r)}}function Zi(s){if(N&&(es(N),N=null),s)return;const t=Q;Q=null,t.length&&ie(()=>jr(t),!1)}function es(s){for(let t=0;t<s.length;t++)_t(s[t])}function Ji(s){let t,e=0;for(t=0;t<s.length;t++){const r=s[t];r.user?s[e++]=r:_t(r)}for(t=0;t<e;t++)_t(s[t])}function Rt(s,t){s.state=0;for(let e=0;e<s.sources.length;e+=1){const r=s.sources[e];if(r.sources){const i=r.state;i===se?r!==t&&(!r.updatedAt||r.updatedAt<Ct)&&_t(r):i===Tt&&Rt(r,t)}}}function ts(s){for(let t=0;t<s.observers.length;t+=1){const e=s.observers[t];e.state||(e.state=Tt,e.pure?N.push(e):Q.push(e),e.observers&&ts(e))}}function Fe(s){let t;if(s.sources)for(;s.sources.length;){const e=s.sources.pop(),r=s.sourceSlots.pop(),i=e.observers;if(i&&i.length){const n=i.pop(),o=e.observerSlots.pop();r<i.length&&(n.sourceSlots[o]=r,i[r]=n,e.observerSlots[r]=o)}}if(s.tOwned){for(t=s.tOwned.length-1;t>=0;t--)Fe(s.tOwned[t]);delete s.tOwned}if(s.owned){for(t=s.owned.length-1;t>=0;t--)Fe(s.owned[t]);s.owned=null}if(s.cleanups){for(t=s.cleanups.length-1;t>=0;t--)s.cleanups[t]();s.cleanups=null}s.state=0}function en(s){return s instanceof Error?s:new Error(typeof s=="string"?s:"Unknown error",{cause:s})}function pr(s,t=I){throw en(s)}function or(s){if(typeof s=="function"&&!s.length)return or(s());if(Array.isArray(s)){const t=[];for(let e=0;e<s.length;e++){const r=or(s[e]);Array.isArray(r)?t.push.apply(t,r):t.push(r)}return t}return s}function tn(s,t){return function(r){let i;return H(()=>i=W(()=>(I.context={...I.context,[s]:r.value},dr(()=>r.children))),void 0),i}}const ar=Symbol("fallback");function bt(s){for(let t=0;t<s.length;t++)s[t]()}function rn(s,t,e={}){let r=[],i=[],n=[],o=0,a=t.length>1?[]:null;return Z(()=>bt(n)),()=>{let c=s()||[],h=c.length,d,u;return c[qr],W(()=>{let p,T,v,R,w,m,x,f,_;if(h===0)o!==0&&(bt(n),n=[],r=[],i=[],o=0,a&&(a=[])),e.fallback&&(r=[ar],i[0]=le(b=>(n[0]=b,e.fallback())),o=1);else if(o===0){for(i=new Array(h),u=0;u<h;u++)r[u]=c[u],i[u]=le(g);o=h}else{for(v=new Array(h),R=new Array(h),a&&(w=new Array(h)),m=0,x=Math.min(o,h);m<x&&r[m]===c[m];m++);for(x=o-1,f=h-1;x>=m&&f>=m&&r[x]===c[f];x--,f--)v[f]=i[x],R[f]=n[x],a&&(w[f]=a[x]);for(p=new Map,T=new Array(f+1),u=f;u>=m;u--)_=c[u],d=p.get(_),T[u]=d===void 0?-1:d,p.set(_,u);for(d=m;d<=x;d++)_=r[d],u=p.get(_),u!==void 0&&u!==-1?(v[u]=i[d],R[u]=n[d],a&&(w[u]=a[d]),u=T[u],p.set(_,u)):n[d]();for(u=m;u<h;u++)u in v?(i[u]=v[u],n[u]=R[u],a&&(a[u]=w[u],a[u](u))):i[u]=le(g);i=i.slice(0,o=h),r=c.slice(0)}return i});function g(p){if(n[u]=p,a){const[T,v]=z(u);return a[u]=v,t(c[u],T)}return t(c[u])}}}function sn(s,t,e={}){let r=[],i=[],n=[],o=[],a=0,c;return Z(()=>bt(n)),()=>{const h=s()||[],d=h.length;return h[qr],W(()=>{if(d===0)return a!==0&&(bt(n),n=[],r=[],i=[],a=0,o=[]),e.fallback&&(r=[ar],i[0]=le(g=>(n[0]=g,e.fallback())),a=1),i;for(r[0]===ar&&(n[0](),n=[],r=[],i=[],a=0),c=0;c<d;c++)c<r.length&&r[c]!==h[c]?o[c](()=>h[c]):c>=r.length&&(i[c]=le(u));for(;c<r.length;c++)n[c]();return a=o.length=n.length=d,r=h.slice(0),i=i.slice(0,a)});function u(g){n[c]=g;const[p,T]=z(h[c]);return o[c]=T,t(p,c)}}}function rs(s,t){return W(()=>s(t||{}))}function st(){return!0}const nn={get(s,t,e){return t===nr?e:s.get(t)},has(s,t){return t===nr?!0:s.has(t)},set:st,deleteProperty:st,getOwnPropertyDescriptor(s,t){return{configurable:!0,enumerable:!0,get(){return s.get(t)},set:st,deleteProperty:st}},ownKeys(s){return s.keys()}};function $t(s){return(s=typeof s=="function"?s():s)?s:{}}function on(){for(let s=0,t=this.length;s<t;++s){const e=this[s]();if(e!==void 0)return e}}function gr(...s){let t=!1;for(let o=0;o<s.length;o++){const a=s[o];t=t||!!a&&nr in a,s[o]=typeof a=="function"?(t=!0,U(a)):a}if(Wi&&t)return new Proxy({get(o){for(let a=s.length-1;a>=0;a--){const c=$t(s[a])[o];if(c!==void 0)return c}},has(o){for(let a=s.length-1;a>=0;a--)if(o in $t(s[a]))return!0;return!1},keys(){const o=[];for(let a=0;a<s.length;a++)o.push(...Object.keys($t(s[a])));return[...new Set(o)]}},nn);const e={},r=Object.create(null);for(let o=s.length-1;o>=0;o--){const a=s[o];if(!a)continue;const c=Object.getOwnPropertyNames(a);for(let h=c.length-1;h>=0;h--){const d=c[h];if(d==="__proto__"||d==="constructor")continue;const u=Object.getOwnPropertyDescriptor(a,d);if(!r[d])r[d]=u.get?{enumerable:!0,configurable:!0,get:on.bind(e[d]=[u.get.bind(a)])}:u.value!==void 0?u:void 0;else{const g=e[d];g&&(u.get?g.push(u.get.bind(a)):u.value!==void 0&&g.push(()=>u.value))}}}const i={},n=Object.keys(r);for(let o=n.length-1;o>=0;o--){const a=n[o],c=r[a];c&&c.get?Object.defineProperty(i,a,c):i[a]=c?c.value:void 0}return i}const an=s=>`Stale read from <${s}>.`;function ln(s){const t="fallback"in s&&{fallback:()=>s.fallback};return U(rn(()=>s.each,s.children,t||void 0))}function mr(s){const t="fallback"in s&&{fallback:()=>s.fallback};return U(sn(()=>s.each,s.children,t||void 0))}function ss(s){const t=s.keyed,e=U(()=>s.when,void 0,{equals:(r,i)=>t?r===i:!r==!i});return U(()=>{const r=e();if(r){const i=s.children;return typeof i=="function"&&i.length>0?W(()=>i(t?r:()=>{if(!W(e))throw an("Show");return s.when})):i}return s.fallback},void 0,void 0)}const[cn,is]=z(void 0);function Ve(s=""){return Ii(s)?s:typeof s=="string"?s.startsWith("#")?+(s.replace("#","0x")+(s.length===7?"ff":"")):s.startsWith("0x")?Number(s):+("0x"+(s.length===6?s+"ff":s)):0}function hn({createElement:s,createTextNode:t,isTextNode:e,replaceText:r,insertNode:i,removeNode:n,setProperty:o,getParentNode:a,getFirstChild:c,getNextSibling:h}){function d(m,x,f,_){if(f!==void 0&&!_&&(_=[]),typeof x!="function")return u(m,x,_,f);H(b=>u(m,x(),b,f),_)}function u(m,x,f,_,b){for(;typeof f=="function";)f=f();if(x===f)return f;const S=typeof x,E=_!==void 0;if(S==="string"||S==="number")if(S==="number"&&(x=x.toString()),E){let C=f[0];C&&e(C)?r(C,x):C=t(x),f=T(m,f,_,C)}else f!==""&&typeof f=="string"?r(c(m),f=x):(T(m,f,_,t(x)),f=x);else if(x==null||S==="boolean")f=T(m,f,_);else{if(S==="function")return H(()=>{let C=x();for(;typeof C=="function";)C=C();f=u(m,C,f,_)}),()=>f;if(Array.isArray(x)){const C=[];if(g(C,x,b))return H(()=>f=u(m,C,f,_,!0)),()=>f;if(C.length===0){const V=T(m,f,_);if(E)return f=V}else Array.isArray(f)?f.length===0?v(m,C,_):p(m,f,C):f==null||f===""?v(m,C):p(m,E&&f||[c(m)],C);f=C}else{if(Array.isArray(f)){if(E)return f=T(m,f,_,x);T(m,f,null,x)}else f==null||f===""||!c(m)?i(m,x):R(m,x,c(m));f=x}}return f}function g(m,x,f){let _=!1;for(let b=0,S=x.length;b<S;b++){let E=x[b],C;if(!(E==null||E===!0||E===!1))if(Array.isArray(E))_=g(m,E)||_;else if((C=typeof E)=="string"||C==="number")m.push(t(E));else if(C==="function")if(f){for(;typeof E=="function";)E=E();_=g(m,Array.isArray(E)?E:[E])||_}else m.push(E),_=!0;else m.push(E)}return _}function p(m,x,f){let _=f.length,b=x.length,S=_,E=0,C=0,V=h(x[b-1]),q=null;for(;E<b||C<S;){if(x[E]===f[C]){E++,C++;continue}for(;x[b-1]===f[S-1];)b--,S--;if(b===E){const G=S<_?C?h(f[C-1]):f[S-C]:V;for(;C<S;)i(m,f[C++],G)}else if(S===C)for(;E<b;)(!q||!q.has(x[E]))&&n(m,x[E]),E++;else if(x[E]===f[S-1]&&f[C]===x[b-1]){const G=h(x[--b]);i(m,f[C++],h(x[E++])),i(m,f[--S],G),x[b]=f[S]}else{if(!q){q=new Map;let j=C;for(;j<S;)q.set(f[j],j++)}const G=q.get(x[E]);if(G!=null)if(C<G&&G<S){let j=E,M=1,P;for(;++j<b&&j<S&&!((P=q.get(x[j]))==null||P!==G+M);)M++;if(M>G-C){const $=x[E];for(;C<G;)i(m,f[C++],$)}else R(m,f[C++],x[E++])}else E++;else n(m,x[E++])}}}function T(m,x,f,_){if(f===void 0){let S;for(;S=c(m);)n(m,S);return _&&i(m,_),""}const b=_||t("");if(x.length){let S=!1;for(let E=x.length-1;E>=0;E--){const C=x[E];if(b!==C){const V=a(C)===m;!S&&!E?V?R(m,b,C):i(m,b,f):V&&n(m,C)}else S=!0}}else i(m,b,f);return[b]}function v(m,x,f){for(let _=0,b=x.length;_<b;_++)i(m,x[_],f)}function R(m,x,f){i(m,x,f),n(m,f)}function w(m,x,f={},_){return x||(x={}),_||H(()=>f.children=u(m,x.children,f.children)),H(()=>x.ref&&x.ref(m)),H(()=>{for(const b in x){if(b==="children"||b==="ref")continue;const S=x[b];S!==f[b]&&(o(m,b,S,f[b]),f[b]=S)}}),f}return{render(m,x){let f;return le(_=>{f=_,d(x,m())}),f},insert:d,spread(m,x,f){typeof x=="function"?H(_=>w(m,x(),_,f)):w(m,x,void 0,f)},createElement:s,createTextNode:t,insertNode:i,setProp(m,x,f,_){return o(m,x,f,_),f},mergeProps:gr,effect:H,memo:U,createComponent:rs,use(m,x,f){return W(()=>m(x,f))}}}function un(s){const t=hn(s);return t.mergeProps=gr,t}const ns={createElement(s){return new re(s)},createTextNode(s){return{_type:Re.Text,text:s}},replaceText(s,t){ae("Replace Text: ",s,t),s.text=t;const e=s.parent;A(e),e.text=e.getText()},setProperty(s,t,e=!0){s[t]=e},insertNode(s,t,e){ae("INSERT: ",s,t,e),s.insertChild(t,e),t._queueDelete=!1,t instanceof re?s.rendered&&t.render(!0):er(s)&&(s.text=s.getText())},isTextNode(s){return er(s)},removeNode(s,t){ae("REMOVE: ",s,t),s.removeChild(t),t._queueDelete=!0,t instanceof re&&queueMicrotask(()=>t.destroy())},getParentNode(s){return s.parent},getFirstChild(s){return s.children[0]},getNextSibling(s){const t=s.parent.children||[],e=t.indexOf(s)+1;if(e<t.length)return t[e]}},os=un(ns);let Vt;const ut=ns.createElement("App"),dn=function(s){return os.render(s,ut)};function fn(s,t){const e=k.rendererOptions;return Vt=Si(e,"app"),k.setActiveElement=is,ut.lng=Vt.root,ut.rendered=!0,{renderer:Vt,rootNode:ut,render:dn}}const{effect:Pt,memo:pn,createComponent:B,createElement:Ge,createTextNode:po,insertNode:go,insert:mo,spread:gn,setProp:O,mergeProps:xo,use:yo}=os,he=s=>{const t=Ge("node");return gn(t,s,!1),t},[vo,mn]=z([]),xn=(s,t)=>{const e=Mt(),r=It.bind(void 0,e);k.setActiveElement=o=>r(()=>is(o));const{cleanup:i,focusPath:n}=zi({userKeyMap:s,keyHoldOptions:t,ownerContext:r});Hi(At(cn,()=>{mn([...n()])},{defer:!0})),Z(i)};const yn=!1;function as(){let s=new Set;function t(i){return s.add(i),()=>s.delete(i)}let e=!1;function r(i,n){if(e)return!(e=!1);const o={to:i,options:n,defaultPrevented:!1,preventDefault:()=>o.defaultPrevented=!0};for(const a of s)a.listener({...o,from:a.location,retry:c=>{c&&(e=!0),a.navigate(i,{...n,resolve:!1})}});return!o.defaultPrevented}return{subscribe:t,confirm:r}}let lr;function xr(){(!window.history.state||window.history.state._depth==null)&&window.history.replaceState({...window.history.state,_depth:window.history.length-1},""),lr=window.history.state._depth}xr();function vn(s){return{...s,_depth:window.history.state&&window.history.state._depth}}function Tn(s,t){let e=!1;return()=>{const r=lr;xr();const i=r==null?null:lr-r;if(e){e=!1;return}i&&t(i)?(e=!0,window.history.go(-i)):s()}}const _n=/^(?:[a-z0-9]+:)?\/\//i,Rn=/^\/+|(\/)\/+$/g,bn="http://sr";function Be(s,t=!1){const e=s.replace(Rn,"$1");return e?t||/^[?#]/.test(e)?e:"/"+e:""}function dt(s,t,e){if(_n.test(t))return;const r=Be(s),i=e&&Be(e);let n="";return!i||t.startsWith("/")?n=r:i.toLowerCase().indexOf(r.toLowerCase())!==0?n=r+i:n=i,(n||"/")+Be(t,!n)}function wn(s,t){return Be(s).replace(/\/*(\*.*)?$/g,"")+Be(t)}function ls(s){const t={};return s.searchParams.forEach((e,r)=>{r in t?Array.isArray(t[r])?t[r].push(e):t[r]=[t[r],e]:t[r]=e}),t}function Sn(s,t,e){const[r,i]=s.split("/*",2),n=r.split("/").filter(Boolean),o=n.length;return a=>{const c=a.split("/").filter(Boolean),h=c.length-o;if(h<0||h>0&&i===void 0&&!t)return null;const d={path:o?"":"/",params:{}},u=g=>e===void 0?void 0:e[g];for(let g=0;g<o;g++){const p=n[g],T=p[0]===":",v=T?c[g]:c[g].toLowerCase(),R=T?p.slice(1):p.toLowerCase();if(T&&Gt(v,u(R)))d.params[R]=v;else if(T||!Gt(v,R))return null;d.path+=`/${v}`}if(i){const g=h?c.slice(-h).join("/"):"";if(Gt(g,u(i)))d.params[i]=g;else return null}return d}}function Gt(s,t){const e=r=>r===s;return t===void 0?!0:typeof t=="string"?e(t):typeof t=="function"?t(s):Array.isArray(t)?t.some(e):t instanceof RegExp?t.test(s):!1}function En(s){const[t,e]=s.pattern.split("/*",2),r=t.split("/").filter(Boolean);return r.reduce((i,n)=>i+(n.startsWith(":")?2:3),r.length-(e===void 0?0:1))}function cs(s){const t=new Map,e=Mt();return new Proxy({},{get(r,i){return t.has(i)||It(e,()=>t.set(i,U(()=>s()[i]))),t.get(i)()},getOwnPropertyDescriptor(){return{enumerable:!0,configurable:!0}},ownKeys(){return Reflect.ownKeys(s())}})}function hs(s){let t=/(\/?\:[^\/]+)\?/.exec(s);if(!t)return[s];let e=s.slice(0,t.index),r=s.slice(t.index+t[0].length);const i=[e,e+=t[1]];for(;t=/^(\/\:[^\/]+)\?/.exec(r);)i.push(e+=t[1]),r=r.slice(t[0].length);return hs(r).reduce((n,o)=>[...n,...i.map(a=>a+o)],[])}const Cn=100,An=Qr(),us=Qr();function Mn(s,t=""){const{component:e,preload:r,load:i,children:n,info:o}=s,a=!n||Array.isArray(n)&&!n.length,c={key:s,component:e,preload:r||i,info:o};return ds(s.path).reduce((h,d)=>{for(const u of hs(d)){const g=wn(t,u);let p=a?g:g.split("/*",1)[0];p=p.split("/").map(T=>T.startsWith(":")||T.startsWith("*")?T:encodeURIComponent(T)).join("/"),h.push({...c,originalPath:d,pattern:p,matcher:Sn(p,!a,s.matchFilters)})}return h},[])}function In(s,t=0){return{routes:s,score:En(s[s.length-1])*1e4-t,matcher(e){const r=[];for(let i=s.length-1;i>=0;i--){const n=s[i],o=n.matcher(e);if(!o)return null;r.unshift({...o,route:n})}return r}}}function ds(s){return Array.isArray(s)?s:[s]}function fs(s,t="",e=[],r=[]){const i=ds(s);for(let n=0,o=i.length;n<o;n++){const a=i[n];if(a&&typeof a=="object"){a.hasOwnProperty("path")||(a.path="");const c=Mn(a,t);for(const h of c){e.push(h);const d=Array.isArray(a.children)&&a.children.length===0;if(a.children&&!d)fs(a.children,h.pattern,e,r);else{const u=In([...e],r.length);r.push(u)}e.pop()}}}return e.length?r:r.sort((n,o)=>o.score-n.score)}function Wt(s,t){for(let e=0,r=s.length;e<r;e++){const i=s[e].matcher(t);if(i)return i}return[]}function Pn(s,t,e){const r=new URL(bn),i=U(d=>{const u=s();try{return new URL(u,r)}catch{return console.error(`Invalid path ${u}`),d}},r,{equals:(d,u)=>d.href===u.href}),n=U(()=>i().pathname),o=U(()=>i().search,!0),a=U(()=>i().hash),c=()=>"",h=At(o,()=>ls(i()));return{get pathname(){return n()},get search(){return o()},get hash(){return a()},get state(){return t()},get key(){return c()},query:e?e(h):cs(h)}}let ne;function Ln(){return ne}function Bn(s,t,e,r={}){const{signal:[i,n],utils:o={}}=s,a=o.parsePath||(M=>M),c=o.renderPath||(M=>M),h=o.beforeLeave||as(),d=dt("",r.base||"");if(d===void 0)throw new Error(`${d} is not a valid base path`);d&&!i().value&&n({value:d,replace:!0,scroll:!1});const[u,g]=z(!1);let p;const T=(M,P)=>{P.value===v()&&P.state===w()||(p===void 0&&g(!0),ne=M,p=P,ji(()=>{p===P&&(R(p.value),m(p.state),_[1]([]))}).finally(()=>{p===P&&qi(()=>{ne=void 0,M==="navigate"&&G(p),g(!1),p=void 0})}))},[v,R]=z(i().value),[w,m]=z(i().state),x=Pn(v,w,o.queryWrapper),f=[],_=z([]),b=U(()=>typeof r.transformUrl=="function"?Wt(t(),r.transformUrl(x.pathname)):Wt(t(),x.pathname)),S=()=>{const M=b(),P={};for(let $=0;$<M.length;$++)Object.assign(P,M[$].params);return P},E=o.paramsWrapper?o.paramsWrapper(S,t):cs(S),C={pattern:d,path:()=>d,outlet:()=>null,resolvePath(M){return dt(d,M)}};return H(At(i,M=>T("native",M),{defer:!0})),{base:C,location:x,params:E,isRouting:u,renderPath:c,parsePath:a,navigatorFactory:q,matches:b,beforeLeave:h,preloadRoute:j,singleFlight:r.singleFlight===void 0?!0:r.singleFlight,submissions:_};function V(M,P,$){W(()=>{if(typeof P=="number"){P&&(o.go?o.go(P):console.warn("Router integration does not support relative routing"));return}const We=!P||P[0]==="?",{replace:Lt,resolve:ue,scroll:Bt,state:Se}={replace:!1,resolve:!We,scroll:!0,...$},Ye=ue?M.resolvePath(P):dt(We&&x.pathname||"",P);if(Ye===void 0)throw new Error(`Path '${P}' is not a routable path`);if(f.length>=Cn)throw new Error("Too many redirects");const yr=v();(Ye!==yr||Se!==w())&&(yn||h.confirm(Ye,$)&&(f.push({value:yr,replace:Lt,scroll:Bt,state:w()}),T("navigate",{value:Ye,state:Se})))})}function q(M){return M=M||Ki(us)||C,(P,$)=>V(M,P,$)}function G(M){const P=f[0];P&&(n({...M,replace:P.replace,scroll:P.scroll}),f.length=0)}function j(M,P){const $=Wt(t(),M.pathname),We=ne;ne="preload";for(let Lt in $){const{route:ue,params:Bt}=$[Lt];ue.component&&ue.component.preload&&ue.component.preload();const{preload:Se}=ue;P&&Se&&It(e(),()=>Se({params:Bt,location:{pathname:M.pathname,search:M.search,hash:M.hash,query:ls(M),state:null,key:""},intent:"preload"}))}ne=We}}function On(s,t,e,r){const{base:i,location:n,params:o}=s,{pattern:a,component:c,preload:h}=r().route,d=U(()=>r().path);c&&c.preload&&c.preload();const u=h?h({params:o,location:n,intent:ne||"initial"}):void 0;return{parent:t,pattern:a,path:d,outlet:()=>c?rs(c,{params:o,location:n,data:u,get children(){return e()}}):e(),resolvePath(p){return dt(i.path(),p,d())}}}const Un=s=>t=>{const{base:e}=t,r=dr(()=>t.children),i=U(()=>fs(r(),t.base||""));let n;const o=Bn(s,i,()=>n,{base:e,singleFlight:t.singleFlight,transformUrl:t.transformUrl});return s.create&&s.create(o),B(An.Provider,{value:o,get children(){return B(kn,{routerState:o,get root(){return t.root},get preload(){return t.rootPreload||t.rootLoad},get children(){return[pn(()=>(n=Mt())&&null),B(Dn,{routerState:o,get branches(){return i()}})]}})}})};function kn(s){const t=s.routerState.location,e=s.routerState.params,r=U(()=>s.preload&&W(()=>{s.preload({params:e,location:t,intent:Ln()||"initial"})}));return B(ss,{get when(){return s.root},keyed:!0,get fallback(){return s.children},children:i=>B(i,{params:e,location:t,get data(){return r()},get children(){return s.children}})})}function Dn(s){const t=[];let e;const r=U(At(s.routerState.matches,(i,n,o)=>{let a=n&&i.length===n.length;const c=[];for(let h=0,d=i.length;h<d;h++){const u=n&&n[h],g=i[h];o&&u&&g.route.key===u.route.key?c[h]=o[h]:(a=!1,t[h]&&t[h](),le(p=>{t[h]=p,c[h]=On(s.routerState,c[h-1]||s.routerState.base,Ur(()=>r()[h+1]),()=>s.routerState.matches()[h])}))}return t.splice(i.length).forEach(h=>h()),o&&a?o:(e=c[0],c)}));return Ur(()=>r()&&e)()}const Ur=s=>()=>B(ss,{get when(){return s()},keyed:!0,children:t=>B(us.Provider,{value:t,get children(){return t.outlet()}})}),Ce=s=>{const t=dr(()=>s.children);return gr(s,{get children(){return t()}})};function Fn([s,t],e,r){return[s,r?i=>t(r(i)):t]}function Nn(s){let t=!1;const e=i=>typeof i=="string"?{value:i}:i,r=Fn(z(e(s.get()),{equals:(i,n)=>i.value===n.value&&i.state===n.state}),void 0,i=>(!t&&s.set(i),i));return s.init&&Z(s.init((i=s.get())=>{t=!0,r[1](e(i)),t=!1})),Un({signal:r,create:s.create,utils:s.utils})}function Xn(s){const t=s.replace(/^.*?#/,"");if(!t.startsWith("/")){const[,e="/"]=window.location.hash.split("#",2);return`${e}#${t}`}return t}function zn(s,t,e){return s.addEventListener(t,e),()=>s.removeEventListener(t,e)}function $n(s){const t=()=>window.location.hash.slice(1),e=as();return Nn({get:t,set({value:r,replace:i,state:n}){i?window.history.replaceState(vn(n),"","#"+r):window.history.pushState(n,"","#"+r),xr()},init:r=>zn(window,"hashchange",Tn(r,i=>!e.confirm(i&&i<0?i:t()))),utils:{go:r=>window.history.go(r),renderPath:r=>`#${r}`,parsePath:Xn,beforeLeave:e,paramsWrapper:s.forceProxy||!Vn?(r,i)=>Gn(r,Wn(i())):void 0}})(s)}const Vn=typeof Proxy=="function";function Gn(s,t){const e=new Map,r=Mt(),i={},n=a=>(e.has(a)||It(r,()=>e.set(a,U(()=>s()[a]))),e.get(a)());return(t||Object.keys(s())).forEach(a=>{Object.defineProperty(i,a,{get:()=>n(a),enumerable:!0,configurable:!0})}),i}const Wn=s=>{const t=[];return s.forEach(e=>{e.routes.forEach(r=>{if(r.pattern){const i=r.pattern.match(/:(\w+)/g);i&&i.forEach(n=>{const o=n.slice(1);t.includes(o)||t.push(o)})}})}),t};function J(s,t){return Math.floor(Math.random()*(t-s+1))+s}const kr=600,Dr=800,Fr=()=>"0x"+Math.floor(Math.random()*16777215).toString(16)+"FF",Yn=()=>{const[s,t]=z([]);let e;const r=()=>{const n=[];if(s().length===0){for(let o=0;o<1e3;o++)n.push({width:J(50,100),height:J(50,100),x:J(0,Dr),y:J(0,kr),color:Fr()});t(n)}for(let o=0;o<1e3;o++){let a=e.children[o];a.width=J(50,100),a.height=J(50,100),a.x=J(0,Dr),a.y=J(0,kr),a.color=Fr()}},i=setInterval(()=>{r()},2e3);return Z(()=>{clearInterval(i)}),B(he,{ref(n){var o=e;typeof o=="function"?o(n):e=n},get style(){return{color:Ve("#f0f0f0")}},get children(){return B(mr,{get each(){return s()},children:n=>(()=>{var o=Ge("node");return Pt(a=>{var c=n().x,h=n().y,d=n().width,u=n().height,g=n().color,p={radius:{radius:n().borderRadius}};return c!==a.e&&(a.e=O(o,"x",c,a.e)),h!==a.t&&(a.t=O(o,"y",h,a.t)),d!==a.a&&(a.a=O(o,"width",d,a.a)),u!==a.o&&(a.o=O(o,"height",u,a.o)),g!==a.i&&(a.i=O(o,"color",g,a.i)),p!==a.n&&(a.n=O(o,"effects",p,a.n)),a},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),o})()})}})};function it(s,t){return Math.floor(Math.random()*(t-s+1))+s}const Hn=()=>"0x"+Math.floor(Math.random()*16777215).toString(16)+"FF",qn=s=>B(he,s),jn=600,Kn=800,Qn=()=>{const[s,t]=z([]);let e;const r=()=>{const n=[];for(let o=0;o<1e3;o++)n.push({width:it(50,100),height:it(50,100),x:it(0,Kn),y:it(0,jn),color:Hn()});t(n)},i=setInterval(()=>{r()},2e3);return Z(()=>{clearInterval(i)}),B(he,{ref(n){var o=e;typeof o=="function"?o(n):e=n},get style(){return{color:Ve("#f0f0f0")}},get children(){return B(mr,{get each(){return s()},children:n=>B(qn,{get x(){return n().x},get y(){return n().y},get width(){return n().width},get height(){return n().height},get color(){return n().color},get effects(){return{radius:{radius:n().borderRadius}}}})})}})};function nt(s,t){return Math.floor(Math.random()*(t-s+1))+s}const Zn=600,Jn=800,eo=()=>"0x"+Math.floor(Math.random()*16777215).toString(16)+"FF",to=()=>{const[s,t]=z([]);let e;const r=()=>{const n=[];for(let o=0;o<1e3;o++)n.push({width:nt(50,100),height:nt(50,100),x:nt(0,Jn),y:nt(0,Zn),color:eo()});t(n)},i=setInterval(()=>{r()},2e3);return Z(()=>{clearInterval(i)}),B(he,{ref(n){var o=e;typeof o=="function"?o(n):e=n},get style(){return{color:Ve("#f0f0f0")}},get children(){return s().map(n=>(()=>{var o=Ge("node");return Pt(a=>{var c=n.x,h=n.y,d=n.width,u=n.height,g=n.color,p={radius:{radius:n.borderRadius}};return c!==a.e&&(a.e=O(o,"x",c,a.e)),h!==a.t&&(a.t=O(o,"y",h,a.t)),d!==a.a&&(a.a=O(o,"width",d,a.a)),u!==a.o&&(a.o=O(o,"height",u,a.o)),g!==a.i&&(a.i=O(o,"color",g,a.i)),p!==a.n&&(a.n=O(o,"effects",p,a.n)),a},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),o})())}})};function ot(s,t){return Math.floor(Math.random()*(t-s+1))+s}const ro=()=>"0x"+Math.floor(Math.random()*16777215).toString(16)+"FF",so=600,io=800,no=()=>{const[s,t]=z([]);let e;const r=()=>{const n=[];for(let o=0;o<1e3;o++)n.push({width:ot(50,100),height:ot(50,100),x:ot(0,io),y:ot(0,so),color:ro()});t(n)},i=setInterval(()=>{r()},2e3);return Z(()=>{clearInterval(i)}),B(he,{ref(n){var o=e;typeof o=="function"?o(n):e=n},get style(){return{color:Ve("#f0f0f0")}},get children(){return B(mr,{get each(){return s()},children:n=>(()=>{var o=Ge("node");return Pt(a=>{var c=n().x,h=n().y,d=n().width,u=n().height,g=n().color,p={radius:{radius:n().borderRadius}};return c!==a.e&&(a.e=O(o,"x",c,a.e)),h!==a.t&&(a.t=O(o,"y",h,a.t)),d!==a.a&&(a.a=O(o,"width",d,a.a)),u!==a.o&&(a.o=O(o,"height",u,a.o)),g!==a.i&&(a.i=O(o,"color",g,a.i)),p!==a.n&&(a.n=O(o,"effects",p,a.n)),a},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),o})()})}})};function at(s,t){return Math.floor(Math.random()*(t-s+1))+s}const oo=()=>"0x"+Math.floor(Math.random()*16777215).toString(16)+"FF",ao=600,lo=800,co=()=>{const[s,t]=z([]);let e;const r=()=>{const n=[];for(let o=0;o<1e3;o++)n.push({width:at(50,100),height:at(50,100),x:at(0,lo),y:at(0,ao),color:oo()});t(n)},i=setInterval(()=>{r()},2e3);return Z(()=>{clearInterval(i)}),B(he,{ref(n){var o=e;typeof o=="function"?o(n):e=n},get style(){return{color:Ve("#f0f0f0")}},get children(){return B(ln,{get each(){return s()},children:n=>(()=>{var o=Ge("node");return Pt(a=>{var c=n.x,h=n.y,d=n.width,u=n.height,g=n.color,p={radius:{radius:n.borderRadius}};return c!==a.e&&(a.e=O(o,"x",c,a.e)),h!==a.t&&(a.t=O(o,"y",h,a.t)),d!==a.a&&(a.a=O(o,"width",d,a.a)),u!==a.o&&(a.o=O(o,"height",u,a.o)),g!==a.i&&(a.i=O(o,"color",g,a.i)),p!==a.n&&(a.n=O(o,"effects",p,a.n)),a},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),o})()})}})},ho=s=>(xn(),B(he,{ref(t){var e=window.APP;typeof e=="function"?e(t):window.APP=t},onLast:()=>history.back(),onText:()=>navigate("/text"),onCounter:()=>navigate("/counter"),onButtons:()=>navigate("/buttons"),onMenu:()=>navigate("/"),get children(){return s.children}}));k.debug=!1;k.fontSettings.fontFamily="Ubuntu";k.fontSettings.color=4294967295;k.rendererOptions={numImageWorkers:2,enableInspector:!1,renderEngine:wi,fontEngines:[]};const{render:uo}=fn();uo(()=>B($n,{root:s=>B(ho,s),get children(){return[B(Ce,{path:"",component:Yn}),B(Ce,{path:"tile",component:Qn}),B(Ce,{path:"for",component:co}),B(Ce,{path:"map",component:to}),B(Ce,{path:"index",component:no})]}}));
//# sourceMappingURL=index-AM2w3LwI.js.map
