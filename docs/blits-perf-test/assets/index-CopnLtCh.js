var Ri=Object.defineProperty;var Ci=(r,t,e)=>t in r?Ri(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var f=(r,t,e)=>Ci(r,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function e(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=e(i);fetch(i.href,o)}})();const p={currentView:Symbol("currentView"),cursorTagStart:Symbol("cursorTagStart"),computedKeys:Symbol("computedKeys"),destroy:Symbol("destroy"),getChildren:Symbol("getChildren"),holder:Symbol("holder"),id:Symbol("id"),identifier:Symbol("identifier"),index:Symbol("index"),init:Symbol("init"),inputEvents:Symbol("inputEvents"),intervals:Symbol("intervals"),launched:Symbol("launched"),level:Symbol("level"),methodKeys:Symbol("methodKeys"),originalState:Symbol("originalState"),propKeys:Symbol("propKeys"),raw:Symbol("raw"),ready:Symbol("ready"),renderer:Symbol("renderer"),routes:Symbol("routes"),settings:Symbol("settings"),state:Symbol("state"),stateKeys:Symbol("stateKeys"),textnode:Symbol("textnode"),timeouts:Symbol("timeouts"),type:Symbol("type"),watchers:Symbol("watchers"),watchKeys:Symbol("watchKeys"),wrapper:Symbol("wrapper"),children:Symbol.for("children"),components:Symbol.for("components"),isSlot:Symbol.for("isSlot"),props:Symbol.for("props"),slots:Symbol.for("slots"),componentType:Symbol.for("componentType")},fe={[p.settings]:{},get(r,t=null){return r in this[p.settings]?this[p.settings][r]:t},set(r,t){typeof r=="object"?Object.keys(r).forEach(e=>{this.set(e,r[e])}):this[p.settings][r]=t}},Dt=()=>{},Cs=()=>new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"}),Ur=r=>{const t=fe.get("debugLevel"),e={};return Object.defineProperty(e,"info",{get(){return(t>=1||Array.isArray(t)&&t.indexOf("info")>-1)&&console.info.bind(window.console,`%c ⚡️ ${r} %c ${Cs()}`,"background-color: #0284c7; color: white; padding: 3px 6px 3px 1px; border-radius: 3px","color: ##94a3b8;")||Dt}}),Object.defineProperty(e,"warn",{get(){return(t>=1||Array.isArray(t)&&t.indexOf("warn")>-1)&&console.warn.bind(window.console,`%c ⚡️ ${r} %c ${Cs()}`,"background-color: #fbbf24; color: white; padding: 3px 6px 3px 1px; border-radius: 3px","color: ##94a3b8;")||Dt}}),Object.defineProperty(e,"error",{get(){return(t>=1||Array.isArray(t)&&t.indexOf("error")>-1)&&console.error.bind(window.console,`%c ⚡️ ${r} %c ${Cs()}`,"background-color: #dc2626; color: white; padding: 3px 6px 3px 1px; border-radius: 3px","color: ##94a3b8;")||Dt}}),Object.defineProperty(e,"debug",{get(){return(t>=2||Array.isArray(t)&&t.indexOf("debug")>-1)&&console.debug.bind(window.console,`%c ⚡️ ${r} %c (${new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"})})`,"background-color: #e2e8f0; color: #334155; padding: 3px 6px 3px 1px; border-radius: 3px","color: ##94a3b8;")||Dt}}),e};let Q;const Ei=()=>{Q=Ur("Blits")},Nt={aliceblue:"0xf0f8ffff",antiquewhite:"0xfaebd7ff",aqua:"0xffffff00",aquamarine:"0x7fffd4ff",azure:"0xf0ffffff",beige:"0xf5f5dcff",bisque:"0xffe4c4ff",black:"0x000000ff",blanchedalmond:"0xffebcdff",blue:"0x0000ffff",blueviolet:"0x8a2be2ff",brown:"0xa52a2aff",burlywood:"0xdeb887ff",cadetblue:"0x5f9ea0ff",chartreuse:"0x7fff00ff",chocolate:"0xd2691eff",coral:"0xff7f50ff",cornflowerblue:"0x6495edff",cornsilk:"0xfff8dcff",crimson:"0xdc143cff",cyan:"0x00ffffff",darkblue:"0x00008bff",darkcyan:"0x008b8bff",darkgoldenrod:"0xb8860bff",darkgray:"0xa9a9a9ff",darkgreen:"0x006400ff",darkgrey:"0xa9a9a9ff",darkkhaki:"0xbdb76bff",darkmagenta:"0x8b008bff",darkolivegreen:"0x556b2fff",darkorange:"0xff8c00ff",darkorchid:"0x9932ccff",darkred:"0x8b0000ff",darksalmon:"0xe9967aff",darkseagreen:"0x8fbc8fff",darkslateblue:"0x483d8bff",darkslategray:"0x2f4f4fff",darkslategrey:"0x2f4f4fff",darkturquoise:"0x00ced1ff",darkviolet:"0x9400d3ff",deeppink:"0xff1493ff",deepskyblue:"0x00bfffff",dimgray:"0x696969ff",dimgrey:"0x696969ff",dodgerblue:"0x1e90ffff",firebrick:"0xb22222ff",floralwhite:"0xfffaf0ff",forestgreen:"0x228b22ff",fuchsia:"0xff00ffff",gainsboro:"0xdcdcdcff",ghostwhite:"0xf8f8ffff",gold:"0xffd700ff",goldenrod:"0xdaa520ff",gray:"0x808080ff",green:"0x008000ff",greenyellow:"0xadff2fff",grey:"0x808080ff",honeydew:"0xf0fff0ff",hotpink:"0xff69b4ff",indianred:"0xcd5c5cff",indigo:"0x4b0082ff",ivory:"0xfffff0ff",khaki:"0xf0e68cff",lavender:"0xe6e6faff",lavenderblush:"0xfff0f5ff",lawngreen:"0x7cfc00ff",lemonchiffon:"0xfffacdff",lightblue:"0xadd8e6ff",lightcoral:"0xf08080ff",lightcyan:"0xe0ffffff",lightgoldenrodyellow:"0xfafad2ff",lightgray:"0xd3d3d3ff",lightgreen:"0x90ee90ff",lightgrey:"0xd3d3d3ff",lightpink:"0xffb6c1ff",lightsalmon:"0xffa07aff",lightseagreen:"0x20b2aaff",lightskyblue:"0x87cefaff",lightslategray:"0x778899ff",lightslategrey:"0x778899ff",lightsteelblue:"0xb0c4deff",lightyellow:"0xffffe0ff",lime:"0x00ff00ff",limegreen:"0x32cd32ff",linen:"0xfaf0e6ff",magenta:"0xff00ffff",maroon:"0x800000ff",mediumaquamarine:"0x66cdaaff",mediumblue:"0x0000cdff",mediumorchid:"0xba55d3ff",mediumpurple:"0x9370dbff",mediumseagreen:"0x3cb371ff",mediumslateblue:"0x7b68eeff",mediumspringgreen:"0x00fa9aff",mediumturquoise:"0x48d1ccff",mediumvioletred:"0xc71585ff",midnightblue:"0x191970ff",mintcream:"0xf5fffaff",mistyrose:"0xffe4e1ff",moccasin:"0xffe4b5ff",navajowhite:"0xffdeadff",navy:"0x000080ff",oldlace:"0xfdf5e6ff",olive:"0x808000ff",olivedrab:"0x6b8e23ff",orange:"0xffa500ff",orangered:"0xff4500ff",orchid:"0xda70d6ff",palegoldenrod:"0xeee8aaff",palegreen:"0x98fb98ff",paleturquoise:"0xafeeeeff",palevioletred:"0xdb7093ff",papayawhip:"0xffefd5ff",peachpuff:"0xffdab9ff",peru:"0xcd853fff",pink:"0xffc0cbff",plum:"0xdda0ddff",powderblue:"0xb0e0e6ff",purple:"0x800080ff",rebeccapurple:"0x663399ff",red:"0xff0000ff",rosybrown:"0xbc8f8fff",royalblue:"0x4169e1ff",saddlebrown:"0x8b4513ff",salmon:"0xfa8072ff",sandybrown:"0xf4a460ff",seagreen:"0x2e8b57ff",seashell:"0xfff5eeff",sienna:"0xa0522dff",silver:"0xc0c0c0ff",skyblue:"0x87ceebff",slateblue:"0x6a5acdff",slategray:"0x708090ff",slategrey:"0x708090ff",snow:"0xfffafaff",springgreen:"0x00ff7fff",steelblue:"0x4682b4ff",tan:"0xd2b48cff",teal:"0x008080ff",thistle:"0xd8bfd8ff",tomato:"0xff6347ff",transparent:"0x00000000",turquoise:"0x40e0d0ff",violet:"0xee82eeff",wheat:"0xf5deb3ff",white:"0xffffffff",whitesmoke:"0xf5f5f5ff",yellow:"0xffff00ff",yellowgreen:"0x9acd32ff"},Ai=/^#?([0-9a-f]{3}|[0-9a-f]{6}|[0-9a-f]{8})$/i,Mi=/^(rgba?)\((\s*(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])\s*),(\s*(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])\s*),(\s*(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])\s*)(,(\s*(-?\d+(?:\.\d+)?)\s*))?\)$/,Ii=/^(hsla?)\((\s*(360|3[0-5][0-9]|[12]?[0-9]{1,2})\s*),(\s*(100|[1-9]?[0-9])\s*)%,(\s*(100|[1-9]?[0-9])\s*)%(,(\s*(1|0(?:\.\d+)?)\s*))?\)$/,Es={},zt=r=>{if(Es[r]!==void 0)return Es[r];const t=parseInt(r).toString(16).padStart(2,"0");return Es[r]=t,t},et={normalize:(r="",t="0xffffffff")=>{if(r=r.toString(),r.startsWith("0x")&&r.length===10)return r;if(Nt[r]!==void 0)return Nt[r];if(Ai.test(r)){r=r.replace("#","").toLowerCase(),r.length===3&&(r=r.split("").map(i=>i+i).join(""));const s="0x"+r.padEnd(8,"f");return Nt[r]=s,s}const e=Mi.exec(r);if(e){const s=zt(e[3]),i=zt(e[5]),o=zt(e[7]);let a="ff";if(e[10]&&e[1]==="rgba"){const l=Math.min(Math.max(Math.round(parseFloat(e[10])*255),0),255);a=zt(l)}const n="0x"+s+i+o+a;return Nt[r]=n,n}return Ii.test(r)?(console.warn("HSL(A) color format is not supported yet"),"0xffffffff"):t}},Li=(r="",t,e,s=null)=>{let i=0,o=0,a=[],n=null,l=0;const c=/^<\/?([a-zA-Z0-9_\-.]+)\s*/,h=/^\s*(\/?>)\s*/,d=/^([A-Za-z0-9:.\-_@$]+)=\s*(["'])/,u=/^<>\s*/,x=/^\s*(<\/>)\s*/,m=()=>{r=b(r);try{return g(_),F(a)}catch(v){throw(v.name=="TemplateParseError"||v.name=="TemplateStructureError")&&(v.message=`${v.message}
${v.context}`),v}},g=v=>{i>=r.length||v()},b=v=>v.replace(/<!--.*?-->/gms,"").replace(/\r?\n\s*\r\n/gm," ").replace(/\r?\n\s*(\S)/gm," $1").replace(/\r?\n/g,"").trim(),T=v=>{const R=r.slice(i).match(v);return R&&(o=i,i+=R[0].length),R},_=()=>{T(u)?(a.push({[Symbol.for("componentType")]:null,[p.type]:"opening",[p.level]:l,[p.cursorTagStart]:o}),l++,g(_)):g(C)},C=()=>{T(x)?(l--,a.push({[Symbol.for("componentType")]:null,[p.type]:"closing",[p.level]:l}),g(_)):g(S)},S=()=>{const v=T(c);if(v)n={[Symbol.for("componentType")]:v[1],[p.level]:l,[p.cursorTagStart]:o},v[0].startsWith("</")?(l--,n[p.type]="closing",n[p.level]=l):(n[p.type]="opening",l++),g(P);else throw z("InvalidTag")},P=()=>{const v=T(h);if(v){if(v[1]==="/>"){if(n[p.type]==="closing")throw z("InvalidClosingTag");n[p.type]="self-closing",l--}if(n[p.type]==="opening"){const R=r.slice(i,r.indexOf("<",i));R&&(n.content=R,i+=R.length)}a.push(n),g(_)}else g(G)},G=()=>{const v=T(d);if(v){if(n[p.type]==="closing")throw z("AttributesInClosingTag");const R=v[2],O=new RegExp(`^(.*?)${R}\\s*`),k=T(O);if(k){const D=I(v[1],k[1]);n[D.name]=D.value,g(P)}else throw z("MissingOrInvalidAttributeValue")}else throw z("InvalidAttribute")},I=(v,R)=>{if(v.includes(".")){const[O,k]=v.split(".");return{name:O,value:`{${k}: ${R}}`}}return["color",":color",":effects","effects"].includes(v)?L(v,R):{name:v,value:R}},L=(v,R)=>{let O=R,k=et.normalize(O,null);if(k===null){const D=/'([^']+)'/g;let X,U=0,W="";for(;(X=D.exec(R))!==null;){const q=X[1],H=X.index,Z=X[0].length;W+=R.slice(U,H),k=et.normalize(q,null),k===null?W+=R.slice(H,H+Z):W+=`'${k}'`,U=H+Z}W+=R.slice(U),O=W}else O=k;return{name:v,value:O}},F=v=>{let R=[],O=!1,k={children:[]},D=k;for(let X=0;X<v.length;X++){let U=v[X];if(U[p.level]===0&&U[p.type]!=="closing"){if(O)throw N("MultipleTopLevelTags",U);O=!0}if(U[p.type]==="opening")R.push({[p.level]:U[p.level],[p.type]:U[p.type],[p.cursorTagStart]:U[p.cursorTagStart],[Symbol.for("componentType")]:U[Symbol.for("componentType")],parent:D});else if(U[p.type]==="closing"){const q=R.length===0;let H=!1,Z=!1;if(q||(H=R[R.length-1][p.level]!==U[p.level],Z=R[R.length-1][Symbol.for("componentType")]!==U[Symbol.for("componentType")]),q||H||Z)throw N("MismatchedClosingTag",U);D=R.pop().parent}const W={...U};delete W[p.type],delete W[p.level],delete W[p.cursorTagStart],U[p.type]==="opening"?(X+1<v.length&&v[X+1][p.type]!=="closing"&&(W.children=[]),D.children.push(W),D=W):U[p.type]==="self-closing"&&D.children.push(W)}if(R.length>0)throw N("UnclosedTags",R);return k},M=10,y=50,z=v=>{const R=A();v=`${v} in ${R}`;const O=new Error(v);O.name="TemplateParseError";const k=Math.max(0,o-M),D=Math.min(r.length,i+y),X=r.slice(k,D),U=i-k;return O.context=V(U,X),O},N=(v,R)=>{const O=A();v=`${v} in ${O}`;const k=new Error(v);k.name="TemplateStructureError",Array.isArray(R)?k.context=R.map(X=>D(X)).join(`
`):k.context=D(R);function D(X){const U=Math.max(0,X[p.cursorTagStart]-M),W=r.slice(U,U+y);return V(M,W)}return k},V=(v,R)=>{const O=" ".repeat(v)+"^";return`
${R}
${O}
`},A=()=>s||"Blits.Application";return m()};let $;function Pi(r={children:[]}){const t={renderCode:["const elms = []","let componentType","const rootComponent = component"],effectsCode:[],context:{props:[],components:this.components}};return $=-1,Dr.call(t,r),t.renderCode.push("return elms"),{render:new Function("parent","component","context","components","effect","getRaw",t.renderCode.join(`
`)),effects:t.effectsCode.map(e=>new Function("component","elms","context","components","rootComponent","effect",e)),context:t.context}}const ls=function(r,t=!1,e={key:!1,component:"component.",forceEffect:!1,forloop:!1}){const s=e.forceEffect?this.effectsCode:this.renderCode;t&&s.push(`parent = ${t}`),"key"in r&&(e.key=ae(r.key,e.component));const i=e.key?`elms[${$}][${e.key}]`:`elms[${$}]`;e.key&&s.push(`
      if(elms[${$}] === undefined) {
        elms[${$}] = {}
      }
    `),s.push(`const elementConfig${$} = {}`),e.forloop&&s.push(`if(${i} === undefined) {`),s.push(`
    ${i} = this.element({parent: parent || 'root'}, component)
  `),e.forloop&&s.push("}");const o=r.children;delete r.children,r[Symbol.for("componentType")]==="Slot"&&s.push(`elementConfig${$}[Symbol.for('isSlot')] = true`),Object.keys(r).forEach(a=>{if(a==="slot"&&s.push(`
        elementConfig${$}['parent'] = component[Symbol.for('slots')].filter(slot => slot.ref === '${r.slot}').shift() || component[Symbol.for('slots')][0] || parent
      `),a!=="key")if(Nr(a)){if(e.holder&&a===":color")return;e.holder?this.effectsCode.push(`
        if(typeof skip${$} === 'undefined' ||
          skip${$}.indexOf('${a.substring(1)}') === -1)
          ${i}.set('${a.substring(1)}', ${ae(r[a],e.component)})
        `):this.effectsCode.push(`
            ${i}.set('${a.substring(1)}', ${ae(r[a],e.component)})
          `),s.push(`elementConfig${$}['${a.substring(1)}'] = ${ae(r[a],e.component)}`)}else s.push(`elementConfig${$}['${a}'] = ${er(r[a],a,e.component)}`)}),e.holder===!0&&s.push(`
    const skip${$} = []
    if(typeof cmp${$} !== 'undefined') {
      for(let key in cmp${$}.config.props) {
        delete elementConfig${$}[cmp${$}.config.props[key]]
        skip${$}.push(cmp${$}.config.props[key])
      }
    }
    `),e.forloop&&s.push(`if(${i}.nodeId === undefined) {`),s.push(`${i}.populate(elementConfig${$})`),e.forloop&&s.push("}"),o&&Dr.call(this,{children:o},`${i}`,e)},$r=function(r,t=!1,e={key:!1,component:"component.",forceEffect:!1,holder:!1,forloop:!1}){const s=e.forceEffect?this.effectsCode:this.renderCode;s.push(`
    const cmp${$} =
      (context.components && context.components['${r[Symbol.for("componentType")]}']) || components['${r[Symbol.for("componentType")]}']
  `),"key"in r&&(e.key=ae(r.key,e.component));const i=r.children;delete r.children,ls.call(this,r,t,{...e,holder:!0}),t=e.key?`elms[${$}][${e.key}]`:`elms[${$}]`,$++;const o=e.key?`elms[${$}][${e.key}]`:`elms[${$}]`;e.key&&s.push(`
      if(elms[${$}] === undefined) {
        elms[${$}] = {}
      }
    `),t&&s.push(`parent = ${t}`),s.push(`const props${$} = {}`),e.forloop&&s.push(`if(${o} === undefined) {`),Object.keys(r).forEach(a=>{Nr(a)?(this.effectsCode.push(`
        ${o}[Symbol.for('props')]['${a.substring(1)}'] = ${ae(r[a],e.component)}`),s.push(`props${$}['${a.substring(1)}'] = ${ae(r[a],e.component)}`)):s.push(`props${$}['${a}'] = ${er(r[a],a,e.component)}`)}),s.push(`
    componentType = props${$}['is'] || '${r[Symbol.for("componentType")]}'

    let component${$}
    if(typeof componentType === 'string') {
      component${$} = context.components && context.components[componentType] || components[componentType]
      if(!component${$}) {
        throw new Error('Component "${r[Symbol.for("componentType")]}" not found')
      }
    } else if(typeof componentType === 'function' && componentType.name === 'factory') {
      component${$} = componentType
    }

    ${o} = component${$}.call(null, {props: props${$}}, ${t}, component)

    if (${o}[Symbol.for('slots')][0]) {
      parent = ${o}[Symbol.for('slots')][0]
      component = ${o}
    } else {
      parent = ${o}[Symbol.for('children')][0]
    }
  `),e.forloop&&s.push("}"),i&&($++,ls.call(this,{children:i},!1,{...e}))},Fi=function(r,t){const e=r[":for"];delete r[":for"];const s=r.key,i=ae(s,"scope."),o=!(r.$shallow&&r.$shallow.toLowerCase()==="false");delete r.$shallow,delete r.key;const n=/(.+)\s+in\s+(.+)/gi.exec(e),[l,c="index"]=n[1].replace("(","").replace(")","").split(/\s*,\s*/),h=new RegExp(`(scope\\.(?!${l}\\.|${c}|key)(\\w+))`,"gi"),d={renderCode:[],effectsCode:[],context:{props:[],components:this.components}};t&&d.renderCode.push(`parent = ${t}`);const x=new RegExp(`\\$${c}(?!['\\w])`).exec(s);Array.isArray(x)&&d.renderCode.push(`console.warn(" Using '${c}' in the key, like key=${s},  is not recommended")`);const m=$;d.renderCode.push(`
    const created${m} = []
    const forloop${m} = (collection = [], elms, created) => {
      const rawCollection = getRaw(collection)
      const keys = new Set()
      let l = rawCollection.length
      while(l--) {
        const ${l} = rawCollection[l]
        const ${c} = l
        keys.add('' +  ${ae(s,"")||"l"})
      }
  `);const g=d.renderCode.length;d.renderCode.push(`
      created.length = 0
      const length = rawCollection.length
      for(let __index = 0; __index < length; __index++) {
        const scope = Object.create(component)
        parent = ${t}
        scope['${c}'] = __index
        scope['${l}'] = rawCollection[__index]
        scope['key'] = '' + ${i||"__index"}
  `),"ref"in r&&r.ref.indexOf("$")===-1&&(d.renderCode.push(`
        scope['__ref'] = '${r.ref}' + __index
    `),r.ref="$__ref"),d.renderCode.push(`
        created.push(scope.key)
  `),r[Symbol.for("componentType")]==="Element"||r[Symbol.for("componentType")]==="Slot"||r[Symbol.for("componentType")]==="Text"?ls.call(d,r,t,{key:"scope.key",component:"scope.",forceEffect:!1,forloop:!0}):$r.call(d,r,!1,{key:"scope.key",component:"scope.",forceEffect:!1,forloop:!0});const b=d.effectsCode.filter(S=>[...S.matchAll(h)].length===0),T=d.effectsCode.filter(S=>[...S.matchAll(h)].length!==0);o===!1&&d.renderCode.push(`
      scope['${l}'] = null
      scope['${l}'] = collection[__index]
  `),b.forEach(S=>{const P=S.indexOf(`scope.${c}`)>-1?`'${ae(n[2],"")}'`:null;S.indexOf("Symbol.for('props')")===-1?d.renderCode.push(`
        effect(() => {
          ${S}
        }, ${P})
      `):d.renderCode.push(`
        ${S}
      `)}),d.renderCode.push(`
    }
  }`);const _=[];_.push(`
      let i = created.length

      while (i--) {
        if (keys.has(created[i]) === false) {
          const key = created[i]
  `);const C=$;for(let S=m;S<=C;S++)_.push(`
          elms[${S}][key] && elms[${S}][key].destroy()
          delete elms[${S}][key]
      `);_.push(`
       }
    }
  `),d.renderCode.splice(g,0,..._),d.renderCode.push(`
    effect(() => {
      forloop${m}(${er(n[2],":for")}, elms, created${m})
    }, '${ae(n[2],"")}')
  `),T.forEach(S=>{const P=[...S.matchAll(h)];let G=P.length;const I=[];for(;G--;){const L=P[G],F=`component.${L[2]}`;I.indexOf(F)===-1&&I.push(F),S=S.substring(0,L.index)+F+S.substring(L.index+L[1].length)}d.renderCode.push(`
      effect(() => {
        void ${I.join(", ")}
        for(let __index = 0; __index < ${ae(n[2])}.length; __index++) {
          const scope = {}
          scope['${c}'] = __index
          scope['${l}'] = ${ae(n[2])}[__index]
          scope['key'] = ${i||"__index"}
    `),d.renderCode.push(`
          ${S}
        }
      })
    `)}),this.renderCode.push(d.renderCode.join(`
`))},Dr=function(r,t=!1,e={}){r.children&&r.children.forEach(s=>{$++,Object.keys(s).indexOf(":for")>-1?Fi.call(this,s,t):s[Symbol.for("componentType")]==="Element"||s[Symbol.for("componentType")]==="Slot"||s[Symbol.for("componentType")]==="Text"?(s[Symbol.for("componentType")]==="Text"&&(s.__textnode="true"),ls.call(this,s,t,e)):$r.call(this,s,t,e)})},ae=(r,t="component.")=>{if(r===void 0)return r;const e=/('.*?')+/gi,s=/\$(\$(?=\$)|\$?)/g,i=r.matchAll(e),o=[];let a=0;for(const n of i)o.push(n[0]),r=r.replace(n[0],`[@@REPLACEMENT${a}@@]`),a++;return r=r.replace(s,(n,l)=>{if(l==="")return t;if(l==="$")return t+"$"}),o.forEach((n,l)=>{r=r.replace(`[@@REPLACEMENT${l}@@]`,n)}),r},er=(r="",t=!1,e="component.")=>{const s=/\$\w+/gi;let i;if(t==="content")if(r.startsWith("$"))i=`${e}${r.replace("$","")}`;else{const o=r.replace(/\\\\/g,"__DOUBLE_BACKSLASH__").replace(/(^|[^\\])'/g,"$1\\'").replace(/__DOUBLE_BACKSLASH__/g,"\\\\");i=`'${ki(o,e)}'`}else if(t!=="color"&&!isNaN(parseFloat(r))){if(i=parseFloat(r),r.endsWith("%")){const a={w:"width",width:"width",x:"width",h:"height",height:"height",y:"height"}[t];a&&(i=`parent.node.${a} * (${i} / 100)`)}}else if(r.toLowerCase()==="true")i=!0;else if(r.toLowerCase()==="false")i=!1;else if(t.startsWith("@")&&r){const o=e.slice(0,-1);i=`${o}['${r.replace("$","")}'] && ${o}['${r.replace("$","")}'].bind(${o})`}else if(r.startsWith("$"))i=`${e}${r.replace("$","")}`;else if(s.exec(r)){const o=/\w+\s*:\s*(?:[^\s,}]+|".*?"|'.*?')/g,a=r.match(o);if(i={},a)for(let n=0;n<a.length;n++){const l=a[n].split(/\s*:\s*/);l&&Bi(l[0],l[1],e,i)}return Oi(i)}else i=`"${r}"`;return i},Nr=r=>r.startsWith(":"),ki=(r,t)=>{const e=/\{\{\s*(\$\S+)\s*\}\}/g,s=[...r.matchAll(e)];if(s.length)for(let[i,o]of s)r=r.replace(i,`${o.replace("$",`'+${t}`)}+'`);return r},Bi=(r,t,e,s)=>{t.startsWith("$")?s[r]=`${e}${t.replace("$","")}`:s[r]=t},Oi=r=>{const t=[];return Object.keys(r).forEach(e=>{t.push(`${e}: ${r[e]}`)}),` { ${t.join(", ")} }`},hr={};let Ui=0;const $i=r=>`BlitsComponent::${r}_${hr[r]=(hr[r]||0)+1}`,Di=()=>++Ui,Le={},Us=(r,t,e,s=[])=>{Le[t]&&Le[t][r]&&Le[t][r].apply(e,s)},Ni=(r,t,e)=>{const s=p[r];Le[t]&&Le[t][s]&&Le[t][s].apply(e)},zi=(r={},t)=>{Le[t]={},[...Object.keys(r),...Object.getOwnPropertySymbols(r)].forEach(s=>{typeof r[s]=="function"&&(Le[t][s]=r[s])})};let gt=null,fs=null,Ss=!1;const Xi=()=>{Ss=!0},Gi=()=>{Ss=!1},$s=new WeakMap,es=(r,t)=>{if(gt){if(Ss||fs!==null&&t!==fs)return;let e=$s.get(r);e||(e=new Map,$s.set(r,e));let s=e.get(t);s||(s=new Set,e.set(t,s)),s.add(gt)}},tt=(r,t,e=!1)=>{if(Ss===!0)return;const s=$s.get(r);if(!s)return;const i=s.get(t);if(i)for(let o of i)o(e)},Xt=(r,t=null)=>{gt=r,fs=t,gt(),gt=null,fs=null},ts=["push","pop","shift","unshift","splice","sort"],dr=new WeakMap,Qe=r=>{const t=r&&r[p.raw];return t?Qe(t):r},Ds=(r,t=null,e)=>{if(typeof r=="object"&&(r[p.id]!==void 0||r.constructor.name==="_ImageTexture"))return r;const s=dr.get(r);if(s)return s;const i={get(a,n,l){return n===p.raw?r:Array.isArray(a)?typeof a[n]=="object"&&a[n]!==null?(Array.isArray(a[n])&&es(a,n),Ds(Qe(a[n]),a,n)):ts.indexOf(n)!==-1?function(...c){Xi();const h=a[n].apply(this,c);return Gi(),tt(t,e),h}:n==="length"?r.length:Reflect.get(a,n,l):typeof a[n]=="object"&&a[n]!==null?(Array.isArray(a[n])&&es(a,n),Ds(Qe(a[n]),a,n)):(es(a,n),Reflect.get(a,n,l))},set(a,n,l,c){const h=Qe(a[n]),d=Qe(l);let u=!0;return h!==d&&(u=Reflect.set(a,n,l,c)),u&&h!==d&&(Array.isArray(a)&&n in a&&tt(t,e,!0),tt(a,n,!0)),u}},o=new Proxy(r,i);return dr.set(r,o),o},zr=r=>(Object.keys(r).forEach(t=>{let e=r[t];if(r[t]!==null&&typeof r[t]=="object"){if(Object.getPrototypeOf(r[t])===Object.prototype)return zr(r[t]);if(Array.isArray(r[t]))for(let s=0;s<ts.length-1;s++)r[t][ts[s]]=function(i){Array.prototype[ts[s]].call(this,i),tt(r,t)}}Object.defineProperty(r,t,{enumerable:!0,configurable:!0,get(){return es(r,t),e},set(s){e!==s&&(e=s,tt(r,t))}})}),r),ur=(r,t="Proxy")=>t==="defineProperty"?zr(r):Ds(r),Wi=["init","ready","focus","unfocus","destroy","attach","detach","enter","exit"],Vi={previous:null,current:null,get state(){return this.current},set state(r){Wi.indexOf(r)>-1&&(r!==this.current||r==="focus")&&(Q.debug(`Setting lifecycle state from ${this.current} to ${r} for ${this.component.componentId}`),this.previous=this.current,this.current=r,Ni(r,this.component[p.identifier],this.component),Us(r,this.component[p.identifier],this.component))}},Hi={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1};function Yi(r,t){const e={alpha:!0,antialias:!1,depth:!1,stencil:!0,desynchronized:!1,powerPreference:"high-performance",premultipliedAlpha:!0,preserveDrawingBuffer:!1},s=r.getContext("webgl",e)||r.getContext("experimental-webgl",e);if(!s)throw new Error("Unable to create WebGL context");return t?new Proxy(s,{get(i,o){const a=i[o];return typeof a=="function"?(t.increment(String(o)),a.bind(i)):a}}):s}function E(r,t){if(!tr()&&!r)throw new Error(t||"Assertion failed")}function pr(r,t,e){const s=Math.trunc(r>>>24),i=Math.trunc(r>>>16&255),o=Math.trunc(r>>>8&255),a=Math.trunc(r&255),n=Math.trunc(t>>>24),l=Math.trunc(t>>>16&255),c=Math.trunc(t>>>8&255),h=Math.trunc(t&255),d=Math.round(n*e+s*(1-e)),u=Math.round(l*e+i*(1-e)),x=Math.round(c*e+o*(1-e)),m=Math.round(h*e+a*(1-e));return(d<<24|u<<16|x<<8|m)>>>0}function Ki(r,t){const e=r>>>24,s=r>>>16&255,i=r>>>8&255,o=Math.trunc((r&255)*t);return(e<<24|s<<16|i<<8|o)>>>0}let Xr=!0;function ji(r){Xr=r==="webgl"}function Gt(r,t,e=!1){const s=(r&255)/255*t,i=Xr?s:1,o=Math.trunc((r>>>24)*i),a=Math.trunc((r>>>16&255)*i),n=Math.trunc((r>>>8&255)*i),l=Math.trunc(s*255);return e?(l<<24|n<<16|a<<8|o)>>>0:(o<<24|a<<16|n<<8|l)>>>0}function cs(r,t){return Object.prototype.hasOwnProperty.call(r,t)}function tr(){return Hi&&!0}let qi=1;function Zi(){return qi++}class Pe{constructor(){f(this,"eventListeners",{})}on(t,e){let s=this.eventListeners[t];s||(s=[]),s.push(e),this.eventListeners[t]=s}off(t,e){const s=this.eventListeners[t];if(!s)return;if(!e){delete this.eventListeners[t];return}const i=s.indexOf(e);i>=0&&s.splice(i,1)}once(t,e){const s=(i,o)=>{this.off(t,s),e(i,o)};this.on(t,s)}emit(t,e){const s=this.eventListeners[t];s&&[...s].forEach(i=>{i(this,e)})}removeAllListeners(){this.eventListeners={}}}const Qi=/^(data|ftps?|https?):/,wt=r=>{const t=r>>>24,e=r>>>16&255,s=r>>>8&255,i=r&255;return[t/255,e/255,s/255,i/255]},Ji=r=>{const t=r>>>24,e=r>>>16&255,s=r>>>8&255,i=r&255;return[t,e,s,i]};function eo(r){return(r&255)/255}function As(r){const t=Math.floor(r[0]*255),e=Math.floor(r[1]*255),s=Math.floor(r[2]*255),i=Math.floor(r[3]*255);return`rgba(${t},${e},${s},${i.toFixed(4)})`}function Xe(r,t,e,s,i){return i?(i.x1=r,i.y1=t,i.x2=e,i.y2=s,i):{x1:r,y1:t,x2:e,y2:s}}function Ms(r,t){return r.x1<t.x2&&r.x2>t.x1&&r.y1<t.y2&&r.y2>t.y1}function to(r,t){return t?(t.x=r.x1,t.y=r.y1,t.width=r.x2-r.x1,t.height=r.y2-r.y1,t):{x:r.x1,y:r.y1,width:r.x2-r.x1,height:r.y2-r.y1}}function Gr(r,t,e){const s=Math.max(r.x,t.x),i=Math.max(r.y,t.y),o=Math.min(r.x+r.width,t.x+t.width)-s,a=Math.min(r.y+r.height,t.y+t.height)-i;return o>0&&a>0?e?(e.x=s,e.y=i,e.width=o,e.height=a,e):{x:s,y:i,width:o,height:a}:e?(e.x=0,e.y=0,e.width=0,e.height=0,e):{x:0,y:0,width:0,height:0}}function Wr(r,t){return t?(t.x=r.x,t.y=r.y,t.width=r.width,t.height=r.height,t):{x:r.x,y:r.y,width:r.width,height:r.height}}function so(r,t){return r===t?!0:r===null||t===null?!1:r.x===t.x&&r.y===t.y&&r.width===t.width&&r.height===t.height}function mr(r,t){return r.x1<=t.x2&&r.y1<=t.y2&&r.x2>=t.x1&&r.y2>=t.y1}function ro(r,t){return r.x1<t.x1&&r.x2>t.x2&&r.y1<t.y1&&r.y2>t.y2}function io(r){return r.x1<r.x2&&r.y1<r.y2}function oo(r){if(self.location.protocol==="file:"&&!Qi.test(r)){const e=self.location.pathname.split("/");e.pop();const s=e.join("/"),i=self.location.protocol+"//"+s;return r.charAt(0)==="."&&(r=r.slice(1)),r.charAt(0)==="/"&&(r=r.slice(1)),i+"/"+r}return new URL(r,self.location.href).href}class re{constructor(){f(this,"ta");f(this,"tb");f(this,"tx");f(this,"tc");f(this,"td");f(this,"ty");f(this,"_floatArr",null);f(this,"mutation");this.ta=0,this.tb=0,this.tx=0,this.tc=0,this.td=0,this.ty=0,this.mutation=!0}static get temp(){return no}static multiply(t,e,s){const i=t.ta*e.ta+t.tb*e.tc,o=t.ta*e.tb+t.tb*e.td,a=t.ta*e.tx+t.tb*e.ty+t.tx,n=t.tc*e.ta+t.td*e.tc,l=t.tc*e.tb+t.td*e.td,c=t.tc*e.tx+t.td*e.ty+t.ty;return s||(s=new re),s.ta=i,s.tb=o,s.tx=a,s.tc=n,s.td=l,s.ty=c,s.mutation=!0,s}static identity(t){return t||(t=new re),t.ta=1,t.tb=0,t.tx=0,t.tc=0,t.td=1,t.ty=0,t.mutation=!0,t}static translate(t,e,s){return s||(s=new re),s.ta=1,s.tb=0,s.tx=t,s.tc=0,s.td=1,s.ty=e,s.mutation=!0,s}static scale(t,e,s){return s||(s=new re),s.ta=t,s.tb=0,s.tx=0,s.tc=0,s.td=e,s.ty=0,s.mutation=!0,s}static rotate(t,e){const s=Math.cos(t),i=Math.sin(t);return e||(e=new re),e.ta=s,e.tb=-i,e.tx=0,e.tc=i,e.td=s,e.ty=0,e.mutation=!0,e}static copy(t,e){return e||(e=new re),e.ta=t.ta,e.tc=t.tc,e.tb=t.tb,e.td=t.td,e.tx=t.tx,e.ty=t.ty,e.mutation=!0,e}translate(t,e){return this.tx=this.ta*t+this.tb*e+this.tx,this.ty=this.tc*t+this.td*e+this.ty,this.mutation=!0,this}scale(t,e){return this.ta=this.ta*t,this.tb=this.tb*e,this.tc=this.tc*t,this.td=this.td*e,this.mutation=!0,this}rotate(t){if(t===0||!(t%Math.PI*2))return this;const e=Math.cos(t),s=Math.sin(t),i=this.ta*e+this.tb*s,o=this.tb*e-this.ta*s,a=this.tc*e+this.td*s,n=this.td*e-this.tc*s;return this.ta=i,this.tb=o,this.tc=a,this.td=n,this.mutation=!0,this}multiply(t){return re.multiply(this,t,this)}getFloatArr(){return this._floatArr||(this._floatArr=new Float32Array(9)),this.mutation&&(this._floatArr[0]=this.ta,this._floatArr[1]=this.tc,this._floatArr[2]=0,this._floatArr[3]=this.tb,this._floatArr[4]=this.td,this._floatArr[5]=0,this._floatArr[6]=this.tx,this._floatArr[7]=this.ty,this._floatArr[8]=1,this.mutation=!1),this._floatArr}}const no=new re,Wt=0,Vt=2,Ht=4,Yt=6,Kt=1,jt=3,qt=5,Zt=7;class hs{constructor(t){f(this,"data");this.data=new Float32Array(8),t&&(this.data[Wt]=t[Wt],this.data[Vt]=t[Vt],this.data[Ht]=t[Ht],this.data[Yt]=t[Yt],this.data[Kt]=t[Kt],this.data[jt]=t[jt],this.data[qt]=t[qt],this.data[Zt]=t[Zt])}static translate(t,e,s,i,o,a,n,l,c){return c||(c=new hs),c.data[Wt]=t,c.data[Vt]=s,c.data[Ht]=o,c.data[Yt]=n,c.data[Kt]=e,c.data[jt]=i,c.data[qt]=a,c.data[Zt]=l,c}get x1(){return this.data[Wt]}get x2(){return this.data[Vt]}get x3(){return this.data[Ht]}get x4(){return this.data[Yt]}get y1(){return this.data[Kt]}get y2(){return this.data[jt]}get y3(){return this.data[qt]}get y4(){return this.data[Zt]}}const gr=r=>r&&!(r&r-1),Vr=(r,t,e,s)=>{const i=3*r,o=3*(e-r)-i,a=1-i-o,n=3*t,l=3*(s-t)-n,c=1-n-l;return function(h){if(h>=1)return 1;if(h<=0)return 0;let d=.5,u,x,m;for(let T=0;T<20;T++){if(u=d*(d*(d*a+o)+i),m=h-u,m>-1e-8&&m<1e-8)return d*(d*(d*c+l)+n);if(x=d*(d*(3*a)+2*o)+i,x>1e-10&&x<1e-10)break;d+=m/x}let g=0,b=1;for(let T=0;T<20;T++){if(d=.5*(g+b),u=d*(d*(d*a+o)+i),m=h-u,m>-1e-8&&m<1e-8)return d*(d*(d*c+l)+n);m<0?b=d:g=d}}},ss={},ao={ease:[.25,.1,.25,1],"ease-in":[.42,0,1,1],"ease-out":[0,0,.58,1],"ease-in-out":[.42,0,.58,1],"ease-in-sine":[.12,0,.39,0],"ease-out-sine":[.12,0,.39,0],"ease-in-out-sine":[.37,0,.63,1],"ease-in-cubic":[.32,0,.67,0],"ease-out-cubic":[.33,1,.68,1],"ease-in-out-cubic":[.65,0,.35,1],"ease-in-circ":[.55,0,1,.45],"ease-out-circ":[0,.55,.45,1],"ease-in-out-circ":[.85,0,.15,1],"ease-in-back":[.36,0,.66,-.56],"ease-out-back":[.34,1.56,.64,1],"ease-in-out-back":[.68,-.6,.32,1.6]},rs=r=>r,lo=r=>{const t=/-?\d*\.?\d+/g,e=r.match(t);if(e){const[s,i,o,a]=e,n=parseFloat(s||"0.42"),l=parseFloat(i||"0"),c=parseFloat(o||"1"),h=parseFloat(a||"1"),d=Vr(n,l,c,h);return ss[r]=d,d}return console.warn("Unknown cubic-bezier timing: "+r),rs},fo=r=>{if(r==="linear")return rs;if(ss[r]!==void 0)return ss[r]||rs;if(r==="step-start")return()=>1;if(r==="step-end")return e=>e===1?1:0;const t=ao[r];if(t!==void 0){const[e,s,i,o]=t,a=Vr(e,s,i,o);return ss[r]=a,a}return r.startsWith("cubic-bezier")?lo(r):(console.warn("Unknown timing function: "+r),rs)};function xr(r){return(r/1024/1024).toFixed(2)}class co extends Pe{constructor(e,s,i){super();f(this,"node");f(this,"props");f(this,"settings");f(this,"progress",0);f(this,"delayFor",0);f(this,"timingFunction");f(this,"propValuesMap",{});f(this,"dynPropValuesMap");this.node=e,this.props=s;for(const n in s)if(n!=="shaderProps")this.propValuesMap.props===void 0&&(this.propValuesMap.props={}),this.propValuesMap.props[n]={start:e[n]||0,target:s[n]};else if(e.shader.type!=="DynamicShader"){this.propValuesMap.shaderProps={};for(const l in s.shaderProps)this.propValuesMap.shaderProps[l]={start:e.shader.props[l],target:s.shaderProps[l]}}else{const l=Object.keys(s.shaderProps),c=l.length;this.dynPropValuesMap={};for(let h=0;h<c;h++){const d=l[h],u=s.shaderProps[d];this.dynPropValuesMap[d]={};const x=Object.entries(u),m=x.length;for(let g=0;g<m;g++){const[b,T]=x[g];this.dynPropValuesMap[d][b]={start:e.shader.props[d][b],target:T}}}}const o=i.easing||"linear",a=i.delay??0;this.settings={duration:i.duration??0,delay:a,easing:o,loop:i.loop??!1,repeat:i.repeat??0,repeatDelay:i.repeatDelay??0,stopMethod:i.stopMethod??!1},this.timingFunction=fo(o),this.delayFor=a}reset(){this.progress=0,this.delayFor=this.settings.delay||0,this.update(0)}restoreValues(e,s){const i=Object.entries(s),o=i.length;for(let a=0;a<o;a++){const[n,l]=i[a];e[n]=l.start}}restore(){if(this.reset(),this.propValuesMap.props!==void 0&&this.restoreValues(this.node,this.propValuesMap.props),this.propValuesMap.shaderProps!==void 0&&this.restoreValues(this.node.shader.props,this.propValuesMap.shaderProps),this.dynPropValuesMap!==void 0){const e=Object.keys(this.dynPropValuesMap),s=e.length;if(s>0)for(let i=0;i<s;i++){const o=e[i];this.restoreValues(this.node.shader.props[o],this.dynPropValuesMap[o])}}}reverseValues(e){const s=Object.entries(e),i=s.length;for(let o=0;o<i;o++){const[a,n]=s[o];e[a]={start:n.target,target:n.start}}}reverse(){if(this.progress=0,this.propValuesMap.props!==void 0&&this.reverseValues(this.propValuesMap.props),this.propValuesMap.shaderProps!==void 0&&this.reverseValues(this.propValuesMap.shaderProps),this.dynPropValuesMap!==void 0){const e=Object.keys(this.dynPropValuesMap),s=e.length;if(s>0)for(let i=0;i<s;i++){const o=e[i];this.reverseValues(this.dynPropValuesMap[o])}}this.settings.loop||(this.settings.stopMethod=!1)}applyEasing(e,s,i){return(this.timingFunction(e)||e)*(i-s)+s}updateValue(e,s,i,o){if(this.progress===1)return s;if(this.progress===0)return i;const a=s;if(e.indexOf("color")!==-1){if(i===a)return i;if(o){const n=this.timingFunction(this.progress)||this.progress;return pr(i,a,n)}return pr(i,a,this.progress)}return o?this.applyEasing(this.progress,i,a):i+(a-i)*this.progress}updateValues(e,s,i){const o=Object.entries(s),a=o.length;for(let n=0;n<a;n++){const[l,c]=o[n];e[l]=this.updateValue(l,c.target,c.start,i)}}update(e){const{duration:s,loop:i,easing:o,stopMethod:a}=this.settings,{delayFor:n}=this;if(s===0&&n===0){this.emit("finished",{});return}if(this.delayFor>0){if(this.delayFor-=e,this.delayFor>=0)return;e=-this.delayFor,this.delayFor=0}if(s===0){this.emit("finished",{});return}if(this.progress===0&&this.emit("animating",{}),this.progress+=e/s,this.progress>1&&(this.progress=i?0:1,a)){this.emit("finished",{});return}if(this.propValuesMap.props!==void 0&&this.updateValues(this.node,this.propValuesMap.props,o),this.propValuesMap.shaderProps!==void 0&&this.updateValues(this.node.shader.props,this.propValuesMap.shaderProps,o),this.dynPropValuesMap!==void 0){const l=Object.keys(this.dynPropValuesMap),c=l.length;if(c>0)for(let h=0;h<c;h++){const d=l[h];this.updateValues(this.node.shader.props[d],this.dynPropValuesMap[d],o)}}this.progress===1&&this.emit("finished",{})}}class ho extends Pe{constructor(e,s){super();f(this,"manager");f(this,"animation");f(this,"stoppedPromise");f(this,"stoppedResolve",null);f(this,"state");this.manager=e,this.animation=s,this.state="stopped",this.stoppedPromise=Promise.resolve(),this.onAnimating=this.onAnimating.bind(this),this.onFinished=this.onFinished.bind(this)}start(){return this.state!=="running"&&(this.makeStoppedPromise(),this.registerAnimation(),this.state="running"),this}stop(){return this.unregisterAnimation(),this.stoppedResolve!==null&&(this.stoppedResolve(),this.stoppedResolve=null,this.emit("stopped",this)),this.animation.reset(),this.state="stopped",this}pause(){return this.unregisterAnimation(),this.state="paused",this}restore(){return this.stoppedResolve=null,this.animation.restore(),this}waitUntilStopped(){return this.stoppedPromise}registerAnimation(){this.animation.once("finished",this.onFinished),this.animation.on("animating",this.onAnimating),this.manager.registerAnimation(this.animation)}unregisterAnimation(){this.manager.unregisterAnimation(this.animation),this.animation.off("finished",this.onFinished),this.animation.off("animating",this.onAnimating)}makeStoppedPromise(){this.stoppedResolve===null&&(this.stoppedPromise=new Promise(e=>{this.stoppedResolve=e}))}onFinished(){E(this.stoppedResolve);const{loop:e,stopMethod:s}=this.animation.settings;if(s==="reverse"){this.animation.once("finished",this.onFinished),this.animation.reverse();return}e||(this.unregisterAnimation(),this.stoppedResolve(),this.stoppedResolve=null,this.emit("stopped",this),this.state="stopped")}onAnimating(){this.emit("animating",this)}}var se;(function(r){r[r.Init=0]="Init",r[r.OutOfBounds=2]="OutOfBounds",r[r.InBounds=4]="InBounds",r[r.InViewport=8]="InViewport"})(se||(se={}));const vt=new Map;vt.set(se.Init,"init");vt.set(se.OutOfBounds,"outOfBounds");vt.set(se.InBounds,"inBounds");vt.set(se.InViewport,"inViewport");var w;(function(r){r[r.Children=1]="Children",r[r.ScaleRotate=2]="ScaleRotate",r[r.Local=4]="Local",r[r.Global=8]="Global",r[r.Clipping=16]="Clipping",r[r.CalculatedZIndex=32]="CalculatedZIndex",r[r.ZIndexSortedChildren=64]="ZIndexSortedChildren",r[r.PremultipliedColors=128]="PremultipliedColors",r[r.WorldAlpha=256]="WorldAlpha",r[r.RenderState=512]="RenderState",r[r.IsRenderable=1024]="IsRenderable",r[r.RenderTexture=2048]="RenderTexture",r[r.ParentRenderTexture=4096]="ParentRenderTexture",r[r.RenderBounds=8192]="RenderBounds",r[r.None=0]="None",r[r.All=8191]="All"})(w||(w={}));class Ns extends Pe{constructor(e,s){super();f(this,"stage");f(this,"children",[]);f(this,"_id",Zi());f(this,"props");f(this,"updateType",w.All);f(this,"childUpdateType",w.None);f(this,"globalTransform");f(this,"scaleRotateTransform");f(this,"localTransform");f(this,"renderCoords");f(this,"renderBound");f(this,"strictBound");f(this,"preloadBound");f(this,"clippingRect",{x:0,y:0,width:0,height:0,valid:!1});f(this,"isRenderable",!1);f(this,"renderState",se.Init);f(this,"worldAlpha",1);f(this,"premultipliedColorTl",0);f(this,"premultipliedColorTr",0);f(this,"premultipliedColorBl",0);f(this,"premultipliedColorBr",0);f(this,"calcZIndex",0);f(this,"hasRTTupdates",!1);f(this,"parentHasRenderTexture",!1);f(this,"onTextureLoaded",(e,s)=>{var i,o;this.autosizeNode(s),this.stage.requestRender(),this.parentHasRenderTexture&&this.setRTTUpdates(1),this.emit("loaded",{type:"texture",dimensions:s}),((o=(i=this.props.textureOptions)==null?void 0:i.resizeMode)==null?void 0:o.type)==="contain"&&this.setUpdateType(w.Local)});f(this,"onTextureFailed",(e,s)=>{this.emit("failed",{type:"texture",error:s})});f(this,"onTextureFreed",()=>{this.emit("freed",{type:"texture"})});this.stage=e,this.props={...s,parent:null,texture:null,src:null,rtt:!1},this.parent=s.parent,this.texture=s.texture,this.src=s.src,this.rtt=s.rtt,this.updateScaleRotateTransform(),this.setUpdateType(w.Local|w.RenderBounds|w.RenderState)}loadTexture(){const{texture:e}=this.props;E(e),queueMicrotask(()=>{e.preventCleanup=this.props.preventCleanup,this.textureOptions.preload&&e.ctxTexture.load(),e.state==="loaded"?(E(e.dimensions),this.onTextureLoaded(e,e.dimensions)):e.state==="failed"?(E(e.error),this.onTextureFailed(e,e.error)):e.state==="freed"&&this.onTextureFreed(e),e.on("loaded",this.onTextureLoaded),e.on("failed",this.onTextureFailed),e.on("freed",this.onTextureFreed)})}unloadTexture(){this.texture&&(this.texture.off("loaded",this.onTextureLoaded),this.texture.off("failed",this.onTextureFailed),this.texture.off("freed",this.onTextureFreed),this.texture.setRenderableOwner(this,!1))}autosizeNode(e){this.autosize&&(this.width=e.width,this.height=e.height)}setUpdateType(e){this.updateType|=e;const s=this.props.parent;s!==null&&!(s.updateType&w.Children)&&s.setUpdateType(w.Children),this.parentHasRenderTexture&&this.setRTTUpdates(e)}sortChildren(){this.children.sort((e,s)=>e.calcZIndex-s.calcZIndex)}updateScaleRotateTransform(){const{rotation:e,scaleX:s,scaleY:i}=this.props;if(e===0&&s===1&&i===1){this.scaleRotateTransform=void 0;return}this.scaleRotateTransform=re.rotate(e,this.scaleRotateTransform).scale(s,i)}updateLocalTransform(){var c,h;const{x:e,y:s,width:i,height:o}=this.props,a=this.props.mountX*i,n=this.props.mountY*o;if(this.scaleRotateTransform){const d=this.props.pivotX*i,u=this.props.pivotY*o;this.localTransform=re.translate(e-a+d,s-n+u,this.localTransform).multiply(this.scaleRotateTransform).translate(-d,-u)}else this.localTransform=re.translate(e-a,s-n,this.localTransform);const l=this.props.texture;if(l&&l.dimensions&&((h=(c=this.props.textureOptions)==null?void 0:c.resizeMode)==null?void 0:h.type)==="contain"){let d=1,u=1,x=0,m=0;const{width:g,height:b}=l.dimensions,T=g/b,_=i/o;if(T>_){const C=i/g,S=b*C;m=(o-S)/2,u=S/o}else{const C=o/b,S=g*C;x=(i-S)/2,d=S/i}this.localTransform.translate(x,m).scale(d,u)}this.setUpdateType(w.Global)}update(e,s){var a;this.updateType&w.ScaleRotate&&(this.updateScaleRotateTransform(),this.setUpdateType(w.Local)),this.updateType&w.Local&&(this.updateLocalTransform(),this.setUpdateType(w.Global));const i=this.props.parent;let o=null;if(this.updateType&w.ParentRenderTexture){let n=this.parent;for(;n;)n.rtt&&(this.parentHasRenderTexture=!0),n=n.parent}if(this.updateType^w.All&&this.updateType&w.RenderTexture&&this.children.forEach(n=>{n.setUpdateType(w.All)}),this.updateType&w.Global&&(E(this.localTransform),this.globalTransform=re.copy((i==null?void 0:i.globalTransform)||this.localTransform,this.globalTransform),this.parentHasRenderTexture&&((a=this.props.parent)!=null&&a.rtt)&&(this.globalTransform=re.identity()),i&&this.globalTransform.multiply(this.localTransform),this.calculateRenderCoords(),this.updateBoundingRect(),this.setUpdateType(w.RenderState|w.Children),this.clipping===!0&&this.setUpdateType(w.Clipping),this.childUpdateType|=w.Global),this.updateType&w.RenderBounds&&(this.createRenderBounds(),this.setUpdateType(w.RenderState),this.setUpdateType(w.Children)),this.updateType&w.RenderState&&(o=this.checkRenderBounds(),this.setUpdateType(w.IsRenderable),o!==se.OutOfBounds&&this.updateRenderState(o)),this.updateType&w.IsRenderable&&this.updateIsRenderable(),this.renderState!==se.OutOfBounds){if(this.updateType&w.Clipping&&(this.calculateClippingRect(s),this.setUpdateType(w.Children),this.childUpdateType|=w.Clipping,this.childUpdateType|=w.RenderBounds),this.updateType&w.WorldAlpha&&(i?this.worldAlpha=i.worldAlpha*this.props.alpha:this.worldAlpha=this.props.alpha,this.setUpdateType(w.Children|w.PremultipliedColors|w.IsRenderable),this.childUpdateType|=w.WorldAlpha),this.updateType&w.PremultipliedColors&&(this.premultipliedColorTl=Gt(this.props.colorTl,this.worldAlpha,!0),this.props.colorTl===this.props.colorTr&&this.props.colorBl===this.props.colorBr&&this.props.colorTl===this.props.colorBl?this.premultipliedColorTr=this.premultipliedColorBl=this.premultipliedColorBr=this.premultipliedColorTl:(this.premultipliedColorTr=Gt(this.props.colorTr,this.worldAlpha,!0),this.premultipliedColorBl=Gt(this.props.colorBl,this.worldAlpha,!0),this.premultipliedColorBr=Gt(this.props.colorBr,this.worldAlpha,!0))),i!==null&&this.updateType&w.CalculatedZIndex&&(this.calculateZIndex(),i.setUpdateType(w.ZIndexSortedChildren)),this.updateType&w.Children&&this.children.length>0&&this.rtt===!1)for(let n=0;n<this.children.length;n++){const l=this.children[n];l!==void 0&&(l.setUpdateType(this.childUpdateType),l.updateType!==0&&l.update(e,this.clippingRect))}this.updateType&w.ZIndexSortedChildren&&this.sortChildren(),o===se.OutOfBounds&&this.updateRenderState(o),this.updateType=0,this.childUpdateType=0}}checkRenderProps(){return this.props.texture?!0:!this.props.width||!this.props.height?!1:!!(this.props.shader!==this.stage.defShaderCtr||this.props.clipping||this.props.color!==0||this.props.colorTop!==0||this.props.colorBottom!==0||this.props.colorLeft!==0||this.props.colorRight!==0||this.props.colorTl!==0||this.props.colorTr!==0||this.props.colorBl!==0||this.props.colorBr!==0)}checkRenderBounds(){return E(this.renderBound),E(this.strictBound),E(this.preloadBound),mr(this.renderBound,this.strictBound)?se.InViewport:mr(this.renderBound,this.preloadBound)?se.InBounds:ro(this.renderBound,this.strictBound)?se.InViewport:this.parent!==null&&(this.props.width===0||this.props.height===0)?this.parent.renderState:se.OutOfBounds}createPreloadBounds(e){const s=this.stage.boundsMargin;return Xe(e.x1-s[3],e.y1-s[0],e.x2+s[1],e.y2+s[2],this.preloadBound)}updateBoundingRect(){const{renderCoords:e,globalTransform:s}=this;E(s),E(e);const{tb:i,tc:o}=s,{x1:a,y1:n,x3:l,y3:c}=e;if(i===0||o===0)this.renderBound=Xe(a,n,l,c,this.renderBound);else{const{x2:h,x4:d,y2:u,y4:x}=e;this.renderBound=Xe(Math.min(a,h,l,d),Math.min(n,u,c,x),Math.max(a,h,l,d),Math.max(n,u,c,x),this.renderBound)}}createRenderBounds(){if(E(this.stage),this.clipping===!1)if(this.parent!==null){this.strictBound=this.parent.strictBound??Xe(0,0,this.stage.root.width,this.stage.root.height),this.preloadBound=this.parent.preloadBound??this.createPreloadBounds(this.strictBound);return}else{this.strictBound=Xe(0,0,this.stage.root.width,this.stage.root.height),this.preloadBound=this.createPreloadBounds(this.strictBound);return}const{x:e,y:s,width:i,height:o}=this.props,{tx:a,ty:n}=this.globalTransform||{},l=a??e,c=n??s;this.strictBound=Xe(l,c,l+i,c+o,this.strictBound),this.preloadBound=this.createPreloadBounds(this.strictBound)}updateRenderState(e){if(e===this.renderState)return;const s=this.renderState;this.renderState=e;const i=vt.get(e);E(i),this.emit(i,{previous:s,current:e})}updateIsRenderable(){let e;this.worldAlpha===0||!this.checkRenderProps()?e=!1:e=this.renderState>se.OutOfBounds,this.isRenderable!==e&&(this.isRenderable=e,this.onChangeIsRenderable(e))}onChangeIsRenderable(e){var s;(s=this.texture)==null||s.setRenderableOwner(this,e)}calculateRenderCoords(){const{width:e,height:s,globalTransform:i}=this;E(i);const{tx:o,ty:a,ta:n,tb:l,tc:c,td:h}=i;if(l===0&&c===0){const d=o,u=o+e*n,x=a,m=a+s*h;this.renderCoords=hs.translate(d,x,u,x,u,m,d,m,this.renderCoords)}else this.renderCoords=hs.translate(o,a,o+e*n,a+e*c,o+e*n+s*l,a+e*c+s*h,o+s*l,a+s*h,this.renderCoords)}calculateClippingRect(e){E(this.globalTransform);const{clippingRect:s,props:i,globalTransform:o}=this,{clipping:a}=i,n=o.tb!==0||o.tc!==0;a===!0&&n===!1?(s.x=o.tx,s.y=o.ty,s.width=this.width*o.ta,s.height=this.height*o.td,s.valid=!0):s.valid=!1,e.valid===!0&&s.valid===!0?Gr(e,s,s):e.valid===!0&&(Wr(e,s),s.valid=!0)}calculateZIndex(){var a,n;const e=this.props,s=e.zIndex||0,i=((a=e.parent)==null?void 0:a.zIndex)||0;let o=s;(n=e.parent)!=null&&n.zIndexLocked&&(o=s<i?s:i),this.calcZIndex=o}destroy(){this.unloadTexture(),this.clippingRect.valid=!1,this.isRenderable=!1,delete this.renderCoords,delete this.renderBound,delete this.strictBound,delete this.preloadBound,delete this.globalTransform,delete this.scaleRotateTransform,delete this.localTransform,this.props.texture=null,this.props.shader=this.stage.defShaderCtr;const e=[...this.children];for(let s=0;s<e.length;s++)e[s].destroy();this.parent=null,this.rtt&&this.stage.renderer.removeRTTNode(this),this.removeAllListeners()}renderQuads(e){const{texture:s,width:i,height:o,textureOptions:a,rtt:n,shader:l}=this.props;if(this.parentHasRenderTexture&&(!e.renderToTextureActive||this.parentRenderTexture!==e.activeRttNode))return;const{premultipliedColorTl:c,premultipliedColorTr:h,premultipliedColorBl:d,premultipliedColorBr:u}=this,{zIndex:x,worldAlpha:m,globalTransform:g,clippingRect:b,renderCoords:T}=this;E(g),E(T),e.addQuad({width:i,height:o,colorTl:c,colorTr:h,colorBl:d,colorBr:u,texture:s,textureOptions:a,zIndex:x,shader:l.shader,shaderProps:l.getResolvedProps(),alpha:m,clippingRect:b,tx:g.tx,ty:g.ty,ta:g.ta,tb:g.tb,tc:g.tc,td:g.td,renderCoords:T,rtt:n,parentHasRenderTexture:this.parentHasRenderTexture,framebufferDimensions:this.framebufferDimensions})}get id(){return this._id}get data(){return this.props.data}set data(e){this.props.data=e}get x(){return this.props.x}set x(e){this.props.x!==e&&(this.props.x=e,this.setUpdateType(w.Local))}get absX(){var e,s,i;return this.props.x+-this.props.width*this.props.mountX+(((e=this.props.parent)==null?void 0:e.absX)||((i=(s=this.props.parent)==null?void 0:s.globalTransform)==null?void 0:i.tx)||0)}get absY(){var e;return this.props.y+-this.props.height*this.props.mountY+(((e=this.props.parent)==null?void 0:e.absY)??0)}get y(){return this.props.y}set y(e){this.props.y!==e&&(this.props.y=e,this.setUpdateType(w.Local))}get width(){return this.props.width}set width(e){this.props.width!==e&&(this.props.width=e,this.setUpdateType(w.Local),this.props.rtt&&(this.texture=this.stage.txManager.loadTexture("RenderTexture",{width:this.width,height:this.height}),this.textureOptions.preload=!0,this.setUpdateType(w.RenderTexture)))}get height(){return this.props.height}set height(e){this.props.height!==e&&(this.props.height=e,this.setUpdateType(w.Local),this.props.rtt&&(this.texture=this.stage.txManager.loadTexture("RenderTexture",{width:this.width,height:this.height}),this.textureOptions.preload=!0,this.setUpdateType(w.RenderTexture)))}get scale(){return this.scaleX}set scale(e){this.scaleX=e,this.scaleY=e}get scaleX(){return this.props.scaleX}set scaleX(e){this.props.scaleX!==e&&(this.props.scaleX=e,this.setUpdateType(w.ScaleRotate))}get scaleY(){return this.props.scaleY}set scaleY(e){this.props.scaleY!==e&&(this.props.scaleY=e,this.setUpdateType(w.ScaleRotate))}get mount(){return this.props.mount}set mount(e){(this.props.mountX!==e||this.props.mountY!==e)&&(this.props.mountX=e,this.props.mountY=e,this.props.mount=e,this.setUpdateType(w.Local))}get mountX(){return this.props.mountX}set mountX(e){this.props.mountX!==e&&(this.props.mountX=e,this.setUpdateType(w.Local))}get mountY(){return this.props.mountY}set mountY(e){this.props.mountY!==e&&(this.props.mountY=e,this.setUpdateType(w.Local))}get pivot(){return this.props.pivot}set pivot(e){(this.props.pivotX!==e||this.props.pivotY!==e)&&(this.props.pivotX=e,this.props.pivotY=e,this.props.pivot=e,this.setUpdateType(w.Local))}get pivotX(){return this.props.pivotX}set pivotX(e){this.props.pivotX!==e&&(this.props.pivotX=e,this.setUpdateType(w.Local))}get pivotY(){return this.props.pivotY}set pivotY(e){this.props.pivotY!==e&&(this.props.pivotY=e,this.setUpdateType(w.Local))}get rotation(){return this.props.rotation}set rotation(e){this.props.rotation!==e&&(this.props.rotation=e,this.setUpdateType(w.ScaleRotate))}get alpha(){return this.props.alpha}set alpha(e){this.props.alpha=e,this.setUpdateType(w.PremultipliedColors|w.WorldAlpha|w.Children),this.childUpdateType|=w.Global}get autosize(){return this.props.autosize}set autosize(e){this.props.autosize=e}get clipping(){return this.props.clipping}set clipping(e){this.props.clipping=e,this.setUpdateType(w.Clipping|w.RenderBounds|w.Children),this.childUpdateType|=w.Global|w.Clipping}get color(){return this.props.color}set color(e){this.colorTop=e,this.colorBottom=e,this.colorLeft=e,this.colorRight=e,this.props.color=e,this.setUpdateType(w.PremultipliedColors)}get colorTop(){return this.props.colorTop}set colorTop(e){(this.props.colorTl!==e||this.props.colorTr!==e)&&(this.colorTl=e,this.colorTr=e),this.props.colorTop=e,this.setUpdateType(w.PremultipliedColors)}get colorBottom(){return this.props.colorBottom}set colorBottom(e){(this.props.colorBl!==e||this.props.colorBr!==e)&&(this.colorBl=e,this.colorBr=e),this.props.colorBottom=e,this.setUpdateType(w.PremultipliedColors)}get colorLeft(){return this.props.colorLeft}set colorLeft(e){(this.props.colorTl!==e||this.props.colorBl!==e)&&(this.colorTl=e,this.colorBl=e),this.props.colorLeft=e,this.setUpdateType(w.PremultipliedColors)}get colorRight(){return this.props.colorRight}set colorRight(e){(this.props.colorTr!==e||this.props.colorBr!==e)&&(this.colorTr=e,this.colorBr=e),this.props.colorRight=e,this.setUpdateType(w.PremultipliedColors)}get colorTl(){return this.props.colorTl}set colorTl(e){this.props.colorTl=e,this.setUpdateType(w.PremultipliedColors)}get colorTr(){return this.props.colorTr}set colorTr(e){this.props.colorTr=e,this.setUpdateType(w.PremultipliedColors)}get colorBl(){return this.props.colorBl}set colorBl(e){this.props.colorBl=e,this.setUpdateType(w.PremultipliedColors)}get colorBr(){return this.props.colorBr}set colorBr(e){this.props.colorBr=e,this.setUpdateType(w.PremultipliedColors)}get zIndexLocked(){return this.props.zIndexLocked||0}set zIndexLocked(e){this.props.zIndexLocked=e,this.setUpdateType(w.CalculatedZIndex|w.Children),this.children.forEach(s=>{s.setUpdateType(w.CalculatedZIndex)})}get zIndex(){return this.props.zIndex}set zIndex(e){this.props.zIndex=e,this.setUpdateType(w.CalculatedZIndex|w.Children),this.children.forEach(s=>{s.setUpdateType(w.CalculatedZIndex)})}get parent(){return this.props.parent}set parent(e){const s=this.props.parent;if(s!==e){if(this.props.parent=e,s){const i=s.children.indexOf(this);E(i!==-1,"CoreNode.parent: Node not found in old parent's children!"),s.children.splice(i,1),s.setUpdateType(w.Children|w.ZIndexSortedChildren)}e&&(e.children.push(this),this.setUpdateType(w.All),e.setUpdateType(w.Children|w.ZIndexSortedChildren),(e.rtt||e.parentHasRenderTexture)&&this.setRTTUpdates(w.All)),this.updateScaleRotateTransform(),this.setUpdateType(w.RenderBounds|w.Children)}}get preventCleanup(){return this.props.preventCleanup}set preventCleanup(e){this.props.preventCleanup=e}get rtt(){return this.props.rtt}set rtt(e){var s,i;if(this.props.rtt===!0&&(this.props.rtt=e,e===!1&&this.texture!==null)){this.unloadTexture(),this.setUpdateType(w.All),this.children.forEach(o=>{o.parentHasRenderTexture=!1}),(s=this.stage.renderer)==null||s.removeRTTNode(this);return}e!==!1&&(this.texture=this.stage.txManager.loadTexture("RenderTexture",{width:this.width,height:this.height}),this.textureOptions.preload=!0,this.props.rtt=!0,this.hasRTTupdates=!0,this.setUpdateType(w.All),this.children.forEach(o=>{o.setUpdateType(w.All)}),(i=this.stage.renderer)==null||i.renderToTexture(this))}get shader(){return this.props.shader}set shader(e){this.props.shader!==e&&(this.props.shader=e,this.setUpdateType(w.IsRenderable))}get src(){return this.props.src}set src(e){if(this.props.src!==e){if(this.props.src=e,!e){this.texture=null;return}this.texture=this.stage.txManager.loadTexture("ImageTexture",{src:e,width:this.props.width,height:this.props.height,type:this.props.imageType,sx:this.props.srcX,sy:this.props.srcY,sw:this.props.srcWidth,sh:this.props.srcHeight})}}set imageType(e){this.props.imageType!==e&&(this.props.imageType=e)}get imageType(){return this.props.imageType||null}get srcHeight(){return this.props.srcHeight}set srcHeight(e){this.props.srcHeight=e}get srcWidth(){return this.props.srcWidth}set srcWidth(e){this.props.srcWidth=e}get srcX(){return this.props.srcX}set srcX(e){this.props.srcX=e}get srcY(){return this.props.srcY}set srcY(e){this.props.srcY=e}get framebufferDimensions(){return this.parentHasRenderTexture&&!this.rtt&&this.parent?this.parent.framebufferDimensions:{width:this.width,height:this.height}}get parentRenderTexture(){let e=this.parent;for(;e;){if(e.rtt)return e;e=e.parent}return null}get texture(){return this.props.texture}set texture(e){if(this.props.texture===e)return;const s=this.props.texture;s&&(s.setRenderableOwner(this,!1),this.unloadTexture()),this.props.texture=e,e&&(e.setRenderableOwner(this,this.isRenderable),this.loadTexture()),this.setUpdateType(w.IsRenderable)}set textureOptions(e){this.props.textureOptions=e}get textureOptions(){return this.props.textureOptions}setRTTUpdates(e){var s;this.hasRTTupdates=!0,(s=this.parent)==null||s.setRTTUpdates(e)}animate(e,s){const i=new co(this,e,s);return new ho(this.stage.animationManager,i)}flush(){}}const uo=r=>{let t=!1;const e=()=>{if(r.updateFrameTime(),r.updateAnimations(),!r.hasSceneUpdates()){r.calculateFps(),setTimeout(e,16.666666666666668),t||(r.txMemManager.checkCleanup()&&r.txMemManager.cleanup(),r.eventBus.emit("idle"),t=!0),r.flushFrameEvents();return}t=!1,r.drawFrame(),r.flushFrameEvents(),requestAnimationFrame(e)};requestAnimationFrame(e)},po=()=>performance?performance.now():Date.now();class mo{constructor(){f(this,"activeAnimations",new Set)}registerAnimation(t){this.activeAnimations.add(t)}unregisterAnimation(t){this.activeAnimations.delete(t)}update(t){this.activeAnimations.forEach(e=>{e.update(t)})}}class it extends Pe{constructor(e){super();f(this,"txManager");f(this,"dimensions",null);f(this,"error",null);f(this,"state","freed");f(this,"renderableOwners",new Set);f(this,"renderable",!1);f(this,"lastRenderableChangeTime",0);f(this,"preventCleanup",!1);this.txManager=e}setRenderableOwner(e,s){var o,a;const i=this.renderableOwners.size;if(s){this.renderableOwners.add(e);const n=this.renderableOwners.size;n>i&&n===1&&(this.renderable=!0,this.lastRenderableChangeTime=this.txManager.frameTime,(o=this.onChangeIsRenderable)==null||o.call(this,!0))}else{this.renderableOwners.delete(e);const n=this.renderableOwners.size;n<i&&n===0&&(this.renderable=!1,this.lastRenderableChangeTime=this.txManager.frameTime,(a=this.onChangeIsRenderable)==null||a.call(this,!1))}}get ctxTexture(){const e=this.txManager.renderer.createCtxTexture(this);return Object.defineProperty(this,"ctxTexture",{value:e}),e}setState(e,...s){if(this.state!==e){if(this.state=e,e==="loaded"){const i=s;this.dimensions=i[0]}else if(e==="failed"){const i=s;this.error=i[0]}this.emit(e,...s)}}static makeCacheKey(e){return!1}static resolveDefaults(e){return{}}}function go(){function r(e){return e.indexOf("image/png")!==-1}function t(e,s,i,o,a,n){return new Promise(function(l,c){var h=new XMLHttpRequest;h.open("GET",e,!0),h.responseType="blob",h.onload=function(){if(h.status!==200)return c(new Error("Failed to load image: "+h.statusText));var d=h.response,u=s!==void 0?s:r(d.type);if(a!==null&&n!==null){createImageBitmap(d,i||0,o||0,a,n,{premultiplyAlpha:u?"premultiply":"none",colorSpaceConversion:"none",imageOrientation:"none"}).then(function(x){l({data:x,premultiplyAlpha:s})}).catch(function(x){c(x)});return}createImageBitmap(d,{premultiplyAlpha:u?"premultiply":"none",colorSpaceConversion:"none",imageOrientation:"none"}).then(function(x){l({data:x,premultiplyAlpha:s})}).catch(function(x){c(x)})},h.onerror=function(){c(new Error("Network error occurred while trying to fetch the image."))},h.send()})}self.onmessage=e=>{var s=e.data.src,i=e.data.id,o=e.data.premultiplyAlpha,a=e.data.sx,n=e.data.sy,l=e.data.sw,c=e.data.sh;t(s,o,a,n,l,c).then(function(h){self.postMessage({id:i,src:s,data:h})}).catch(function(h){self.postMessage({id:i,src:s,error:h.message})})}}class xo{constructor(t){f(this,"imageWorkersEnabled",!0);f(this,"messageManager",{});f(this,"workers",[]);f(this,"workerIndex",0);f(this,"nextId",0);this.workers=this.createWorkers(t),this.workers.forEach(e=>{e.onmessage=this.handleMessage.bind(this)})}handleMessage(t){const{id:e,data:s,error:i}=t.data,o=this.messageManager[e];if(o){const[a,n]=o;delete this.messageManager[e],i?n(new Error(i)):a(s)}}createWorkers(t=1){const e=`(${go.toString()})()`,s=new Blob([e.replace('"use strict";',"")],{type:"application/javascript"}),i=(self.URL?URL:webkitURL).createObjectURL(s),o=[];for(let a=0;a<t;a++)o.push(new Worker(i));return o}getNextWorker(){const t=this.workers[this.workerIndex];return this.workerIndex=(this.workerIndex+1)%this.workers.length,t}getImage(t,e,s,i,o,a){return new Promise((n,l)=>{try{if(this.workers){const c=this.nextId++;this.messageManager[c]=[n,l];const h=this.getNextWorker();h&&h.postMessage({id:c,src:t,premultiplyAlpha:e,sx:s,sy:i,sw:o,sh:a})}}catch(c){l(c)}})}}const xt=class xt extends it{constructor(e,s){super(e);f(this,"props");this.props=xt.resolveDefaults(s||{})}get color(){return this.props.color}set color(e){this.props.color=e}async getTextureData(){const e=new Uint32Array([this.color]),s=new Uint8ClampedArray(e.buffer);return{data:new ImageData(s,1,1),premultiplyAlpha:!0}}static makeCacheKey(e){return`ColorTexture,${xt.resolveDefaults(e).color}`}static resolveDefaults(e){return{color:e.color||4294967295}}};f(xt,"z$__type__Props");let ds=xt;function yo(r){return/\.(ktx|pvr)$/.test(r)}const yr=async r=>{const e=await(await fetch(r)).arrayBuffer();return r.indexOf(".ktx")!==-1?To(e):bo(e)},To=async r=>{const t=new DataView(r),e=t.getUint32(12)===16909060,s=[],i={glInternalFormat:t.getUint32(28,e),pixelWidth:t.getUint32(36,e),pixelHeight:t.getUint32(40,e),numberOfMipmapLevels:t.getUint32(56,e),bytesOfKeyValueData:t.getUint32(60,e)};let o=64;o+=i.bytesOfKeyValueData;for(let a=0;a<i.numberOfMipmapLevels;a++){const n=t.getUint32(o);o+=4,s.push(t.buffer.slice(o,n)),o+=n}return{data:{glInternalFormat:i.glInternalFormat,mipmaps:s,width:i.pixelWidth||0,height:i.pixelHeight||0,type:"ktx"},premultiplyAlpha:!1}},bo=async r=>{const n=r,l=new Int32Array(n,0,13),c=l[12]+52,h=new Uint8Array(n,c),d=[],u={pixelWidth:l[7],pixelHeight:l[6],numberOfMipmapLevels:l[11]||0};let x=0,m=u.pixelWidth||0,g=u.pixelHeight||0;for(let b=0;b<u.numberOfMipmapLevels;b++){const T=(m+3>>2)*(g+3>>2)*8,_=new Uint8Array(n,h.byteOffset+x,T);d.push(_),x+=T,m=m>>1,g=g>>1}return{data:{glInternalFormat:36196,mipmaps:d,width:u.pixelWidth||0,height:u.pixelHeight||0,type:"pvr"},premultiplyAlpha:!1}};function So(r){return/\.(svg)$/.test(r)}const Tr=(r,t,e,s,i,o,a)=>new Promise((n,l)=>{const c=document.createElement("canvas"),h=c.getContext("2d");E(h),h.imageSmoothingEnabled=!0;const d=new Image;d.onload=()=>{const u=s??0,x=i??0,m=t||d.width,g=e||d.height;c.width=m,c.height=g,h.drawImage(d,0,0,m,g),n({data:h.getImageData(u,x,o??m,a??g),premultiplyAlpha:!1})},d.onerror=u=>{l(u)},d.src=r}),yt=class yt extends it{constructor(e,s){super(e);f(this,"props");this.props=yt.resolveDefaults(s)}hasAlphaChannel(e){return e.indexOf("image/png")!==-1}async loadImage(e){const{premultiplyAlpha:s,sx:i,sy:o,sw:a,sh:n,width:l,height:c}=this.props;if(this.txManager.imageWorkerManager!==null)return await this.txManager.imageWorkerManager.getImage(e,s,i,o,a,n);if(this.txManager.hasCreateImageBitmap===!0){const d=await(await fetch(e)).blob(),u=s??this.hasAlphaChannel(d.type);return a!==null&&n!==null?{data:await createImageBitmap(d,i??0,o??0,a,n,{premultiplyAlpha:u?"premultiply":"none",colorSpaceConversion:"none",imageOrientation:"none"}),premultiplyAlpha:u}:{data:await createImageBitmap(d,{premultiplyAlpha:u?"premultiply":"none",colorSpaceConversion:"none",imageOrientation:"none"}),premultiplyAlpha:u}}else{const h=new Image(l||void 0,c||void 0);return e.substr(0,5)!=="data:"&&(h.crossOrigin="Anonymous"),h.src=e,await new Promise((d,u)=>{h.onload=()=>d(),h.onerror=()=>u(new Error("Failed to load image"))}).catch(d=>{console.error(d)}),{data:h,premultiplyAlpha:s??!0}}}async getTextureData(){const{src:e,premultiplyAlpha:s,type:i}=this.props;if(e===null)return{data:null};if(typeof e!="string")return e instanceof ImageData?{data:e,premultiplyAlpha:s}:{data:e(),premultiplyAlpha:s};const o=oo(e);return i==="regular"?this.loadImage(o):i==="svg"?Tr(o,this.props.width,this.props.height,this.props.sx,this.props.sy,this.props.sw,this.props.sh):So(e)===!0?Tr(o,this.props.width,this.props.height,this.props.sx,this.props.sy,this.props.sw,this.props.sh):i==="compressed"||yo(e)===!0?yr(o):this.loadImage(o)}static makeCacheKey(e){const s=yt.resolveDefaults(e),i=s.key||s.src;if(typeof i!="string")return!1;let o="";return s.sh!==null&&s.sw!==null&&(o+=",",o+=s.sx??"",o+=s.sy??"",o+=s.sw||"",o+=s.sh||""),`ImageTexture,${i},${s.premultiplyAlpha??"true"}${o}`}static resolveDefaults(e){return{src:e.src??"",premultiplyAlpha:e.premultiplyAlpha??!0,key:e.key??null,type:e.type??null,width:e.width??null,height:e.height??null,sx:e.sx??null,sy:e.sy??null,sw:e.sw??null,sh:e.sh??null}}};f(yt,"z$__type__Props");let us=yt;const Tt=class Tt extends it{constructor(e,s){super(e);f(this,"props");this.props=Tt.resolveDefaults(s)}async getTextureData(){const{width:e,height:s}=this.props,i=e*s*4,o=new Uint8ClampedArray(i);for(let a=0;a<i;a+=4){const n=Math.floor(Math.random()*256);o[a]=n,o[a+1]=n,o[a+2]=n,o[a+3]=255}return{data:new ImageData(o,e,s)}}static makeCacheKey(e){if(e.cacheId===void 0)return!1;const s=Tt.resolveDefaults(e);return`NoiseTexture,${s.width},${s.height},${s.cacheId}`}static resolveDefaults(e){return{width:e.width??128,height:e.height??128,cacheId:e.cacheId??0}}};f(Tt,"z$__type__Props");let zs=Tt;const ys=class ys extends it{constructor(e,s){super(e);f(this,"props");f(this,"parentTexture");f(this,"onParentTxLoaded",()=>{this.setState("loaded",{width:this.props.width,height:this.props.height})});f(this,"onParentTxFailed",(e,s)=>{this.setState("failed",s)});this.props=ys.resolveDefaults(s||{}),this.parentTexture=this.props.texture,queueMicrotask(()=>{const i=this.parentTexture;i.state==="loaded"?this.onParentTxLoaded(i,i.dimensions):i.state==="failed"&&this.onParentTxFailed(i,i.error),i.on("loaded",this.onParentTxLoaded),i.on("failed",this.onParentTxFailed)})}onChangeIsRenderable(e){this.parentTexture.setRenderableOwner(this,e)}async getTextureData(){return{data:this.props}}static makeCacheKey(e){return!1}static resolveDefaults(e){return{texture:e.texture,x:e.x||0,y:e.y||0,width:e.width||0,height:e.height||0}}};f(ys,"z$__type__Props");let rt=ys;const Ts=class Ts extends it{constructor(e,s){super(e);f(this,"props");this.props=Ts.resolveDefaults(s||{})}get width(){return this.props.width}set width(e){this.props.width=e}get height(){return this.props.height}set height(e){this.props.height=e}async getTextureData(){return{data:null,premultiplyAlpha:null}}static resolveDefaults(e){return{width:e.width||256,height:e.height||256}}};f(Ts,"z$__type__Props");let bt=Ts;class wo{constructor(t){f(this,"keyCache",new Map);f(this,"inverseKeyCache",new WeakMap);f(this,"txConstructors",{});f(this,"imageWorkerManager",null);f(this,"hasCreateImageBitmap",!!self.createImageBitmap);f(this,"hasWorker",!!self.Worker);f(this,"renderer");f(this,"frameTime",0);this.hasCreateImageBitmap&&this.hasWorker&&t>0&&(this.imageWorkerManager=new xo(t)),this.hasCreateImageBitmap||console.warn("[Lightning] createImageBitmap is not supported on this browser. ImageTexture will be slower."),this.registerTextureType("ImageTexture",us),this.registerTextureType("ColorTexture",ds),this.registerTextureType("NoiseTexture",zs),this.registerTextureType("SubTexture",rt),this.registerTextureType("RenderTexture",bt)}registerTextureType(t,e){this.txConstructors[t]=e}loadTexture(t,e){let s;const i=this.txConstructors[t];if(!i)throw new Error(`Texture type "${t}" is not registered`);if(!s){const o=i.makeCacheKey(e);o&&this.keyCache.has(o)?s=this.keyCache.get(o):(s=new i(this,e),o&&this.initTextureToCache(s,o))}return s}initTextureToCache(t,e){const{keyCache:s,inverseKeyCache:i}=this;s.set(e,t),i.set(t,e)}removeTextureFromCache(t){const{inverseKeyCache:e,keyCache:s}=this,i=e.get(t);i&&s.delete(i)}}const Is=new Map,vo={normal:400,bold:700,bolder:900,lighter:100},br=r=>typeof r=="number"?r:vo[r]||400;function _o(r,t,e,s,i){let o=br(e);for(const a of r){const n=a[t];if(!n)continue;if(n.size===1)return console.warn(`TrFontManager: Only one font face found for family: '${t}' - will be used for all weights and styles`),n.values().next().value;const l=new Map;for(const h of n){const d=br(h.descriptors.weight);if(d===o&&h.descriptors.style===s&&h.descriptors.stretch===i)return h;l.set(d,h)}const c=`TrFontManager: No exact match: '${t} Weight: ${o} Style: ${s} Stretch: ${i}'`;if(console.error(c),o===400&&l.has(500))return l.get(500);if(o===500&&l.has(400))return l.get(400);if(o<400){for(;o>0;){if(l.has(o))return l.get(o);o-=100}o=600}for(;o<1e3;){if(l.has(o))return l.get(o);o+=100}for(o=500;o>0;){if(l.has(o))return l.get(o);o-=100}}}class sr{constructor(t){f(this,"textRenderers");this.textRenderers=t}addFontFace(t){for(const e in this.textRenderers){const s=this.textRenderers[e];s&&s.isFontFaceSupported(t)&&s.addFontFace(t)}}static resolveFontFace(t,e){const{fontFamily:s,fontWeight:i,fontStyle:o,fontStretch:a}=e,n=`${s}${o}${i}${a}`;if(Is.has(n)===!0)return Is.get(n);const l=_o(t,s,i,o,a);return l!==void 0&&Is.set(n,l),l}}class Hr{static makeCacheKey(t){return!1}static resolveDefaults(t){return{}}}function Sr(r,t,e){const s=r.createShader(t);if(!s)throw new Error;if(r.shaderSource(s,e),r.compileShader(s),r.getShaderParameter(s,r.COMPILE_STATUS))return s;console.log(r.getShaderInfoLog(s)),r.deleteShader(s)}function Ro(r,t,e){const s=r.createProgram();if(!s)throw new Error;if(r.attachShader(s,t),r.attachShader(s,e),r.linkProgram(s),r.getProgramParameter(s,r.LINK_STATUS))return s;console.log(r.getProgramInfoLog(s)),r.deleteProgram(s)}class Fe extends Hr{constructor(e){super();f(this,"boundBufferCollection",null);f(this,"buffersBound",!1);f(this,"program");f(this,"vao");f(this,"renderer");f(this,"glw");f(this,"attributeBuffers");f(this,"attributeLocations");f(this,"attributeNames");f(this,"uniformLocations");f(this,"uniformTypes");f(this,"supportsIndexedTextures");const s=this.renderer=e.renderer,i=this.glw=this.renderer.glw;this.supportsIndexedTextures=e.supportsIndexedTextures||!1;const o=i.isWebGl2(),a=o&&e.webgl2Extensions||!o&&e.webgl1Extensions||[],n=o?"2.0":"1.0";a.forEach(g=>{if(!i.getExtension(g))throw new Error(`Shader "${this.constructor.name}" requires extension "${g}" for WebGL ${n} but wasn't found`)});const l=e.shaderSources||this.constructor.shaderSources;if(l)o&&(l!=null&&l.webGl2)&&(l.fragment=l.webGl2.fragment,l.vertex=l.webGl2.vertex,delete l.webGl2);else throw new Error(`Shader "${this.constructor.name}" is missing shaderSources.`);const c=s.system.parameters.MAX_VERTEX_TEXTURE_IMAGE_UNITS,h=l.vertex instanceof Function?l.vertex(c):l.vertex,d=l.fragment instanceof Function?l.fragment(c):l.fragment,u=Sr(i,i.VERTEX_SHADER,h),x=Sr(i,i.FRAGMENT_SHADER,d);if(!u||!x)throw new Error;const m=Ro(i,u,x);if(!m)throw new Error;if(this.program=m,o){const g=i.createVertexArray();if(!g)throw new Error;this.vao=g,i.bindVertexArray(this.vao)}this.attributeLocations={},this.attributeBuffers={},this.attributeNames=[],[...e.attributes].forEach(g=>{const b=i.getAttribLocation(this.program,g);if(b<0)throw new Error(`${this.constructor.name}: Vertex shader must have an attribute "${g}"!`);const T=i.createBuffer();if(!T)throw new Error(`${this.constructor.name}: Could not create buffer for attribute "${g}"`);this.attributeLocations[g]=b,this.attributeBuffers[g]=T,this.attributeNames.push(g)}),this.uniformLocations={},this.uniformTypes={},e.uniforms.forEach(g=>{const b=i.getUniformLocation(this.program,g.name);if(this.uniformTypes[g.name]=g.uniform,!b){console.warn(`Shader "${this.constructor.name}" could not get uniform location for "${g.name}"`);return}this.uniformLocations[g.name]=b})}bindBufferAttribute(e,s,i){const{glw:o}=this;o.enableVertexAttribArray(e),o.vertexAttribPointer(s,e,i.size,i.type,i.normalized,i.stride,i.offset)}disableAttribute(e){this.glw.disableVertexAttribArray(e)}disableAttributes(){for(const e in this.attributeLocations)this.disableAttribute(this.attributeLocations[e]);this.boundBufferCollection=null}canBatchShaderProps(e,s){return!1}bindRenderOp(e,s){this.bindBufferCollection(e.buffers),e.textures.length>0&&this.bindTextures(e.textures);const{glw:i,parentHasRenderTexture:o,renderToTexture:a}=e;if(!(a&&o)){if(o){const{width:n,height:l}=e.framebufferDimensions||{};this.setUniform("u_pixelRatio",1),this.setUniform("u_resolution",new Float32Array([n??0,l??0]))}else this.setUniform("u_pixelRatio",e.options.pixelRatio),this.setUniform("u_resolution",new Float32Array([i.canvas.width,i.canvas.height]));if(s){if(cs(s,"$dimensions")){let n=s.$dimensions;n||(n=e.dimensions),this.setUniform("u_dimensions",[n.width,n.height])}if(cs(s,"$alpha")){let n=s.$alpha;n||(n=e.alpha),this.setUniform("u_alpha",n)}this.bindProps(s)}}}setUniform(e,...s){this.glw.setUniform(this.uniformTypes[e],this.uniformLocations[e],...s)}bindBufferCollection(e){if(this.boundBufferCollection!==e){for(const s in this.attributeLocations){const i=e.getBuffer(s),o=e.getAttributeInfo(s);E(i,`Buffer for "${s}" not found`),E(o),this.bindBufferAttribute(this.attributeLocations[s],i,o)}this.boundBufferCollection=e}}bindProps(e){}bindTextures(e){}attach(){this.glw.useProgram(this.program),this.glw.useProgram(this.program),this.glw.isWebGl2()&&this.vao&&this.glw.bindVertexArray(this.vao)}detach(){this.disableAttributes()}}f(Fe,"shaderSources");class Yr extends Fe{constructor(t){super({renderer:t,attributes:["a_position","a_textureCoordinate","a_color"],uniforms:[{name:"u_resolution",uniform:"uniform2fv"},{name:"u_pixelRatio",uniform:"uniform1f"},{name:"u_texture",uniform:"uniform2fv"}]})}bindTextures(t){const{glw:e}=this;e.activeTexture(0),e.bindTexture(t[0].ctxTexture)}}f(Yr,"shaderSources",{vertex:`
      # ifdef GL_FRAGMENT_PRECISION_HIGH
      precision highp float;
      # else
      precision mediump float;
      # endif

      attribute vec2 a_position;
      attribute vec2 a_textureCoordinate;
      attribute vec4 a_color;

      uniform vec2 u_resolution;
      uniform float u_pixelRatio;


      varying vec4 v_color;
      varying vec2 v_textureCoordinate;

      void main() {
        vec2 normalized = a_position * u_pixelRatio;
        vec2 screenSpace = vec2(2.0 / u_resolution.x, -2.0 / u_resolution.y);

        v_color = a_color;
        v_textureCoordinate = a_textureCoordinate;

        gl_Position = vec4(normalized.x * screenSpace.x - 1.0, normalized.y * -abs(screenSpace.y) + 1.0, 0.0, 1.0);
        gl_Position.y = -sign(screenSpace.y) * gl_Position.y;
      }
    `,fragment:`
      # ifdef GL_FRAGMENT_PRECISION_HIGH
      precision highp float;
      # else
      precision mediump float;
      # endif

      uniform vec2 u_resolution;
      uniform sampler2D u_texture;

      varying vec4 v_color;
      varying vec2 v_textureCoordinate;

      void main() {
          vec4 color = texture2D(u_texture, v_textureCoordinate);
          gl_FragColor = vec4(v_color) * texture2D(u_texture, v_textureCoordinate);
      }
    `});class Kr extends Fe{constructor(e){super({renderer:e,attributes:["a_position","a_textureCoordinate","a_color","a_textureIndex"],uniforms:[{name:"u_resolution",uniform:"uniform2fv"},{name:"u_pixelRatio",uniform:"uniform1f"},{name:"u_textures[0]",uniform:"uniform1iv"}]});f(this,"supportsIndexedTextures",!0)}bindTextures(e){const{renderer:s,glw:i}=this;if(e.length>s.system.parameters.MAX_VERTEX_TEXTURE_IMAGE_UNITS)throw new Error(`DefaultShaderBatched: Cannot bind more than ${s.system.parameters.MAX_VERTEX_TEXTURE_IMAGE_UNITS} textures`);e.forEach((a,n)=>{i.activeTexture(n),i.bindTexture(a.ctxTexture)});const o=Array.from(Array(e.length).keys());this.setUniform("u_textures[0]",o)}}f(Kr,"shaderSources",{vertex:`
      # ifdef GL_FRAGMENT_PRECISION_HIGH
      precision highp float;
      # else
      precision mediump float;
      # endif

      attribute vec2 a_textureCoordinate;
      attribute vec2 a_position;
      attribute vec4 a_color;
      attribute float a_textureIndex;
      attribute float a_depth;

      uniform vec2 u_resolution;
      uniform float u_pixelRatio;

      varying vec4 v_color;
      varying vec2 v_textureCoordinate;
      varying float v_textureIndex;

      void main(){
        vec2 normalized = a_position * u_pixelRatio / u_resolution;
        vec2 zero_two = normalized * 2.0;
        vec2 clip_space = zero_two - 1.0;

        // pass to fragment
        v_color = a_color;
        v_textureCoordinate = a_textureCoordinate;
        v_textureIndex = a_textureIndex;

        // flip y
        gl_Position = vec4(clip_space * vec2(1.0, -1.0), 0, 1);
      }
    `,fragment:e=>`
      #define txUnits ${e}
      # ifdef GL_FRAGMENT_PRECISION_HIGH
      precision highp float;
      # else
      precision mediump float;
      # endif

      uniform vec2 u_resolution;
      uniform sampler2D u_image;
      uniform sampler2D u_textures[txUnits];

      varying vec4 v_color;
      varying vec2 v_textureCoordinate;
      varying float v_textureIndex;

      vec4 sampleFromTexture(sampler2D textures[${e}], int idx, vec2 uv) {
        ${Array.from(Array(e).keys()).map(s=>`
          ${s!==0?"else ":""}if (idx == ${s}) {
            return texture2D(textures[${s}], uv);
          }
        `).join("")}
        return texture2D(textures[0], uv);
      }

      void main(){
        gl_FragColor = vec4(v_color) * sampleFromTexture(u_textures, int(v_textureIndex), v_textureCoordinate);
      }
    `});class te{constructor(t){f(this,"priority",1);f(this,"name","");f(this,"ref");f(this,"target");f(this,"passParameters","");f(this,"declaredUniforms","");f(this,"uniformInfo",{});const{ref:e,target:s,props:i={}}=t;this.ref=e,this.target=s;const o={},a=[];let n="";const l=this.constructor.uniforms||{};for(const c in l){const h=l[c],d=h.type,u=`${e}_${c}`;let x="";h.size&&(x=`[${h.size(i)}]`),a.push(u),n+=`uniform ${d} ${u}${x};`,o[c]={name:u,uniform:l[c].method}}this.passParameters=a.join(","),this.declaredUniforms=n,this.uniformInfo=o}static getEffectKey(t){return""}static getMethodParameters(t,e){const s=[];for(const i in t){const o=t[i];let a="";o.size&&(a=`[${o.size(e)}]`),s.push(`${o.type} ${i}${a}`)}return s.join(",")}static resolveDefaults(t){return{}}static makeEffectKey(t){return!1}}f(te,"uniforms",{}),f(te,"methods"),f(te,"onShaderMask"),f(te,"onColorize"),f(te,"onEffectMask");const Ls=new Map,Co=(r,t)=>{const e=JSON.stringify(r);if(Ls.has(e))return Ls.get(e);r=r??[];const s=[],i=r.length;let o=0;for(;o<i;o++){const{name:a,type:n,props:l}=r[o],c={name:a,type:n,props:{}},h=t[n],d=h.resolveDefaults(l),u=h.uniforms,x=Object.keys(u),m=x.length;let g=0;for(;g<m;g++){const b=x[g],T=u[b],_={value:d[b],programValue:void 0,updateOnBind:T.updateOnBind||!1,hasValidator:T.validator!==void 0,hasProgramValueUpdater:T.updateProgramValue!==void 0},C=_.hasValidator&&T.validator(d[b],d)||d[b];d[b]!==C&&(_.validatedValue=C),_.hasProgramValueUpdater&&T.updateProgramValue(_),_.programValue===void 0&&(_.programValue=_.value),c.props[b]=_}s.push(c)}return Ls.set(e,s),s},de=class de extends Fe{constructor(e,s,i){const o=de.createShader(s,i);super({renderer:e,attributes:["a_position","a_textureCoordinate","a_color"],uniforms:[{name:"u_resolution",uniform:"uniform2fv"},{name:"u_pixelRatio",uniform:"uniform1f"},{name:"u_texture",uniform:"uniform2fv"},{name:"u_dimensions",uniform:"uniform2fv"},{name:"u_alpha",uniform:"uniform1f"},...o.uniforms],shaderSources:{vertex:o.vertex,fragment:o.fragment}});f(this,"effects",[]);this.effects=o.effects}bindTextures(e){const{glw:s}=this;s.activeTexture(0),s.bindTexture(e[0].ctxTexture)}bindProps(e){var a;const s=e.effects,i=s.length;let o=0;for(;o<i;o++){const n=s[o],l=this.effects[o].uniformInfo,c=Object.keys(n.props),h=c.length;let d=0;for(;d<h;d++){const u=c[d];if(n.props[u].updateOnBind===!0){const m=(a=this.renderer.shManager.getRegisteredEffects()[n.type])==null?void 0:a.uniforms[u];m==null||m.updateProgramValue(n.props[u],e)}this.setUniform(l[u].name,n.props[u].programValue)}}}canBatchShaderProps(e,s){if(e.$alpha!==s.$alpha||e.$dimensions.width!==s.$dimensions.width||e.$dimensions.height!==s.$dimensions.height||e.effects.length!==s.effects.length)return!1;const i=e.effects.length;let o=0;for(;o<i;o++){const a=e.effects[o],n=s.effects[o];if(a.type!==n.type)return!1;for(const l in a.props)if(n.props&&!n.props[l]||a.props[l].value!==n.props[l].value)return!1}return!0}static createShader(e,s){const i={},o={};let a="";const n=[],l=[],c=e.effects.map(m=>{const g=s[m.type],b=g.getEffectKey(m.props||{});i[b]=i[b]?++i[b]:1;const T=i[b];T===1&&l.push({key:b,type:m.type,props:m.props});const _=new g({ref:`${b}${T===1?"":T}`,target:b,props:m.props});return a+=_.declaredUniforms,n.push(...Object.values(_.uniformInfo)),_});let h="";l==null||l.forEach(m=>{const g=s[m.type],b=g.resolveDefaults(m.props??{}),T=[];for(const I in g.methods){let L=I;const F=g.methods[I];o[I]&&o[I]!==F&&(L=de.resolveMethodDuplicate(I,F,o)),o[L]=F.replace("function",L),T.push({m:I,cm:L})}let _=g.onShaderMask instanceof Function?g.onShaderMask(b):g.onShaderMask,C=g.onColorize instanceof Function?g.onColorize(b):g.onColorize,S=g.onEffectMask instanceof Function?g.onEffectMask(b):g.onEffectMask;T.forEach(I=>{const{m:L,cm:F}=I,M=new RegExp(`\\$${L}`,"g");_&&(_=_.replace(M,F)),C&&(C=C.replace(M,F)),S&&(S=S.replace(M,F))});const P=g.getMethodParameters(g.uniforms,b),G=P.length>0?`, ${P}`:"";_&&(h+=`
        float fx_${m.key}_onShaderMask(float shaderMask ${G}) {
          ${_}
        }
        `),C&&(h+=`
          vec4 fx_${m.key}_onColorize(float shaderMask, vec4 maskColor, vec4 shaderColor${G}) {
            ${C}
          }
        `),S&&(h+=`
          vec4 fx_${m.key}_onEffectMask(float shaderMask, vec4 maskColor, vec4 shaderColor${G}) {
            ${S}
          }
        `)});let d="";for(const m in o)d+=o[m];let u="mix(shaderColor, maskColor, clamp(-(lng_DefaultMask), 0.0, 1.0))",x=`

    `;for(let m=0;m<c.length;m++){const g=c[m],b=g.passParameters.length>0?`, ${g.passParameters}`:"",T=s[g.name];T.onShaderMask&&(x+=`
        shaderMask = fx_${g.target}_onShaderMask(shaderMask ${b});
        `),T.onColorize&&(x+=`
        maskColor = fx_${g.target}_onColorize(shaderMask, maskColor, shaderColor${b});
        `),T.onEffectMask&&(u=`fx_${g.target}_onEffectMask(shaderMask, maskColor, shaderColor${b})`);const _=c[m+1];(_===void 0||s[_.name].onEffectMask)&&(x+=`
          shaderColor = ${u};
        `)}return{effects:c,uniforms:n,fragment:de.fragment(a,d,h,x),vertex:de.vertex()}}static resolveMethodDuplicate(e,s,i,o=0){const a=e+(o>0?o:"");return i[a]&&i[a]!==s?this.resolveMethodDuplicate(e,s,i,++o):a}static resolveDefaults(e,s){return E(s),{effects:Co(e.effects??[],s),$dimensions:{width:0,height:0},$alpha:0}}static makeCacheKey(e,s){var o;let i="";return(o=e.effects)==null||o.forEach(a=>{const l=s[a.type].getEffectKey(a.props||{});i+=`,${l}`}),`DynamicShader${i}`}};f(de,"z$__type__Props"),f(de,"vertex",()=>`
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision mediump float;
    # endif

    attribute vec2 a_textureCoordinate;
    attribute vec2 a_position;
    attribute vec4 a_color;
    attribute float a_textureIndex;

    uniform vec2 u_resolution;
    uniform float u_pixelRatio;

    varying vec4 v_color;
    varying vec2 v_textureCoordinate;
    varying float v_textureIndex;

    void main(){
      vec2 normalized = a_position * u_pixelRatio / u_resolution;
      vec2 zero_two = normalized * 2.0;
      vec2 clip_space = zero_two - 1.0;

      // pass to fragment
      v_color = a_color;
      v_textureCoordinate = a_textureCoordinate;
      v_textureIndex = a_textureIndex;

      // flip y
      gl_Position = vec4(clip_space * vec2(1.0, -1.0), 0, 1);
    }
  `),f(de,"fragment",(e,s,i,o)=>`
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision mediump float;
    # endif

    #define PI 3.14159265359

    uniform vec2 u_resolution;
    uniform vec2 u_dimensions;
    uniform float u_alpha;
    uniform float u_radius;
    uniform sampler2D u_texture;
    uniform float u_pixelRatio;

    ${e}

    varying vec4 v_color;
    varying vec2 v_textureCoordinate;

    ${s}

    ${i}

    void main() {
      vec2 p = v_textureCoordinate.xy * u_dimensions - u_dimensions * 0.5;
      vec2 d = abs(p) - (u_dimensions) * 0.5;
      float lng_DefaultMask = min(max(d.x, d.y), 0.0) + length(max(d, 0.0));

      vec4 shaderColor = vec4(0.0);
      float shaderMask = lng_DefaultMask;

      vec4 maskColor = texture2D(u_texture, v_textureCoordinate) * v_color;

      shaderColor = mix(shaderColor, maskColor, clamp(-(lng_DefaultMask + 0.5), 0.0, 1.0));

      ${o}

      gl_FragColor = shaderColor * u_alpha;
    }
  `);let Je=de;class Xs extends Fe{constructor(t){super({renderer:t,attributes:["a_position","a_textureCoordinate","a_color"],uniforms:[{name:"u_resolution",uniform:"uniform2fv"},{name:"u_pixelRatio",uniform:"uniform1f"},{name:"u_texture",uniform:"uniform2f"},{name:"u_dimensions",uniform:"uniform2fv"},{name:"u_radius",uniform:"uniform1f"}]})}static resolveDefaults(t){return{radius:t.radius||10,$dimensions:{width:0,height:0}}}bindTextures(t){const{glw:e}=this;e.activeTexture(0),e.bindTexture(t[0].ctxTexture)}bindProps(t){const e=Math.min(t.$dimensions.width,t.$dimensions.height)/(2*t.radius);this.setUniform("u_radius",t.radius*Math.min(e,1))}canBatchShaderProps(t,e){return t.radius===e.radius&&t.$dimensions.width===e.$dimensions.width&&t.$dimensions.height===e.$dimensions.height}}f(Xs,"z$__type__Props"),f(Xs,"shaderSources",{vertex:`
      # ifdef GL_FRAGMENT_PRECISION_HIGH
      precision highp float;
      # else
      precision mediump float;
      # endif

      attribute vec2 a_position;
      attribute vec2 a_textureCoordinate;
      attribute vec4 a_color;
      attribute float a_textureIndex;
      attribute float a_depth;

      uniform vec2 u_resolution;
      uniform float u_pixelRatio;

      varying vec4 v_color;
      varying vec2 v_textureCoordinate;

      void main() {
        vec2 normalized = a_position * u_pixelRatio / u_resolution;
        vec2 zero_two = normalized * 2.0;
        vec2 clip_space = zero_two - 1.0;

        // pass to fragment
        v_color = a_color;
        v_textureCoordinate = a_textureCoordinate;

        // flip y
        gl_Position = vec4(clip_space * vec2(1.0, -1.0), 0, 1);
      }
    `,fragment:`
      # ifdef GL_FRAGMENT_PRECISION_HIGH
      precision highp float;
      # else
      precision mediump float;
      # endif

      uniform vec2 u_resolution;
      uniform vec2 u_dimensions;
      uniform float u_radius;
      uniform sampler2D u_texture;

      varying vec4 v_color;
      varying vec2 v_textureCoordinate;

      float boxDist(vec2 p, vec2 size, float radius){
        size -= vec2(radius);
        vec2 d = abs(p) - size;
        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0)) - radius;
      }

      float fillMask(float dist) {
        return clamp(-dist, 0.0, 1.0);
      }

      void main() {
        vec4 color = texture2D(u_texture, v_textureCoordinate) * v_color;
        vec2 halfDimensions = u_dimensions * 0.5;

        float d = boxDist(v_textureCoordinate.xy * u_dimensions - halfDimensions, halfDimensions + 0.5, u_radius);
        gl_FragColor = mix(vec4(0.0), color, fillMask(d));
      }
    `});const Eo=new Float32Array([1,0,0,0,1,0,0,0,1]),bs=class bs extends Fe{constructor(t){super({renderer:t,attributes:["a_position","a_textureCoordinate"],uniforms:[{name:"u_resolution",uniform:"uniform2fv"},{name:"u_transform",uniform:"uniformMatrix3fv"},{name:"u_scrollY",uniform:"uniform1f"},{name:"u_pixelRatio",uniform:"uniform1f"},{name:"u_texture",uniform:"uniform2f"},{name:"u_color",uniform:"uniform4fv"},{name:"u_size",uniform:"uniform1f"},{name:"u_distanceRange",uniform:"uniform1f"},{name:"u_debug",uniform:"uniform1i"}]})}bindTextures(t){const{glw:e}=this;e.activeTexture(0),e.bindTexture(t[0].ctxTexture)}bindProps(t){const e=bs.resolveDefaults(t);for(const s in e)if(s==="transform")this.setUniform("u_transform",!1,e[s]);else if(s==="scrollY")this.setUniform("u_scrollY",e[s]);else if(s==="color"){const i=wt(e.color);this.setUniform("u_color",i)}else s==="size"?this.setUniform("u_size",e[s]):s==="distanceRange"?this.setUniform("u_distanceRange",e[s]):s==="debug"&&this.setUniform("u_debug",e[s]?1:0)}static resolveDefaults(t={}){return{transform:t.transform??Eo,scrollY:t.scrollY??0,color:t.color??4294967295,size:t.size??16,distanceRange:t.distanceRange??1,debug:t.debug??!1}}};f(bs,"shaderSources",{vertex:`
      # ifdef GL_FRAGMENT_PRECISION_HIGH
      precision highp float;
      # else
      precision mediump float;
      # endif
      // an attribute is an input (in) to a vertex shader.
      // It will receive data from a buffer
      attribute vec2 a_position;
      attribute vec2 a_textureCoordinate;

      uniform vec2 u_resolution;
      uniform mat3 u_transform;
      uniform float u_scrollY;
      uniform float u_pixelRatio;
      uniform float u_size;

      varying vec2 v_texcoord;

      void main() {
        vec2 scrolledPosition = a_position * u_size - vec2(0, u_scrollY);
        vec2 transformedPosition = (u_transform * vec3(scrolledPosition, 1)).xy;

        // Calculate screen space with pixel ratio
        vec2 screenSpace = (transformedPosition * u_pixelRatio / u_resolution * 2.0 - 1.0) * vec2(1, -1);

        gl_Position = vec4(screenSpace, 0.0, 1.0);
        v_texcoord = a_textureCoordinate;

      }
    `,fragment:`
      # ifdef GL_FRAGMENT_PRECISION_HIGH
      precision highp float;
      # else
      precision mediump float;
      # endif
      uniform vec4 u_color;
      uniform sampler2D u_texture;
      uniform float u_distanceRange;
      uniform float u_pixelRatio;
      uniform int u_debug;

      varying vec2 v_texcoord;

      float median(float r, float g, float b) {
          return max(min(r, g), min(max(r, g), b));
      }

      void main() {
          vec3 sample = texture2D(u_texture, v_texcoord).rgb;
          if (u_debug == 1) {
            gl_FragColor = vec4(sample.r, sample.g, sample.b, 1.0);
            return;
          }
          float scaledDistRange = u_distanceRange * u_pixelRatio;
          float sigDist = scaledDistRange * (median(sample.r, sample.g, sample.b) - 0.5);
          float opacity = clamp(sigDist + 0.5, 0.0, 1.0) * u_color.a;

          // Build the final color.
          // IMPORTANT: We must premultiply the color by the alpha value before returning it.
          gl_FragColor = vec4(u_color.r * opacity, u_color.g * opacity, u_color.b * opacity, opacity);
      }
    `});let Gs=bs;const ot=r=>{r.programValue===void 0&&(r.programValue=new Float32Array(4));const t=r.value,e=r.programValue;e[0]=(t>>>24)/255,e[1]=(t>>>16&255)/255,e[2]=(t>>>8&255)/255,e[3]=(t&255)/255},Ao=r=>{const t=r.validatedValue||r.value;if(r.programValue instanceof Float32Array){const e=r.programValue;e[0]=t[0],e[1]=t[1]}else r.programValue=new Float32Array(t)},Mo=r=>{const t=r.validatedValue||r.value;if(r.programValue instanceof Float32Array){const e=r.programValue;e[0]=t[0],e[1]=t[1],e[2]=t[1],e[3]=t[1]}else r.programValue=new Float32Array(t)},jr=r=>{const t=r.validatedValue||r.value;if(r.programValue instanceof Float32Array){const e=t.length,s=r.programValue;for(let i=0;i<e;i++)s[i]=t[i]}else r.programValue=new Float32Array(t)},rr=r=>{const t=Array.isArray(r);if(t){if(t&&r.length===4)return r;if(t&&r.length===2)return[r[0],r[1],r[0],r[1]];if(t&&r.length===3)return[r[0],r[1],r[2],r[0]]}else return[r,r,r,r];return[r[0],r[0],r[0],r[0]]},qr=(r,t)=>{r.programValue===void 0&&(r.programValue=new Float32Array(4));const e=r.programValue,s=r.validatedValue||r.value;if(t===void 0&&r.$dimensions===void 0){e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3];return}let i=r.$dimensions;if(t!==void 0){const{$dimensions:u}=t;if(i!==void 0&&(i.width===u.width||i.height===u.height))return;i===void 0&&(i={width:u==null?void 0:u.width,height:u==null?void 0:u.height},r.$dimensions=i)}const{width:o,height:a}=i,[n,l,c,h]=s,d=Math.min(Math.min(Math.min(o/Math.max(o,n+l),o/Math.max(o,c+h)),Math.min(a/Math.max(a,n+c),a/Math.max(a,l+h))),1);e[0]=n*d,e[1]=l*d,e[2]=c*d,e[3]=h*d};class We extends te{constructor(){super(...arguments);f(this,"name","radius")}static getEffectKey(){return"radius"}static resolveDefaults(e){return{radius:e.radius??10}}}f(We,"z$__type__Props"),f(We,"uniforms",{radius:{value:0,method:"uniform4fv",type:"vec4",updateOnBind:!0,validator:rr,updateProgramValue:qr}}),f(We,"methods",{fillMask:`
      float function(float dist) {
        return clamp(-dist, 0.0, 1.0);
      }
    `,boxDist:`
      float function(vec2 p, vec2 size, float radius) {
        size -= vec2(radius);
        vec2 d = abs(p) - size;
        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0)) - radius;
      }
    `}),f(We,"onShaderMask",`
  vec2 halfDimensions = u_dimensions * 0.5;
  float r = radius[0] * step(v_textureCoordinate.x, 0.5) * step(v_textureCoordinate.y, 0.5);
  r = r + radius[1] * step(0.5, v_textureCoordinate.x) * step(v_textureCoordinate.y, 0.5);
  r = r + radius[2] * step(0.5, v_textureCoordinate.x) * step(0.5, v_textureCoordinate.y);
  r = r + radius[3] * step(v_textureCoordinate.x, 0.5) * step(0.5, v_textureCoordinate.y);
  return $boxDist(v_textureCoordinate.xy * u_dimensions - halfDimensions, halfDimensions, r);
  `),f(We,"onEffectMask",`
  return mix(vec4(0.0), maskColor, $fillMask(shaderMask));
  `);class dt extends te{constructor(){super(...arguments);f(this,"name","border")}static getEffectKey(){return"border"}static resolveDefaults(e){return{width:e.width??10,color:e.color??4294967295}}}f(dt,"z$__type__Props"),f(dt,"uniforms",{width:{value:0,method:"uniform1f",type:"float"},color:{value:4294967295,updateProgramValue:ot,method:"uniform4fv",type:"vec4"}}),f(dt,"onEffectMask",`
  float intR = shaderMask + 1.0;
  float mask = clamp(intR + width, 0.0, 1.0) - clamp(intR, 0.0, 1.0);
  return mix(shaderColor, mix(shaderColor, maskColor, maskColor.a), mask);
  `),f(dt,"onColorize",`
    return color;
  `);const Ae=class Ae extends te{constructor(){super(...arguments);f(this,"name","linearGradient")}static getEffectKey(e){return`linearGradient${e.colors.length}`}static resolveDefaults(e){const s=e.colors??[4278190080,4294967295];let i=e.stops||[];if(i.length===0||i.length!==s.length){const o=s.length;let a=0;const n=i;for(;a<o;a++)i[a]?(n[a]=i[a],i[a-1]===void 0&&n[a-2]!==void 0&&(n[a-1]=n[a-2]+(i[a]-n[a-2])/2)):n[a]=a*(1/(s.length-1));i=n}return{colors:s,stops:i,angle:e.angle??0}}};f(Ae,"z$__type__Props"),f(Ae,"uniforms",{angle:{value:0,method:"uniform1f",type:"float"},colors:{value:4294967295,validator:e=>e.reduce((s,i)=>s.concat(wt(i)),[]),updateProgramValue:jr,size:e=>e.colors.length,method:"uniform4fv",type:"vec4"},stops:{value:[],size:e=>e.colors.length,method:"uniform1fv",type:"float"}}),f(Ae,"methods",{fromLinear:`
      vec4 function(vec4 linearRGB) {
        vec4 higher = vec4(1.055)*pow(linearRGB, vec4(1.0/2.4)) - vec4(0.055);
        vec4 lower = linearRGB * vec4(12.92);
        return mix(higher, lower, 1.0);
      }
    `,toLinear:`
      vec4 function(vec4 sRGB) {
        vec4 higher = pow((sRGB + vec4(0.055))/vec4(1.055), vec4(2.4));
        vec4 lower = sRGB/vec4(12.92);
        return mix(higher, lower, 1.0);
      }
    `,calcPoint:`
      vec2 function(float d, float angle) {
        return d * vec2(cos(angle), sin(angle)) + (u_dimensions * 0.5);
      }
    `}),f(Ae,"ColorLoop",e=>{let s="";for(let i=2;i<e;i++)s+=`colorOut = mix(colorOut, colors[${i}], clamp((dist - stops[${i-1}]) / (stops[${i}] - stops[${i-1}]), 0.0, 1.0));`;return s}),f(Ae,"onColorize",e=>{const s=e.colors.length||1;return`
      float a = angle - (PI / 180.0 * 90.0);
      float lineDist = abs(u_dimensions.x * cos(a)) + abs(u_dimensions.y * sin(a));
      vec2 f = $calcPoint(lineDist * 0.5, a);
      vec2 t = $calcPoint(lineDist * 0.5, a + PI);
      vec2 gradVec = t - f;
      float dist = dot(v_textureCoordinate.xy * u_dimensions - f, gradVec) / dot(gradVec, gradVec);

      float stopCalc = (dist - stops[0]) / (stops[1] - stops[0]);
      vec4 colorOut = $fromLinear(mix($toLinear(colors[0]), $toLinear(colors[1]), stopCalc));
      ${Ae.ColorLoop(s)}
      return mix(maskColor, colorOut, clamp(colorOut.a, 0.0, 1.0));
    `});let Ws=Ae;class Vs extends te{constructor(){super(...arguments);f(this,"name","grayscale")}static getEffectKey(){return"grayscale"}static resolveDefaults(e){return{amount:e.amount??1}}}f(Vs,"uniforms",{amount:{value:1,method:"uniform1f",type:"float"}}),f(Vs,"onColorize",`
    float grayness = 0.2 * maskColor.r + 0.6 * maskColor.g + 0.2 * maskColor.b;
    return vec4(amount * vec3(grayness) + (1.0 - amount) * maskColor.rgb, maskColor.a);
  `);class Ve extends te{constructor(){super(...arguments);f(this,"name","borderRight")}static getEffectKey(){return"borderRight"}static resolveDefaults(e){return{width:e.width??10,color:e.color??4294967295}}}f(Ve,"z$__type__Props"),f(Ve,"uniforms",{width:{value:0,method:"uniform1f",type:"float"},color:{value:4294967295,updateProgramValue:ot,method:"uniform4fv",type:"vec4"}}),f(Ve,"methods",{fillMask:`
      float function(float dist) {
        return clamp(-dist, 0.0, 1.0);
      }
    `,rectDist:`
      float function(vec2 p, vec2 size) {
        vec2 d = abs(p) - size;
        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));
      }
    `}),f(Ve,"onEffectMask",`
  vec2 pos = vec2(u_dimensions.x - width * 0.5, 0.0);
  float mask = $rectDist(v_textureCoordinate.xy * u_dimensions - pos, vec2(width*0.5, u_dimensions.y));
  return mix(shaderColor, maskColor, $fillMask(mask));
  `),f(Ve,"onColorize",`
    return color;
  `);class He extends te{constructor(){super(...arguments);f(this,"name","borderTop")}static getEffectKey(){return"borderTop"}static resolveDefaults(e){return{width:e.width??10,color:e.color??4294967295}}}f(He,"z$__type__Props"),f(He,"uniforms",{width:{value:0,method:"uniform1f",type:"float"},color:{value:4294967295,updateProgramValue:ot,method:"uniform4fv",type:"vec4"}}),f(He,"methods",{fillMask:`
      float function(float dist) {
        return clamp(-dist, 0.0, 1.0);
      }
    `,rectDist:`
      float function(vec2 p, vec2 size) {
        vec2 d = abs(p) - size;
        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));
      }
    `}),f(He,"onEffectMask",`
  vec2 pos = vec2(0.0, width * 0.5);
  float mask = $rectDist(v_textureCoordinate.xy * u_dimensions - pos, vec2(u_dimensions.x, width*0.5));
  return mix(shaderColor, maskColor, $fillMask(mask));
  `),f(He,"onColorize",`
    return color;
  `);class Ye extends te{constructor(){super(...arguments);f(this,"name","borderBottom")}static getEffectKey(){return"borderBottom"}static resolveDefaults(e){return{width:e.width??10,color:e.color??4294967295}}}f(Ye,"z$__type__Props"),f(Ye,"uniforms",{width:{value:0,method:"uniform1f",type:"float"},color:{value:4294967295,updateProgramValue:ot,method:"uniform4fv",type:"vec4"}}),f(Ye,"methods",{fillMask:`
      float function(float dist) {
        return clamp(-dist, 0.0, 1.0);
      }
    `,rectDist:`
      float function(vec2 p, vec2 size) {
        vec2 d = abs(p) - size;
        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));
      }
    `}),f(Ye,"onEffectMask",`
  vec2 pos = vec2(0.0, u_dimensions.y - width * 0.5);
  float mask = $rectDist(v_textureCoordinate.xy * u_dimensions - pos, vec2(u_dimensions.x, width*0.5));
  return mix(shaderColor, maskColor, $fillMask(mask));
  `),f(Ye,"onColorize",`
    return color;
  `);class Ke extends te{constructor(){super(...arguments);f(this,"name","borderLeft")}static getEffectKey(){return"borderLeft"}static resolveDefaults(e){return{width:e.width??10,color:e.color??4294967295}}}f(Ke,"z$__type__Props"),f(Ke,"uniforms",{width:{value:0,method:"uniform1f",type:"float"},color:{value:4294967295,updateProgramValue:ot,method:"uniform4fv",type:"vec4"}}),f(Ke,"methods",{fillMask:`
      float function(float dist) {
        return clamp(-dist, 0.0, 1.0);
      }
    `,rectDist:`
      float function(vec2 p, vec2 size) {
        vec2 d = abs(p) - size;
        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));
      }
    `}),f(Ke,"onEffectMask",`
  vec2 pos = vec2(width * 0.5, 0.0);
  float mask = $rectDist(v_textureCoordinate.xy * u_dimensions - pos, vec2(width*0.5, u_dimensions.y));
  return mix(shaderColor, maskColor, $fillMask(mask));
  `),f(Ke,"onColorize",`
    return color;
  `);class ut extends te{constructor(){super(...arguments);f(this,"name","glitch")}static getEffectKey(e){return"glitch"}static resolveDefaults(e){return{amplitude:e.amplitude??.2,narrowness:e.narrowness??4,blockiness:e.blockiness??2,minimizer:e.minimizer??8,time:e.time??Date.now()}}}f(ut,"z$__type__Props"),f(ut,"uniforms",{amplitude:{value:0,method:"uniform1f",type:"float"},narrowness:{value:0,method:"uniform1f",type:"float"},blockiness:{value:0,method:"uniform1f",type:"float"},minimizer:{value:0,method:"uniform1f",type:"float"},time:{value:0,method:"uniform1f",updateOnBind:!0,updateProgramValue:e=>{const s=e.value=(Date.now()-e.value)%1e3;e.programValue=s},type:"float"}}),f(ut,"methods",{rand:`
      float function(vec2 p, float time) {
        float t = floor(time * 20.) / 10.;
        return fract(sin(dot(p, vec2(t * 12.9898, t * 78.233))) * 43758.5453);
      }
    `,noise:`
      float function(vec2 uv, float blockiness, float time) {
        vec2 lv = fract(uv);
        vec2 id = floor(uv);

        float n1 = rand(id, time);
        float n2 = rand(id+vec2(1,0), time);
        float n3 = rand(id+vec2(0,1), time);
        float n4 = rand(id+vec2(1,1), time);
        vec2 u = smoothstep(0.0, 1.0 + blockiness, lv);
        return mix(mix(n1, n2, u.x), mix(n3, n4, u.x), u.y);
      }
    `,fbm:`
      float function(vec2 uv, int count, float blockiness, float complexity, float time) {
        float val = 0.0;
        float amp = 0.5;
        const int MAX_ITERATIONS = 10;

        for(int i = 0; i < MAX_ITERATIONS; i++) {
          if(i >= count) {break;}
          val += amp * noise(uv, blockiness, time);
          amp *= 0.5;
          uv *= complexity;
        }
        return val;
      }
    `}),f(ut,"onColorize",`
    vec2 uv = v_textureCoordinate.xy;
    float aspect = u_dimensions.x / u_dimensions.y;
    vec2 a = vec2(uv.x * aspect , uv.y);
    vec2 uv2 = vec2(a.x / u_dimensions.x, exp(a.y));

    float shift = amplitude * pow($fbm(uv2, 4, blockiness, narrowness, time), minimizer);
    float colR = texture2D(u_texture, vec2(uv.x + shift, uv.y)).r * (1. - shift);
    float colG = texture2D(u_texture, vec2(uv.x - shift, uv.y)).g * (1. - shift);
    float colB = texture2D(u_texture, vec2(uv.x - shift, uv.y)).b * (1. - shift);

    vec3 f = vec3(colR, colG, colB);
    return vec4(f, texture2D(u_texture, vec2(uv.x - shift, uv.y)).a);
  `);class is extends te{constructor(){super(...arguments);f(this,"name","fadeOut")}static getEffectKey(){return"fadeOut"}static resolveDefaults(e){return{fade:e.fade??10}}}f(is,"z$__type__Props"),f(is,"uniforms",{fade:{value:0,method:"uniform4fv",type:"vec4",validator:rr,updateProgramValue:Mo}}),f(is,"onColorize",`
  vec2 point = v_textureCoordinate.xy * u_dimensions.xy;
  vec2 pos1;
  vec2 pos2;
  vec2 d;
  float c;
  vec4 result = maskColor;


  if(fade[0] > 0.0) {
    pos1 = vec2(point.x, point.y);
    pos2 = vec2(point.x, point.y + fade[0]);
    d = pos2 - pos1;
    c = dot(pos1, d) / dot(d, d);
    result = mix(vec4(0.0), result, smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0)));
  }

  if(fade[1] > 0.0) {
    pos1 = vec2(point.x - u_dimensions.x - fade[1], v_textureCoordinate.y);
    pos2 = vec2(point.x - u_dimensions.x, v_textureCoordinate.y);
    d = pos1 - pos2;
    c = dot(pos2, d) / dot(d, d);
    result = mix(vec4(0.0), result, smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0)));
  }

  if(fade[2] > 0.0) {
    pos1 = vec2(v_textureCoordinate.x, point.y - u_dimensions.y - fade[2]);
    pos2 = vec2(v_textureCoordinate.x, point.y - u_dimensions.y);
    d = pos1 - pos2;
    c = dot(pos2, d) / dot(d, d);
    result = mix(vec4(0.0), result, smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0)));
  }

  if(fade[3] > 0.0) {
    pos1 = vec2(point.x, point.y);
    pos2 = vec2(point.x + fade[3], point.y);
    d = pos2 - pos1;
    c = dot(pos1, d) / dot(d, d);
    result = mix(vec4(0.0), result, smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0)));
  }

  return result;
  `);const Ue=class Ue extends te{constructor(){super(...arguments);f(this,"name","radialGradient")}static getEffectKey(e){return`radialGradient${e.colors.length}`}static resolveDefaults(e){const s=e.colors??[4278190080,4294967295];let i=e.stops||[];if(i.length===0||i.length!==s.length){const o=s.length;let a=0;const n=i;for(;a<o;a++)i[a]?(n[a]=i[a],i[a-1]===void 0&&n[a-2]!==void 0&&(n[a-1]=n[a-2]+(i[a]-n[a-2])/2)):n[a]=a*(1/(s.length-1));i=n}return{colors:s,stops:i,width:e.width??0,height:e.height??e.width??0,pivot:e.pivot??[.5,.5]}}};f(Ue,"z$__type__Props"),f(Ue,"uniforms",{width:{value:0,method:"uniform1f",type:"float"},height:{value:0,method:"uniform1f",type:"float"},pivot:{value:[.5,.5],updateProgramValue:Ao,method:"uniform2fv",type:"vec2"},colors:{value:4294967295,validator:e=>e.reduce((s,i)=>s.concat(wt(i)),[]),updateProgramValue:jr,size:e=>e.colors.length,method:"uniform4fv",type:"vec4"},stops:{value:[],size:e=>e.colors.length,method:"uniform1fv",type:"float"}}),f(Ue,"ColorLoop",e=>{let s="";for(let i=2;i<e;i++)s+=`colorOut = mix(colorOut, colors[${i}], clamp((dist - stops[${i-1}]) / (stops[${i}] - stops[${i-1}]), 0.0, 1.0));`;return s}),f(Ue,"onColorize",e=>{const s=e.colors.length||1;return`
      vec2 point = v_textureCoordinate.xy * u_dimensions;
      vec2 projection = vec2(pivot.x * u_dimensions.x, pivot.y * u_dimensions.y);

      float dist = length((point - projection) / vec2(width, height));

      float stopCalc = (dist - stops[0]) / (stops[1] - stops[0]);
      vec4 colorOut = mix(colors[0], colors[1], stopCalc);
      ${Ue.ColorLoop(s)}
      return mix(maskColor, colorOut, clamp(colorOut.a, 0.0, 1.0));
    `});let Hs=Ue;class je extends te{constructor(){super(...arguments);f(this,"name","radialProgress")}static getEffectKey(){return"radialProgress"}static resolveDefaults(e){return{width:e.width??10,progress:e.progress??.5,offset:e.offset??0,range:e.range??Math.PI*2,rounded:e.rounded??!1,radius:e.radius??1,color:e.color??4294967295}}}f(je,"z$__type__Props"),f(je,"uniforms",{width:{value:0,method:"uniform1f",type:"float"},progress:{value:.5,method:"uniform1f",type:"float"},offset:{value:0,method:"uniform1f",type:"float"},range:{value:0,method:"uniform1f",type:"float"},rounded:{value:0,method:"uniform1f",type:"float",validator:e=>e?1:0},radius:{value:1,method:"uniform1f",type:"float"},color:{value:4294967295,updateProgramValue:ot,method:"uniform4fv",type:"vec4"}}),f(je,"methods",{rotateUV:`
    vec2 function(vec2 uv, float d) {
      float s = sin(d);
      float c = cos(d);
      mat2 rotMatrix = mat2(c, -s, s, c);
      return uv * rotMatrix;
    }
    `,drawDot:`
    float function(vec2 uv, vec2 p, float r) {
      uv += p;
      float circle = length(uv) - r;
      return clamp(-circle, 0.0, 1.0);
    }
    `}),f(je,"onEffectMask",`
    float outerRadius = radius * u_dimensions.y * 0.5;

    float endAngle = range * progress - 0.0005;

    vec2 uv = v_textureCoordinate.xy * u_dimensions.xy - u_dimensions * 0.5;

    uv = $rotateUV(uv, -(offset));
    float linewidth = width * u_pixelRatio;
    float circle = length(uv) - (outerRadius - linewidth) ;
    circle = abs(circle) - linewidth;
    circle = clamp(-circle, 0.0, 1.0);

    float angle = (atan(uv.x, -uv.y) / 3.14159265359 * 0.5);
    float p = endAngle / (PI * 2.);

    circle *= step(fract(angle), fract(p));

    circle = rounded < 1. ? circle : max(circle, $drawDot(uv, vec2(0, outerRadius - linewidth), linewidth));
    circle = rounded < 1. ? circle : max(circle, $drawDot($rotateUV(uv, -(endAngle)), vec2(0, outerRadius - linewidth), linewidth));

    return mix(shaderColor, maskColor, circle);
  `),f(je,"onColorize",`
    return color;
  `);class qe extends te{constructor(){super(...arguments);f(this,"name","holePunch")}static getEffectKey(){return"holePunch"}static resolveDefaults(e){return{x:e.x||0,y:e.y||0,width:e.width||50,height:e.height||50,radius:e.radius??0}}}f(qe,"z$__type__Props"),f(qe,"uniforms",{x:{value:0,method:"uniform1f",type:"float"},y:{value:0,method:"uniform1f",type:"float"},width:{value:0,method:"uniform1f",type:"float"},height:{value:0,method:"uniform1f",type:"float"},radius:{value:0,method:"uniform4fv",type:"vec4",updateOnBind:!0,validator:rr,updateProgramValue:qr}}),f(qe,"methods",{fillMask:`
      float function(float dist) {
        return clamp(-dist, 0.0, 1.0);
      }
    `,boxDist:`
      float function(vec2 p, vec2 size, float radius) {
        size -= vec2(radius);
        vec2 d = abs(p) - size;
        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0)) - radius;
      }
    `}),f(qe,"onShaderMask",`
  vec2 halfDimensions = u_dimensions * 0.5;
  vec2 size = vec2(width, height) * 0.5;
  vec2 basePos = v_textureCoordinate.xy * u_dimensions.xy - vec2(x, y);
  vec2 pos = basePos - size;
  float r = radius[0] * step(pos.x, 0.5) * step(pos.y, 0.5);
  r = r + radius[1] * step(0.5, pos.x) * step(pos.y, 0.5);
  r = r + radius[2] * step(0.5, pos.x) * step(0.5, pos.y);
  r = r + radius[3] * step(pos.x, 0.5) * step(0.5, pos.y);
  return $boxDist(pos, size, r);
  `),f(qe,"onEffectMask",`
  return mix(maskColor, vec4(0.0), $fillMask(shaderMask));
  `);const Zr="RoundedRectangle";class ir extends Hr{constructor(e){super();f(this,"shType");this.shType=e,e!==Zr&&console.warn("Unsupported shader:",e)}bindRenderOp(){}bindProps(){}attach(){}detach(){}}class Io{constructor(t,e,s,i){f(this,"type");f(this,"shader");f(this,"resolvedProps");f(this,"props");this.type=t,this.shader=e,this.resolvedProps=s;const o=Object.keys(s),a=o.length,n={};for(let l=0;l<a;l++){const c=o[l];Object.defineProperty(n,c,{get:()=>this.resolvedProps[c],set:h=>{this.resolvedProps[c]=h,i.requestRender()}})}this.props=n}getResolvedProps(){return this.resolvedProps}}class Lo{constructor(t,e,s){f(this,"shader");f(this,"resolvedProps");f(this,"props");f(this,"type");this.shader=t,this.type="DynamicShader",this.resolvedProps=e;const i=s.getRegisteredEffects(),o={},a=e.effects,n=a.length;for(let l=0;l<n;l++){const{name:c,props:h,type:d}=a[l];if(c===void 0)continue;const u={},x=Object.keys(h),m=x.length;for(let g=0;g<m;g++){const b=x[g];Object.defineProperty(u,b,{get:()=>this.resolvedProps.effects[l].props[b].value,set:T=>{var C,S;const _=this.resolvedProps.effects[l].props[b];_.value=T,_.hasValidator&&(T=_.validatedValue=(C=i[d].uniforms[b])==null?void 0:C.validator(T,h)),_.hasProgramValueUpdater?(S=i[d].uniforms[b])==null||S.updateProgramValue(_):_.programValue=T,s.renderer.stage.requestRender()}})}Object.defineProperty(o,c,{get:()=>u})}this.props=o}getResolvedProps(){return this.resolvedProps}}class Po{constructor(){f(this,"shCache",new Map);f(this,"shConstructors",{});f(this,"attachedShader",null);f(this,"effectConstructors",{});f(this,"renderer");this.registerShaderType("DefaultShader",Yr),this.registerShaderType("DefaultShaderBatched",Kr),this.registerShaderType("RoundedRectangle",Xs),this.registerShaderType("DynamicShader",Je),this.registerShaderType("SdfShader",Gs),this.registerEffectType("border",dt),this.registerEffectType("borderBottom",Ye),this.registerEffectType("borderLeft",Ke),this.registerEffectType("borderRight",Ve),this.registerEffectType("borderTop",He),this.registerEffectType("fadeOut",is),this.registerEffectType("linearGradient",Ws),this.registerEffectType("radialGradient",Hs),this.registerEffectType("grayscale",Vs),this.registerEffectType("glitch",ut),this.registerEffectType("radius",We),this.registerEffectType("radialProgress",je),this.registerEffectType("holePunch",qe)}registerShaderType(t,e){this.shConstructors[t]=e}registerEffectType(t,e){this.effectConstructors[t]=e}getRegisteredEffects(){return this.effectConstructors}getRegisteredShaders(){return this.shConstructors}loadShader(t,e){if(!this.renderer)throw new Error("Renderer is not been defined");const s=this.shConstructors[t];if(!s)throw new Error(`Shader type "${t}" is not registered`);if(this.renderer.mode==="canvas"&&s.prototype instanceof Fe)return this._createShaderCtr(t,new ir(t),e);if(t==="DynamicShader")return this.loadDynamicShader(e);const i=s.resolveDefaults(e),o=s.makeCacheKey(i)||s.name;if(o&&this.shCache.has(o))return this._createShaderCtr(t,this.shCache.get(o),i);const a=new s(this.renderer,e);return o&&this.shCache.set(o,a),this._createShaderCtr(t,a,i)}loadDynamicShader(t){if(!this.renderer)throw new Error("Renderer is not been defined");const e=Je.resolveDefaults(t,this.effectConstructors),s=Je.makeCacheKey(e,this.effectConstructors);if(s&&this.shCache.has(s))return this._createDynShaderCtr(this.shCache.get(s),e);const i=new Je(this.renderer,t,this.effectConstructors);return s&&this.shCache.set(s,i),this._createDynShaderCtr(i,e)}_createShaderCtr(t,e,s){return new Io(t,e,s,this.renderer.stage)}_createDynShaderCtr(t,e){return new Lo(t,e,this)}useShader(t){this.attachedShader!==t&&(this.attachedShader&&this.attachedShader.detach(),t.attach(),this.attachedShader=t)}}const Fo={x:(r,t)=>{r.props.x=t},y:(r,t)=>{r.props.y=t},width:(r,t)=>{r.props.width=t},height:(r,t)=>{r.props.height=t},color:(r,t)=>{r.props.color=t},zIndex:(r,t)=>{r.props.zIndex=t},fontFamily:(r,t)=>{r.props.fontFamily=t},fontWeight:(r,t)=>{r.props.fontWeight=t},fontStyle:(r,t)=>{r.props.fontStyle=t},fontStretch:(r,t)=>{r.props.fontStretch=t},fontSize:(r,t)=>{r.props.fontSize=t},text:(r,t)=>{r.props.text=t},textAlign:(r,t)=>{r.props.textAlign=t},contain:(r,t)=>{r.props.contain=t},offsetY:(r,t)=>{r.props.offsetY=t},scrollable:(r,t)=>{r.props.scrollable=t},scrollY:(r,t)=>{r.props.scrollY=t},letterSpacing:(r,t)=>{r.props.letterSpacing=t},lineHeight:(r,t)=>{r.props.lineHeight=t},maxLines:(r,t)=>{r.props.maxLines=t},textBaseline:(r,t)=>{r.props.textBaseline=t},verticalAlign:(r,t)=>{r.props.verticalAlign=t},overflowSuffix:(r,t)=>{r.props.overflowSuffix=t},debug:(r,t)=>{r.props.debug=t}};class or{constructor(t){f(this,"stage");f(this,"set");this.stage=t;const e={...Fo,...this.getPropertySetters()};this.set=Object.freeze(Object.fromEntries(Object.entries(e).map(([s,i])=>[s,(o,a)=>{o.props[s]!==a&&(i(o,a),this.stage.requestRender())}])))}setStatus(t,e,s){t.status!==e&&(t.status=e,t.emitter.emit(e,s))}setIsRenderable(t,e){t.isRenderable=e}destroyState(t){this.setStatus(t,"destroyed"),t.emitter.removeAllListeners()}scheduleUpdateState(t){t.updateScheduled||(t.updateScheduled=!0,queueMicrotask(()=>{t.status!=="destroyed"&&(t.updateScheduled=!1,this.updateState(t))}))}}class ko{constructor(){f(this,"data",{})}reset(){this.data={}}increment(t){this.data[t]||(this.data[t]=0),this.data[t]++}getData(){return{...this.data}}}class Bo{constructor(t,e){f(this,"stage");f(this,"memUsed",0);f(this,"loadedTextures",new Map);f(this,"criticalThreshold");f(this,"targetThreshold");f(this,"cleanupInterval");f(this,"debugLogging");f(this,"lastCleanupTime",0);f(this,"criticalCleanupRequested",!1);f(this,"frameTime",0);this.stage=t;const{criticalThreshold:s}=e;this.criticalThreshold=Math.round(s);const i=Math.max(0,Math.min(1,e.targetThresholdLevel));if(this.targetThreshold=Math.round(s*i),this.cleanupInterval=e.cleanupInterval,this.debugLogging=e.debugLogging,e.debugLogging){let o=0;setInterval(()=>{o!==this.memUsed&&(o=this.memUsed,console.log(`[TextureMemoryManager] Memory used: ${xr(this.memUsed)} mb / ${xr(this.criticalThreshold)} mb (${(this.memUsed/this.criticalThreshold*100).toFixed(1)}%)`))},1e3)}s===0&&(this.setTextureMemUse=()=>{})}setTextureMemUse(t,e){if(this.loadedTextures.has(t)&&(this.memUsed-=this.loadedTextures.get(t)),e===0){this.loadedTextures.delete(t);return}else this.memUsed+=e,this.loadedTextures.set(t,e);this.memUsed>this.criticalThreshold&&(this.criticalCleanupRequested=!0)}checkCleanup(){return this.criticalCleanupRequested||this.memUsed>this.targetThreshold&&this.frameTime-this.lastCleanupTime>=this.cleanupInterval}cleanup(){const t=this.criticalCleanupRequested;this.lastCleanupTime=this.frameTime,this.criticalCleanupRequested=!1,t&&this.stage.queueFrameEvent("criticalCleanup",{memUsed:this.memUsed,criticalThreshold:this.criticalThreshold}),this.debugLogging&&console.log(`[TextureMemoryManager] Cleaning up textures. Critical: ${t}`);const e=[...this.loadedTextures.keys()].sort((o,a)=>{const n=o.renderable,l=a.renderable;return n===l?o.lastRenderableChangeTime-a.lastRenderableChangeTime:n?1:l?-1:0}),s=this.targetThreshold,i=this.stage.txManager;for(const o of e)if(o.renderable||(o.preventCleanup===!1&&(o.ctxTexture.free(),i.removeTextureFromCache(o)),this.memUsed<=s))break;this.memUsed>=this.criticalThreshold&&(this.stage.queueFrameEvent("criticalCleanupFailed",{memUsed:this.memUsed,criticalThreshold:this.criticalThreshold}),console.warn(`[TextureMemoryManager] Memory usage above critical threshold after cleanup: ${this.memUsed}`))}getMemoryInfo(){let t=0;const e=[...this.loadedTextures.keys()].reduce((s,i)=>(t+=i.renderable?1:0,s+(i.renderable?this.loadedTextures.get(i):0)),0);return{criticalThreshold:this.criticalThreshold,targetThreshold:this.targetThreshold,renderableMemUsed:e,memUsed:this.memUsed,renderableTexturesLoaded:t,loadedTextures:this.loadedTextures.size}}}class Qr{constructor(t,e){f(this,"textureSource");f(this,"memManager");this.memManager=t,this.textureSource=e}setTextureMemUse(t){this.memManager.setTextureMemUse(this.textureSource,t)}get renderable(){return this.textureSource.renderable}}class Jr{constructor(t){f(this,"options");f(this,"mode");f(this,"stage");f(this,"txManager");f(this,"txMemManager");f(this,"shManager");f(this,"rttNodes",[]);this.options=t,this.stage=t.stage,this.txManager=t.txManager,this.txMemManager=t.txMemManager,this.shManager=t.shManager}}class Oo extends Ns{constructor(e,s,i){super(e,s);f(this,"textRenderer");f(this,"trState");f(this,"_textRendererOverride",null);f(this,"onTextLoaded",()=>{const{contain:e}=this,s=this.trState.props.width,i=this.trState.props.height,o=this.trState.textW||0,a=this.trState.textH||0;e==="both"?(this.props.width=s,this.props.height=i):e==="width"?(this.props.width=s,this.props.height=a):e==="none"&&(this.props.width=o,this.props.height=a),this.updateLocalTransform(),this.stage.requestRender(),this.emit("loaded",{type:"text",dimensions:{width:this.trState.textW||0,height:this.trState.textH||0}})});f(this,"onTextFailed",(e,s)=>{this.emit("failed",{type:"text",error:s})});this._textRendererOverride=s.textRendererOverride,this.textRenderer=i;const o=this.createState({x:this.absX,y:this.absY,width:s.width,height:s.height,textAlign:s.textAlign,color:s.color,zIndex:s.zIndex,contain:s.contain,scrollable:s.scrollable,scrollY:s.scrollY,offsetY:s.offsetY,letterSpacing:s.letterSpacing,debug:s.debug,fontFamily:s.fontFamily,fontSize:s.fontSize,fontStretch:s.fontStretch,fontStyle:s.fontStyle,fontWeight:s.fontWeight,text:s.text,lineHeight:s.lineHeight,maxLines:s.maxLines,textBaseline:s.textBaseline,verticalAlign:s.verticalAlign,overflowSuffix:s.overflowSuffix});this.trState=o}get width(){return this.props.width}set width(e){this.props.width=e,this.textRenderer.set.width(this.trState,e),this.contain==="none"&&this.setUpdateType(w.Local)}get height(){return this.props.height}set height(e){this.props.height=e,this.textRenderer.set.height(this.trState,e),this.contain!=="both"&&this.setUpdateType(w.Local)}get color(){return this.trState.props.color}set color(e){this.textRenderer.set.color(this.trState,e)}get text(){return this.trState.props.text}set text(e){this.textRenderer.set.text(this.trState,e)}get textRendererOverride(){return this._textRendererOverride}set textRendererOverride(e){this._textRendererOverride=e,this.textRenderer.destroyState(this.trState);const s=this.stage.resolveTextRenderer(this.trState.props,this._textRendererOverride);if(!s){console.warn("Text Renderer not found for font",this.trState.props.fontFamily);return}this.textRenderer=s,this.trState=this.createState(this.trState.props)}get fontSize(){return this.trState.props.fontSize}set fontSize(e){this.textRenderer.set.fontSize(this.trState,e)}get fontFamily(){return this.trState.props.fontFamily}set fontFamily(e){this.textRenderer.set.fontFamily(this.trState,e)}get fontStretch(){return this.trState.props.fontStretch}set fontStretch(e){this.textRenderer.set.fontStretch(this.trState,e)}get fontStyle(){return this.trState.props.fontStyle}set fontStyle(e){this.textRenderer.set.fontStyle(this.trState,e)}get fontWeight(){return this.trState.props.fontWeight}set fontWeight(e){this.textRenderer.set.fontWeight(this.trState,e)}get textAlign(){return this.trState.props.textAlign}set textAlign(e){this.textRenderer.set.textAlign(this.trState,e)}get contain(){return this.trState.props.contain}set contain(e){this.textRenderer.set.contain(this.trState,e)}get scrollable(){return this.trState.props.scrollable}set scrollable(e){this.textRenderer.set.scrollable(this.trState,e)}get scrollY(){return this.trState.props.scrollY}set scrollY(e){this.textRenderer.set.scrollY(this.trState,e)}get offsetY(){return this.trState.props.offsetY}set offsetY(e){this.textRenderer.set.offsetY(this.trState,e)}get letterSpacing(){return this.trState.props.letterSpacing}set letterSpacing(e){this.textRenderer.set.letterSpacing(this.trState,e)}get lineHeight(){return this.trState.props.lineHeight}set lineHeight(e){this.textRenderer.set.lineHeight(this.trState,e)}get maxLines(){return this.trState.props.maxLines}set maxLines(e){this.textRenderer.set.maxLines(this.trState,e)}get textBaseline(){return this.trState.props.textBaseline}set textBaseline(e){this.textRenderer.set.textBaseline(this.trState,e)}get verticalAlign(){return this.trState.props.verticalAlign}set verticalAlign(e){this.textRenderer.set.verticalAlign(this.trState,e)}get overflowSuffix(){return this.trState.props.overflowSuffix}set overflowSuffix(e){this.textRenderer.set.overflowSuffix(this.trState,e)}get debug(){return this.trState.props.debug}set debug(e){this.textRenderer.set.debug(this.trState,e)}update(e,s){super.update(e,s),E(this.globalTransform),this.textRenderer.set.x(this.trState,this.globalTransform.tx),this.textRenderer.set.y(this.trState,this.globalTransform.ty)}checkRenderProps(){return this.trState&&this.trState.props.text!==""?!0:super.checkRenderProps()}onChangeIsRenderable(e){super.onChangeIsRenderable(e),this.textRenderer.setIsRenderable(this.trState,e)}renderQuads(e){var s;if(E(this.globalTransform),!this.textRenderer.renderQuads){super.renderQuads(e);return}this.parentHasRenderTexture&&(!e.renderToTextureActive||this.parentRenderTexture!==e.activeRttNode)||(this.parentHasRenderTexture&&((s=this.props.parent)!=null&&s.rtt)&&(this.globalTransform=re.identity(),this.localTransform&&this.globalTransform.multiply(this.localTransform)),E(this.globalTransform),this.textRenderer.renderQuads(this.trState,this.globalTransform,this.clippingRect,this.worldAlpha,this.parentHasRenderTexture,this.framebufferDimensions))}destroy(){super.destroy(),this.textRenderer.destroyState(this.trState)}createState(e){const s=this.textRenderer.createState(e,this);return s.emitter.on("loaded",this.onTextLoaded),s.emitter.on("failed",this.onTextFailed),this.textRenderer.scheduleUpdateState(s),s}}function Uo(r){const t={boolean:!0,string:!0,number:!0,undefined:!0},e=Object.keys(r);for(let s=0;s<e.length;s++){const i=e[s];if(!i)continue;const o=r[i],a=typeof o;a==="string"&&o.length>2048&&(console.warn(`Custom Data value for ${i} is too long, it will be truncated to 2048 characters`),r[i]=o.substring(0,2048)),t[a]||(console.warn(`Custom Data value for ${i} is not a boolean, string, or number, it will be ignored`),delete r[i])}return r}const $o=2e6;class Do{constructor(t){f(this,"options");f(this,"animationManager");f(this,"txManager");f(this,"txMemManager");f(this,"fontManager");f(this,"textRenderers");f(this,"shManager");f(this,"renderer");f(this,"root");f(this,"boundsMargin");f(this,"defShaderCtr");f(this,"eventBus");f(this,"deltaTime",0);f(this,"lastFrameTime",0);f(this,"currentFrameTime",0);f(this,"fpsNumFrames",0);f(this,"fpsElapsedTime",0);f(this,"renderRequested",!1);f(this,"frameEventQueue",[]);f(this,"fontResolveMap",{});f(this,"contextSpy",null);this.options=t;const{canvas:e,clearColor:s,appWidth:i,appHeight:o,boundsMargin:a,enableContextSpy:n,numImageWorkers:l,textureMemory:c,renderEngine:h,fontEngines:d}=t;this.eventBus=t.eventBus,this.txManager=new wo(l),this.txMemManager=new Bo(this,c),this.shManager=new Po,this.animationManager=new mo,this.contextSpy=n?new ko:null;let u=[0,0,0,0];a&&(u=Array.isArray(a)?a:[a,a,a,a]),this.boundsMargin=u;const x={stage:this,canvas:e,pixelRatio:t.devicePhysicalPixelRatio*t.deviceLogicalPixelRatio,clearColor:s??4278190080,bufferMemory:$o,txManager:this.txManager,txMemManager:this.txMemManager,shManager:this.shManager,contextSpy:this.contextSpy};this.renderer=new h(x);const m=this.renderer.mode||"webgl";this.defShaderCtr=this.renderer.getDefShaderCtr(),ji(m),this.txManager.renderer=this.renderer,this.textRenderers={},d.forEach(b=>{const T=new b(this),_=T.type;if(_==="sdf"&&m==="canvas"){console.warn("SdfTextRenderer is not compatible with Canvas renderer. Skipping...");return}T instanceof or&&(_==="canvas"?this.textRenderers.canvas=T:_==="sdf"&&(this.textRenderers.sdf=T))}),Object.keys(this.textRenderers).length===0&&console.warn("No text renderers available. Your text will not render."),this.fontManager=new sr(this.textRenderers);const g=new Ns(this,{x:0,y:0,width:i,height:o,alpha:1,autosize:!1,clipping:!1,color:0,colorTop:0,colorBottom:0,colorLeft:0,colorRight:0,colorTl:0,colorTr:0,colorBl:0,colorBr:0,zIndex:0,zIndexLocked:0,scaleX:1,scaleY:1,mountX:0,mountY:0,mount:0,pivot:.5,pivotX:.5,pivotY:.5,rotation:0,parent:null,texture:null,textureOptions:{},shader:this.defShaderCtr,rtt:!1,src:null,scale:1,preventCleanup:!1});this.root=g,uo(this)}updateFrameTime(){const t=po();this.lastFrameTime=this.currentFrameTime,this.currentFrameTime=t,this.deltaTime=this.lastFrameTime?t-this.lastFrameTime:100/6,this.txManager.frameTime=t,this.txMemManager.frameTime=t,this.eventBus.emit("frameTick",{time:this.currentFrameTime,delta:this.deltaTime})}updateAnimations(){const{animationManager:t}=this;this.root&&t.update(this.deltaTime)}hasSceneUpdates(){return!!this.root.updateType||this.renderRequested}drawFrame(){const{renderer:t,renderRequested:e}=this;E(t),this.root.updateType!==0&&this.root.update(this.deltaTime,this.root.clippingRect),t.reset(),this.txMemManager.criticalCleanupRequested&&this.txMemManager.cleanup(),t.rttNodes.length>0&&t.renderRTTNodes(),this.addQuads(this.root),t==null||t.render(),this.calculateFps(),e&&(this.renderRequested=!1)}queueFrameEvent(t,e){this.frameEventQueue.push([t,e])}flushFrameEvents(){for(const[t,e]of this.frameEventQueue)this.eventBus.emit(t,e);this.frameEventQueue=[]}calculateFps(){var e,s;const{fpsUpdateInterval:t}=this.options;if(t&&(this.fpsNumFrames++,this.fpsElapsedTime+=this.deltaTime,this.fpsElapsedTime>=t)){const i=Math.round(this.fpsNumFrames*1e3/this.fpsElapsedTime);this.fpsNumFrames=0,this.fpsElapsedTime=0,this.queueFrameEvent("fpsUpdate",{fps:i,contextSpyData:((e=this.contextSpy)==null?void 0:e.getData())??null}),(s=this.contextSpy)==null||s.reset()}}addQuads(t){E(this.renderer),t.isRenderable===!0&&t.renderQuads(this.renderer);for(let e=0;e<t.children.length;e++){const s=t.children[e];s!==void 0&&s.worldAlpha!==0&&this.addQuads(s)}}requestRender(){this.renderRequested=!0}resolveTextRenderer(t,e=null){const s=`${t.fontFamily}${t.fontStyle}${t.fontWeight}${t.fontStretch}${e||""}`;if(this.fontResolveMap[s]!==void 0)return this.fontResolveMap[s];let i=e,o=!1;if(i){const n=this.textRenderers[i];n?n.canRenderFont(t)||(console.warn(`Cannot use override text renderer '${i}' for font`,t),i=null,o=!0):(console.warn(`Text renderer override '${i}' not found.`),i=null,o=!0)}if(!i){for(const[n,l]of Object.entries(this.textRenderers))if(l.canRenderFont(t)){i=n;break}!i&&this.textRenderers.canvas!==void 0&&(i="canvas")}if(o&&console.warn(`Falling back to text renderer ${String(i)}`),!i)return null;const a=this.textRenderers[i];return E(a,"resolvedTextRenderer undefined"),this.fontResolveMap[s]=a,a}createShaderCtr(t,e){return this.shManager.loadShader(t,e)}createNode(t){const e=this.resolveNodeDefaults(t);return new Ns(this,e)}createTextNode(t){const e=t.fontSize??16,s={...this.resolveNodeDefaults(t),text:t.text??"",textRendererOverride:t.textRendererOverride??null,fontSize:e,fontFamily:t.fontFamily??"sans-serif",fontStyle:t.fontStyle??"normal",fontWeight:t.fontWeight??"normal",fontStretch:t.fontStretch??"normal",textAlign:t.textAlign??"left",contain:t.contain??"none",scrollable:t.scrollable??!1,scrollY:t.scrollY??0,offsetY:t.offsetY??0,letterSpacing:t.letterSpacing??0,lineHeight:t.lineHeight,maxLines:t.maxLines??0,textBaseline:t.textBaseline??"alphabetic",verticalAlign:t.verticalAlign??"middle",overflowSuffix:t.overflowSuffix??"...",debug:t.debug??{},shaderProps:null},i=this.resolveTextRenderer(s,t.textRendererOverride);if(!i)throw new Error(`No compatible text renderer found for ${s.fontFamily}`);return new Oo(this,s,i)}resolveNodeDefaults(t){const e=t.color??4294967295,s=t.colorTl??t.colorTop??t.colorLeft??e,i=t.colorTr??t.colorTop??t.colorRight??e,o=t.colorBl??t.colorBottom??t.colorLeft??e,a=t.colorBr??t.colorBottom??t.colorRight??e,n=Uo(t.data??{});return{x:t.x??0,y:t.y??0,width:t.width??0,height:t.height??0,alpha:t.alpha??1,autosize:t.autosize??!1,clipping:t.clipping??!1,color:e,colorTop:t.colorTop??e,colorBottom:t.colorBottom??e,colorLeft:t.colorLeft??e,colorRight:t.colorRight??e,colorBl:o,colorBr:a,colorTl:s,colorTr:i,zIndex:t.zIndex??0,zIndexLocked:t.zIndexLocked??0,parent:t.parent??null,texture:t.texture??null,textureOptions:t.textureOptions??{},shader:t.shader??this.defShaderCtr,src:t.src??null,srcHeight:t.srcHeight,srcWidth:t.srcWidth,srcX:t.srcX,srcY:t.srcY,scale:t.scale??null,scaleX:t.scaleX??t.scale??1,scaleY:t.scaleY??t.scale??1,mount:t.mount??0,mountX:t.mountX??t.mount??0,mountY:t.mountY??t.mount??0,pivot:t.pivot??.5,pivotX:t.pivotX??t.pivot??.5,pivotY:t.pivotY??t.pivot??.5,rotation:t.rotation??0,rtt:t.rtt??!1,data:n,preventCleanup:t.preventCleanup??!1,imageType:t.imageType}}}class No extends Pe{constructor(e,s){var g,b,T,_;super();f(this,"root");f(this,"canvas");f(this,"settings");f(this,"stage");f(this,"inspector",null);const i={criticalThreshold:((g=e.textureMemory)==null?void 0:g.criticalThreshold)||124e6,targetThresholdLevel:((b=e.textureMemory)==null?void 0:b.targetThresholdLevel)||.5,cleanupInterval:((T=e.textureMemory)==null?void 0:T.cleanupInterval)||3e4,debugLogging:((_=e.textureMemory)==null?void 0:_.debugLogging)||!1},o={appWidth:e.appWidth||1920,appHeight:e.appHeight||1080,textureMemory:i,boundsMargin:e.boundsMargin||0,deviceLogicalPixelRatio:e.deviceLogicalPixelRatio||1,devicePhysicalPixelRatio:e.devicePhysicalPixelRatio||window.devicePixelRatio,clearColor:e.clearColor??0,fpsUpdateInterval:e.fpsUpdateInterval||0,numImageWorkers:e.numImageWorkers!==void 0?e.numImageWorkers:2,enableContextSpy:e.enableContextSpy??!1,inspector:e.inspector??!1,renderEngine:e.renderEngine,quadBufferSize:e.quadBufferSize??4*1024*1024,fontEngines:e.fontEngines};this.settings=o;const{appWidth:a,appHeight:n,deviceLogicalPixelRatio:l,devicePhysicalPixelRatio:c,inspector:h}=o,d=a*l,u=n*l,x=document.createElement("canvas");this.canvas=x,x.width=d*c,x.height=u*c,x.style.width=`${d}px`,x.style.height=`${u}px`,this.stage=new Do({appWidth:this.settings.appWidth,appHeight:this.settings.appHeight,boundsMargin:this.settings.boundsMargin,clearColor:this.settings.clearColor,canvas:this.canvas,deviceLogicalPixelRatio:this.settings.deviceLogicalPixelRatio,devicePhysicalPixelRatio:this.settings.devicePhysicalPixelRatio,enableContextSpy:this.settings.enableContextSpy,fpsUpdateInterval:this.settings.fpsUpdateInterval,numImageWorkers:this.settings.numImageWorkers,renderEngine:this.settings.renderEngine,textureMemory:i,eventBus:this,quadBufferSize:this.settings.quadBufferSize,fontEngines:this.settings.fontEngines}),this.root=this.stage.root;let m;if(typeof s=="string"?m=document.getElementById(s):m=s,!m)throw new Error("Could not find target element");m.appendChild(x),h&&!tr()&&(this.inspector=new h(x,o))}createNode(e){E(this.stage,"Stage is not initialized");const s=this.stage.createNode(e);return this.inspector?this.inspector.createNode(s):s}createTextNode(e){const s=this.stage.createTextNode(e);return this.inspector?this.inspector.createTextNode(s):s}destroyNode(e){return this.inspector&&this.inspector.destroyNode(e.id),e.destroy()}createTexture(e,s){return this.stage.txManager.loadTexture(e,s)}createShader(e,s){return this.stage.shManager.loadShader(e,s)}createDynamicShader(e){return this.stage.shManager.loadDynamicShader({effects:e})}createEffect(e,s,i){return{name:i,type:e,props:s}}getNodeById(e){var o;const s=(o=this.stage)==null?void 0:o.root;if(!s)return null;const i=a=>{if(a.id===e)return a;for(const n of a.children){const l=i(n);if(l)return l}return null};return i(s)}toggleFreeze(){throw new Error("Not implemented")}advanceFrame(){throw new Error("Not implemented")}getBufferInfo(){return this.stage.renderer.getBufferInfo()}rerender(){throw new Error("Not implemented")}}class ei extends Pe{constructor(e){super();f(this,"fontFamily");f(this,"descriptors");f(this,"loaded",!1);f(this,"metrics",null);const{fontFamily:s,descriptors:i,metrics:o}=e;o&&(this.metrics={ascender:o.ascender/o.unitsPerEm,descender:o.descender/o.unitsPerEm,lineGap:o.lineGap/o.unitsPerEm}),this.fontFamily=s,this.descriptors={style:"normal",weight:"normal",stretch:"normal",...i}}static convertToCssFontFaceDescriptors(e){return{style:e.style,weight:typeof e.weight=="number"?`${e.weight}`:e.weight,stretch:e.stretch,unicodeRange:e.unicodeRange,featureSettings:e.featureSettings,display:e.display}}}class os extends ei{constructor(e){super(e);f(this,"fontFace");f(this,"fontUrl");const{fontFamily:s,fontUrl:i}=e,o=i.replace(/\(|\)/g,""),a=this.descriptors,n={style:a.style,weight:typeof a.weight=="number"?`${a.weight}`:a.weight,stretch:a.stretch,unicodeRange:a.unicodeRange,featureSettings:a.featureSettings,display:a.display},l=new FontFace(s,`url(${o})`,n);o.length>0?l.load().then(()=>{this.loaded=!0,this.emit("loaded")}).catch(console.error):(this.loaded=!0,this.emit("loaded")),this.fontFace=l,this.fontUrl=i}}class zo{}class ti extends zo{constructor(e,s,i,o,a,n,l,c,h,d,u,x,m){super();f(this,"glw");f(this,"options");f(this,"buffers");f(this,"shader");f(this,"shaderProps");f(this,"alpha");f(this,"clippingRect");f(this,"dimensions");f(this,"bufferIdx");f(this,"zIndex");f(this,"renderToTexture");f(this,"parentHasRenderTexture");f(this,"framebufferDimensions");f(this,"length",0);f(this,"numQuads",0);f(this,"textures",[]);f(this,"maxTextures");this.glw=e,this.options=s,this.buffers=i,this.shader=o,this.shaderProps=a,this.alpha=n,this.clippingRect=l,this.dimensions=c,this.bufferIdx=h,this.zIndex=d,this.renderToTexture=u,this.parentHasRenderTexture=x,this.framebufferDimensions=m,this.maxTextures=o.supportsIndexedTextures?e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS):1}addTexture(e){const{textures:s,maxTextures:i}=this,o=s.findIndex(n=>n===e);if(o!==-1)return o;const a=s.length;return a>=i?4294967295:(this.textures.push(e),a)}draw(){const{glw:e,shader:s,shaderProps:i,options:o}=this,{shManager:a}=o;a.useShader(s),s.bindRenderOp(this,i);const n=this.bufferIdx/24*6*2;if(this.clippingRect.valid){const{x:l,y:c,width:h,height:d}=this.clippingRect,u=o.pixelRatio,x=o.canvas.height,m=Math.round(l*u),g=Math.round(h*u),b=Math.round(d*u),T=Math.round(x-b-c*u);e.setScissorTest(!0),e.scissor(m,T,g,b)}else e.setScissorTest(!1);e.drawElements(e.TRIANGLES,6*this.numQuads,e.UNSIGNED_SHORT,n)}}function Xo(r){const t={MAX_RENDERBUFFER_SIZE:0,MAX_TEXTURE_SIZE:0,MAX_VIEWPORT_DIMS:0,MAX_VERTEX_TEXTURE_IMAGE_UNITS:0,MAX_TEXTURE_IMAGE_UNITS:0,MAX_COMBINED_TEXTURE_IMAGE_UNITS:0,MAX_VERTEX_ATTRIBS:0,MAX_VARYING_VECTORS:0,MAX_VERTEX_UNIFORM_VECTORS:0,MAX_FRAGMENT_UNIFORM_VECTORS:0};return Object.keys(t).forEach(s=>{t[s]=r.getParameter(r[s])}),t}function Go(r){const t={ANGLE_instanced_arrays:null,WEBGL_compressed_texture_s3tc:null,WEBGL_compressed_texture_astc:null,WEBGL_compressed_texture_etc:null,WEBGL_compressed_texture_etc1:null,WEBGL_compressed_texture_pvrtc:null,WEBKIT_WEBGL_compressed_texture_pvrtc:null,WEBGL_compressed_texture_s3tc_srgb:null,OES_vertex_array_object:null};return Object.keys(t).forEach(s=>{t[s]=r.getExtension(s)}),t}function Wo(r,t){const e=~~(t/80),s=new Uint16Array(e*6);for(let o=0,a=0;o<e;o+=6,a+=4)s[o]=a,s[o+1]=a+1,s[o+2]=a+2,s[o+3]=a+2,s[o+4]=a+1,s[o+5]=a+3;const i=r.createBuffer();r.elementArrayBufferData(i,s,r.STATIC_DRAW)}function Vo(r){return r!==null&&typeof r=="object"&&r.constructor&&r.constructor.name==="HTMLImageElement"}const Ps=new Uint8Array([0,0,0,0]);class ps extends Qr{constructor(e,s,i){super(s,i);f(this,"glw");f(this,"_nativeCtxTexture",null);f(this,"_state","freed");f(this,"_w",0);f(this,"_h",0);this.glw=e}get ctxTexture(){return this._state==="freed"&&this.load(),E(this._nativeCtxTexture),this._nativeCtxTexture}get w(){return this._w}get h(){return this._h}load(){this._state==="loading"||this._state==="loaded"||(this._state="loading",this.textureSource.setState("loading"),this._nativeCtxTexture=this.createNativeCtxTexture(),this.onLoadRequest().then(({width:e,height:s})=>{this._state!=="freed"&&(this._state="loaded",this._w=e,this._h=s,this.textureSource.setState("loaded",{width:e,height:s}))}).catch(e=>{this._state!=="freed"&&(this._state="failed",this.textureSource.setState("failed",e),console.error(e))}))}async onLoadRequest(){var a;const{glw:e}=this;e.texImage2D(0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,null),this.setTextureMemUse(Ps.byteLength);const s=await((a=this.textureSource)==null?void 0:a.getTextureData());if(!this._nativeCtxTexture)return E(this._state==="freed"),{width:0,height:0};let i=0,o=0;if(E(this._nativeCtxTexture),e.activeTexture(0),typeof ImageBitmap<"u"&&s.data instanceof ImageBitmap||s.data instanceof ImageData||Vo(s.data)){const n=s.data;i=n.width,o=n.height,e.bindTexture(this._nativeCtxTexture),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!!s.premultiplyAlpha),e.texImage2D(0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n),this.setTextureMemUse(i*o*4),(e.isWebGl2()||gr(i)&&gr(o))&&e.generateMipmap()}else if(s.data===null)i=0,o=0,e.bindTexture(this._nativeCtxTexture),e.texImage2D(0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,Ps),this.setTextureMemUse(Ps.byteLength);else if("mipmaps"in s.data&&s.data.mipmaps){const{mipmaps:n,width:l=0,height:c=0,type:h,glInternalFormat:d}=s.data,u=h==="ktx"?new DataView(n[0]??new ArrayBuffer(0)):n[0];e.bindTexture(this._nativeCtxTexture),e.compressedTexImage2D(0,d,l,c,0,u),e.texParameteri(e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_MIN_FILTER,e.LINEAR),this.setTextureMemUse(u.byteLength)}else console.error("WebGlCoreCtxTexture.onLoadRequest: Unexpected textureData returned",s);return{width:i,height:o}}free(){if(this._state==="freed"||(this._state="freed",this.textureSource.setState("freed"),this._w=0,this._h=0,!this._nativeCtxTexture))return;const{glw:e}=this;e.deleteTexture(this._nativeCtxTexture),this.setTextureMemUse(0),this._nativeCtxTexture=null}createNativeCtxTexture(){const{glw:e}=this,s=e.createTexture();if(!s)throw new Error("Could not create WebGL Texture");return e.activeTexture(0),e.bindTexture(s),e.texParameteri(e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),s}}class Ho extends ps{constructor(t,e,s){super(t,e,s)}async onLoadRequest(){var e,s;const t=await this.textureSource.getTextureData();return{width:((e=t.data)==null?void 0:e.width)||0,height:((s=t.data)==null?void 0:s.height)||0}}}class si{constructor(t){f(this,"config");this.config=t}getBuffer(t){var e;return(e=this.config.find(s=>s.attributes[t]))==null?void 0:e.buffer}getAttributeInfo(t){var e;return(e=this.config.find(s=>s.attributes[t]))==null?void 0:e.attributes[t]}}function Yo(r){return self.WebGL2RenderingContext&&r instanceof self.WebGL2RenderingContext}class Ko{constructor(t){f(this,"gl");f(this,"activeTextureUnit",0);f(this,"texture2dUnits");f(this,"texture2dParams",new WeakMap);f(this,"scissorEnabled");f(this,"scissorX");f(this,"scissorY");f(this,"scissorWidth");f(this,"scissorHeight");f(this,"blendEnabled");f(this,"blendSrcRgb");f(this,"blendDstRgb");f(this,"blendSrcAlpha");f(this,"blendDstAlpha");f(this,"boundArrayBuffer");f(this,"boundElementArrayBuffer");f(this,"curProgram");f(this,"programUniforms",new WeakMap);f(this,"canvas");f(this,"MAX_RENDERBUFFER_SIZE");f(this,"MAX_TEXTURE_SIZE");f(this,"MAX_VIEWPORT_DIMS");f(this,"MAX_VERTEX_TEXTURE_IMAGE_UNITS");f(this,"MAX_TEXTURE_IMAGE_UNITS");f(this,"MAX_COMBINED_TEXTURE_IMAGE_UNITS");f(this,"MAX_VERTEX_ATTRIBS");f(this,"MAX_VARYING_VECTORS");f(this,"MAX_VERTEX_UNIFORM_VECTORS");f(this,"MAX_FRAGMENT_UNIFORM_VECTORS");f(this,"TEXTURE_MAG_FILTER");f(this,"TEXTURE_MIN_FILTER");f(this,"TEXTURE_WRAP_S");f(this,"TEXTURE_WRAP_T");f(this,"LINEAR");f(this,"CLAMP_TO_EDGE");f(this,"RGBA");f(this,"UNSIGNED_BYTE");f(this,"UNPACK_PREMULTIPLY_ALPHA_WEBGL");f(this,"UNPACK_FLIP_Y_WEBGL");f(this,"FLOAT");f(this,"TRIANGLES");f(this,"UNSIGNED_SHORT");f(this,"ONE");f(this,"ONE_MINUS_SRC_ALPHA");f(this,"VERTEX_SHADER");f(this,"FRAGMENT_SHADER");f(this,"STATIC_DRAW");f(this,"COMPILE_STATUS");f(this,"LINK_STATUS");f(this,"DYNAMIC_DRAW");f(this,"COLOR_ATTACHMENT0");this.gl=t,this.activeTextureUnit=t.getParameter(t.ACTIVE_TEXTURE)-t.TEXTURE0;const e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.texture2dUnits=new Array(e).fill(void 0).map((i,o)=>(this.activeTexture(o),t.getParameter(t.TEXTURE_BINDING_2D))),this.activeTexture(this.activeTextureUnit),this.scissorEnabled=t.isEnabled(t.SCISSOR_TEST);const s=t.getParameter(t.SCISSOR_BOX);this.scissorX=s[0],this.scissorY=s[1],this.scissorWidth=s[2],this.scissorHeight=s[3],this.blendEnabled=t.isEnabled(t.BLEND),this.blendSrcRgb=t.getParameter(t.BLEND_SRC_RGB),this.blendDstRgb=t.getParameter(t.BLEND_DST_RGB),this.blendSrcAlpha=t.getParameter(t.BLEND_SRC_ALPHA),this.blendDstAlpha=t.getParameter(t.BLEND_DST_ALPHA),this.boundArrayBuffer=t.getParameter(t.ARRAY_BUFFER_BINDING),this.boundElementArrayBuffer=t.getParameter(t.ELEMENT_ARRAY_BUFFER_BINDING),this.curProgram=t.getParameter(t.CURRENT_PROGRAM),this.canvas=t.canvas,this.MAX_RENDERBUFFER_SIZE=t.MAX_RENDERBUFFER_SIZE,this.MAX_TEXTURE_SIZE=t.MAX_TEXTURE_SIZE,this.MAX_VIEWPORT_DIMS=t.MAX_VIEWPORT_DIMS,this.MAX_VERTEX_TEXTURE_IMAGE_UNITS=t.MAX_VERTEX_TEXTURE_IMAGE_UNITS,this.MAX_TEXTURE_IMAGE_UNITS=t.MAX_TEXTURE_IMAGE_UNITS,this.MAX_COMBINED_TEXTURE_IMAGE_UNITS=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS,this.MAX_VERTEX_ATTRIBS=t.MAX_VERTEX_ATTRIBS,this.MAX_VARYING_VECTORS=t.MAX_VARYING_VECTORS,this.MAX_VERTEX_UNIFORM_VECTORS=t.MAX_VERTEX_UNIFORM_VECTORS,this.MAX_FRAGMENT_UNIFORM_VECTORS=t.MAX_FRAGMENT_UNIFORM_VECTORS,this.TEXTURE_MAG_FILTER=t.TEXTURE_MAG_FILTER,this.TEXTURE_MIN_FILTER=t.TEXTURE_MIN_FILTER,this.TEXTURE_WRAP_S=t.TEXTURE_WRAP_S,this.TEXTURE_WRAP_T=t.TEXTURE_WRAP_T,this.LINEAR=t.LINEAR,this.CLAMP_TO_EDGE=t.CLAMP_TO_EDGE,this.RGBA=t.RGBA,this.UNSIGNED_BYTE=t.UNSIGNED_BYTE,this.UNPACK_PREMULTIPLY_ALPHA_WEBGL=t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.UNPACK_FLIP_Y_WEBGL=t.UNPACK_FLIP_Y_WEBGL,this.FLOAT=t.FLOAT,this.TRIANGLES=t.TRIANGLES,this.UNSIGNED_SHORT=t.UNSIGNED_SHORT,this.ONE=t.ONE,this.ONE_MINUS_SRC_ALPHA=t.ONE_MINUS_SRC_ALPHA,this.MAX_VERTEX_TEXTURE_IMAGE_UNITS=t.MAX_VERTEX_TEXTURE_IMAGE_UNITS,this.TRIANGLES=t.TRIANGLES,this.UNSIGNED_SHORT=t.UNSIGNED_SHORT,this.VERTEX_SHADER=t.VERTEX_SHADER,this.FRAGMENT_SHADER=t.FRAGMENT_SHADER,this.STATIC_DRAW=t.STATIC_DRAW,this.COMPILE_STATUS=t.COMPILE_STATUS,this.LINK_STATUS=t.LINK_STATUS,this.DYNAMIC_DRAW=t.DYNAMIC_DRAW,this.COLOR_ATTACHMENT0=t.COLOR_ATTACHMENT0}isWebGl2(){return Yo(this.gl)}activeTexture(t){const{gl:e}=this;this.activeTextureUnit!==t&&(e.activeTexture(t+e.TEXTURE0),this.activeTextureUnit=t)}bindTexture(t){const{gl:e,activeTextureUnit:s,texture2dUnits:i}=this;i[s]!==t&&(i[s]=t,e.bindTexture(this.gl.TEXTURE_2D,t))}_getActiveTexture(){const{activeTextureUnit:t,texture2dUnits:e}=this;return e[t]}texParameteri(t,e){const{gl:s,texture2dParams:i}=this,o=this._getActiveTexture();if(!o)throw new Error("No active texture");let a=i.get(o);a||(a={},i.set(o,a)),a[t]!==e&&(a[t]=e,s.texParameteri(s.TEXTURE_2D,t,e))}texImage2D(t,e,s,i,o,a,n,l){const{gl:c}=this;a?c.texImage2D(c.TEXTURE_2D,t,e,s,i,o,a,n,l):c.texImage2D(c.TEXTURE_2D,t,e,s,i,o)}compressedTexImage2D(t,e,s,i,o,a){const{gl:n}=this;n.compressedTexImage2D(n.TEXTURE_2D,t,e,s,i,o,a)}pixelStorei(t,e){const{gl:s}=this;s.pixelStorei(t,e)}generateMipmap(){const{gl:t}=this;t.generateMipmap(t.TEXTURE_2D)}createTexture(){const{gl:t}=this;return t.createTexture()}deleteTexture(t){const{gl:e}=this;t&&this.texture2dParams.delete(t),e.deleteTexture(t)}viewport(t,e,s,i){const{gl:o}=this;o.viewport(t,e,s,i)}clearColor(t,e,s,i){const{gl:o}=this;o.clearColor(t,e,s,i)}setScissorTest(t){const{gl:e,scissorEnabled:s}=this;t!==s&&(t?e.enable(e.SCISSOR_TEST):e.disable(e.SCISSOR_TEST),this.scissorEnabled=t)}scissor(t,e,s,i){const{gl:o,scissorX:a,scissorY:n,scissorWidth:l,scissorHeight:c}=this;(t!==a||e!==n||s!==l||i!==c)&&(o.scissor(t,e,s,i),this.scissorX=t,this.scissorY=e,this.scissorWidth=s,this.scissorHeight=i)}setBlend(t){const{gl:e,blendEnabled:s}=this;t!==s&&(t?e.enable(e.BLEND):e.disable(e.BLEND),this.blendEnabled=t)}blendFunc(t,e){const{gl:s,blendSrcRgb:i,blendDstRgb:o,blendSrcAlpha:a,blendDstAlpha:n}=this;(t!==i||e!==o||t!==a||e!==n)&&(s.blendFunc(t,e),this.blendSrcRgb=t,this.blendDstRgb=e,this.blendSrcAlpha=t,this.blendDstAlpha=e)}createBuffer(){const{gl:t}=this;return t.createBuffer()}createFramebuffer(){const{gl:t}=this;return t.createFramebuffer()}bindFramebuffer(t){const{gl:e}=this;e.bindFramebuffer(e.FRAMEBUFFER,t)}framebufferTexture2D(t,e,s){const{gl:i}=this;i.framebufferTexture2D(i.FRAMEBUFFER,t,i.TEXTURE_2D,e,s)}clear(){const{gl:t}=this;t.clear(t.COLOR_BUFFER_BIT)}arrayBufferData(t,e,s){const{gl:i,boundArrayBuffer:o}=this;o!==t&&(i.bindBuffer(i.ARRAY_BUFFER,t),this.boundArrayBuffer=t),i.bufferData(i.ARRAY_BUFFER,e,s)}elementArrayBufferData(t,e,s){const{gl:i,boundElementArrayBuffer:o}=this;o!==t&&(i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,t),this.boundElementArrayBuffer=t),i.bufferData(i.ELEMENT_ARRAY_BUFFER,e,s)}vertexAttribPointer(t,e,s,i,o,a,n){const{gl:l,boundArrayBuffer:c}=this;c!==t&&(l.bindBuffer(l.ARRAY_BUFFER,t),this.boundArrayBuffer=t),l.vertexAttribPointer(e,s,i,o,a,n)}useProgram(t){const{gl:e,curProgram:s}=this;s!==t&&(e.useProgram(t),this.curProgram=t)}setUniform(t,e,...s){const{gl:i,programUniforms:o}=this;let a=o.get(this.curProgram);a||(a=new Map,o.set(this.curProgram,a));const n=a.get(e);(!n||!jo(n,s))&&(a.set(e,s),i[t](e,...s))}getParameter(t){const{gl:e}=this;return e.getParameter(t)}drawElements(t,e,s,i){const{gl:o}=this;o.drawElements(t,e,s,i)}getExtension(t){const{gl:e}=this;return e.getExtension(t)}createVertexArray(){const{gl:t}=this;return E(t instanceof WebGL2RenderingContext),t.createVertexArray()}bindVertexArray(t){const{gl:e}=this;E(e instanceof WebGL2RenderingContext),e.bindVertexArray(t)}getAttribLocation(t,e){const{gl:s}=this;return s.getAttribLocation(t,e)}getUniformLocation(t,e){const{gl:s}=this;return s.getUniformLocation(t,e)}enableVertexAttribArray(t){const{gl:e}=this;e.enableVertexAttribArray(t)}disableVertexAttribArray(t){const{gl:e}=this;e.disableVertexAttribArray(t)}createShader(t){const{gl:e}=this;return e.createShader(t)}compileShader(t){const{gl:e}=this;e.compileShader(t)}attachShader(t,e){const{gl:s}=this;s.attachShader(t,e)}linkProgram(t){const{gl:e}=this;e.linkProgram(t)}deleteProgram(t){const{gl:e}=this;e.deleteProgram(t)}getShaderParameter(t,e){const{gl:s}=this;return s.getShaderParameter(t,e)}getShaderInfoLog(t){const{gl:e}=this;return e.getShaderInfoLog(t)}createProgram(){const{gl:t}=this;return t.createProgram()}getProgramParameter(t,e){const{gl:s}=this;return s.getProgramParameter(t,e)}getProgramInfoLog(t){const{gl:e}=this;return e.getProgramInfoLog(t)}shaderSource(t,e){const{gl:s}=this;s.shaderSource(t,e)}deleteShader(t){const{gl:e}=this;e.deleteShader(t)}}function jo(r,t){return r.length!==t.length?!1:r.every((e,s)=>Array.isArray(e)||e instanceof Float32Array?!1:e===t[s])}class wr extends ps{constructor(e,s,i){super(e,s,i);f(this,"framebuffer");const o=e.createFramebuffer();E(o,"Unable to create framebuffer"),this.framebuffer=o}async onLoadRequest(){const{glw:e}=this,s=this._nativeCtxTexture=this.createNativeCtxTexture(),{width:i,height:o}=this.textureSource;return e.texImage2D(0,e.RGBA,i,o,0,e.RGBA,e.UNSIGNED_BYTE,null),this.setTextureMemUse(i*o*4),e.bindFramebuffer(this.framebuffer),e.framebufferTexture2D(e.COLOR_ATTACHMENT0,s,0),e.bindFramebuffer(null),{width:i,height:o}}}const qo=24;class nr extends Jr{constructor(e){super(e);f(this,"glw");f(this,"system");f(this,"quadBuffer");f(this,"fQuadBuffer");f(this,"uiQuadBuffer");f(this,"renderOps",[]);f(this,"curBufferIdx",0);f(this,"curRenderOp",null);f(this,"rttNodes",[]);f(this,"activeRttNode",null);f(this,"defShaderCtrl");f(this,"defaultShader");f(this,"quadBufferCollection");f(this,"defaultTexture");f(this,"quadBufferUsage",0);f(this,"renderToTextureActive",!1);this.quadBuffer=new ArrayBuffer(this.stage.options.quadBufferSize),this.fQuadBuffer=new Float32Array(this.quadBuffer),this.uiQuadBuffer=new Uint32Array(this.quadBuffer),this.mode="webgl";const{canvas:s,clearColor:i,bufferMemory:o}=e;this.defaultTexture=new ds(this.txManager),this.defaultTexture.setRenderableOwner(this,!0),this.defaultTexture.once("loaded",()=>{this.stage.requestRender()});const a=Yi(s,e.contextSpy),n=this.glw=new Ko(a),l=wt(i);n.viewport(0,0,s.width,s.height),n.clearColor(l[0],l[1],l[2],l[3]),n.setBlend(!0),n.blendFunc(n.ONE,n.ONE_MINUS_SRC_ALPHA),Wo(n,o),this.system={parameters:Xo(this.glw),extensions:Go(this.glw)},this.shManager.renderer=this,this.defShaderCtrl=this.shManager.loadShader("DefaultShader"),this.defaultShader=this.defShaderCtrl.shader;const c=n.createBuffer();E(c);const h=6*Float32Array.BYTES_PER_ELEMENT;this.quadBufferCollection=new si([{buffer:c,attributes:{a_position:{name:"a_position",size:2,type:n.FLOAT,normalized:!1,stride:h,offset:0},a_textureCoordinate:{name:"a_textureCoordinate",size:2,type:n.FLOAT,normalized:!1,stride:h,offset:2*Float32Array.BYTES_PER_ELEMENT},a_color:{name:"a_color",size:4,type:n.UNSIGNED_BYTE,normalized:!0,stride:h,offset:4*Float32Array.BYTES_PER_ELEMENT},a_textureIndex:{name:"a_textureIndex",size:1,type:n.FLOAT,normalized:!1,stride:h,offset:5*Float32Array.BYTES_PER_ELEMENT}}}])}reset(){const{glw:e}=this;this.curBufferIdx=0,this.curRenderOp=null,this.renderOps.length=0,e.setScissorTest(!1),e.clear()}getShaderManager(){return this.shManager}createCtxTexture(e){return e instanceof rt?new Ho(this.glw,this.txMemManager,e):e instanceof bt?new wr(this.glw,this.txMemManager,e):new ps(this.glw,this.txMemManager,e)}addQuad(e){const{fQuadBuffer:s,uiQuadBuffer:i}=this,{width:o,height:a,colorTl:n,colorTr:l,colorBl:c,colorBr:h,textureOptions:d,shader:u,shaderProps:x,alpha:m,clippingRect:g,tx:b,ty:T,ta:_,tb:C,tc:S,td:P,renderCoords:G,rtt:I,parentHasRenderTexture:L,framebufferDimensions:F}=e;let{texture:M}=e;if(x!==null){if(cs(x,"$dimensions")){const q=x.$dimensions;q.width=o,q.height=a}cs(x,"$alpha")&&(x.$alpha=m)}M=M??this.defaultTexture,E(M instanceof it,"Invalid texture type");let{curBufferIdx:y,curRenderOp:z}=this;const N={width:o,height:a},V=u||this.defaultShader;E(V instanceof Fe),this.reuseRenderOp(e)||(this.newRenderOp(V,x,m,N,g,y,I,L,F),z=this.curRenderOp,E(z));const A=(d==null?void 0:d.flipX)??!1;let v=(d==null?void 0:d.flipY)??!1;M instanceof bt&&(v=!v);let R=0,O=0,k=1,D=1;if(M instanceof rt){const{x:q,y:H,width:Z,height:K}=M.props,{width:Y=0,height:ee=0}=M.parentTexture.dimensions||{width:0,height:0};R=q/Y,k=R+Z/Y,O=H/ee,D=O+K/ee,M=M.parentTexture}const X=(d==null?void 0:d.resizeMode)??!1;if(M instanceof us&&X&&M.dimensions){const{width:q,height:H}=M.dimensions;if(X.type==="cover"){const Z=o/q,K=a/H,Y=Math.max(Z,K),ee=1/Y;if(Y&&Z&&Z<Y){const J=ee*o;R=(1-J/q)*(X.clipX??.5),k=R+J/q}if(Y&&K&&K<Y){const J=ee*a;O=(1-J/H)*(X.clipY??.5),D=O+J/H}}}A&&([R,k]=[k,R]),v&&([O,D]=[D,O]);const U=M.ctxTexture;E(U instanceof ps);const W=this.addTexture(U,y);if(z=this.curRenderOp,E(z),G){const{x1:q,y1:H,x2:Z,y2:K,x3:Y,y3:ee,x4:J,y4:oe}=G;s[y++]=q,s[y++]=H,s[y++]=R,s[y++]=O,i[y++]=n,s[y++]=W,s[y++]=Z,s[y++]=K,s[y++]=k,s[y++]=O,i[y++]=l,s[y++]=W,s[y++]=J,s[y++]=oe,s[y++]=R,s[y++]=D,i[y++]=c,s[y++]=W,s[y++]=Y,s[y++]=ee,s[y++]=k,s[y++]=D,i[y++]=h,s[y++]=W}else if(C!==0||S!==0)s[y++]=b,s[y++]=T,s[y++]=R,s[y++]=O,i[y++]=n,s[y++]=W,s[y++]=b+o*_,s[y++]=T+o*S,s[y++]=k,s[y++]=O,i[y++]=l,s[y++]=W,s[y++]=b+a*C,s[y++]=T+a*P,s[y++]=R,s[y++]=D,i[y++]=c,s[y++]=W,s[y++]=b+o*_+a*C,s[y++]=T+o*S+a*P,s[y++]=k,s[y++]=D,i[y++]=h,s[y++]=W;else{const q=b+o*_,H=T+a*P;s[y++]=b,s[y++]=T,s[y++]=R,s[y++]=O,i[y++]=n,s[y++]=W,s[y++]=q,s[y++]=T,s[y++]=k,s[y++]=O,i[y++]=l,s[y++]=W,s[y++]=b,s[y++]=H,s[y++]=R,s[y++]=D,i[y++]=c,s[y++]=W,s[y++]=q,s[y++]=H,s[y++]=k,s[y++]=D,i[y++]=h,s[y++]=W}z.length+=qo,z.numQuads++,this.curBufferIdx=y}newRenderOp(e,s,i,o,a,n,l,c,h){const d=new ti(this.glw,this.options,this.quadBufferCollection,e,s,i,a,o,n,0,l,c,h);this.curRenderOp=d,this.renderOps.push(d)}addTexture(e,s,i){const{curRenderOp:o}=this;E(o);const a=o.addTexture(e);if(a===4294967295){if(i)throw new Error("Unable to add texture to render op");const{shader:n,shaderProps:l,dimensions:c,clippingRect:h,alpha:d}=o;return this.newRenderOp(n,l,d,c,h,s),this.addTexture(e,s,!0)}return a}reuseRenderOp(e){var c;const{shader:s,shaderProps:i,parentHasRenderTexture:o,rtt:a,clippingRect:n}=e,l=s||this.defaultShader;return!(((c=this.curRenderOp)==null?void 0:c.shader)!==l||!so(this.curRenderOp.clippingRect,n)||o||a||this.curRenderOp.shader!==this.defaultShader&&(!i||!this.curRenderOp.shader.canBatchShaderProps(this.curRenderOp.shaderProps,i)))}addRenderOp(e){this.renderOps.push(e),this.curRenderOp=null}render(e="screen"){const{glw:s,quadBuffer:i}=this,o=new Float32Array(i,0,this.curBufferIdx),a=this.quadBufferCollection.getBuffer("a_position")??null;s.arrayBufferData(a,o,s.STATIC_DRAW),this.renderOps.forEach((n,l)=>{n.draw()}),this.quadBufferUsage=this.curBufferIdx*o.BYTES_PER_ELEMENT}renderToTexture(e){for(let s=0;s<this.rttNodes.length;s++)if(this.rttNodes[s]===e)return;this.rttNodes.unshift(e)}renderRTTNodes(){const{glw:e}=this;this.stage;for(let s=0;s<this.rttNodes.length;s++){const i=this.rttNodes[s];if(!i||!i.hasRTTupdates)continue;this.activeRttNode=i,E(i.texture,"RTT node missing texture");const o=i.texture.ctxTexture;E(o instanceof wr),this.renderToTextureActive=!0,e.bindFramebuffer(o.framebuffer),e.viewport(0,0,o.w,o.h),e.clear();for(let a=0;a<i.children.length;a++){const n=i.children[a];n&&(n.update(this.stage.deltaTime,{x:0,y:0,width:0,height:0,valid:!1}),this.stage.addQuads(n),n.hasRTTupdates=!1)}this.render(),this.renderOps.length=0,i.hasRTTupdates=!1}e.bindFramebuffer(null),e.viewport(0,0,this.glw.canvas.width,this.glw.canvas.height),this.renderToTextureActive=!1}removeRTTNode(e){const s=this.rttNodes.indexOf(e);s!==-1&&this.rttNodes.splice(s,1)}getBufferInfo(){return{totalAvailable:this.stage.options.quadBufferSize,totalUsed:this.quadBufferUsage}}getDefShaderCtr(){return this.defShaderCtrl}}const Zo={LINE_FEED:10,CARRIAGE_RETURN:13,SPACE:32,TAB:9,ZERO_WIDTH_SPACE:8203,ZERO_WIDTH_NON_JOINER:8204,ZERO_WIDTH_JOINER:8205,LEFT_TO_RIGHT_MARK:8206,RIGHT_TO_LEFT_MARK:8207,LEFT_TO_RIGHT_EMBEDDING:8234,RIGHT_TO_LEFT_EMBEDDING:8235,POP_DIRECTIONAL_FORMATTING:8236,LEFT_TO_RIGHT_OVERRIDE:8237,RIGHT_TO_LEFT_OVERRIDE:8238,LINE_SEPARATOR:8232,PARAGRAPH_SEPARATOR:8233,OBJECT_REPLACEMENT_CHARACTER:65532,REPLACEMENT_CHARACTER:65533,ZERO_WIDTH_NO_BREAK_SPACE:65279,LEFT_TO_RIGHT_ISOLATE:8294,RIGHT_TO_LEFT_ISOLATE:8295,FIRST_STRONG_ISOLATE:8296,POP_DIRECTIONAL_ISOLATE:8297,INHIBIT_SYMMETRIC_SWAPPING:8298,ACTIVATE_SYMMETRIC_SWAPPING:8299,INHIBIT_ARABIC_FORM_SHAPING:8300,ACTIVATE_ARABIC_FORM_SHAPING:8301,NATIONAL_DIGIT_SHAPES:8302,NOMINAL_DIGIT_SHAPES:8303,LEFT_TO_RIGHT_BOUNDARY:8206,RIGHT_TO_LEFT_BOUNDARY:8207};class Qo{}class Jo extends Qo{constructor(e,s){super();f(this,"data");f(this,"glyphMap");f(this,"kernings");this.data=e,this.glyphMap=s;const i=this.kernings={};e.kernings.forEach(o=>{const a=o.second,n=i[a]=i[a]||{};n[o.first]=o.amount}),this.kernings=i}*shapeText(e,s){var a;let i,o;for(;(i=s.peek())&&!i.done;){const n=i.value,l=this.glyphMap.get(n);if(s.next(),l!==void 0){const c=o!==void 0?(((a=this.kernings[l.id])==null?void 0:a[o])||0)+e.letterSpacing:0;o=l.id,yield{mapped:!0,glyphId:l.id,codepoint:n,cluster:s.lastIndex,xAdvance:l.xadvance+c,yAdvance:0,xOffset:l.xoffset+c,yOffset:l.yoffset,xBearing:0,yBearing:0,width:l.width,height:l.height}}else n===Zo.LINE_FEED&&(o=void 0),yield{mapped:!1,codepoint:n,cluster:s.lastIndex}}}}class Ys extends ei{constructor(e,s){super(s);f(this,"type");f(this,"texture");f(this,"maxCharHeight",0);f(this,"data");f(this,"shaper");f(this,"glyphMap",new Map);const{atlasUrl:i,atlasDataUrl:o,stage:a}=s;this.type=e;const n=a.renderer;E(n instanceof nr,"SDF Font Faces can only be used with the WebGL Renderer"),this.texture=a.txManager.loadTexture("ImageTexture",{src:i,premultiplyAlpha:!1}),this.texture.on("loaded",()=>{this.checkLoaded(),a.requestRender()}),this.texture.ctxTexture.load(),fetch(o).then(async l=>{var h;this.data=await l.json(),E(this.data);let c=0;if(this.data.chars.forEach(d=>{this.glyphMap.set(d.id,d);const u=d.yoffset+d.height;u>c&&(c=u)}),this.maxCharHeight=c,this.shaper=new Jo(this.data,this.glyphMap),!this.metrics)if((h=this.data)!=null&&h.lightningMetrics){const{ascender:d,descender:u,lineGap:x,unitsPerEm:m}=this.data.lightningMetrics;this.metrics={ascender:d/m,descender:u/m,lineGap:x/m}}else throw new Error(`Font metrics not found in ${this.type} font ${this.fontFamily}. Make sure you are using the latest version of the Lightning 3 \`msdf-generator\` tool to generate your SDF fonts.`);this.checkLoaded()}).catch(console.error)}getAtlasEntry(e){const s=this.glyphMap.get(e);if(s===void 0)throw new Error(`Glyph ${e} not found in font ${this.fontFamily}`);return{x:s.x,y:s.y,width:s.width,height:s.height}}checkLoaded(){this.loaded||this.texture.state==="loaded"&&this.data&&(this.loaded=!0,this.emit("loaded"))}}const en=24;function tn(r,t,e,s,i,o,a,n,l){const c=Math.min(Math.max(a.firstLineIdx,0),n.length),h=0,{metrics:d}=e;E(d,"Font metrics not loaded"),E(e.data,"Font data not loaded");const u=(d.ascender-d.descender)*r;let x=0;s==="middle"?x=(t-u)/2:s==="bottom"&&(x=t-u);const m=i/o,g=e.data.common.base,T=d.ascender*r-g,_=m+T+c*t+x;if(!(l&&_>=l/o))return{sdfX:h,sdfY:_,lineIndex:c}}class pt{constructor(t,e=0){f(this,"iterator");f(this,"peekBuffer",[]);f(this,"_lastIndex");this.iterator=t,this.iterator=t,this._lastIndex=e-1,this.peekBuffer=[]}next(){const t=this.peekBuffer.length>0?this.peekBuffer.pop():this.iterator.next();return t.done?this._lastIndex=-1:this._lastIndex++,t}peek(){if(this.peekBuffer.length>0)return this.peekBuffer[0];const t=this.iterator.next();return this.peekBuffer.push(t),t}get lastIndex(){return this._lastIndex}}function*mt(r,t=0){let e=t;for(;e<r.length;){const s=r.codePointAt(e);if(s===void 0)throw new Error("Invalid Unicode code point");yield s,e+=s<=65535?1:2}}function sn(r,t,e){const s=e.shapeText(t,new pt(mt(r,0),0));let i=0;for(const o of s)o.mapped&&(i+=o.xAdvance);return i}function rn(r,t,e,s,i,o,a,n,l,c,h,d,u,x,m,g,b,T,_){E(m,"Font face must be loaded"),E(m.loaded,"Font face must be loaded"),E(m.data,"Font face must be loaded"),E(m.shaper,"Font face must be loaded");const C=n/m.data.info.size,S=l/C,P=o/C,G=c/C,I=u[r],L=(I==null?void 0:I.codepointIndex)||0,F=(I==null?void 0:I.maxX)||0,M=(I==null?void 0:I.maxY)||0;let y=F,z=M,N=t,V=e,A=0;const v={codepointIndex:-1,bufferOffset:-1,xStart:-1},R=m.shaper,O={letterSpacing:G};let k=R.shapeText(O,new pt(mt(s,L),L)),D,X=-1;const U=[],W=a/C,q=sn(T,O,R);let H=!0;for(;H;){const Z=(_===0||r+1<_)&&(d!=="both"||b||V+S+m.maxCharHeight<=W),K=Z?P:P-q;let Y=0;const ee=V+m.maxCharHeight>=x.y1,J=V<=x.y2,oe=ee&&J;for(;(D=k.next())&&!D.done;){const j=D.value;if(r===u.length)u.push({codepointIndex:j.cluster,maxY:z,maxX:y});else if(r>u.length)throw new Error("Unexpected lineCache length");if(j.codepoint===32||j.codepoint===10?v.codepointIndex!==-1&&(v.codepointIndex=-1,Y=N):v.codepointIndex===-1&&(v.codepointIndex=j.cluster,v.bufferOffset=A,v.xStart=Y),j.mapped){const De=N+j.xOffset+j.width;if(d!=="none"&&De>=K&&v.codepointIndex!==-1&&v.xStart>0)if(Z){k=R.shapeText(O,new pt(mt(s,v.codepointIndex),v.codepointIndex)),A=v.bufferOffset;break}else k=R.shapeText(O,new pt(mt(T,0),0)),N=v.xStart,A=v.bufferOffset,d="none";else{const ce=N+j.xOffset,ie=V+j.yOffset;if(oe){X===-1&&(X=A);const Ne=m.getAtlasEntry(j.glyphId),ne=Ne.x/m.data.common.scaleW,he=Ne.y/m.data.common.scaleH,ze=Ne.width/m.data.common.scaleW,ke=Ne.height/m.data.common.scaleH;h[A++]=ce,h[A++]=ie,h[A++]=ne,h[A++]=he,h[A++]=ce+j.width,h[A++]=ie,h[A++]=ne+ze,h[A++]=he,h[A++]=ce,h[A++]=ie+j.height,h[A++]=ne,h[A++]=he+ke,h[A++]=ce+j.width,h[A++]=ie+j.height,h[A++]=ne+ze,h[A++]=he+ke}z=Math.max(z,ie+j.height),y=Math.max(y,ce+j.width),N+=j.xAdvance}}else if(j.codepoint===10){if(Z)break;k=R.shapeText(O,new pt(mt(T,0),0)),d="none"}}X!==-1&&(U.push({bufferStart:X,bufferEnd:A}),X=-1),N=0,V+=S,r++,v.codepointIndex=-1,Y=0,!g&&d==="both"&&V>x.y2||D&&D.done?H=!1:Z||(H=!1)}if(i==="center"){const Z=d==="none"?y:P;for(let K=0;K<U.length;K++){const Y=U[K],ee=h[Y.bufferEnd-4]-h[Y.bufferStart],J=(Z-ee)/2;for(let oe=Y.bufferStart;oe<Y.bufferEnd;oe+=4)h[oe]+=J}}else if(i==="right"){const Z=d==="none"?y:P;for(let K=0;K<U.length;K++){const Y=U[K],ee=Y.bufferEnd===Y.bufferStart?0:h[Y.bufferEnd-4]-h[Y.bufferStart],J=Z-ee;for(let oe=Y.bufferStart;oe<Y.bufferEnd;oe+=4)h[oe]+=J}}return E(D),{bufferNumFloats:A,bufferNumQuads:A/16,layoutNumCharacters:D.done?s.length-L:D.value.cluster-L+1,fullyProcessed:!!D.done,maxX:y,maxY:z,numLines:u.length}}function on(r,t){return Math.ceil(r/t)*t}function nn(r,t){return Math.floor(r/t)*t}function an(r,t,e,s,i,o,a,n){const{screen:l,sdf:c}=r;if(!io(a))l.x1=0,l.y1=0,l.x2=0,l.y2=0,c.x1=0,c.y1=0,c.x2=0,c.y2=0,r.numLines=0,r.firstLineIdx=0;else{const h=a.x1-t,d=h+(a.x2-a.x1),u=a.y1-e+s,x=nn(u-o,i||1),m=on(u+(a.y2-a.y1)+o,i||1);l.x1=h,l.y1=x,l.x2=d,l.y2=m,c.x1=h/n,c.y1=x/n,c.x2=d/n,c.y2=m/n,r.numLines=Math.ceil((m-x)/i),r.firstLineIdx=i?Math.floor(x/i):0}r.valid=!0}function ri(r,t){return t*(r.ascender-r.descender+r.lineGap)}const ln={x:0,y:0,width:0,height:0};class fn extends or{constructor(e){super(e);f(this,"ssdfFontFamilies",{});f(this,"msdfFontFamilies",{});f(this,"fontFamilyArray",[this.ssdfFontFamilies,this.msdfFontFamilies]);f(this,"sdfShader");f(this,"rendererBounds");f(this,"type","sdf");this.sdfShader=this.stage.shManager.loadShader("SdfShader").shader,this.rendererBounds={x1:0,y1:0,x2:this.stage.options.appWidth,y2:this.stage.options.appHeight}}getPropertySetters(){return{fontFamily:(e,s)=>{e.props.fontFamily=s,this.releaseFontFace(e),this.invalidateLayoutCache(e)},fontWeight:(e,s)=>{e.props.fontWeight=s,this.releaseFontFace(e),this.invalidateLayoutCache(e)},fontStyle:(e,s)=>{e.props.fontStyle=s,this.releaseFontFace(e),this.invalidateLayoutCache(e)},fontStretch:(e,s)=>{e.props.fontStretch=s,this.releaseFontFace(e),this.invalidateLayoutCache(e)},fontSize:(e,s)=>{e.props.fontSize=s,this.invalidateLayoutCache(e)},text:(e,s)=>{e.props.text=s,this.invalidateLayoutCache(e)},textAlign:(e,s)=>{e.props.textAlign=s,this.invalidateLayoutCache(e)},color:(e,s)=>{e.props.color=s},x:(e,s)=>{e.props.x=s,e.elementBounds.valid&&(this.setElementBoundsX(e),!e.renderWindow.valid&&Ms(e.elementBounds,this.rendererBounds)&&this.scheduleUpdateState(e))},y:(e,s)=>{e.props.y=s,e.elementBounds.valid&&(this.setElementBoundsY(e),!e.renderWindow.valid&&Ms(e.elementBounds,this.rendererBounds)&&this.scheduleUpdateState(e))},contain:(e,s)=>{e.props.contain=s,this.invalidateLayoutCache(e)},width:(e,s)=>{e.props.width=s,e.props.contain!=="none"&&this.invalidateLayoutCache(e)},height:(e,s)=>{e.props.height=s,e.props.contain==="both"&&this.invalidateLayoutCache(e)},offsetY:(e,s)=>{e.props.offsetY=s,this.invalidateLayoutCache(e)},scrollable:(e,s)=>{e.props.scrollable=s,this.invalidateLayoutCache(e)},scrollY:(e,s)=>{e.props.scrollY=s,this.scheduleUpdateState(e)},letterSpacing:(e,s)=>{e.props.letterSpacing=s,this.invalidateLayoutCache(e)},lineHeight:(e,s)=>{e.props.lineHeight=s,e.resLineHeight=void 0,this.invalidateLayoutCache(e)},maxLines:(e,s)=>{e.props.maxLines=s,this.invalidateLayoutCache(e)},textBaseline:(e,s)=>{e.props.textBaseline=s,this.invalidateLayoutCache(e)},verticalAlign:(e,s)=>{e.props.verticalAlign=s,this.invalidateLayoutCache(e)},overflowSuffix:(e,s)=>{e.props.overflowSuffix=s,this.invalidateLayoutCache(e)},debug:(e,s)=>{e.props.debug=s}}}canRenderFont(e){const{fontFamily:s}=e;return s in this.ssdfFontFamilies||s in this.msdfFontFamilies||s==="$$SDF_FAILURE_TEST$$"}isFontFaceSupported(e){return e instanceof Ys}addFontFace(e){E(e instanceof Ys);const s=e.fontFamily,i=e.type==="ssdf"?this.ssdfFontFamilies:e.type==="msdf"?this.msdfFontFamilies:void 0;if(!i){console.warn(`Invalid font face type: ${e.type}`);return}let o=i[s];o||(o=new Set,i[s]=o),o.add(e)}createState(e){return{props:e,status:"initialState",updateScheduled:!1,emitter:new Pe,lineCache:[],forceFullLayoutCalc:!1,renderWindow:{screen:{x1:0,y1:0,x2:0,y2:0},sdf:{x1:0,y1:0,x2:0,y2:0},firstLineIdx:0,numLines:0,valid:!1},elementBounds:{x1:0,y1:0,x2:0,y2:0,valid:!1},clippingRect:{x:0,y:0,width:0,height:0,valid:!1},bufferNumFloats:0,bufferNumQuads:0,vertexBuffer:void 0,webGlBuffers:null,bufferUploaded:!1,textH:void 0,textW:void 0,distanceRange:0,trFontFace:void 0,isRenderable:!1,resLineHeight:void 0,debugData:{updateCount:0,layoutCount:0,lastLayoutNumCharacters:0,layoutSum:0,drawSum:0,drawCount:0,bufferSize:0}}}updateState(e){let{trFontFace:s}=e;const{textH:i,lineCache:o,debugData:a,forceFullLayoutCalc:n}=e;if(a.updateCount++,e.status==="initialState"&&this.setStatus(e,"loading"),!s){if(s=this.resolveFontFace(e.props),e.trFontFace=s,!s){const R=`SdfTextRenderer: Could not resolve font face for family: '${e.props.fontFamily}'`;console.error(R),this.setStatus(e,"failed",new Error(R));return}s.texture.setRenderableOwner(e,!0)}if(!s.loaded){s.once("loaded",()=>{this.scheduleUpdateState(e)});return}E(s.data,"Font face data should be loaded"),E(s.metrics,"Font face metrics should be loaded");const{text:l,fontSize:c,x:h,y:d,contain:u,width:x,height:m,verticalAlign:g,scrollable:b,overflowSuffix:T,maxLines:_}=e.props,C=u==="both"&&b?e.props.scrollY:0,{renderWindow:S}=e,P=s.data.info.size,G=c/P;let I=e.resLineHeight;if(I===void 0){const R=e.props.lineHeight;R===void 0?I=ri(s.metrics,c):I=R,e.resLineHeight=I}const L=I/G;e.distanceRange=G*s.data.distanceField.distanceRange;const F=l.length*en;let M=e.vertexBuffer;(!M||M.length<F)&&(M=new Float32Array(F*2));const y=e.elementBounds;if(y.valid||(this.setElementBoundsX(e),this.setElementBoundsY(e),y.valid=!0),!n&&S.valid){const R=S.screen;if(h+R.x1<=y.x1&&h+R.x2>=y.x2&&d-C+R.y1<=y.y1&&d-C+R.y2>=y.y2){this.setStatus(e,"loaded");return}S.valid=!1,this.setStatus(e,"loading")}const{offsetY:z,textAlign:N}=e.props;if(!S.valid){if(!Ms(y,this.rendererBounds))return;an(S,h,d,C,I,u==="both"?y.y2-y.y1:0,y,G)}const V=tn(P,L,s,g,z,G,S,o,i);if(!V){this.setStatus(e,"loaded");return}const{letterSpacing:A}=e.props,v=rn(V.lineIndex,V.sdfX,V.sdfY,l,N,x,m,c,I,A,M,u,o,S.sdf,s,n,b,T,_);e.bufferUploaded=!1,e.bufferNumFloats=v.bufferNumFloats,e.bufferNumQuads=v.bufferNumQuads,e.vertexBuffer=M,e.renderWindow=S,a.lastLayoutNumCharacters=v.layoutNumCharacters,a.bufferSize=M.byteLength,v.fullyProcessed&&(e.textW=v.maxX*G,e.textH=v.numLines*L*G),this.setStatus(e,"loaded")}renderQuads(e,s,i,o,a,n){var y,z;if(!e.vertexBuffer)return;const l=this.stage.renderer;E(l instanceof nr);const{fontSize:c,color:h,contain:d,scrollable:u,zIndex:x,debug:m}=e.props,g=d==="both"&&u?e.props.scrollY:0,{textW:b=0,textH:T=0,distanceRange:_,vertexBuffer:C,bufferUploaded:S,trFontFace:P,elementBounds:G}=e;let{webGlBuffers:I}=e;if(!I){const N=l.glw,V=4*Float32Array.BYTES_PER_ELEMENT,A=N.createBuffer();E(A),e.webGlBuffers=new si([{buffer:A,attributes:{a_position:{name:"a_position",size:2,type:N.FLOAT,normalized:!1,stride:V,offset:0},a_textureCoordinate:{name:"a_textureCoordinate",size:2,type:N.FLOAT,normalized:!1,stride:V,offset:2*Float32Array.BYTES_PER_ELEMENT}}}]),e.bufferUploaded=!1,E(e.webGlBuffers),I=e.webGlBuffers}if(!S){const N=l.glw,V=(I==null?void 0:I.getBuffer("a_textureCoordinate"))??null;N.arrayBufferData(V,C,N.STATIC_DRAW),e.bufferUploaded=!0}if(E(P),u&&d==="both"){E(G.valid);const N=to(G,ln);i.valid?(e.clippingRect.valid=!0,i=Gr(i,N,e.clippingRect)):(e.clippingRect.valid=!0,i=Wr(N,e.clippingRect))}const L=new ti(l.glw,l.options,I,this.sdfShader,{transform:s.getFloatArr(),color:Ki(h,o),size:c/(((y=P.data)==null?void 0:y.info.size)||0),scrollY:g,distanceRange:_,debug:m.sdfShaderDebug},o,i,{height:T,width:b},0,x,!1,a,n),F=(z=e.trFontFace)==null?void 0:z.texture;E(F);const M=F.ctxTexture;L.addTexture(M),L.length=e.bufferNumFloats,L.numQuads=e.bufferNumQuads,l.addRenderOp(L)}setIsRenderable(e,s){var i;super.setIsRenderable(e,s),(i=e.trFontFace)==null||i.texture.setRenderableOwner(e,s)}destroyState(e){var s;super.destroyState(e),(s=e.trFontFace)==null||s.texture.setRenderableOwner(e,!1)}resolveFontFace(e){return sr.resolveFontFace(this.fontFamilyArray,e)}releaseFontFace(e){e.resLineHeight=void 0,e.trFontFace&&(e.trFontFace.texture.setRenderableOwner(e,!1),e.trFontFace=void 0)}invalidateLayoutCache(e){e.renderWindow.valid=!1,e.elementBounds.valid=!1,e.textH=void 0,e.textW=void 0,e.lineCache=[],this.setStatus(e,"loading"),this.scheduleUpdateState(e)}setElementBoundsX(e){const{x:s,contain:i,width:o}=e.props,{elementBounds:a}=e;a.x1=s,a.x2=i!=="none"?s+o:1/0}setElementBoundsY(e){const{y:s,contain:i,height:o}=e.props,{elementBounds:a}=e;a.y1=s,a.y2=i==="both"?s+o:1/0}}function cn(r,t,e){if(t.metrics)return t.metrics;const s=r.measureText("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz");console.warn(`Font metrics not provided for Canvas Web font ${t.fontFamily}. Using fallback values. It is HIGHLY recommended you use the latest version of the Lightning 3 \`msdf-generator\` tool to extract the default metrics for the font and provide them in the Canvas Web font definition.`);let i;return s.actualBoundingBoxDescent&&s.actualBoundingBoxAscent?i={ascender:s.actualBoundingBoxAscent/e,descender:-s.actualBoundingBoxDescent/e,lineGap:.2}:i={ascender:.8,descender:-.2,lineGap:.2},t.metrics=i,i}const vr=2048;function _r(r,t,e,s,i){const o=r!=="bottom"?.5*t:0;return e*(s-1)+o+Math.max(e,t)+(i||0)}class hn{constructor(t,e){f(this,"_canvas");f(this,"_context");f(this,"_settings");this._canvas=t,this._context=e,this._settings=this.mergeDefaults({})}set settings(t){this._settings=this.mergeDefaults(t)}get settings(){return this._settings}getPrecision(){return this._settings.precision}setFontProperties(){this._context.font=this._getFontSetting(),this._context.textBaseline=this._settings.textBaseline}_getFontSetting(){const t=[this._settings.fontFamily],e=[];for(let s=0,i=t.length;s<i;s++)t[s]==="serif"||t[s]==="sans-serif"?e.push(t[s]):e.push(`"${t[s]}"`);return`${this._settings.fontStyle} ${this._settings.fontSize*this.getPrecision()}px ${e.join(",")}`}_load(){if(document.fonts){const t=this._getFontSetting();try{if(!document.fonts.check(t,this._settings.text))return document.fonts.load(t,this._settings.text).catch(e=>{console.warn("[Lightning] Font load error",e,t)}).then(()=>{document.fonts.check(t,this._settings.text)||console.warn("[Lightning] Font not found",t)})}catch{console.warn("[Lightning] Can't check font loading for "+t)}}}calculateRenderInfo(){const t={},e=this.getPrecision(),s=this._settings.paddingLeft*e,i=this._settings.paddingRight*e,o=this._settings.fontSize*e;let a=this._settings.offsetY===null?null:this._settings.offsetY*e;const n=this._settings.w*e,l=this._settings.h*e;let c=this._settings.wordWrapWidth*e;const h=this._settings.cutSx*e,d=this._settings.cutEx*e,u=this._settings.cutSy*e,x=this._settings.cutEy*e,m=(this._settings.letterSpacing||0)*e,g=this._settings.textIndent*e,b=this._settings.trFontFace;this.setFontProperties(),E(b);const T=cn(this._context,b,o),_=ri(T,o)*e,C=this._settings.lineHeight!==null?this._settings.lineHeight*e:_,S=this._settings.maxHeight,P=S!==null&&C>0?Math.floor(S/C):0,G=this._settings.maxLines,I=P>0&&G>0?Math.min(P,G):Math.max(P,G);let L=n||2048/this.getPrecision(),F=L-s;if(F<10&&(L+=10-F,F=10),c||(c=F),this._settings.textOverflow&&!this._settings.wordWrap){let A;switch(this._settings.textOverflow){case"clip":A="";break;case"ellipsis":A=this._settings.overflowSuffix;break;default:A=this._settings.textOverflow}this._settings.text=this.wrapWord(this._settings.text,c-g,A)}let M;if(this._settings.wordWrap)M=this.wrapText(this._settings.text,c,m,g);else{M={l:this._settings.text.split(/(?:\r\n|\r|\n)/),n:[]};const A=M.l.length;for(let v=0;v<A-1;v++)M.n.push(v)}let y=M.l;if(I&&y.length>I){const A=y.slice(0,I);let v=null;if(this._settings.overflowSuffix){const X=this._settings.overflowSuffix?this.measureText(this._settings.overflowSuffix):0,U=this.wrapText(A[A.length-1],c-X,m,g);A[A.length-1]=`${U.l[0]}${this._settings.overflowSuffix}`,v=[U.l.length>1?U.l[1]:""]}else v=[""];let R;const O=y.length;let k=0;const D=M.n.length;for(R=I;R<O;R++)v[k]+=`${v[k]?" ":""}${y[R]}`,R+1<D&&M.n[R+1]&&k++;t.remainingText=v.join(`
`),t.moreTextLines=!0,y=A}else t.moreTextLines=!1,t.remainingText="";let z=0;const N=[];for(let A=0;A<y.length;A++){const v=this.measureText(y[A],m)+(A===0?g:0);N.push(v),z=Math.max(z,v)}t.lineWidths=N,n||(L=z+s+i,F=z);let V;return l?V=l:V=_r(this._settings.textBaseline,o,C,y.length,a),a===null&&(a=o),t.w=L,t.h=V,t.lines=y,t.precision=e,L||(L=1),V||(V=1),(h||d)&&(L=Math.min(L,d-h)),(u||x)&&(V=Math.min(V,x-u)),t.width=L,t.innerWidth=F,t.height=V,t.fontSize=o,t.cutSx=h,t.cutSy=u,t.cutEx=d,t.cutEy=x,t.lineHeight=C,t.defLineHeight=_,t.lineWidths=N,t.offsetY=a,t.paddingLeft=s,t.paddingRight=i,t.letterSpacing=m,t.textIndent=g,t.metrics=T,t}draw(t,e){const s=this.getPrecision(),i=(e==null?void 0:e.lines)||t.lines,o=(e==null?void 0:e.lineWidths)||t.lineWidths,a=e?_r(this._settings.textBaseline,t.fontSize,t.lineHeight,e.lines.length,this._settings.offsetY===null?null:this._settings.offsetY*s):t.height;this._canvas.width=Math.min(Math.ceil(t.width+this._settings.textRenderIssueMargin),vr),this._canvas.height=Math.min(Math.ceil(a),vr),this.setFontProperties(),t.fontSize>=128&&(this._context.globalAlpha=.01,this._context.fillRect(0,0,.01,.01),this._context.globalAlpha=1),(t.cutSx||t.cutSy)&&this._context.translate(-t.cutSx,-t.cutSy);let n,l;const c=[],{metrics:h}=t,d=h?h.ascender*t.fontSize:t.fontSize,u=(h.ascender-h.descender)*t.fontSize;for(let m=0,g=i.length;m<g;m++)n=m===0?t.textIndent:0,l=m*t.lineHeight+d,this._settings.verticalAlign=="middle"?l+=(t.lineHeight-u)/2:this._settings.verticalAlign=="bottom"&&(l+=t.lineHeight-u),this._settings.textAlign==="right"?n+=t.innerWidth-o[m]:this._settings.textAlign==="center"&&(n+=(t.innerWidth-o[m])/2),n+=t.paddingLeft,c.push({text:i[m],x:n,y:l,w:o[m]});if(this._settings.highlight){const m=this._settings.highlightColor,g=this._settings.highlightHeight*s||t.fontSize*1.5,b=this._settings.highlightOffset*s,T=this._settings.highlightPaddingLeft!==null?this._settings.highlightPaddingLeft*s:t.paddingLeft,_=this._settings.highlightPaddingRight!==null?this._settings.highlightPaddingRight*s:t.paddingRight;this._context.fillStyle=As(m);for(let C=0;C<c.length;C++){const S=c[C];this._context.fillRect(S.x-T,S.y-t.offsetY+b,S.w+_+T,g)}}let x=null;this._settings.shadow&&(x=[this._context.shadowColor,this._context.shadowOffsetX,this._context.shadowOffsetY,this._context.shadowBlur],this._context.shadowColor=As(this._settings.shadowColor),this._context.shadowOffsetX=this._settings.shadowOffsetX*s,this._context.shadowOffsetY=this._settings.shadowOffsetY*s,this._context.shadowBlur=this._settings.shadowBlur*s),this._context.fillStyle=As(this._settings.textColor);for(let m=0,g=c.length;m<g;m++){const b=c[m];if(t.letterSpacing===0)this._context.fillText(b.text,b.x,b.y);else{const T=b.text.split("");let _=b.x;for(let C=0,S=T.length;C<S;C++)this._context.fillText(T[C],_,b.y),_+=this.measureText(T[C],t.letterSpacing)}}x&&(this._context.shadowColor=x[0],this._context.shadowOffsetX=x[1],this._context.shadowOffsetY=x[2],this._context.shadowBlur=x[3]),(t.cutSx||t.cutSy)&&this._context.translate(t.cutSx,t.cutSy)}wrapWord(t,e,s){const i=this._context.measureText(s).width,o=t.length,a=this._context.measureText(t).width;if(a<=e)return t;let n=Math.floor(e*o/a),l=this._context.measureText(t.substring(0,n)).width+i;if(l>e)for(;n>0&&(l=this._context.measureText(t.substring(0,n)).width+i,l>e);)n-=1;else for(;n<o;)if(l=this._context.measureText(t.substring(0,n)).width+i,l<e)n+=1;else{n-=1;break}return t.substring(0,n)+(e>=i?s:"")}wrapText(t,e,s,i=0){const o=t.split(/\r?\n/g);let a=[];const n=[];for(let l=0;l<o.length;l++){const c=[];let h="",d=e-i;const u=o[l].split(" ");for(let x=0;x<u.length;x++){const m=this.measureText(u[x],s),g=m+this.measureText(" ",s);x===0||g>d?(x>0&&(c.push(h),h=""),h+=u[x],d=e-m-(x===0?i:0)):(d-=g,h+=` ${u[x]}`)}c.push(h),h="",a=a.concat(c),l<o.length-1&&n.push(a.length)}return{l:a,n}}measureText(t,e=0){return e?t.split("").reduce((s,i)=>s+this._context.measureText(i).width+e,0):this._context.measureText(t).width}mergeDefaults(t){return{text:"",w:0,h:0,fontStyle:"normal",fontSize:40,fontFamily:null,trFontFace:null,wordWrap:!0,wordWrapWidth:0,wordBreak:!1,textOverflow:"",lineHeight:null,textBaseline:"alphabetic",textAlign:"left",verticalAlign:"top",offsetY:null,maxLines:0,maxHeight:null,overflowSuffix:"...",textColor:[1,1,1,1],paddingLeft:0,paddingRight:0,shadow:!1,shadowColor:[0,0,0,1],shadowOffsetX:0,shadowOffsetY:0,shadowBlur:5,highlight:!1,highlightHeight:0,highlightColor:[0,0,0,1],highlightOffset:0,highlightPaddingLeft:0,highlightPaddingRight:0,letterSpacing:0,textIndent:0,cutSx:0,cutEx:0,cutSy:0,cutEy:0,advancedRenderer:!1,fontBaselineRatio:0,precision:1,textRenderIssueMargin:0,...t}}}const Rr=typeof self>"u"?globalThis:self;var Or;const Cr=((Or=Rr.document)==null?void 0:Or.fonts)||Rr.fonts;function dn(r){const{fontFamily:t,fontStyle:e,fontWeight:s,fontStretch:i,fontSize:o}=r;return[e,s,i,`${o}px`,t].join(" ")}class un extends or{constructor(e){super(e);f(this,"canvas");f(this,"context");f(this,"fontFamilies",{});f(this,"fontFamilyArray",[this.fontFamilies]);f(this,"type","canvas");f(this,"loadFont",e=>{const s=dn(e.props),i=sr.resolveFontFace(this.fontFamilyArray,e.props);if(E(i,`Could not resolve font face for ${s}`),e.fontInfo={fontFace:i,cssString:s,loaded:!1},!e.fontInfo.loaded){Cr.load(s).then(this.onFontLoaded.bind(this,e,s)).catch(this.onFontLoadError.bind(this,e,s));return}});typeof OffscreenCanvas<"u"?this.canvas=new OffscreenCanvas(0,0):this.canvas=document.createElement("canvas");let s=this.canvas.getContext("2d",{willReadFrequently:!0});s||(this.canvas=document.createElement("canvas"),s=this.canvas.getContext("2d",{willReadFrequently:!0})),E(s),this.context=s,this.addFontFace(new os({fontFamily:"sans-serif",descriptors:{},fontUrl:""}))}getPropertySetters(){return{fontFamily:(e,s)=>{e.props.fontFamily=s,e.fontInfo=void 0,this.invalidateLayoutCache(e)},fontWeight:(e,s)=>{e.props.fontWeight=s,e.fontInfo=void 0,this.invalidateLayoutCache(e)},fontStyle:(e,s)=>{e.props.fontStyle=s,e.fontInfo=void 0,this.invalidateLayoutCache(e)},fontStretch:(e,s)=>{e.props.fontStretch=s,e.fontInfo=void 0,this.invalidateLayoutCache(e)},fontSize:(e,s)=>{e.props.fontSize=s,e.fontInfo=void 0,this.invalidateLayoutCache(e)},text:(e,s)=>{e.props.text=s,this.invalidateLayoutCache(e)},textAlign:(e,s)=>{e.props.textAlign=s,this.invalidateLayoutCache(e)},color:(e,s)=>{e.props.color=s,this.invalidateLayoutCache(e)},x:(e,s)=>{e.props.x=s},y:(e,s)=>{e.props.y=s},contain:(e,s)=>{e.props.contain=s,this.invalidateLayoutCache(e)},width:(e,s)=>{e.props.width=s,e.props.contain!=="none"&&this.invalidateLayoutCache(e)},height:(e,s)=>{e.props.height=s,e.props.contain==="both"&&this.invalidateLayoutCache(e)},offsetY:(e,s)=>{e.props.offsetY=s,this.invalidateLayoutCache(e)},scrollY:(e,s)=>{e.props.scrollY=s},letterSpacing:(e,s)=>{e.props.letterSpacing=s,this.invalidateLayoutCache(e)},lineHeight:(e,s)=>{e.props.lineHeight=s,this.invalidateLayoutCache(e)},maxLines:(e,s)=>{e.props.maxLines=s,this.invalidateLayoutCache(e)},textBaseline:(e,s)=>{e.props.textBaseline=s,this.invalidateLayoutCache(e)},verticalAlign:(e,s)=>{e.props.verticalAlign=s,this.invalidateLayoutCache(e)},overflowSuffix:(e,s)=>{e.props.overflowSuffix=s,this.invalidateLayoutCache(e)}}}canRenderFont(e){return!0}isFontFaceSupported(e){return e instanceof os}addFontFace(e){E(e instanceof os),e.fontFamily!=="sans-serif"&&Cr.add(e.fontFace);const{fontFamilies:s}=this,i=e.fontFace.family;let o=s[i];o||(o=new Set,s[i]=o),o.add(e)}createState(e,s){return{node:s,props:e,status:"initialState",updateScheduled:!1,emitter:new Pe,textureNode:void 0,lightning2TextRenderer:new hn(this.canvas,this.context),renderInfo:void 0,forceFullLayoutCalc:!1,textW:0,textH:0,fontInfo:void 0,isRenderable:!1,debugData:{updateCount:0,layoutCount:0,drawCount:0,lastLayoutNumCharacters:0,layoutSum:0,drawSum:0,bufferSize:0}}}updateState(e){if(e.status==="initialState"&&this.setStatus(e,"loading"),e.status!=="loaded"){if(!e.fontInfo)return this.loadFont(e);e.fontInfo.loaded&&(e.renderInfo||(e.renderInfo=this.calculateRenderInfo(e),e.textH=e.renderInfo.lineHeight*e.renderInfo.lines.length,e.textW=e.renderInfo.width,this.renderSingleCanvasPage(e)))}}renderSingleCanvasPage(e){E(e.renderInfo);const s=e.node,i=this.stage.txManager.loadTexture("ImageTexture",{src:(function(o,a){return E(a),o.draw(a,{lines:a.lines,lineWidths:a.lineWidths}),this.canvas.width===0||this.canvas.height===0?null:this.context.getImageData(0,0,this.canvas.width,this.canvas.height)}).bind(this,e.lightning2TextRenderer,e.renderInfo)});if(e.textureNode)e.textureNode.texture=i;else{const o=this.stage.createNode({parent:s,texture:i,autosize:!0,alpha:eo(e.props.color)});e.textureNode=o}this.setStatus(e,"loaded")}calculateRenderInfo(e){var s;return e.lightning2TextRenderer.settings={text:e.props.text,textAlign:e.props.textAlign,fontFamily:e.props.fontFamily,trFontFace:(s=e.fontInfo)==null?void 0:s.fontFace,fontSize:e.props.fontSize,fontStyle:[e.props.fontStretch,e.props.fontStyle,e.props.fontWeight].join(" "),textColor:wt(e.props.color),offsetY:e.props.offsetY,wordWrap:e.props.contain!=="none",wordWrapWidth:e.props.contain==="none"?void 0:e.props.width,letterSpacing:e.props.letterSpacing,lineHeight:e.props.lineHeight??null,maxLines:e.props.maxLines,maxHeight:e.props.contain==="both"?e.props.height-e.props.offsetY:null,textBaseline:e.props.textBaseline,verticalAlign:e.props.verticalAlign,overflowSuffix:e.props.overflowSuffix,w:e.props.contain!=="none"?e.props.width:void 0},e.renderInfo=e.lightning2TextRenderer.calculateRenderInfo(),e.renderInfo}renderQuads(){}destroyState(e){e.status!=="destroyed"&&(super.destroyState(e),e.textureNode&&(e.textureNode.destroy(),delete e.textureNode),delete e.renderInfo)}invalidateLayoutCache(e){e.renderInfo=void 0,this.setStatus(e,"loading"),this.scheduleUpdateState(e)}onFontLoaded(e,s){var i;s!==((i=e.fontInfo)==null?void 0:i.cssString)||!e.fontInfo||(e.fontInfo.loaded=!0,this.scheduleUpdateState(e))}onFontLoadError(e,s,i){var o;s!==((o=e.fontInfo)==null?void 0:o.cssString)||!e.fontInfo||(e.fontInfo.loaded=!0,console.error(`CanvasTextRenderer: Error loading font '${e.fontInfo.cssString}'`,i),this.scheduleUpdateState(e))}}const pn={isWhite:!0,a:1,r:255,g:255,b:255};function Fs(r){if(r===4294967295)return pn;const t=(r>>>24&255)/255,e=r>>>16&255&255,s=r>>>8&255&255,i=r&255&255;return{isWhite:!1,a:t,r:i,g:s,b:e}}function ns({a:r,r:t,g:e,b:s}){return`rgba(${t},${e},${s},${r})`}class mn extends Qr{constructor(){super(...arguments);f(this,"image");f(this,"tintCache")}load(){this.textureSource.state==="freed"&&(this.textureSource.setState("loading"),this.onLoadRequest().then(e=>{this.textureSource.setState("loaded",e),this.updateMemSize()}).catch(e=>{this.textureSource.setState("failed",e)}))}free(){this.image=void 0,this.tintCache=void 0,this.textureSource.setState("freed"),this.setTextureMemUse(0)}updateMemSize(){const e=this.tintCache?8:4;if(this.textureSource.dimensions){const{width:s,height:i}=this.textureSource.dimensions;this.setTextureMemUse(s*i*e)}}hasImage(){return this.image!==void 0}getImage(e){var a;const s=this.image;if(E(s,"Attempt to get unloaded image texture"),e.isWhite)return this.tintCache&&(this.tintCache=void 0,this.updateMemSize()),s;const i=ns(e);if(((a=this.tintCache)==null?void 0:a.key)===i)return this.tintCache.image;const o=this.tintTexture(s,i);return this.tintCache={key:i,image:o},this.updateMemSize(),o}tintTexture(e,s){const{width:i,height:o}=e,a=document.createElement("canvas");a.width=i,a.height=o;const n=a.getContext("2d");return n&&(n.fillStyle=s,n.globalCompositeOperation="copy",n.fillRect(0,0,i,o),n.globalCompositeOperation="multiply",n.drawImage(e,0,0,i,o,0,0,i,o),n.globalCompositeOperation="destination-in",n.drawImage(e,0,0,i,o,0,0,i,o)),a}async onLoadRequest(){const{data:e}=await this.textureSource.getTextureData();if(e instanceof ImageData){const s=document.createElement("canvas");s.width=e.width,s.height=e.height;const i=s.getContext("2d");return i&&i.putImageData(e,0,0),this.image=s,{width:e.width,height:e.height}}else if(typeof ImageBitmap<"u"&&e instanceof ImageBitmap)return this.image=e,{width:e.width,height:e.height};return{width:0,height:0}}}function gn(r){var t;return r.shader instanceof ir&&r.shader.shType===Zr?((t=r.shaderProps)==null?void 0:t.radius)??0:0}class xn extends Jr{constructor(e){super(e);f(this,"context");f(this,"canvas");f(this,"pixelRatio");f(this,"clearColor");f(this,"renderToTextureActive",!1);f(this,"activeRttNode",null);f(this,"defShaderCtr");this.mode="canvas",this.shManager.renderer=this;const{canvas:s,pixelRatio:i,clearColor:o}=e;this.canvas=s,this.context=s.getContext("2d"),this.pixelRatio=i,this.clearColor=o?Ji(o):void 0,this.defShaderCtr={type:"DefaultShader",props:{},shader:new ir("DefaultShader"),getResolvedProps:()=>()=>({})}}reset(){this.canvas.width=this.canvas.width;const e=this.context;if(this.clearColor){const[s,i,o,a]=this.clearColor;e.fillStyle=`rgba(${s}, ${i}, ${o}, ${a/255})`,e.fillRect(0,0,this.canvas.width,this.canvas.height)}e.scale(this.pixelRatio,this.pixelRatio)}render(){}addQuad(e){const s=this.context,{tx:i,ty:o,width:a,height:n,alpha:l,colorTl:c,colorTr:h,colorBr:d,ta:u,tb:x,tc:m,td:g,clippingRect:b}=e;let T=e.texture,_,C;if(T){if(T instanceof rt&&(C=T.props,T=T.parentTexture),_=T.ctxTexture,T.state==="freed"){_.load();return}if(T.state!=="loaded"||!_.hasImage())return}const S=Fs(c),P=u!==1,G=b.width!==0&&b.height!==0,I=c!==h||c!==d,L=e.shader?gn(e):0;if((P||G||L)&&s.save(),G){const F=new Path2D,{x:M,y,width:z,height:N}=b;F.rect(M,y,z,N),s.clip(F)}if(P){const F=this.pixelRatio;s.setTransform(u,m,x,g,i*F,o*F),s.scale(F,F),s.translate(-i,-o)}if(L){const F=new Path2D;F.roundRect(i,o,a,n,L),s.clip(F)}if(_){const F=_.getImage(S);s.globalAlpha=l,C?s.drawImage(F,C.x,C.y,C.width,C.height,i,o,a,n):s.drawImage(F,i,o,a,n),s.globalAlpha=1}else if(I){let F=i,M=o,y;c===h?(F=i,M=o+n,y=Fs(d)):(F=i+a,M=o,y=Fs(h));const z=s.createLinearGradient(i,o,F,M);z.addColorStop(0,ns(S)),z.addColorStop(1,ns(y)),s.fillStyle=z,s.fillRect(i,o,a,n)}else s.fillStyle=ns(S),s.fillRect(i,o,a,n);(P||G||L)&&s.restore()}createCtxTexture(e){return new mn(this.txMemManager,e)}getShaderManager(){return this.shManager}getDefShaderCtr(){return this.defShaderCtr}renderRTTNodes(){}removeRTTNode(e){}renderToTexture(e){}getBufferInfo(){return null}}const Qt={alpha:r=>r===1?null:{prop:"opacity",value:`${r}`},x:r=>({prop:"left",value:`${r}px`}),y:r=>({prop:"top",value:`${r}px`}),width:r=>r===0?null:{prop:"width",value:`${r}px`},height:r=>r===0?null:{prop:"height",value:`${r}px`},zIndex:()=>"zIndex",fontFamily:()=>"font-family",fontSize:()=>"font-size",fontStyle:()=>"font-style",fontWeight:()=>"font-weight",fontStretch:()=>"font-stretch",lineHeight:()=>"line-height",letterSpacing:()=>"letter-spacing",textAlign:()=>"text-align",overflowSuffix:()=>"overflow-suffix",maxLines:()=>"max-lines",contain:()=>"contain",verticalAlign:()=>"vertical-align",clipping:r=>r===!1?null:{prop:"overflow",value:r?"hidden":"visible"},rotation:r=>r===0?null:{prop:"transform",value:`rotate(${r}rad)`},scale:r=>r===1?null:{prop:"transform",value:`scale(${r})`},scaleX:r=>r===1?null:{prop:"transform",value:`scaleX(${r})`},scaleY:r=>r===1?null:{prop:"transform",value:`scaleY(${r})`},color:r=>r===0?null:{prop:"color",value:ii(r)}},ii=r=>{const t=(r&255)/255,e=r>>8&255,s=r>>16&255;return`rgba(${r>>24&255},${s},${e},${t})`},Er={id:"test-id"};class yn{constructor(t,e){f(this,"root",null);f(this,"canvas",null);f(this,"height",1080);f(this,"width",1920);f(this,"scaleX",1);f(this,"scaleY",1);if(tr())return;if(!e)throw new Error("settings is required");this.height=Math.ceil(e.appHeight??1080/(e.deviceLogicalPixelRatio??1)),this.width=Math.ceil(e.appWidth??1920/(e.deviceLogicalPixelRatio??1)),this.scaleX=e.deviceLogicalPixelRatio??1,this.scaleY=e.deviceLogicalPixelRatio??1,this.canvas=t,this.root=document.createElement("div"),this.setRootPosition(),document.body.appendChild(this.root),new MutationObserver(this.setRootPosition.bind(this)).observe(t,{attributes:!0,childList:!1,subtree:!1}),new ResizeObserver(this.setRootPosition.bind(this)).observe(t),window.addEventListener("resize",this.setRootPosition.bind(this)),console.warn("Inspector is enabled, this will impact performance")}setRootPosition(){if(this.root===null||this.canvas===null)return;const t=this.canvas.getBoundingClientRect(),e=document.documentElement.scrollTop+t.top,s=document.documentElement.scrollLeft+t.left;this.root.id="root",this.root.style.left=`${s}px`,this.root.style.top=`${e}px`,this.root.style.width=`${this.width}px`,this.root.style.height=`${this.height}px`,this.root.style.position="absolute",this.root.style.transformOrigin="0 0 0",this.root.style.transform=`scale(${this.scaleX}, ${this.scaleY})`,this.root.style.overflow="hidden",this.root.style.zIndex="65534"}createDiv(t,e){const s=document.createElement("div");s.style.position="absolute",s.id=t.toString();for(const i in e)this.updateNodeProperty(s,i,e[i]);return s}createNode(t){const e=this.createDiv(t.id,t.props);return e.node=t,t.div=e,this.createProxy(t,e)}createTextNode(t){const e=this.createDiv(t.id,t.props);return e.node=t,t.div=e,this.createProxy(t,e)}createProxy(t,e){return new Proxy(t,{set:(s,i,o)=>(this.updateNodeProperty(e,i,o),Reflect.set(s,i,o)),get:(s,i,o)=>(i==="destroy"&&this.destroyNode(s.id),i==="animate"?(a,n)=>{const l=s.animate(a,n);return new Proxy(l,{get:(c,h,d)=>(h==="start"&&this.animateNode(e,a,n),Reflect.get(c,h,d))})}:Reflect.get(s,i,o))})}destroyNode(t){const e=document.getElementById(t.toString());e==null||e.remove()}updateNodeProperty(t,e,s){var i;if(!(this.root===null||s===void 0||s===null)){if(e==="parent"){const o=s.id;if(o===1){this.root.appendChild(t);return}const a=document.getElementById(o.toString());a==null||a.appendChild(t);return}if(e==="text"){t.innerHTML=String(s),t.style.visibility="hidden";return}if(e==="src"&&s){t.setAttribute("data-src",String(s));return}if(Qt[e]){const o=(i=Qt[e])==null?void 0:i.call(Qt,s);if(o===null)return;if(typeof o=="string"){t.style.setProperty(o,String(s));return}typeof o=="object"&&t.style.setProperty(o.prop,o.value);return}if(Er[e]){const o=Er[e];if(!o)return;t.setAttribute(String(o),String(s));return}if(e==="data"){for(const o in s){const a=s[o];a===void 0?t.removeAttribute(`data-${o}`):t.setAttribute(`data-${o}`,String(a))}return}}}animateNode(t,e,s){const{duration:i=1e3,delay:o=0}=s,{x:a,y:n,width:l,height:c,alpha:h=1,rotation:d=0,scale:u=1,color:x}=e;function m(){setTimeout(()=>{t.style.top=`${n}px`,t.style.left=`${a}px`,t.style.width=`${l}px`,t.style.height=`${c}px`,t.style.opacity=`${h}`,t.style.rotate=`${d}rad`,t.style.scale=`${u}`,t.style.color=ii(x)},i)}setTimeout(m,o)}}const oi=50,Ar={hd:.66666667,"720p":.66666667,720:.66666667,fhd:1,fullhd:1,"1080p":1,1080:1,"4k":2,"2160p":2,2160:2},Tn=()=>{const r=le.stage;fe.get("fonts",[]).forEach(t=>{t.type==="sdf"||t.type==="msdf"?(!t.png&&t.file&&(t.png=t.file.replace(/\.[^.]+$/,`.${t.type}.png`)),!t.json&&t.file&&(t.json=t.file.replace(/\.[^.]+$/,`.${t.type}.json`)),r.fontManager.addFontFace(new Ys(t.type,{fontFamily:t.family,descriptors:{},atlasUrl:t.png,atlasDataUrl:t.json,stage:r,metrics:t.metrics}))):t.type==="web"&&r.fontManager.addFontFace(new os({fontFamily:t.family,fontUrl:t.file,descriptors:{},metrics:t.metrics}))})},bn=()=>{const r=le.stage;fe.get("shaders",[]).forEach(t=>{r.shManager.registerShaderType(t.name,t.type)}),fe.get("effects",[]).forEach(t=>{r.shManager.registerShaderType(t.name,t.type)})};let le={};const Sn=r=>{const t="renderMode"in r?r.renderMode:"webgl";if(t==="webgl")return nr;if(t==="canvas")return xn},wn=(r,t,e={})=>{le=new No({appWidth:e.w||1920,appHeight:e.h||1080,fpsUpdateInterval:e.fpsInterval||1e3,deviceLogicalPixelRatio:e.pixelRatio||Ar[e.screenResolution]||Ar[window.innerHeight]||1,numImageWorkers:"webWorkersLimit"in e?e.webWorkersLimit:window.navigator.hardwareConcurrency||2,clearColor:e.canvasColor&&et.normalize(e.canvasColor)||0,inspector:e.inspector===!0?yn:void 0,boundsMargin:e.viewportMargin||0,txMemByteThreshold:"gpuMemoryLimit"in e?e.gpuMemoryLimit*1024*1024:200*1024*1024,renderEngine:Sn(e),fontEngines:[fn,un]},t);const s=()=>{let i=r();i.quit=()=>{Q.info("Closing App"),i.destroy(),i=null,le=null}};return bn(),Tn(),s(),le},Mr=r=>r!==null&&typeof r=="object"&&"transition"in r,nt=r=>typeof r=="string"&&r.startsWith("{")&&r.endsWith("}"),at=r=>JSON.parse(r.replace(/'/g,'"').replace(/([\w-_]+)\s*:/g,'"$1":')),Ge=function(r,t){return typeof r!="string"?r:r.indexOf("%")===r.length-1?this.element.parent&&this.element.parent[t]&&this.element.parent[t]*(parseFloat(r)/100):r},Ks=r=>{if(typeof r!="object"||r===null)return r;if(r.constructor===Object){if("value"in r)return r.value;if("transition"in r)return Ks(r.transition)}return r},vn={top:"colorTop",bottom:"colorBottom",left:"colorLeft",right:"colorRight"};let js=null;const _n={set parent(r){this.props.parent=r==="root"?le.root:r.node},set rotation(r){this.props.rotation=r*(Math.PI/180)},set w(r){this.props.width=Ge.call(this,r,"width")},set width(r){this.props.width=Ge.call(this,r,"width")},set h(r){this.props.height=Ge.call(this,r,"height")},set height(r){this.props.height=Ge.call(this,r,"height")},set x(r){this.props.x=Ge.call(this,r,"width")},set y(r){this.props.y=Ge.call(this,r,"height")},set z(r){this.props.zIndex=r},set zIndex(r){this.props.zIndex=r},set color(r){typeof r=="string"&&r.startsWith("{")===!1?this.props.color=et.normalize(r):(typeof r=="object"||nt(r)===!0&&(r=at(r)))&&(this.props.color=0,Object.entries(r).forEach(t=>{this.props[vn[t[0]]]=et.normalize(t[1])}))},set src(r){this.props.src=r,this.raw.color===void 0&&(this.props.color=4294967295)},set texture(r){this.props.texture=r,this.raw.color===void 0&&r==null?this.props.color=0:this.raw.color===void 0&&(this.props.color=4294967295)},set fit(r){const t={};if(r==="cover"||r==="contain"){this.props.textureOptions={resizeMode:{type:r}};return}(typeof r=="object"||nt(r)===!0&&(r=at(r)))&&(t.type=r.type||"cover",typeof r.position=="number"&&(t.clipY=t.clipX=r.position),typeof r.position=="object"&&(t.clipX="x"in r.position?r.position.x:null,t.clipY="y"in r.position?r.position.y:null),this.props.textureOptions={resizeMode:t})},set rtt(r){this.props.rtt=r,r===!0&&this.raw.color===void 0&&(this.props.color=4294967295)},set mount(r){typeof r=="object"||nt(r)===!0&&(r=at(r))?("x"in r&&(this.props.mountX=r.x),"y"in r&&(this.props.mountY=r.y)):(this.props.mountX=r,this.props.mountY=r)},set pivot(r){typeof r=="object"||nt(r)===!0&&(r=at(r))?("x"in r&&(this.props.pivotX=r.x),"y"in r&&(this.props.pivotY=r.y)):(this.props.pivotX=r,this.props.pivotY=r)},set scale(r){typeof r=="object"||nt(r)===!0&&(r=at(r))?("x"in r&&(this.props.scaleX=r.x),"y"in r&&(this.props.scaleY=r.y)):this.props.scale=r},set show(r){this.props.alpha=r?1:0},set alpha(r){this.props.alpha=r},set shader(r){r!==null?this.props.shader=le.createShader(r.type,r.props):this.props.shader=le.createShader("DefaultShader")},set effects(r){for(let t=0;t<r.length;t++)r[t].props&&r[t].props.color&&(r[t].props.color=et.normalize(r[t].props.color));this.props.shader=le.createShader("DynamicShader",{effects:r})},set clipping(r){this.props.clipping=r},set overflow(r){this.props.clipping=!r},set font(r){this.props.fontFamily=r},set size(r){this.props.fontSize=r},set wordwrap(r){this.props.width=r,this.props.contain="width"},set maxheight(r){this.props.height=r,this.props.contain="both"},set contain(r){this.props.contain=r},set maxlines(r){this.props.maxLines=r},set textoverflow(r){this.props.overflowSuffix=r===!1?" ":r===!0?void 0:r},set letterspacing(r){this.props.letterSpacing=r||1},set lineheight(r){this.props.lineHeight=r},set align(r){this.props.textAlign=r},set content(r){this.props.text=""+r}},Rn={populate(r){const t=r;t.node=this.config.node,t[p.isSlot]===!0&&(this[p.isSlot]=!0),this.props.element=this,this.props.parent=this.config.parent,delete t.parent,this.props.raw=r;const e=Object.keys(t),s=e.length;for(let i=0;i<s;i++){const o=e[i],a=t[o];a!==void 0&&(this.props[o]=Ks(a))}this.props.props.color===void 0&&!("__textnode"in t)&&(this.props.props.color=0),this.node=t.__textnode?le.createTextNode({...js,...this.props.props}):le.createNode(this.props.props),t["@loaded"]!==void 0&&typeof t["@loaded"]=="function"&&this.node.on("loaded",(i,{type:o,dimensions:a})=>{t["@loaded"]({w:a.width,h:a.height,type:o},this)}),t["@error"]!==void 0&&typeof t["@error"]=="function"&&this.node.on("failed",(i,o)=>{t["@error"](o,this)})},set(r,t){if(t===void 0||this.props.raw[r]===t)return;this.props.raw[r]=t,this.props.props={},this.props[r]=Ks(t);const e=Object.keys(this.props.props);if(e.length===1){if(Mr(t)===!0)return this.animate(e[0],this.props.props[e[0]],t.transition);this.node[e[0]]=this.props.props[e[0]]}else for(let s=0;s<e.length;s++){if(Mr(t)===!0)return this.animate(e[s],this.props.props[e[s]],t.transition);this.node[e[s]]=this.props.props[e[s]]}},animate(r,t,e){if(this.node[r]===t)return;this.scheduledTransitions[r]&&this.scheduledTransitions[r].f.state==="running"&&(this.node[r]=this.scheduledTransitions[r].v);const s={};s[r]=t;const i=this.node.animate(s,{duration:typeof e=="object"&&"duration"in e?e.duration:300,easing:typeof e=="object"&&"easing"in e?e.easing:"ease",delay:typeof e=="object"&&"delay"in e?e.delay:0}),o=this.node[r];this.scheduledTransitions[r]={v:s[r],cancel:!1,f:i},e.start&&typeof e.start=="function"&&i.once("animating",()=>{e.start.call(this.component,this,r,o)}),i.once("stopped",()=>{this.scheduledTransitions[r]=null,e.end&&typeof e.end=="function"&&e.end.call(this.component,this,r,this.node[r])}),i.start()},destroy(){Q.debug("Deleting  Node",this.nodeId),this.node.destroy()},get nodeId(){return this.node&&this.node.id},get ref(){return this.props.ref||null},get parent(){return this.node&&this.node.parent},get children(){return this.component[p.getChildren]().filter(r=>r.parent===(this[p.isSlot]?this.node.children[0]:this.node))}},Cn=(r,t)=>(js===null&&(js={fontSize:32,fontFamily:fe.get("defaultFont","sans-serif")}),Object.assign(Object.create(Rn),{props:Object.assign(Object.create(_n),{props:{}}),scheduledTransitions:{},config:r,component:t})),Ir={Element:Cn,Launch:wn};let St={};const ar={},En=(r,t,e)=>{fe.set(e),Ei(),ar.element=Ir.Element,St=Ir.Launch(r,t,e)},An={before:{prop:"alpha",value:0},in:{prop:"alpha",value:1,duration:200},out:{prop:"alpha",value:0,duration:100}},Me=window.speechSynthesis,Mn=()=>(window.navigator||{}).userAgent||"",Lr=()=>/android/i.test(Mn());let ni=!1,ms=null;const lr=()=>ms&&clearTimeout(ms),qs=r=>{if(!r||ms)return lr();Me.pause(),Me.resume(),ms=setTimeout(()=>{qs(r)},5e3)},Ze={lang:"en-US",pitch:1,rate:1,voice:null,volume:1},In=()=>{Ze.voice=Me.getVoices()[0],ni=!0},Ln=(r,t)=>{const e=new SpeechSynthesisUtterance(t.value);e.lang=t.lang||Ze.lang,e.pitch=t.pitch||Ze.pitch,e.rate=t.rate||Ze.rate,e.voice=t.voice||Ze.voice,e.volume=t.volume||Ze.volume,e.onstart=()=>{Lr()||qs(e),r.onstart()},e.onresume=()=>{Lr()||qs(e),r.onresume()},e.onpause=()=>{r.onpause()},e.onend=()=>{r.onend()},e.onerror=()=>{lr(),r.onerror()},Me.speak(e)},as={speak(r){ni||In(),this.cancel(),Ln(this,r)},resume(){Me.resume()},pause(){Me.pause()},cancel(){Me.cancel(),lr()},getVoices(){return Me.getVoices()},onend(){},onerror(){},onstart(){},onresume(){},onpause(){}};let Pr;const fr=(r,t="off")=>{clearTimeout(Pr),as.cancel(),t==="assertive"?as.speak({value:r}):Pr=setTimeout(()=>{as.speak({value:r})},400)},Pn=r=>fr(r,"polite"),Fn=r=>fr(r,"assertive"),kn=()=>{as.cancel()},ai={speak:fr,polite:Pn,assertive:Fn,stop:kn};let gs,xs=!1;const li=new WeakMap,fi=[];let ci={},hi={},Zs=!1,di;const Bn=()=>(document.location.hash||"/").replace(/^#/,""),Fr=r=>r.replace(/^\/+|\/+$/g,"").toLowerCase(),On=r=>typeof r=="object"&&r!==null,Un=r=>typeof r=="string",$n=(r,t=[])=>{const e=r;r=Fr(r);let s=!1,i=0;for(;!s&&i<t.length;){const o=t[i];if(o.path=Fr(o.path),o.path===r)o.params={},s=o;else if(o.path.indexOf(":")>-1){const a=[...o.path.matchAll(/:([^\s/]+)/gi)];let n=o.path;a.reverse().forEach(c=>{n=n.substring(0,c.index)+"([^\\s/]+)"+n.substring(c.index+c[0].length)});const l=e.match(new RegExp(`${n}`,"i"));l&&(o.params=a.reverse().reduce((c,h,d)=>(c[h[1]]=l[d+1],c),{}),s=o)}else if(o.path.endsWith("*")){const a=new RegExp(o.path.replace(/\/?\*/,"/?([^\\s]*)"),"i"),n=r.match(a);n&&(n[1]&&(o.params={path:n[1]}),s=o)}i++}return s&&(s.options={...s.options,...ci},s.data||(s.data={}),gs=s),s},Dn=async function(){if(xs=!0,this.parent[p.routes]){const r=gs,t=Bn();let e=$n(t,this.parent[p.routes]),s;if(e){if(e.hooks&&e.hooks.before&&(s=await e.hooks.before(e,r),Un(s))){gs=r,ws(s);return}e=On(s)?s:e,Zs===!1&&r&&r.options.inHistory===!0&&fi.push(r),"transition"in e||(e.transition=An),typeof e.transition=="function"&&(e.transition=e.transition(r,e));let i,{view:o,focus:a}=li.get(e)||{};if(o)i=o[p.holder];else{i=ar.element({parent:this[p.children][0]}),i.populate({}),i.set("w","100%"),i.set("h","100%");const l={...this[p.props],...e.params,...hi,...e.data};o=await e.component({props:l},i,this),o[Symbol.toStringTag]==="Module"&&(o.default&&typeof o.default=="function"?o=o.default({props:l},i,this):Q.error("Dynamic import doesn't have a default export or default is not a function")),typeof o=="function"&&(o=o({props:l},i,this))}if(this[p.children].push(o),di=Ie.get(),a?Ie.set(a):Ie.set(o),e.transition.before)if(Array.isArray(e.transition.before))for(let l=0;l<e.transition.before.length;l++)i.set(e.transition.before[l].prop,e.transition.before[l].value);else i.set(e.transition.before.prop,e.transition.before.value);let n=!1;if(r){n=!0;const l=this[p.children].splice(1,1).pop();l&&Nn(r,l,e.transition.out)}if(e.transition.in)if(Array.isArray(e.transition.in))for(let l=0;l<e.transition.in.length;l++)l===e.transition.length-1?await st(i,e.transition.in[l],n):st(i,e.transition.in[l],n);else await st(i,e.transition.in,n);e.announce&&(typeof e.announce=="string"&&(e.announce={message:e.announce}),ai.speak(e.announce.message,e.announce.politeness)),this.activeView=this[p.children][this[p.children].length-1]}else Q.error(`Route ${t} not found`)}Zs=!1,xs=!1},Nn=async(r,t,e)=>{if(e)if(Array.isArray(e))for(let s=0;s<e.length;s++)s===e.length-1?await st(t[p.holder],e[s]):st(t[p.holder],e[s]);else await st(t[p.holder],e);r.options&&r.options.keepAlive===!0?li.set(r,{view:t,focus:di}):(t.destroy(),t=null)},st=(r,t,e=!0)=>new Promise(s=>{if(e){const i=t.end;t.end=i?(...o)=>{i(...o),s()}:s,r.set(t.prop,{transition:t})}else r.set(t.prop,t.value),s()}),ws=(r,t={},e={})=>{hi=t,ci=e,window.location.hash=`#${r}`},ui=()=>{const r=fi.pop();if(r){Zs=!0;let t=r.path;return t.indexOf(":")>-1&&Object.keys(r.params).forEach(e=>{t=t.replace(`:${e}`,r.params[e])}),ws(t),!0}else return!1},ks={navigate:Dn,to:ws,back:ui};let Ee=null,Jt=[],kr;const Ie={_hold:!1,set hold(r){this._hold=r},get hold(){return this._hold},get(){return Ee},set(r,t){clearTimeout(kr),Ee&&Ee!==r.parent&&Ee.unfocus(),Jt.reverse().forEach(e=>e.unfocus()),r!==Ee&&(kr=setTimeout(()=>{Ee=r,Ee.lifecycle.state="focus",t instanceof KeyboardEvent?document.dispatchEvent(new KeyboardEvent("keydown",t)):Jt=[]},this.hold?fe.get("holdTimeout",oi):0))},input(r,t){if(xs===!0)return;Jt=pi([Ee],r);const e=Jt.shift();e&&(e[p.inputEvents][r]?e[p.inputEvents][r].call(e,t):e[p.inputEvents].any&&e[p.inputEvents].any.call(e,t))}},pi=(r,t)=>r[0][p.inputEvents]&&(typeof r[0][p.inputEvents][t]=="function"||typeof r[0][p.inputEvents].any=="function")?r:r[0].parent?(r.unshift(r[0].parent),pi(r,t)):[],lt=new Map,ft=new Map,Qs={registerListener(r,t,e,s=0){let i=lt.get(t);i===void 0&&(i=new Map,lt.set(t,i));let o=i.get(r);o===void 0&&(o=new Set,i.set(r,o)),o.add({cb:e,priority:s}),ft.delete(t)},executeListeners(r,t){const e=lt.get(r);if(e===void 0||e.size===0)return!0;if(ft.has(r)===!1){const i=[];for(const[o,a]of e)for(const n of a)i.push({...n,component:o});i.sort((o,a)=>a.priority-o.priority),ft.set(r,i)}const s=ft.get(r);for(let i=0;i<s.length;i++){const{cb:o,component:a}=s[i];if(o.call(a,t)===!1)return!1}return!0},removeListeners(r){for(const[t,e]of lt)e.has(r)&&(e.delete(r),ft.delete(t),e.size===0&&lt.delete(t))}},zn={focus:{value:function(r){return Q.warn("this.focus is deprecated, use this.$focus instead"),this.$focus(r)},writable:!1,enumerable:!0,configurable:!1},$focus:{value:function(r){this[p.state].hasFocus=!0,Ie.set(this,r)},writable:!1,enumerable:!0,configurable:!1},unfocus:{value:function(){this[p.state].hasFocus=!1,this.lifecycle.state="unfocus"},writable:!1,enumerable:!0,configurable:!1},destroy:{value:function(){this.lifecycle.state="destroy",this.$clearTimeouts(),this.$clearIntervals(),Qs.removeListeners(this),mi(this[p.children]),Q.debug(`Destroyed component ${this.componentId}`)},writable:!1,enumerable:!0,configurable:!1},select:{value:function(r){return Q.warn("this.select is deprecated, use this.$select instead"),this.$select(r)},writable:!1,enumerable:!0,configurable:!1},$select:{value:function(r){let t=null;return this[p.children].forEach(e=>{Array.isArray(e)?e.forEach(s=>{s.ref===r&&(t=s)}):Object.getPrototypeOf(e)===Object.prototype?Object.keys(e).forEach(s=>{e[s].ref===r&&(t=e[s])}):e.ref===r&&(t=e)}),t},writable:!1,enumerable:!0,configurable:!1},trigger:{value:function(r){return Q.warn("this.trigger is deprecated, use this.$trigger instead"),this.$trigger(r)},writable:!1,enumerable:!0,configurable:!1},$trigger:{value:function(r){let t=this[p.originalState];if(r.indexOf(".")>-1){const e=r.split(".");r=e.pop(e);for(let s=0;s<e.length;s++)t=t[e[s]]}tt(t,r,!0)},writable:!1,enumerable:!0,configurable:!1},shader:{value:function(r,t){return{type:r,props:t}},writable:!1,enumerable:!0,configurable:!1}},mi=function(r){for(let t=0;t<r.length;t++){if(!r[t])return;r[t].destroy&&typeof r[t].destroy=="function"?r[t].destroy():Object.getPrototypeOf(r[t])===Object.prototype&&mi(Object.values(r[t])),r[t]=null}r.length=0},Xn={$setTimeout:{value:function(r,t,...e){const s=setTimeout(()=>{this[p.timeouts]=this[p.timeouts].filter(i=>i!==s),r.apply(null,e)},t,e);return this[p.timeouts].push(s),s},writable:!1,enumerable:!0,configurable:!1},$clearTimeout:{value:function(r){this[p.timeouts].indexOf(r)>-1&&(this[p.timeouts]=this[p.timeouts].filter(t=>t!==r),clearTimeout(r))},writable:!1,enumerable:!0,configurable:!1},$clearTimeouts:{value:function(){for(let r=0;r<this[p.timeouts].length;r++)clearTimeout(this[p.timeouts][r]);this[p.timeouts]=[]},writable:!1,enumerable:!0,configurable:!1},$setInterval:{value:function(r,t,...e){const s=setInterval(()=>r.apply(null,e),t,e);return this[p.intervals].push(s),s},writable:!1,enumerable:!0,configurable:!1},$clearInterval:{value:function(r){this[p.intervals].indexOf(r)>-1&&(this[p.intervals]=this[p.intervals].filter(t=>t!==r),clearInterval(r))},writable:!1,enumerable:!0,configurable:!1},$clearIntervals:{value:function(){for(let r=0;r<this[p.intervals].length;r++)clearInterval(this[p.intervals][r]);this[p.intervals]=[]},writable:!1,enumerable:!0,configurable:!1}},Gn={$emit:{value:function(r,t){return Qs.executeListeners(r,t)},writable:!1,enumerable:!0,configurable:!1},$listen:{value:function(r,t,e=0){Qs.registerListener(this,r,t,e)},writable:!1,enumerable:!0,configurable:!1}},Wn={$router:{value:{to:ws,back:ui,get currentRoute(){return gs},get routes(){return this[p.routes]},get navigating(){return xs}},writable:!1,enumerable:!0,configurable:!1}},Vn={$announcer:{value:ai,writable:!1,enumerable:!0,configurable:!1}},Hn={[p.renderer]:{value:()=>St,writable:!1,enumerable:!0,configurable:!1},[p.getChildren]:{value(){const r=this.rootParent||this.parent;return(this[p.children]||[]).concat(r&&r[p.getChildren]().map(t=>Object.getPrototypeOf(t)===Object.prototype?Object.values(t).map(e=>(e.forComponent=e.config&&e.config.parent.component,e)):t).flat().filter(t=>{if(t&&t.component)return t.component&&t.component.componentId===this.componentId||t.forComponent&&t.forComponent.componentId===this.componentId})||[])},writable:!1,enumerable:!0,configurable:!1}},ct=Object.defineProperties({[p.launched]:!1},{...zn,...Xn,...Gn,...Wn,...Vn,...Hn}),Yn={cast:r=>r,required:!1},Kn=(r,t=[])=>{t.indexOf("ref")===-1&&t.push("ref"),r[p.propKeys]=[],t.forEach(e=>{e={...Yn,...typeof e=="object"?e:{key:e}},r[p.propKeys].push(e.key),Object.defineProperty(r,e.key,{get(){const s=e.cast(this[p.props]&&e.key in this[p.props]?this[p.props][e.key]:"default"in e?e.default:void 0);return e.required&&s===void 0&&Q.warn(`${e.key} is required`),s},set(s){Q.warn(`Warning! Avoid mutating props directly (${e.key})`),this[p.props][e.key]=s}})})},jn=(r,t)=>{r[p.methodKeys]=[];for(let e in t)r[p.propKeys]&&r[p.propKeys].indexOf(e)>-1?Q.error(`${e} already exists as a prop`):(typeof t[e]!="function"&&Q.warn(`${e} is not a function`),r[p.methodKeys].push(e),r[e]=t[e])},qn=(r,t=()=>{})=>{Object.defineProperty(r,p.stateKeys,{value:[],enumerable:!1,configurable:!1,writable:!1}),Object.keys(t.apply(r)||{}).concat(["hasFocus"]).forEach(s=>{r[p.propKeys]&&r[p.propKeys].indexOf(s)>-1&&Q.error(`State ${s} already exists as a prop`),r[p.methodKeys]&&r[p.methodKeys].indexOf(s)>-1&&Q.error(`State ${s} already exists as a method`),r[p.stateKeys].push(s),Object.defineProperty(r,s,{get(){return this[p.state][s]},set(i){this[p.state][s]=i}})})},Zn=(r,t)=>{r[p.computedKeys]=[];for(let e in t)r[p.stateKeys]&&r[p.stateKeys].indexOf(e)>-1?Q.error(`${e} already exists as a state variable`):r[p.propKeys]&&r[p.propKeys].indexOf(e)>-1?Q.error(`${e} already exists as a prop`):r[p.methodKeys]&&r[p.methodKeys].indexOf(e)>-1?Q.error(`${e} already exists as a method`):(typeof t[e]!="function"&&Q.warn(`${e} is not a function`),r[p.computedKeys].push(e),Object.defineProperty(r,e,{get(){return t[e].apply(this)}}))},Qn=(r,t)=>{r[p.inputEvents]=[],Object.keys(t).forEach(e=>{typeof t[e]!="function"&&Q.warn(`${t[e]} is not a function`),r[p.inputEvents][e]=t[e]})},Jn=(r,t)=>{r[p.routes]=[],Object.keys(t).forEach(e=>{r[p.routes][e]={...t[e],options:{inHistory:!0,...t[e].options}}})},ea=(r,t)=>{r[p.watchKeys]=[],r[p.watchers]={};for(let e in t)typeof t[e]!="function"&&console.warn(`${e} is not a function`),r[p.watchKeys].push(e),r[p.watchers][e]=function(s,i){t[e].call(this,s,i)}};let ta=0;function sa(r,t){return r[p.identifier]=++ta,zi(t.hooks,r[p.identifier]),Kn(r,t.props),t.methods&&jn(r,t.methods),qn(r,t.state),t.computed&&Zn(r,t.computed),t.watch&&ea(r,t.watch),t.routes&&Jn(r,t.routes),t.input&&Qn(r,t.input),r}const ra=()=>$e("Circle",{code:{render:function(t,e,s,i,o,a){const n=[],l={};return n[0]=this.element({parent:t||"root"},e),l.color=e.color,l.w=e.size,l.h=e.size,l.effects=[e.shader("radius",{radius:e.radius})],n[0].populate(l),n},effects:[function(t,e,s,i,o,a){e[0].set("color",t.color)},function(t,e,s,i,o,a){e[0].set("w",t.size)},function(t,e,s,i,o,a){e[0].set("h",t.size)},function(t,e,s,i,o,a){e[0].set("effects",[t.shader("radius",{radius:t.radius})])}],context:{}},props:[{key:"size",default:40},"color"],computed:{radius(){return this.size/2}}});let Bs;const ia=()=>$e("RouterView",{code:{render:function(t,e,s,i,o,a){const n=[],l={};return n[0]=this.element({parent:t||"root"},e),l.w=t.node.width*(100/100),l.height=t.node.height*(100/100),n[0].populate(l),n},effects:[],context:{}},state(){return{activeView:null}},hooks:{ready(){Bs=()=>ks.navigate.apply(this),ks.navigate.apply(this),window.addEventListener("hashchange",Bs)},destroy(){window.removeEventListener("hashchange",Bs,!1)},focus(){this.activeView&&this.activeView.$focus()}},input:{back(){ks.back()}}}),oa=()=>$e("Sprite",{code:{render:function(t,e,s,i,o,a){const n=[],l={};return n[0]=this.element({parent:t||"root"},e),l.w=t.node.width*(100/100),l.h=t.node.height*(100/100),l.texture=e.texture,l.color=e.color,n[0].populate(l),n},effects:[function(t,e,s,i,o,a){e[0].set("texture",t.texture)},function(t,e,s,i,o,a){e[0].set("color",t.color)}],context:{}},props:["image","map","frame","color"],state(){return{spriteTexture:!1}},computed:{texture(){const r="frames"in this.map?Object.assign({},this.map.defaults||{},this.map.frames[this.frame]):this.map[this.frame];if(this.spriteTexture&&r)return this[p.renderer]().createTexture("SubTexture",{texture:this.spriteTexture,x:r.x,y:r.y,width:r.w,height:r.h})}},hooks:{ready(){this.spriteTexture=this[p.renderer]().createTexture("ImageTexture",{src:this.image})}}}),na="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAaMAAAAbCAYAAADRe+BYAAAAAXNSR0IArs4c6QAAGn9JREFUeF7tXQ1UVdWePxcWFg7ZA0sym5n0Tmk1z4+0YeVU4yo1h1jvPVBo1ETU8QvTdJlhsmKpi0he5jyXX0CKIWkpl3OlME3RGcdJixVEas+nJtq0sMwXN/kIgbxn1m+791n/ezifF0hr7lmrVV3O2Wfv/977//v//h/7uKTQFZJASAIhCYQkEJLADZaAy+j9iqIMkCRpliRJGeSeWkmSClwuV25X9VtRlOGSJI3m7wq6bd5Osqa/6OZSSZJKXC4X+h7UpSgKZABZQCbiKuHt4t+dvri8z5GG3E77rChKtCRJ9TY647ht0aaiKJAx5LCK/4Y5m23jneotiqJgvg84eCaYd6Cf4h/xqgo+ZwUO3h1wK5cx1oIYP/5eJUlSrsvl6tRakGUZbYr9tjQpKanL9lmw4w09F5LAzyUBXTDiih3KAspN76pwuVxjgu2koijYzGibbmg0tzQYoOPt5Zv0xydJ0hiXywWlYfviAAE5UBDSPu9YUep1QFEUvAdKWlyOAYPP26c2BhhM25ivXZo+4lWOxx8EGEHRw6iwdXHjQbu26LMwTlJsNUZusrEeHMuC9kGWZRgSYs/VJiUluZ32MXR/SAK/VAkYgREsdKaAKysr58fFxd0Di23Xrl1ScjKMTUl69913906cODHe6cDNFAVvcyAUHCxNO21rGIVv7969ufHx8djQGatWrZIyMq4bmj6frz4mJuYRSZJsMyQNQJS43e4/19bWThk+fPiA/Px8afhwkDpJKikpKUhJSXHEDujY9MDU7XZLtbWsq1BItvrMWQsAQxozZoxUUQEiYHrZapuzAYCcAOWSnJycv2RmZjZThiRJklMZGDIkyHfWLNgskkRkgXVh+g4N0NUuWLCgYN26dcMHDBiQjPUr5qyoqOjttLS0KVYC0syTui/q6+tX9O7duyU6OnoV2h09+rodEexakGUZG4vNnbiWL18uHT9+HCBsay84Gcv/13s9Hs/osLAwlZW7XK6KxMRES8Pa6/Ue4GuLic7v94+ZMGGC5Qb7OeXcXWMrLS3Nd7lcs+zKKtgxdwAjupnPnDlTNHDgwN9RhlRfXy9FR0dDuUsxMTGYDMuJ1GxooAO0eNWgQYNaX3jhhcfnzp2bhHuWLl0q5eayfWd7AyqKoro2uIJ5jr7vwIEDqqKIi4trqKysfJK7VUxlRl1ebW1tX99yyy3tlCFB+aBtroCklJQUS0Wp90L+Hii5ABYaJBhBtowRjBgxQqqqsiSCdsEISpJZIZcuXVp01113PaPHkKyAQmf8umCE9XXu3Dm2zgCoAFZ+YXGYMiS6HjZt2iSnp6eztYVLZ87gVrPFkCjQX758+d0+ffr8k1gP6Oenn34qDRgwgBkQbrfb8VqQZVnIGCyerYX9+/dLeXl5MERuSoYky7JiU/GoLE+r1A2eh4cEIKG7gD0ez4CwsDCsxwD2qygKmGlFUlKSobtUq7A5sLgnTJhgaPDx91EX+i8CjLpqbHSeXS7XCKN5sbkWDG/TAyNVuSckJHyzZ8+evvxpbNoSRVHgDmMmK1d4toFD0wumOGH9wgruBBip7q2YmBgGkiBCXDGiv6qCnj17tlRQUGBrc5PYgJSZmTk1JyfnAd5/LPTZBESowoTV7igeoSiKUEK1ly5dCo+Njf17vKezYERkAU0etAVHjZPm5uaiqKioxylD4uMNun0DgFbnbNq0aXveeustgB8TixVLpOuTsEPMeYqiKFgXTKkQkLM1ZxTkNPuCrf8rV678qVevXi+QfWGrXdxfXl4e3dbWxmJ933zzzbHz588/OnLkSKmpqUlKT0/Hv9U51CjGDq482hZk1aNHjxEJCQlsU3D2JYxB/MRiXTQG6Pf7TRUzna9uBCPxmg5xM1mW1bVhovxKkpKSdI0MPTAqLi6WvF6voWGt907OWtGFTu2vzipw+nx3jU0wo6+++qpu0aJF/bg+cURC7IxTD4xUK5goRNUipco9JSUFbgks9Bg7L9MBo+EbN24M7wwzIm3S4K+qCKgSIcpphB12xNumSQEqkFElDTYHVgewtmtp42ZqbX/99dfTzp07VzBq1KiIToCRaii4XOrUOhlrh2mk8nv66acr9u/fL+JatpWtk7VBmaLf778QHh5+O2cKtli4jvGB17O+0jkrKCiQYJzYnTMKcnpuQ+pqdWL0cJBQFeybb7557Nq1a4/OmTOHiS0vLw8MKYBpERYlaS1VjbsvNykpiS1MCyWOdc1csMGCUVKSSkDNprvW6/XWCncXUejqM2PHjpXE2PFjdXX10uzsbOYu0Shb39mzZ7MyMjL+BkYt5mTKlCnS4MGDWVunTp0qy8zM/IO2M3oKGyx8yZIlbNvpGTuyLMNFfd0nz69fChh18dgoE+6UXtFbJHpgpDINsulU9DfY7EF3jG7iYNx0ZFA0AQDg6KOK7erVqy2RkZGR/H4nihRgdD14cZ1xCaUGxT/A7/dfue+++27n8R1bCpMDEdoVcRgE1OH2SxaxhyCZEZMBxrpt27ZIEXPhfQdQMjeGQ3BgG7G9vb0pPj4+Cm2KuCFvJ6ikE6M+0PWgcbPZskDpnGNOYDBVVVWNURQFCheGFlMqRL625syAcdF9gTXCKD5Zx7b2hVB2iqL8MHXq1N+gjW3btjERcWWCdQdFyRiO1+udxfsjcateBSuakQcFi+fvvffeD9asWSPiu779+/e/lZeX9wRkAcUPABDX3Llz4Yo1VMx03igz6iowQvsUkI4fPy4tX76csU8Kwh6PZ/uOHTsm0/5ERUVJGzdulPBvXDNmzCjz+XwBgETBCOOMjY1l93JZdfDyeL3e4YqisKSgpqam+qioKGZ43+xg1E1jE8aurT3jRM/gXrtgpFoMBmDEXHhOX86Vst4mDtb1F9AFatVv3br18PTp0/+F32BLsdHGqDIiv1ekpqZuKy4uvq45rrs8bGV9kb75EhMTs3bv3r2OxreCBCM1wG4yFylOUpAVRWHWUEtLy9XIyMhbDdqtgoUezPxrn1EUhY0BivmOO+6Q6uvroZxtuVZFW8gqrKurK+vXrx9cCtqrdv369fnz588XSQG24jt03RNWRfeFyswJGFkaPVTZnT9//sTixYt/iw5v2LDhWN++fR8lilJti7riuLJWvRMiI6+xsVEFtldffbXsgQce+D3a2rdvn1xQUBBAY15//XUGzri6AIwMy0XQPo0ZGSl0Oj64KlNTU/FoCgdaxuBIP1WXPH7Pz88vvfPOO9n4Vq9eLR09ejRgT1Iw8nq9UmJiIhs3/ru4uBhuy4B1TMF93759344bN+4u3K/Xd85KA8oJYPwhlkXjWBp21sHVKsuyuo9RNpGYmGjL9d9dY6P9SUpKYvNL3cUYn6IoyHjNQKID2XCOyhO6CowsN52RoupCZhTwCtruTz/9VBMREYFYDNhIUG5FPTACW5gxY0ZzcXExzCu0i4VsmflG3UU8KwtZXQOqq6svDRs2jJlqQYIR3D0Zp0+fDp88eXKvqqoq9KkkIyNjFjILcTU3N7c9+eSTz1ZWVu62Ag9t7RMSItLT05EEMn7o0KGLNm/eHC+y04LNrqR9oG7L3bt3y4mJiUJpOlpfkK/f738zLCzsXu0YwWRnzpz5fWFhocgMtIxDoQ1togkHHGbUUKMH9zph+FTZbdiwofbgwYPol2/Lli0ro6Oj/8NIUVKWAGXd1NQ0AgpVWPFQnAUFBVCcPlmWsSYZI+T34j9VJU4B4mYAI3ROh3VV8PExNzF3XzKQ0jGEsc9pUhDzlHAlqmbTgVUOGTKEufbAJDB2vofVxAkB7j/88EPF+++/PxquQD0wEnEVkz0VoJg196t/o6wX4zKKfem9h4JRV47NCox4yAPrtkMpEIBq/PjxtrJsf5VgpEnv9Y0cOXLXsWPHhEA6y7ryR48ezZS7UMRz5sw5kZ+fD3eAJRBxxSYsHzAKUF6AiK+xsfHPUVFR/xwsGJEF2oEh0VRpriwt2SwFI7i8kLDiu54hwhYdssfgBsLFs8g6WJZWgKcBI9XVOnDgwK/PnDnzt1yJqC4qq/ZorVVTU9Op+Ph46ciRIw+gr5CBcIOmpqZeKi4uRualbbclBUudfqhxFx4zYrhklZYtlJ3f729IS0vrBSYAJVReXj5bJDUQdqC6/ajS4gxgqSzLeJZZHcJFB9esLMvMWqVsScTRONipacs3AxhRpUpiHj6v17tUuCcJIBkZE2r8lAKWVmE3NzerMSrOdlQmRe997733Prxy5crTemDk9XrB5JmLFvt50aJF2y9cuBDvdruTX3zxRdUVuGrVqvmVlZXrcR/YX0tLy/+Gh4dHYX7nzZt34Z133nm4ra1NgKjv+eefb7p48SL2AC5Lg6w7xob9oQEj1hmPx+MOCwtTMwyPHj0qFRYWFtXX168cMWLE6wsWLEgS7tL09PQV33777XKrvfurAyNt4eeMGTNyCgsLl3FBdEpZ8jbYIqeK+LPPPrv28MMPT7TjqqTunldeeSU9Ozt7I28XGw1WH7P8gmFGZLIZQ+LgiEVcpRO8D4hD6C0UCkaaFGvIkbXb0tJy4tZbb/1HPM8z+CwVsMG71DTv48ePVwwZMkQkSjhqj9aGpaamphYXF2MTMBZEU8YvXLjg79+//7/ZmTPa39OnT//hiy++2JmYmNgDv6N+LTo6+mVaxE3S6k37TpMNvvzyy7+89NJLg/i7mKFA2Y/W5URdWTwFvMrr9SJOOhqxjdTUVJFUBPcWq186ffp0w8svv9yLv0NlC13BjEwUTYAbyspNx2WCPcYMHsKAmK7XnFIhtbe3/xgREbHS7/eXmKVni/5pXVlgW1u2bGmJiIiI1KbSE/biS01NdT333HO/EfE16qaTZRl9ZWtsyZIlQ8+dO4d1xS64AQWA8bGoa4IaFHh3ZGTk3scff/xf8dwnn3wi5+bmCs+ArcSo7hibHTAirBJ6gTEkjFm4QPnatXSH282m040Z8Ww6W6httFi70k2nPTli/fr1GSQ2YNuNZoXg4u/Nzc0Xe/bsyVLfefaaKdtwcFyP2oUDBw6kjh07tthun0zkjEXCLJmSkhIW2Ley3Gl/CRiBAcBCZ24PnSwzR/Ed0V/aTkpKSnVJScnD/G+23GikHRbjunr1al1kZKSIGang2djY+D8a9mnJEHVk2qFAVRSEX7lyBSAXxksMTK1ZCjZW8wvLc/Xq1QEuZvG8SAEXSQ8ffPDBic2bNyP2xO4XLi+iNALm6EaBkdWYz58/v3Px4sXP8vtUQ3LatGn5Dz744CwR5yLtwNNQYBZjoQqbg4/0xhtvnOjfv/9vCQNl7lfBWuvq6vbMnz//GZrsYRDvUuPfnHGneL3eZE2yCbqrrumdO3f+V0REhIhls6EoinJh/PjxIovUtt7qrrFZMSMetxTTwEpfOBtnLJ0YFKoBpDf3pnVGBGwoGKmp38QCtKSQ3Q1G3IpH1guzqD766KOcxx57TDAi/GQrs4koNXFmHn4S7rSAYYhgOwEjU+alc/6c1X5Ehp0tMOLMR6Sf4rimgIJBg7RmS2uFxyCG8yJn9Dcgk4YyEVLbZLrotIOmcvnuu++qY2NjBRBZ9k+nLQZGFy9ebOnXr5/InqTrV5stGhR4kvMUkylLPnLkSOUTTzyBgljTNaepB7JcB7iBx3tU8KTMCjECYYFnZGQ0nD17FgyIyY+mJvM2AuawK8DIRjYdk7PNotdcj8fTtmPHjudJHEKrY5DOnYF4Dyxw4RLie7EiIiIiRdRXUeHqKewJEyaUTZo0iSV4CCtelmXIiDHKDRs27Dl48OAz8+bNa33qqaduwW96YJSVlfV2bGxsXN++ff9Bb0J55iP+pI6FJrCIZwoLCzeXl5f/O/9/256B7hqbAzBS9xItJbCI76miMj2BwSBriJ2fxY/XUV0BTt0dROl3OptOe2bY559/vm7o0KGIB4iAWjDZc1Ds4py3DmfxUQV64sSJ1sGDB7NFqpehqLMwdQ80NcimE4+bjkETz+hwRhplHiTAbkn/deq0VEWmiSn91e1238E765TNqP7911577ciyZctQWIsrmHlTa0K4q5PWhqmB7aampvbbbruN1XTZKaY1QwsKyMOGDfugpqYGadSmblC6WQmT6fAa6u7gykydMw5oLMYAqx4KuaGhoTYtLU0kZwgLX83044ohAIApWHVBzMhIVB3ASK/OyOBhoyxVcTDycIASAFHUGV2+fPnU7NmzH9S2p6eweVwNbUULBsrBCL/5ONBG5+Tk1A4aNIjJloJReXl5VVtbG4ycgFok7bsJGAUADJU/Ya943JGh1B1js+OmI8xI1Q0GYGRKWozOplM3NGdH4vQFlRWtXbv2xMKFC1kaqlPWQSeps2467blptbW1f3S73TNNLCozvRLwN8p8uMWbybOnsOigQNniW7hw4V/Xrl0rFLFpait/geoyoy/sDBihHdpfnt32Co8XqUWVyACMjY2N4m4kS+ZBs8jwzMSJE5s+/PDD2zgQqXU7mZmZp8gpFbaZEW2fH7skArZB1TLQmByy/yZNmoREiL/j71EPevV4PHXJycnCjecIPMWcaU9z52vvJf53U9lSBUSSDTqsTQAqUq9xkWC+Kl+tq+/QoUOH169fD7eP6tKjabgALQDS0aNHWRvaLDAKRvw5duaV3llsBnVGwaR2G+1JgBDWgVWSifBiZGzatCla1A5lZWVVnjx5cpxwKeMlVGETJYokD8iLHWQJGWzatIn1iRfPMta0devW6ttvv52xdgpGpaWlySKlGQkMa9asOYWkGbBnWjOlB0Z6ZxISJuHIGOuOsd0MYIQiR/gyr1ePdbzAFLAAYGk6Qm9tU10ARnaOB1Ff6yJHE1ihEmJQ165dOxQeHi6Cvh0eqaury7/nnntEpl6nEiSohR1MAgP629TUtCcqKup6JV/Hy5eQkPCfe/bsEYFRWy4Aq1O2OyMDCh55eXmVc+fOFS6uzrh+aSZVBym0trYevvvuu4fwGiZHqf4mspjtcrlgSYvEC0OAo66Z77//vm7mzJkCFHXnQwe41Pu0yoy46ALYhCZl2HDpUzAqLS1V60b0UnS7EIwsla5mnIYpz+vWrSvv168fOz6KK/UAo8ZIYXu9XtTKME8IQEowrJUrV1bU1NRgTpHNJxKBAsBIlmVWAI9n09LSahoaGoYKAdsAI5H56vvxxx979ezZM1xk1zU2Nva30lH0790xthsORhggLN+cnJz/XrZsGS0cFN8zAhBdP77bRvqqmUBvZjDicohesWLFl1OmTIlBbIBcBTt27KiZPHnyDELPg1ag/F16p184strBANDfBQsWxCB7jFxLR40aFXP48GFhuVtm09GHy8rKhp09e/bo4sWLaeFrRWVlZVlcXFxaMDKgrKgzRa566ys7O/vtuLi4ySKVm99TVV9fX967d2+kzwvQsGSHtH0NGDGr3e12R+I0d3JmnynIUzZSWlpat337drHHdOOa1OUhMudEcSZ11RHmhC53UPBZWVlTwsLCtglFC5der169cIIGTnRg8jBiRgZFnurxMCRmFAwzsgQjTYzN16NHD7deTIjGpHj8B8NS5WqgsBlg0dgIHmpvbz/57LPPskxRpOhzI4LJSZNNB8Yd3dra2jpx4kThrkebSLfH/SyQr2VGdF5ramq2f/zxx5PFUUh8nh3pk+4Y200BRnwCADqm3zVyemq3CTDRTBRbFrumLUcMyWZsR7zCSg5ssdo9fcEMnPnf6NFGjsCIzBs2iNF3mNj3nRyczye6bPVRvM7IgM5fMPOvJ1ZThiQynqgbx8bcWMnCiQKhcUk7rJqekaYFLno2oxnbo/uMjYWewECKYum6o3KkRw/9bGCEflLlDeA9dOjQsb17947E3wBWra2tq4S7rKGhgdVt8clS58RCYQfokLKysi+LiopEMgKKilfpnKsHEINMmXFOAAdZjAEfYaRg5PF4SkidTu3UqVPDGhsb783Ly/P36dMnDG1xlovCbXHQrehfLXebBtQ1dsfYuhqMPB5PBf+EB3RTQCGw3fiG9rh2xpCsCvocbGzcejODEfonzqjTfvEVckBQ2cqv7UQcnQUj2l8sYEqR2Jdv7Rbo6nRa7wvAGLuQg5NxintpxbwjxmbjZVi7mDP64UIofsigM98JosAs4hqQAVMcNi+q5O0AMFWWWkZH+9PBKOBuLgT5MW7ci7ZGI74i4iN1dXUN8+fPFwqcghFtW2UxP6ebTshz+/btf4qMjGSno5tcvqysrLMnT54ULl81A9FMYWs/FUGAmRkKRjVSvL7LyGhXi6H5kUPo9lKv1ztaABs9oikhIWHz9OnTWSYdZ7oU/E2PCeqOsXU1GPFTNMSHUANq0OyAkc19FbotJIGQBG5GCXAlK8oe6NEzOARUTcQpKir6qqysjH3ChJ/EbwqsNwKM0LGHHnoo9/77739Jm9INpt/Y2Fg+depU1P6JM9ICYtpmChttC8DR1M4wQ8GsYBcyrqqqOvDII48wb0R7ezsKaVf06NGjQJykITLlZs2aJY8bN47FbTWuQFbD5/V6dwmg4myKsWDBDFHUvGTJkphLly7hfhgHjCF119gcpHZbZtNRZrRz5876nTt3IpGGyTcERjej9gj1KSSBLpQAXFjt7e2qgtNruqGh4d20tDRxcoAdlyFthn5awK5OoezfMmak02fqljSSlpk7Wsts6fd5tNmu2uxQo76bufNVhqRx6dO2qIuX9k87H/S4Lz23cHeMjZE14voX80xlpZcBS9k87Sv1hDGDwe7C6cKtEWoqJIGQBG6EBHJzc5+vr69/Iy4ujh1lxK+S6urqquzsbLgzRZ2Mk7gXmrkRYIT3QhGKWiPqirbjhjVT2GhbgISegjUDUvQJCph+dgZuU7jb2AcUSQYyVch6BgB9D3XjqrEjyozInHbX2LoSjCAnjI/FjkLM6EZohNA7QxK4cRKAwlZrrQy64Si78MYNJfTmX5sEQszo1zajofGEJGAtAfHNHVGegSeQ2CD+sW4hdEdIAl0sgRAYdbFAQ82FJBCSQEgCIQk4l0AIjJzLLPRESAIhCYQkEJJAF0vg/wBMng85iZWBHAAAAABJRU5ErkJggg==",aa=()=>$e("FPScounter",{code:{render:function(t,e,s,i,o,a){const n=[];let l;const c={};n[0]=this.element({parent:t||"root"},e),n[0].populate(c),t=n[0];const h={};n[1]=this.element({parent:t||"root"},e),h.y=15,h.x=20,n[1].populate(h),t=n[1];const d={};n[2]=this.element({parent:t||"root"},e),n[2].populate(d);const u=s.components&&s.components.Sprite||i.Sprite;t=n[2];const x={};n[3]=this.element({parent:t||"root"},e),x.image=e.image,x.w=43,x.h=25,x.map=e.sprite,x.frame="fps";const m=[];if(typeof u<"u")for(let B in u.config.props)delete x[u.config.props[B]],m.push(u.config.props[B]);n[3].populate(x),t=n[3];const g={};g.image=e.image,g.w=43,g.h=25,g.map=e.sprite,g.frame="fps",l=g.is||"Sprite";let b;if(typeof l=="string"){if(b=s.components&&s.components[l]||i[l],!b)throw new Error('Component "Sprite" not found')}else typeof l=="function"&&l.name==="factory"&&(b=l);n[4]=b.call(null,{props:g},n[3],e),n[4][Symbol.for("slots")][0]?(t=n[4][Symbol.for("slots")][0],e=n[4]):t=n[4][Symbol.for("children")][0],t=n[2];const T={};n[5]=this.element({parent:t||"root"},e),T.x=58,T.y=2,n[5].populate(T);const _=s.components&&s.components.Sprite||i.Sprite;t=n[5];const C={};n[6]=this.element({parent:t||"root"},e),C.image=e.image,C.x=0,C.h=20,C.w=20,C.map=e.sprite,C.frame=e.fps[0];const S=[];if(typeof _<"u")for(let B in _.config.props)delete C[_.config.props[B]],S.push(_.config.props[B]);n[6].populate(C),t=n[6];const P={};P.image=e.image,P.x=0,P.h=20,P.w=20,P.map=e.sprite,P.frame=e.fps[0],l=P.is||"Sprite";let G;if(typeof l=="string"){if(G=s.components&&s.components[l]||i[l],!G)throw new Error('Component "Sprite" not found')}else typeof l=="function"&&l.name==="factory"&&(G=l);n[7]=G.call(null,{props:P},n[6],e),n[7][Symbol.for("slots")][0]?(t=n[7][Symbol.for("slots")][0],e=n[7]):t=n[7][Symbol.for("children")][0];const I=s.components&&s.components.Sprite||i.Sprite;t=n[5];const L={};n[8]=this.element({parent:t||"root"},e),L.image=e.image,L.x=18,L.h=20,L.w=20,L.map=e.sprite,L.frame=e.fps[1];const F=[];if(typeof I<"u")for(let B in I.config.props)delete L[I.config.props[B]],F.push(I.config.props[B]);n[8].populate(L),t=n[8];const M={};M.image=e.image,M.x=18,M.h=20,M.w=20,M.map=e.sprite,M.frame=e.fps[1],l=M.is||"Sprite";let y;if(typeof l=="string"){if(y=s.components&&s.components[l]||i[l],!y)throw new Error('Component "Sprite" not found')}else typeof l=="function"&&l.name==="factory"&&(y=l);n[9]=y.call(null,{props:M},n[8],e),n[9][Symbol.for("slots")][0]?(t=n[9][Symbol.for("slots")][0],e=n[9]):t=n[9][Symbol.for("children")][0];const z=s.components&&s.components.Sprite||i.Sprite;t=n[5];const N={};n[10]=this.element({parent:t||"root"},e),N.image=e.image,N.x=36,N.h=20,N.w=20,N.map=e.sprite,N.frame=e.fps[2];const V=[];if(typeof z<"u")for(let B in z.config.props)delete N[z.config.props[B]],V.push(z.config.props[B]);n[10].populate(N),t=n[10];const A={};A.image=e.image,A.x=36,A.h=20,A.w=20,A.map=e.sprite,A.frame=e.fps[2],l=A.is||"Sprite";let v;if(typeof l=="string"){if(v=s.components&&s.components[l]||i[l],!v)throw new Error('Component "Sprite" not found')}else typeof l=="function"&&l.name==="factory"&&(v=l);n[11]=v.call(null,{props:A},n[10],e),n[11][Symbol.for("slots")][0]?(t=n[11][Symbol.for("slots")][0],e=n[11]):t=n[11][Symbol.for("children")][0],t=n[1];const R={};n[12]=this.element({parent:t||"root"},e),R.x=150,n[12].populate(R);const O=s.components&&s.components.Sprite||i.Sprite;t=n[12];const k={};n[13]=this.element({parent:t||"root"},e),k.image=e.image,k.y=2,k.w=48,k.h=25,k.map=e.sprite,k.frame="avg";const D=[];if(typeof O<"u")for(let B in O.config.props)delete k[O.config.props[B]],D.push(O.config.props[B]);n[13].populate(k),t=n[13];const X={};X.image=e.image,X.y=2,X.w=48,X.h=25,X.map=e.sprite,X.frame="avg",l=X.is||"Sprite";let U;if(typeof l=="string"){if(U=s.components&&s.components[l]||i[l],!U)throw new Error('Component "Sprite" not found')}else typeof l=="function"&&l.name==="factory"&&(U=l);n[14]=U.call(null,{props:X},n[13],e),n[14][Symbol.for("slots")][0]?(t=n[14][Symbol.for("slots")][0],e=n[14]):t=n[14][Symbol.for("children")][0],t=n[12];const W={};n[15]=this.element({parent:t||"root"},e),W.x=63,W.y=2,n[15].populate(W);const q=s.components&&s.components.Sprite||i.Sprite;t=n[15];const H={};n[16]=this.element({parent:t||"root"},e),H.image=e.image,H.x=0,H.h=20,H.w=20,H.map=e.sprite,H.frame=e.avgFps[0];const Z=[];if(typeof q<"u")for(let B in q.config.props)delete H[q.config.props[B]],Z.push(q.config.props[B]);n[16].populate(H),t=n[16];const K={};K.image=e.image,K.x=0,K.h=20,K.w=20,K.map=e.sprite,K.frame=e.avgFps[0],l=K.is||"Sprite";let Y;if(typeof l=="string"){if(Y=s.components&&s.components[l]||i[l],!Y)throw new Error('Component "Sprite" not found')}else typeof l=="function"&&l.name==="factory"&&(Y=l);n[17]=Y.call(null,{props:K},n[16],e),n[17][Symbol.for("slots")][0]?(t=n[17][Symbol.for("slots")][0],e=n[17]):t=n[17][Symbol.for("children")][0];const ee=s.components&&s.components.Sprite||i.Sprite;t=n[15];const J={};n[18]=this.element({parent:t||"root"},e),J.image=e.image,J.x=18,J.h=20,J.w=20,J.map=e.sprite,J.frame=e.avgFps[1];const oe=[];if(typeof ee<"u")for(let B in ee.config.props)delete J[ee.config.props[B]],oe.push(ee.config.props[B]);n[18].populate(J),t=n[18];const j={};j.image=e.image,j.x=18,j.h=20,j.w=20,j.map=e.sprite,j.frame=e.avgFps[1],l=j.is||"Sprite";let De;if(typeof l=="string"){if(De=s.components&&s.components[l]||i[l],!De)throw new Error('Component "Sprite" not found')}else typeof l=="function"&&l.name==="factory"&&(De=l);n[19]=De.call(null,{props:j},n[18],e),n[19][Symbol.for("slots")][0]?(t=n[19][Symbol.for("slots")][0],e=n[19]):t=n[19][Symbol.for("children")][0];const ce=s.components&&s.components.Sprite||i.Sprite;t=n[15];const ie={};n[20]=this.element({parent:t||"root"},e),ie.image=e.image,ie.x=36,ie.h=20,ie.w=20,ie.map=e.sprite,ie.frame=e.avgFps[2];const Ne=[];if(typeof ce<"u")for(let B in ce.config.props)delete ie[ce.config.props[B]],Ne.push(ce.config.props[B]);n[20].populate(ie),t=n[20];const ne={};ne.image=e.image,ne.x=36,ne.h=20,ne.w=20,ne.map=e.sprite,ne.frame=e.avgFps[2],l=ne.is||"Sprite";let he;if(typeof l=="string"){if(he=s.components&&s.components[l]||i[l],!he)throw new Error('Component "Sprite" not found')}else typeof l=="function"&&l.name==="factory"&&(he=l);n[21]=he.call(null,{props:ne},n[20],e),n[21][Symbol.for("slots")][0]?(t=n[21][Symbol.for("slots")][0],e=n[21]):t=n[21][Symbol.for("children")][0],t=n[1];const ze={};n[22]=this.element({parent:t||"root"},e),ze.x=0,ze.y=40,n[22].populate(ze);const ke=s.components&&s.components.Sprite||i.Sprite;t=n[22];const ue={};n[23]=this.element({parent:t||"root"},e),ue.image=e.image,ue.x=-2,ue.w=47,ue.h=25,ue.map=e.sprite,ue.frame="min";const xi=[];if(typeof ke<"u")for(let B in ke.config.props)delete ue[ke.config.props[B]],xi.push(ke.config.props[B]);n[23].populate(ue),t=n[23];const pe={};pe.image=e.image,pe.x=-2,pe.w=47,pe.h=25,pe.map=e.sprite,pe.frame="min",l=pe.is||"Sprite";let _t;if(typeof l=="string"){if(_t=s.components&&s.components[l]||i[l],!_t)throw new Error('Component "Sprite" not found')}else typeof l=="function"&&l.name==="factory"&&(_t=l);n[24]=_t.call(null,{props:pe},n[23],e),n[24][Symbol.for("slots")][0]?(t=n[24][Symbol.for("slots")][0],e=n[24]):t=n[24][Symbol.for("children")][0],t=n[22];const vs={};n[25]=this.element({parent:t||"root"},e),vs.x=58,vs.y=2,n[25].populate(vs);const Rt=s.components&&s.components.Sprite||i.Sprite;t=n[25];const me={};n[26]=this.element({parent:t||"root"},e),me.image=e.image,me.x=0,me.h=20,me.w=20,me.map=e.sprite,me.frame=e.minFps[0];const yi=[];if(typeof Rt<"u")for(let B in Rt.config.props)delete me[Rt.config.props[B]],yi.push(Rt.config.props[B]);n[26].populate(me),t=n[26];const ge={};ge.image=e.image,ge.x=0,ge.h=20,ge.w=20,ge.map=e.sprite,ge.frame=e.minFps[0],l=ge.is||"Sprite";let Ct;if(typeof l=="string"){if(Ct=s.components&&s.components[l]||i[l],!Ct)throw new Error('Component "Sprite" not found')}else typeof l=="function"&&l.name==="factory"&&(Ct=l);n[27]=Ct.call(null,{props:ge},n[26],e),n[27][Symbol.for("slots")][0]?(t=n[27][Symbol.for("slots")][0],e=n[27]):t=n[27][Symbol.for("children")][0];const Et=s.components&&s.components.Sprite||i.Sprite;t=n[25];const xe={};n[28]=this.element({parent:t||"root"},e),xe.image=e.image,xe.x=18,xe.h=20,xe.w=20,xe.map=e.sprite,xe.frame=e.minFps[1];const Ti=[];if(typeof Et<"u")for(let B in Et.config.props)delete xe[Et.config.props[B]],Ti.push(Et.config.props[B]);n[28].populate(xe),t=n[28];const ye={};ye.image=e.image,ye.x=18,ye.h=20,ye.w=20,ye.map=e.sprite,ye.frame=e.minFps[1],l=ye.is||"Sprite";let At;if(typeof l=="string"){if(At=s.components&&s.components[l]||i[l],!At)throw new Error('Component "Sprite" not found')}else typeof l=="function"&&l.name==="factory"&&(At=l);n[29]=At.call(null,{props:ye},n[28],e),n[29][Symbol.for("slots")][0]?(t=n[29][Symbol.for("slots")][0],e=n[29]):t=n[29][Symbol.for("children")][0];const Mt=s.components&&s.components.Sprite||i.Sprite;t=n[25];const Te={};n[30]=this.element({parent:t||"root"},e),Te.image=e.image,Te.x=36,Te.h=20,Te.w=20,Te.map=e.sprite,Te.frame=e.minFps[2];const bi=[];if(typeof Mt<"u")for(let B in Mt.config.props)delete Te[Mt.config.props[B]],bi.push(Mt.config.props[B]);n[30].populate(Te),t=n[30];const be={};be.image=e.image,be.x=36,be.h=20,be.w=20,be.map=e.sprite,be.frame=e.minFps[2],l=be.is||"Sprite";let It;if(typeof l=="string"){if(It=s.components&&s.components[l]||i[l],!It)throw new Error('Component "Sprite" not found')}else typeof l=="function"&&l.name==="factory"&&(It=l);n[31]=It.call(null,{props:be},n[30],e),n[31][Symbol.for("slots")][0]?(t=n[31][Symbol.for("slots")][0],e=n[31]):t=n[31][Symbol.for("children")][0],t=n[1];const _s={};n[32]=this.element({parent:t||"root"},e),_s.x=150,_s.y=40,n[32].populate(_s);const Lt=s.components&&s.components.Sprite||i.Sprite;t=n[32];const Be={};n[33]=this.element({parent:t||"root"},e),Be.image=e.image,Be.w=53,Be.h=25,Be.map=e.sprite,Be.frame="max";const Si=[];if(typeof Lt<"u")for(let B in Lt.config.props)delete Be[Lt.config.props[B]],Si.push(Lt.config.props[B]);n[33].populate(Be),t=n[33];const Oe={};Oe.image=e.image,Oe.w=53,Oe.h=25,Oe.map=e.sprite,Oe.frame="max",l=Oe.is||"Sprite";let Pt;if(typeof l=="string"){if(Pt=s.components&&s.components[l]||i[l],!Pt)throw new Error('Component "Sprite" not found')}else typeof l=="function"&&l.name==="factory"&&(Pt=l);n[34]=Pt.call(null,{props:Oe},n[33],e),n[34][Symbol.for("slots")][0]?(t=n[34][Symbol.for("slots")][0],e=n[34]):t=n[34][Symbol.for("children")][0],t=n[32];const Rs={};n[35]=this.element({parent:t||"root"},e),Rs.x=63,Rs.y=2,n[35].populate(Rs);const Ft=s.components&&s.components.Sprite||i.Sprite;t=n[35];const Se={};n[36]=this.element({parent:t||"root"},e),Se.image=e.image,Se.x=0,Se.h=20,Se.w=20,Se.map=e.sprite,Se.frame=e.maxFps[0];const wi=[];if(typeof Ft<"u")for(let B in Ft.config.props)delete Se[Ft.config.props[B]],wi.push(Ft.config.props[B]);n[36].populate(Se),t=n[36];const we={};we.image=e.image,we.x=0,we.h=20,we.w=20,we.map=e.sprite,we.frame=e.maxFps[0],l=we.is||"Sprite";let kt;if(typeof l=="string"){if(kt=s.components&&s.components[l]||i[l],!kt)throw new Error('Component "Sprite" not found')}else typeof l=="function"&&l.name==="factory"&&(kt=l);n[37]=kt.call(null,{props:we},n[36],e),n[37][Symbol.for("slots")][0]?(t=n[37][Symbol.for("slots")][0],e=n[37]):t=n[37][Symbol.for("children")][0];const Bt=s.components&&s.components.Sprite||i.Sprite;t=n[35];const ve={};n[38]=this.element({parent:t||"root"},e),ve.image=e.image,ve.x=18,ve.h=20,ve.w=20,ve.map=e.sprite,ve.frame=e.maxFps[1];const vi=[];if(typeof Bt<"u")for(let B in Bt.config.props)delete ve[Bt.config.props[B]],vi.push(Bt.config.props[B]);n[38].populate(ve),t=n[38];const _e={};_e.image=e.image,_e.x=18,_e.h=20,_e.w=20,_e.map=e.sprite,_e.frame=e.maxFps[1],l=_e.is||"Sprite";let Ot;if(typeof l=="string"){if(Ot=s.components&&s.components[l]||i[l],!Ot)throw new Error('Component "Sprite" not found')}else typeof l=="function"&&l.name==="factory"&&(Ot=l);n[39]=Ot.call(null,{props:_e},n[38],e),n[39][Symbol.for("slots")][0]?(t=n[39][Symbol.for("slots")][0],e=n[39]):t=n[39][Symbol.for("children")][0];const Ut=s.components&&s.components.Sprite||i.Sprite;t=n[35];const Re={};n[40]=this.element({parent:t||"root"},e),Re.image=e.image,Re.x=36,Re.h=20,Re.w=20,Re.map=e.sprite,Re.frame=e.maxFps[2];const _i=[];if(typeof Ut<"u")for(let B in Ut.config.props)delete Re[Ut.config.props[B]],_i.push(Ut.config.props[B]);n[40].populate(Re),t=n[40];const Ce={};Ce.image=e.image,Ce.x=36,Ce.h=20,Ce.w=20,Ce.map=e.sprite,Ce.frame=e.maxFps[2],l=Ce.is||"Sprite";let $t;if(typeof l=="string"){if($t=s.components&&s.components[l]||i[l],!$t)throw new Error('Component "Sprite" not found')}else typeof l=="function"&&l.name==="factory"&&($t=l);return n[41]=$t.call(null,{props:Ce},n[40],e),n[41][Symbol.for("slots")][0]?(t=n[41][Symbol.for("slots")][0],e=n[41]):t=n[41][Symbol.for("children")][0],n},effects:[function(t,e,s,i,o,a){(typeof skip6>"u"||skip6.indexOf("frame")===-1)&&e[6].set("frame",t.fps[0])},function(t,e,s,i,o,a){e[7][Symbol.for("props")].frame=t.fps[0]},function(t,e,s,i,o,a){(typeof skip8>"u"||skip8.indexOf("frame")===-1)&&e[8].set("frame",t.fps[1])},function(t,e,s,i,o,a){e[9][Symbol.for("props")].frame=t.fps[1]},function(t,e,s,i,o,a){(typeof skip10>"u"||skip10.indexOf("frame")===-1)&&e[10].set("frame",t.fps[2])},function(t,e,s,i,o,a){e[11][Symbol.for("props")].frame=t.fps[2]},function(t,e,s,i,o,a){(typeof skip16>"u"||skip16.indexOf("frame")===-1)&&e[16].set("frame",t.avgFps[0])},function(t,e,s,i,o,a){e[17][Symbol.for("props")].frame=t.avgFps[0]},function(t,e,s,i,o,a){(typeof skip18>"u"||skip18.indexOf("frame")===-1)&&e[18].set("frame",t.avgFps[1])},function(t,e,s,i,o,a){e[19][Symbol.for("props")].frame=t.avgFps[1]},function(t,e,s,i,o,a){(typeof skip20>"u"||skip20.indexOf("frame")===-1)&&e[20].set("frame",t.avgFps[2])},function(t,e,s,i,o,a){e[21][Symbol.for("props")].frame=t.avgFps[2]},function(t,e,s,i,o,a){(typeof skip26>"u"||skip26.indexOf("frame")===-1)&&e[26].set("frame",t.minFps[0])},function(t,e,s,i,o,a){e[27][Symbol.for("props")].frame=t.minFps[0]},function(t,e,s,i,o,a){(typeof skip28>"u"||skip28.indexOf("frame")===-1)&&e[28].set("frame",t.minFps[1])},function(t,e,s,i,o,a){e[29][Symbol.for("props")].frame=t.minFps[1]},function(t,e,s,i,o,a){(typeof skip30>"u"||skip30.indexOf("frame")===-1)&&e[30].set("frame",t.minFps[2])},function(t,e,s,i,o,a){e[31][Symbol.for("props")].frame=t.minFps[2]},function(t,e,s,i,o,a){(typeof skip36>"u"||skip36.indexOf("frame")===-1)&&e[36].set("frame",t.maxFps[0])},function(t,e,s,i,o,a){e[37][Symbol.for("props")].frame=t.maxFps[0]},function(t,e,s,i,o,a){(typeof skip38>"u"||skip38.indexOf("frame")===-1)&&e[38].set("frame",t.maxFps[1])},function(t,e,s,i,o,a){e[39][Symbol.for("props")].frame=t.maxFps[1]},function(t,e,s,i,o,a){(typeof skip40>"u"||skip40.indexOf("frame")===-1)&&e[40].set("frame",t.maxFps[2])},function(t,e,s,i,o,a){e[41][Symbol.for("props")].frame=t.maxFps[2]}],context:{}},state(){return{image:na,sprite:{defaults:{y:1,w:20,h:20},frames:{"-":{x:-1e3},0:{x:1},1:{x:23},2:{x:45},3:{x:67},4:{x:89},5:{x:111},6:{x:133},7:{x:155},8:{x:177},9:{x:199},avg:{x:221,w:48,h:25},fps:{x:271,w:43,h:25},max:{x:316,w:53,h:25},min:{x:371,w:47,h:25}}},fps:"---",avgFps:"---",minFps:"---",maxFps:"---"}},hooks:{ready(){let r=1e4,t=0,e=0,s=0,i=0;St.on("fpsUpdate",(o,{fps:a})=>{r=Math.min(a,r),t=Math.max(a,t),s+=a,i++,e=Math.round(s/i),this.fps=a.toString().padStart(3,"0"),this.avgFps=e.toString().padStart(3,"0"),this.minFps=r.toString().padStart(3,"0"),this.maxFps=t.toString().padStart(3,"0")})}}}),la=()=>$e("Layout",{code:{render:function(t,e,s,i,o,a){const n=[],l={};return n[0]=this.element({parent:t||"root"},e),l[Symbol.for("isSlot")]=!0,l.ref="slot",n[0].populate(l),n},effects:[],context:{}},props:["direction",{key:"gap",default:0}],hooks:{ready(){this.___layout()}},methods:{___layout(){let r=0;this.$select("slot").children.forEach(t=>{t.set(this.direction==="vertical"?"y":"x",r),r+=(t.node[this.direction==="vertical"?"height":"width"]||0)+(this.gap||0)})}}}),fa=()=>({Circle:ra(),RouterView:ia(),Sprite:oa(),FPScounter:aa(),Layout:la()}),ca={name:"log",plugin(){return Ur("App")}},Js={log:ca},gi=(r,t="",e={})=>{let s;if(typeof t=="object"?e=t:s=t,typeof r=="function"){if(s===void 0)throw Error("Error registering plugin: name is required for plugin");Js[s]={plugin:r,options:e}}else r.plugin&&gi(r.plugin,s||r.name,e)};let Os;const Br=r=>{throw new Error(`Parameter ${r} is required`)},$e=(r=Br("name"),t=Br("config"))=>{let e;const s=function(o,a,n,l){this.componentId=$i(r),this.lifecycle=Object.assign(Object.create(Vi),{component:this,previous:null,current:null}),this.parent=n,this.rootParent=l,this[p.holder]=a,this[p.id]=Di(),this[p.props]=ur(o.props||{},fe.get("reactivityMode")),this[p.timeouts]=[],this[p.intervals]=[],this[p.originalState]={...t.state&&typeof t.state=="function"&&t.state.apply(this)||{},hasFocus:!1},this[p.state]=ur(this[p.originalState],fe.get("reactivityMode")),this.lifecycle.state="init",this[p.children]=t.code.render.apply(ar,[a,this,t,Os,Xt,Qe])||[],this[p.wrapper]=this[p.children][0],this[p.slots]=this[p.children].filter(h=>h[p.isSlot]),t.hooks&&(t.hooks.frameTick&&St.on("frameTick",(h,d)=>Us("frameTick",this[p.identifier],this,[d])),t.hooks.idle&&St.on("idle",()=>{Us("idle",this[p.identifier],this)}),t.hooks.attach&&this[p.wrapper].node.on("inBounds",()=>{this.lifecycle.state="attach"}),t.hooks.detach&&this[p.wrapper].node.on("outOfBounds",(h,{previous:d})=>{d>0&&(this.lifecycle.state="detach")}),t.hooks.enter&&this[p.wrapper].node.on("inViewport",()=>{this.lifecycle.state="enter"}),t.hooks.exit&&this[p.wrapper].node.on("outOfViewport",()=>{this.lifecycle.state="exit"}));const c=t.code.effects;for(let h=0;h<c.length;h++)Xt(()=>{c[h](this,this[p.children],t,Os,l,Xt)});return this[p.watchers]&&Object.keys(this[p.watchers]).forEach(h=>{let d=this,u=h;if(h.indexOf(".")>-1){const m=h.split(".");u=m.pop();for(let g=0;g<m.length;g++)d=d[m[g]]}let x=this[u];Xt((m=!1)=>{const g=d[u];(x!==g||m===!0)&&(this[p.watchers][h].apply(this,[g,x]),x=g)})}),Object.getOwnPropertySymbols(this).forEach(h=>{Object.defineProperties(this,{[h]:{enumerable:!1,configurable:!1}})}),setTimeout(()=>this.lifecycle.state="ready"),this},i=(o={},a,n,l)=>(ct[p.launched]===!1&&(Object.keys(Js).forEach(c=>{const h=`$${c}`;h in ct&&Q.warn(`"${c}" (this.${h}) already exists as a property or plugin on the Base Component. You may be overwriting built-in functionality. Proceed with care!`);const d=Js[c];Object.defineProperty(ct,h,{value:d.plugin(d.options),writable:!1,enumerable:!0,configurable:!1})}),Os=fa(),ct[p.launched]=!0),e||(Q.debug(`Setting up ${r} component`),e=sa(Object.create(ct),t)),t.code||(Q.debug(`Generating code for ${r} component`),t.code=Pi.call(t,Li(t.template))),s.call(Object.create(e),o,a,n,l));return i.config=t,i},ha=r=>{const t={ArrowLeft:"left",ArrowRight:"right",ArrowUp:"up",ArrowDown:"down",Enter:"enter"," ":"space",Backspace:"back",Escape:"escape",37:"left",39:"right",38:"up",40:"down",13:"enter",32:"space",8:"back",27:"escape"};r.hooks=r.hooks||{};let e,s,i;return r.hooks[p.destroy]=function(){document.removeEventListener("keydown",e),document.removeEventListener("keyup",s)},r.hooks[p.init]=function(){const o={...t,...fe.get("keymap",{})};e=a=>{const n=o[a.key]||o[a.keyCode]||a.key||a.keyCode;Ie.input(n,a),clearTimeout(i),i=setTimeout(()=>{Ie.hold=!0},fe.get("holdTimeout",oi))},s=()=>{clearTimeout(i),Ie.hold=!1},document.addEventListener("keydown",e),document.addEventListener("keyup",s),setTimeout(()=>Ie.set(this))},$e("App",r)},cr={Component:$e,Application:ha,Launch:En,Plugin:gi},da=()=>"0x"+Math.floor(Math.random()*16777215).toString(16)+"FF";function ht(r,t){return Math.floor(Math.random()*(t-r+1))+r}const ua=600,pa=800,ma=cr.Component("Home",{code:{render:function(t,e,s,i,o,a){const n=[],l={};n[0]=this.element({parent:t||"root"},e),l.w=1920,l.h=1080,l.color="0xf0f0f0ff",n[0].populate(l),t=n[0];const c=[],h=(d=[],u,x)=>{const m=a(d),g=new Set;let b=m.length;for(;b--;){const C=m[b];g.add(""+C.key)}let T=x.length;for(;T--;)if(g.has(x[T])===!1){const C=x[T];u[1][C]&&u[1][C].destroy(),delete u[1][C]}x.length=0;const _=m.length;for(let C=0;C<_;C++){const S=Object.create(e);t=u[0],S.index=C,S.item=m[C],S.key=""+S.item.key,x.push(S.key),t=u[0],u[1]===void 0&&(u[1]={});const P={};u[1][S.key]===void 0&&(u[1][S.key]=this.element({parent:t||"root"},e)),P.w=S.item.width,P.h=S.item.height,P.x=S.item.x,P.y=S.item.y,P.color=S.item.color,P.effects=[{type:"radius",props:{radius:S.item.radius}}],u[1][S.key].nodeId===void 0&&u[1][S.key].populate(P),o(()=>{u[1][S.key].set("w",S.item.width)},null),o(()=>{u[1][S.key].set("h",S.item.height)},null),o(()=>{u[1][S.key].set("x",S.item.x)},null),o(()=>{u[1][S.key].set("y",S.item.y)},null),o(()=>{u[1][S.key].set("color",S.item.color)},null),o(()=>{u[1][S.key].set("effects",[{type:"radius",props:{radius:S.item.radius}}])},null)}};return o(()=>{h(e.items,n,c)},"items"),n},effects:[],context:{}},state(){return{items:new Array}},hooks:{init(){setInterval(()=>{const r=[];for(let t=0;t<1e3;t++)r.push({key:t,width:ht(50,100),height:ht(50,100),x:ht(0,pa),y:ht(0,ua),radius:ht(0,50),color:da()});this.items=r},2e3)}}}),ga=cr.Application({components:{Home:ma},code:{render:function(t,e,s,i,o,a){const n=[];let l;const c=s.components&&s.components.Home||i.Home,h={};n[0]=this.element({parent:t||"root"},e);const d=[];if(typeof c<"u")for(let m in c.config.props)delete h[c.config.props[m]],d.push(c.config.props[m]);n[0].populate(h),t=n[0];const u={};l=u.is||"Home";let x;if(typeof l=="string"){if(x=s.components&&s.components[l]||i[l],!x)throw new Error('Component "Home" not found')}else typeof l=="function"&&l.name==="factory"&&(x=l);return n[1]=x.call(null,{props:u},n[0],e),n[1][Symbol.for("slots")][0]?(t=n[1][Symbol.for("slots")][0],e=n[1]):t=n[1][Symbol.for("children")][0],n},effects:[],context:{}}});cr.Launch(ga,"app",{w:1920,h:1080,inspector:!1,multithreaded:!0,debugLevel:1,fonts:[{family:"lato",type:"msdf",file:"fonts/Lato-Regular.ttf"},{family:"raleway",type:"msdf",file:"fonts/Raleway-ExtraBold.ttf"},{family:"opensans",type:"web",file:"fonts/OpenSans-Medium.ttf"}]});
